// =================================================================================================
// eModbus: Copyright 2020 by Michael Harwerth, Bert Melis and the contributors to ModbusClient
//               MIT license - see license.md for details
// =================================================================================================
// Includes: <Arduino.h> for Serial etc., WiFi.h for WiFi support

// https://download.mikroe.com/documents/add-on-boards/click/4-20ma/4-20ma-click-manual-v100.pdf
// https://researchdesignlab.com/4-20ma-current-loop-transmitters.html
    

 //http://www.sinneb.net/2010/06/mcp4921-12bit-dac-voltage-controller


 // 16 bit   12bit garantiert  AD5662  
 // 16 bit                     DAC80501 15.5€/7.8     DAC8531 6.3€/9.1       AD5683R 5.4€/8.2       AD5693 4.3€/8.2


 // AD5683R 5.4€/8.2      14-bit AD5682R,  AD5683R 16-bit
 // https://github.com/PatrickBaus/AD568xR


 // AD5693 4.3€/8.2   83=SPI   93=I2C
 // https://github.com/ControlEverythingCommunity/AD5693


 //-----------------------------------------------------------------------
 // Bei Platine  V5 ist PIN_AI_VSS noch auf Pin 17  GPIO 14  ADC16
 // Ab  Platine  V6 ist PIN_AI_VSS auf      Pin 18  GPIO 12  ADC15   

 // Ab  Platine  V6 ist 4-20mA CS  auf      Pin 17  GPIO 14  SS/CS    und   PIN_AI_VSS  auf  ADC2_CH2   GPIO 02  PIN 22

         
 //-----------------------------------------------------------------------

  //  GPIO 15      SS    CS       PIN 21        -    GPIO 05   PIN 34    
  //  GPIO 14      SCK   SCK      PIN 17        -    GPIO 18   PIN 35     I2C_SDA_PIN   18
  //  GPIO 12      MISO           PIN 18        -    GPIO 19   PIN 38  
  //  GPIO 13      MOSI  SDI      PIN 20        -    GPIO 23   PIN 36     I2C_SCL_PIN   23 
  //      #define I2C_SCL_PIN   23 
  //      #define I2C_SDA_PIN   18

 
  //  GPIO 33  PIN 13   U1RXD  FAN 
  //  GPIO 26  PIN 15   U1TXD  FAN


  //  GPIO RX  PIN 40   U0RXD  Programmport 
  //  GPIO TX  PIN 41   U0TXD  Programmport

  //  GPIO 22  PIN 39   SCL  
  //  GPIO 21  PIN 42   SDA         
  //  GPIO 23  PIN 36   Wakeup

  //  GPIO 18  Pin 35   SERIAL2_RXPIN   RXD2        GPIO16  PIN25       gelb     
  //  GPIO 19  Pin 38   SERIAL2_TXPIN   TXD2        GPIO17  PIN27       grün    

  //  GPIO 32  Pin 12   LED RGB

  //  GPIO 35  Pin 11   LED or Normal_version   // Pin   

  //  GPIO 39, ADC1_CH3,PIN 8            PIN_AI_VSS                      
  //  GPIO 38, ADC1_CH2,PIN 7            PIN_AI_VCAPA   

  //  GPIO 04  Pin 24   Relais   relaisIN1

  //  Modbus TCP Server(Slave) stellt Daten bereit,  die vom Client(Master) abgeholt werden 


//#define PCB_v_5
#define PCB_v_7  // 4_20_mA


//-----------------------------------------
#define ESP32_PiCO
#define ESP32_PiCO_EVENT    // mur für originalplatine wegen LED zum testen


//#define OTA_on_NMDS_off     // OTA oder NMDS
//#define CO2_on                // CO2 Sensor eingebaut
#define MB_Gateway          // aktiv ist Gateway  0= Server Client
#define lib_folder 
#define lib_pase            // Parse HTML
#define led_on 
#define Unix_Zeit
//#define Pushover    // Push aktivieren
#define Radoncloud    // Radoncloud aktivieren
#define httpscloud

//******* #define PCB_v_7 *******
//#define v_4_20_mA    //MCP4921
//#define v_4_20_mA_2   //MCP492X  SPI funktioniert  
//#define v_4_20_mA_3   //MCP4921 Software
//#define v_4_20_mA_4   //GP8302 dfrobot

#define v_4_20_mA_5   //DAC8760


#define ap_set_passwort 


//*******************************

//#define MeshRoom    // MeshRoom aktivieren
//-----------------------------------------

#define Freshbox

#define reset_wifires  5             //  ee_wifires = 0;    8322      !wifiManager.auto Connect

#define v_ThingsBoard

#define mqtt_timestamp

//#define Web_wait

//#define onWIFI_wps

//#define vent_option

//#define old_option

//***************************************************************
//-----------------------------------------
//-----------------------------------------
#define nur_Gateway
//#define mit_CO2    // heir noch anpassen   void updateDIVs()
#define mit_MQTT
//#define mit_Mesh

//-- bei 1390 noch ändern für alte Platine
//#define WIFI_nur_LED

//#define WIFI_nur_LED_old_pcb   // Platine mit Options Pad für only LED
    #ifdef WIFI_nur_LED_old_pcb
      #define WIFI_nur_LED_old_version_standard  // hier anpassen wenn alte platine   Standard aktiv
    #endif 
      //  das wir weiter unten abgefragt  
      //  zustandVersion = true;  //1 = Normal Version      #define WIFI_nur_LED
      //  zustandVersion = false; //0 = Nur LED Version     #define WIFI_nur_LED

//-----------------------------------------
//-----------------------------------------
//***************************************************************


//#define BLE_Serial_WG

//#define BLE_Server            //BLE Server
//#define BLE_Serial            //BLE Serial
//#define BLE_Serialparing            //BLE Serialparing
//#define BLE_Serialparing2            //BLE Serialparing
//#define BLE_Serialparing3            //BLE Serialparing
//#define BLE_multi            //BLE Serialparing
//#define BLE_multi2            //BLE Serialparing
//#define BLE_multi3            //BLE Serialparing

#define BLE_WIFI_disable 


//-----------------------------------------


//#define BLE_DEBUG
//#define WIFI_DEBUG  

#define InfoDebug  

//#define MBDebug
     #define MBDebug_min
#define MBDebug_master

//#define DataDebug
//#define NVS_DEBUG
    // #define NVS_space_DEBUG


    //#define RADONCLOUD_DEBUG
//#define RADONCLOUD_DEBUG_min
    //#define RADONCLOUD_DEBUG_return
//#define NVS_cloud_DEBUG


//#define EEPROM_DEBUG       
//#define NVS_DEBUGdetail  
//#define NVS_DEBUGdetail_     
//#define NVS_log_DEBUG 
//#define NVS_datei_DEBUG


  //#define WEB_DEBUG    
//#define WEB_DEBUG2   
//#define WEB_DEBUG3       // File loader
//#define WEB_DEBUG_error   

//#define MQTT_DEBUG   
     #define MQTT_DEBUG_min  
//#define MQTT_DEBUG_last  
//#define NVS_MQTT_DEBUG

//#define CO2_DEBUG
//#define LEDDebug

//#define Freshebug   //all
//#define Freshebug2  //detail 
//#define Freshebug3  //min

//#define PushDebug
    // #define PushDebug_min
//#define MeshDebug
    // #define MeshDebug_min

     //#define NTPDebug
     //#define NTPTimeDebug
//#define DEBUG_NTPClient
//#define TimeDebug
//#define NTPTimeDebugmez

//#define tempDebug
//#define FAN_DEBUG

//#define test_dns
//---------------------------------------------


#include <Arduino.h>
//#include "Arduino.h"

//#include "HardwareSerial.h"
#include <HardwareSerial.h>

//#include "SoftwareSerial.h"

#include <WiFi.h>
//#include "WiFi.h"
#ifdef onWIFI_wps
  #include "esp_wps.h"
#endif

#include <EEPROM.h>
//Constants
#define EEPROM_SIZE 12

//#include "PushoverESP32.h"
#ifdef Pushover
  #include "Pushsafer.h"
#endif
//#define PushsaferKey "XqLUBNqaO1oaRpggaX0h"   // Private Key: http://pushsafer.com


//#include "esp_vfs_fat.h"

#include <DNSServer.h>

//#include <WebServer.h>
//#include <WiFiManager.h>         //https://github.com/tzapu/WiFiManager

//#include "WebServer.h"
#include "WiFiManager.h"         //https://github.com/tzapu/WiFiManager
//#include <WiFiManager.h> 

#ifdef OTA_on_NMDS_off
#include <ArduinoOTA.h>
#else
#include <ESPmDNS.h>
//#include "ESPmDNS.h"
#endif

#include <Preferences.h>
//#include "esp_system.h"
//#include "nvs_flash.h"
//#include "nvs.h"


#include "PubSubClient.h"


#include "FS.h"           // Include the SPIFFS library
#include "SPIFFS.h"

#ifdef lib_folder
#include <AsyncTCP.h>
//#include <WebServer.h>
#include <ESPAsyncWebServer.h>
#else
#include "AsyncTCP.h"
//#include "WebServer.h"
#include "ESPAsyncWebServer.h"
#endif

#ifdef Unix_Zeit
  #include "time.h"
#endif

#include "ESPDateTime.h"
#include "TCPstub.h"
//unsigned long mb_response_size_rtu = 0;
#include "NTPClient.h"

#ifndef Push2
#include "WiFiUdp.h"
WiFiUDP udp2;
#endif

char packetBuffer[255]; //buffer to hold incoming packet
char  ReplyBuffer[] = "acknowledged";       // a string to send back

#ifdef Push2
//#include <WiFiClientSecure.h>
#endif

#ifdef httpscloud
//#include <WiFiClientSecure.h>
#include "WiFiClientSecure.h"
#endif
//#include <certs.h>

// Modbus bridge include
#ifdef MB_Gateway
#include "ModbusBridgeWiFi.h"
#endif



// Modbus server TCP
#ifndef MB_Gateway
#include "ModbusServerTCPasync.h"
#endif

#include <ModbusClientRTU.h>



#include "AsyncUDP.h"

AsyncUDP udp; //this creates an UDP object for later use


const int relaisIN1 = 4;  // GPIO 04  Pin 24   Relais
bool relais_toggle;


#ifdef ESP32_PiCO_EVENT
  #include "TinyPICO.h"
  // Initialise the TinyPICO library
  TinyPICO tp = TinyPICO();
#endif



 #ifdef PCB_v_7
  #ifdef v_4_20_mA 
  
    #ifndef ESP32
    #error ESP32 only example, please select appropriate board
    #endif 

      #include "MCP_DAC.h"

    //  GPIO 15      SS    CS       PIN 21        -    GPIO 05       
    //  GPIO 14      SCK   SCK      PIN 17        -    GPIO 18 
    //  GPIO 12      MISO           PIN 18        -    GPIO 19 
    //  GPIO 13      MOSI  SDI      PIN 20        -    GPIO 23 


      //MCP4921 MCP(14, 12, 13);  // SW SPI   //  CLK=  MISO=  MOSI=
      MCP4921 MCP;  // HW SPI

      volatile int x;
      uint32_t start, stop;
  
    #endif


    #ifdef v_4_20_mA_2 

        #include <MCP492X.h> // Include the library

        #define PIN_SPI_CHIP_SELECT_DAC 5 // Or any pin you'd like to use

        MCP492X myDac(PIN_SPI_CHIP_SELECT_DAC);


    #endif


    #ifdef v_4_20_mA_3 

    //  GPIO 15      SS    CS       PIN 21        -    GPIO 05   PIN 34    
    //  GPIO 14      SCK   SCK      PIN 17        -    GPIO 18   PIN 35  
    //  GPIO 12      MISO           PIN 18        -    GPIO 19   PIN 38  
    //  GPIO 13      MOSI  SDI      PIN 20        -    GPIO 23   PIN 36  


    
      // 2 > 15 ist !CS / Chip Select bei 0
      // 3 > 14 ist SCL / Takt
      // 4 > 13 ist SDI / Daten

      #define DA 23 
      #define CL 18
      #define CS 05 
      #define CLOCK digitalWrite(CL,1); digitalWrite(CL,0);


    #endif




    #ifdef v_4_20_mA_4 

    #include "DFRobot_GP8302.h"


      #define I2C_PIN_REMAP_ENABLE  //Enable I2C pin remapping, remap it to the pins defined by I2C_SCL_PIN and I2C_SDA_PIN, if it's not enabled, the pins used by the hardware Wire object will be used by default.

      //#ifdef I2C_PIN_REMAP_ENABLE
      //#if defined(ESP32)
        #define I2C_SCL_PIN   22  //23 
        #define I2C_SDA_PIN   21  //18
      //#endif

      DFRobot_GP8302 module;


    #endif


    
    
    #ifdef v_4_20_mA_5   //DAC8760

     #include <SPI.h>
     #include "digitalWriteFast.h"
     #include "DAC8760.h"  // kopie von <MCP492X.h>  v_4_20_mA_2

        #define PIN_SPI_CHIP_SELECT_DAC 5 // Or any pin you'd like to use

        //DAC8760 myDac(PIN_SPI_CHIP_SELECT_DAC);
        DAC8760 dac;

    #endif  




  #endif   // PCB_v_7


/* Einfaches Beispiel zum Einlesen des Tasterzustandes */
#define PIN_version 35   // Pin Version   GPIO 35   Pin 11
bool zustandVersion= true;    //1 = Normal Version      #define WIFI_nur_LED
   


#include "ThingsBoard.h"
//#include "variables.h"
//#define o_ThingsBoard2  
//#define o_ThingsBoard 
#define o_ThingsBoard3

#ifdef o_ThingsBoard3
  //#include "LittleFS_Mbed_RP2040.h"
  //#include "FlashIAPBlockDevice.h"
  //#include "LittleFileSystem.h"
  //#include "FileSystem.h"
#endif

#ifdef BLE_Server

  #include <BLEDevice.h>
  #include <BLEUtils.h>
  #include <BLEServer.h>

  // See the following for generating UUIDs:
  // https://www.uuidgenerator.net/

  #define SERVICE_UUID        "4fafc201-1fb5-459e-8fcc-c5c9c331914b"
  #define CHARACTERISTIC_UUID "beb5483e-36e1-4688-b7f5-ea07361b26a8"

#endif



#ifdef BLE_multi

    #include <BLEDevice.h>
    #include <BLEServer.h>
    #include <BLEUtils.h>
    #include <BLE2902.h>

    BLEServer* pServer = NULL;
    BLECharacteristic* pCharacteristic = NULL;
    bool deviceConnected = false;
    bool oldDeviceConnected = false;
    uint32_t valueble = 0;

    // See the following for generating UUIDs:
    // https://www.uuidgenerator.net/

    #define SERVICE_UUID        "4fafc201-1fb5-459e-8fcc-c5c9c331914b"
    #define CHARACTERISTIC_UUID "beb5483e-36e1-4688-b7f5-ea07361b26a8"


    class MyServerCallbacks: public BLEServerCallbacks {
        void onConnect(BLEServer* pServer) {
          deviceConnected = true;
          BLEDevice::startAdvertising();
        };

        void onDisconnect(BLEServer* pServer) {
          deviceConnected = false;
        }
    };

#endif



#ifdef BLE_Serial_WG


/*
   Create a BLE server that will send periodic iBeacon frames.
   The design of creating the BLE server is:
   1. Create a BLE Server
   2. Create advertising data
   3. Start advertising.
   4. wait
   5. Stop advertising.
   6. deep sleep
   
*/
#include "sys/time.h"

#include "BLEDevice.h"
#include "BLEUtils.h"
#include "BLEBeacon.h"
#include "esp_sleep.h"

#define GPIO_DEEP_SLEEP_DURATION     10  // sleep x seconds and then wake up
RTC_DATA_ATTR static time_t last;        // remember last boot in RTC Memory
RTC_DATA_ATTR static uint32_t bootcount; // remember number of boots in RTC Memory

/*
#ifdef __cplusplus
extern "C" {
#endif

uint8_t temprature_sens_read();
//uint8_t g_phyFuns;

#ifdef __cplusplus
}
#endif
*/

// See the following for generating UUIDs:
// https://www.uuidgenerator.net/
BLEAdvertising *pAdvertising;
struct timeval now;

#define BEACON_UUID           "8ec76ea3-6668-48da-9866-75be8bc86f4d" // UUID 1 128-Bit (may use linux tool uuidgen or random numbers via https://www.uuidgenerator.net/)

void setBeacon() {

  BLEBeacon oBeacon = BLEBeacon();
  oBeacon.setManufacturerId(0x4C00); // fake Apple 0x004C LSB (ENDIAN_CHANGE_U16!)
  oBeacon.setProximityUUID(BLEUUID(BEACON_UUID));
  oBeacon.setMajor((bootcount & 0xFFFF0000) >> 16);
  oBeacon.setMinor(bootcount&0xFFFF);
  BLEAdvertisementData oAdvertisementData = BLEAdvertisementData();
  BLEAdvertisementData oScanResponseData = BLEAdvertisementData();
  
  oAdvertisementData.setFlags(0x04); // BR_EDR_NOT_SUPPORTED 0x04
  
  std::string strServiceData = "";
  
  strServiceData += (char)26;     // Len
  strServiceData += (char)0xFF;   // Type
  strServiceData += oBeacon.getData(); 
  oAdvertisementData.addData(strServiceData);
  
  pAdvertising->setAdvertisementData(oAdvertisementData);
  pAdvertising->setScanResponseData(oScanResponseData);
  pAdvertising->setAdvertisementType(ADV_TYPE_NONCONN_IND);

}

#endif



#ifdef BLE_Serial

  #include "BluetoothSerial.h"

  BluetoothSerial SerialBT;

#endif



#ifdef BLE_Serialparing

  #include "BluetoothSerial.h"

  BluetoothSerial SerialBT;
  boolean confirmRequestPending = true;

#endif



#ifdef CO2_on
#include <Wire.h>    // I2C library
#include "ccs811.h"  // CCS811 library
// Wiring for ESP8266 NodeMCU boards: VDD to 3V3, GND to GND, SDA to D2, SCL to D1, nWAKE to D3 (or GND)
//CCS811 ccs811(23); // nWAKE on D3   //SCL D22        SDA  D21

#ifdef ESP32_PiCO
   CCS811 ccs811(27); // nWAKE on D27   //SCL D22        SDA  D21
#else
   CCS811 ccs811(23); // nWAKE on D3   //SCL D22        SDA  D21
#endif

uint16_t eco2val1;
uint16_t etvocval2;
bool gCO2UpdateFlag = true;
#endif

bool gRADONupdateFlag = true;
bool gRADONupdateSinifferFlag = false;
bool gFrashupdateFlag = false;
bool g_ntp_update_start = true;
bool g_ntp_update_ok = false;
uint8_t boot1440 =0;

bool wifiNotConnectFlag = false;

unsigned long previousMillis = 0;
unsigned long interval = 900000;   //60 000 = 60sec     900000

#ifdef ESP32_PiCO
 // #include "Adafruit_GFX.h"
  //#include "FastLED.h"
 // #include "FastLED_NeoMatrix.h"
 // #include "Fonts/TomThumb.h"
 // #define PIN 12   
 
#endif




//*0-3,3V ->0-4095 2^12
int intV_AI_VSS = 0;
int intV_AI_VCAPA = 0;
//< GPIO >

int PIN_AI_VSS = 39;   //VDD,  GPIO 39, ADC1_CH3         



int PIN_AI_VCAPA = 38;  //Solar, GPIO 38, ADC1_CH2 
float AI_VSS_mv, AI_VCAPA_mv;  // Messwert in Millivolt umgerechnet
String AI_VSS_mv_s, AI_VCAPA_mv_s;




uint8_t gCONNECTEDflag = 0;   // 1=WLAN ist verbunden
bool abbruch_portal = false;


  int jahr, monat, tag, stundesz, wochentag, stunde, sw_zeit, dOW;

  uint16_t cyear;
  uint8_t cmonth;
  uint8_t cday;

const char* ntpServer = "pool.ntp.org";
const long  gmtOffset_sec = 3600;   //Replace with your GMT offset (seconds)
int   daylightOffset_sec = 0;  //Replace with your daylight offset (seconds)


      uint16_t t_year;
      uint8_t t_mday,t_mon,t_hour,t_tzHours;

 bool Set_mesz;
 bool failTimeinfo;
 bool fail2Timeinfo = true;   //false = jahr größer 1970




 
#ifdef led_on 
  // esp.c muss auch mit rein in den Libordner
  #include "Adafruit_NeoPixel.h"
  
#ifdef ESP32_PiCO
    #define STRIP_1_PIN 32  // GPIO the LEDs are connected to
#else
   #define STRIP_1_PIN 32  // GPIO the LEDs are connected to
#endif

  #define LED_COUNT 4  // Number of LEDs
  #define BRIGHTNESS 255  // NeoPixel brightness, 0 (min) to 255 (max)
  Adafruit_NeoPixel strip1(LED_COUNT, STRIP_1_PIN, NEO_GRB + NEO_KHZ800); // NEO_KHZ800

#endif
bool gLedSearchFlag = false;
bool gLedDeleteFlag = false;
bool gGraphDeleteFlag = false;
bool gMESHUpdateFlag = true;
bool gMESHUpdateFlag2 = true;
bool gMESHUpdateFlag3 = true;
bool gMESHUpdateFlag4 = true;
bool gMESHUpdateFlag5 = true;


bool gNTPupdateFlag = true;
bool gUhrzeitAktuellFlag = false;
bool g_NTP_update = false;

bool MQTT_VAR_NEW = true;

#include <esp_task_wdt.h>
//3 seconds WDT
#define WDT_TIMEOUT 30



/*
#include <stdio.h>
#include <esp_system.h>
#include <esp_system.h>
#include <esp_err.h>

void app_main(void)
{ntpServer
        
        
        printf("Simply give ok code to check function and see whats happend\n");        
        ESP_ERROR_CHECK(ESP_OK);
        
        printf("And hopefully you see nothing between this and the last output\n");
        
                
        printf(esp_err_to_name(0x106));
         
        char text[30];
        esp_err_to_name_r(0x105,text,30);
        printf(text);
        
        
        // undocument this to produce an error
        //ESP_ERROR_CHECK(ESP_ERR_INVALID_MAC);
        
}
*/



//char ssid[] = "FRITZ!Box 6490 Holger";                     // SSID and ...
//char pass[] = "15400240614617116002";                     // password for the WiFi network used

  uint8_t incoming1Byte = 0; // Für eingehende serielle Daten
  const uint8_t BUFFER_SIZE1 = 18;
  char buf1[BUFFER_SIZE1];

byte f_buffer[BUFFER_SIZE1];
byte ser_val_01[2];
byte ser_val_02[2];
byte ser_val_03[2];
byte ser_val_04;
byte ser_val_05[2];
byte ser_val_06[2];
byte ser_val_07;
byte ser_val_08;
byte ser_val_09;
byte ser_val_10;
byte ser_val_11;
byte ser_val_12;
uint16_t f_check_rec = 0;
bool g_CRC_ok = false;
uint8_t g_crc_counter = 1;
bool g_crc_errorBit = false;


uint8_t gWerte1UpdateFlag = 0;
uint8_t gWerte2UpdateFlag = 0;
uint8_t gWerte3UpdateFlag = 0;  //VAN


uint16_t f_filterRemaining = 0;
uint8_t f_min = 0;
uint8_t f_pwm = 0;
uint16_t f_alarmlevl = 0;
uint8_t f_alarm = 0;
uint16_t f_software = 0;
uint16_t f_opHour = 0;
uint8_t f_filterMonitor = 0;
uint8_t f_checksum = 0;

String inputString = "";         // a String to hold incoming data
bool stringComplete = false;  // whether the string is complete

      #ifdef vent_option
        uint16_t vent_min_stufe = 1;
        uint16_t vent_max_stufe = 2;
        uint16_t pwm_radon_min = 0;
        uint16_t pwm_radon_max = 0;
        uint16_t pwm_radon_range = 0;
        uint16_t pwm_faktor = 0;
        uint16_t pwm_raster = 0;
        uint16_t pwm_radon_value = 0;
      #endif


//default custom static IP
char static_ip[16] = "192.168.178.251";
char static_gw[16] = "192.168.178.1";
char static_sn[16] = "255.255.255.0";
char static_dns[16] = "8.8.8.8";

bool shouldSaveConfig = false;

uint16_t port = 502;                      // port of modbus server
uint16_t aWebPort = 80;                      // port of Web server
// Create a ModbusRTU client instance
ModbusClientRTU MB(Serial2);

#ifdef MB_Gateway
// Create server
ModbusBridgeWiFi MBbridge;
#endif

#define STRINGIFY(x) #x
#define LNO(x) "line " STRINGIFY(x) " "


#include "Logging.h"
//#define LOG_LEVEL LOG_LEVEL_0
//#define LOG_LEVEL_NONE


#define PIN_RESET_BUTTON 4   
#define PIN_BOOT_BUTTON 0       
uint8_t b_RESET = 0; 
uint8_t b_BOOT = 1; 

char incomingByte [16];
String myValue [16];
String stringOne = "";
char* buf2 = 0;
uint8_t Expec_b[] = {0, 4, 2, 0, 0};
uint8_t slaveid[] = {2, 3, 2, 0, 3};
//char dataString[50] = {0};
//int mbbytestart = 0;

unsigned long epochTime_start = 0;
unsigned long epochTime_diff = 0;
uint8_t p_timeon = 0;

unsigned long epochTime_mqtt = 0;
unsigned long epochTime_mqtt_minus = 0;
byte togglebitMqtt = 0;

uint16_t  ee_var_01 = 0; 
uint16_t  ee_var_02 = 0; 
uint16_t  ee_wifires = 0; 
uint16_t  ee_portalTimeout = 620; 
uint16_t  reset_timer_wlan = 30;
uint16_t  ipchangeandreeboot = 0;

byte WiFi_status;

byte count_in = 0;
byte count_out = 0;
uint16_t  scan_server = 0;
uint16_t  Async_WebServer_start = 0;

uint16_t testsExecuted = 0;            // Global test cases counter. Incremented in testOutput().
uint16_t testsPassed = 0;              // Global passed test cases counter. Incremented in testOutput().
bool printPassed = true;               // If true, testOutput will print passed tests as well.
bool mb_Acknowledge = false;
String mb_Acknowledge_s = "";

    uint16_t ledRedVal;
    uint16_t ledOrangeVal;
    uint16_t ledGreenVal;
    uint16_t ledgammaVal;

int32_t ao1OGVal,ao1UGVal;
uint8_t ao1OptionVal,ao1namurVal,ao1nanurVal;  
float ao1KorrekturVal,ao1Korrektur2Val;

uint16_t calc_top2,calc_down2,calc_diff;
float calc_top2_f,calc_down2_f;
uint16_t calc_top = 3569;    //3277
uint16_t calc_down = 895;    //655

// #ifdef v_4_20_mA 
float ao1_div;
float ao1_range;
float ao1_rangediv;
float ao1_adc = 4095;
float ao1_set_soll;
uint16_t ao1_set_ADC = 0;
uint16_t ao1_set_test,ao1_set_test2;
bool dirctionadc;
float ao1_0mA,ao1_4mA,ao1_20mA,ao1_25mA,ao1_diffmA,ao1_stepmA,ao1_outmA;
bool adc_direction = false;

float val1, val2;
uint16_t val3, val4, val5, val6, val7, val8, val9, val10;
uint16_t valm1, valm2, valm3, valm4, valm5, valm6, valm7, valm8, valm9, valm10;


uint32_t rval3,rval4,rval5;
uint16_t rval6;
String rval7 = "          ";

uint16_t fval1, fval2, fval3, fval4, fval5, fval6, fval7, fval8, fval9, fval10;
String bgcolor_g ="bgcolor='#009513'";
String bgcolor_o ="bgcolor='#FF8A3C'";
String bgcolor_r ="bgcolor='#FF0000'";
String bgcolor_vorgabe = "bgcolor='#009513'";

String bgcolor_vorgabeg = "bgcolor='#9F9F9F'"; //grau
String bgcolor_vorgaber = "bgcolor='#FFB3B3'"; // lell rot


String f_alarm_s = "        ";
String f_Rsource = "Sensor not ready!";
bool b_set_mesh_on = false;
bool b_set_mesh_read = false;
bool b_set_mesh_online = false;
uint16_t var_led_t = 0;

uint8_t count_mesh_1_fail = 0;
uint8_t count_mesh_2_fail = 0;
uint8_t count_mesh_3_fail = 0;
uint8_t count_mesh_4_fail = 0;
uint8_t count_mesh_5_fail = 0;

uint8_t ee_ip_search = 0;
uint8_t led_ip_count = 0;

uint32_t val4max;
uint32_t val3max;
uint32_t val1max;
uint32_t val2max;

uint32_t val3max_vorgabe;         //300  rot
uint32_t vredFrom_vorgabe;         //200  orange
uint32_t vyellowFrom_vorgabe;      //100  grün
uint32_t vgreenFrom_vorgabe;      //50
uint32_t val3_vorgabe;           //50
uint32_t val3max_vorgabe2;

uint32_t vredFrom;
uint32_t vredTo;
uint32_t vyellowFrom;
uint32_t vyellowTo;
uint32_t vgreenFrom;
uint32_t vgreenTo;

uint32_t vredFrom2;
uint32_t vredTo2;
uint32_t vyellowFrom2;
uint32_t vyellowTo2;
uint32_t vgreenFrom2;
uint32_t vgreenTo2;

uint32_t vredFrom3;
uint32_t vredTo3;
uint32_t vyellowFrom3;
uint32_t vyellowTo3;
uint32_t vgreenFrom3;
uint32_t vgreenTo3;

String val1_color = "0, 0, 0, 0.3";
String val2_color = "0, 0, 0, 0.3";
String val3_color = "0, 0, 0, 0.3";


String r0_val1, r0_val2, r0_val3;
String r1_val1, r1_val2, r1_val3;
String r2_val1, r2_val2, r2_val3;
String r3_val1, r3_val2, r3_val3;
String r4_val1, r4_val2, r4_val3;
String r5_val1, r5_val2, r5_val3;

byte mb_low = 0;
byte mb_high = 0;
//uint16_t mb_word = word(mb_high, mb_low);
uint32_t mb_long = 0;
byte mb_arry_byte[30];
byte i_loop = 0;
uint16_t mb_byte_size = 0;
uint16_t mb_byte_header = 4;
uint16_t mb_byte_resault = 2;
uint16_t mb_byte_header_t = 3;
byte responsegetFunctionCode = 0;

uint32_t mb_radon_ist_long = 0;
uint16_t  mb_radon_ist_word = 0;
uint32_t mb_radon_long = 0;
uint16_t  mb_radon_int = 0;
uint16_t  mb_radon_eintrarge = 0;

uint32_t mb_radon_live_32bit = 0;
uint32_t mb_radon_live_32bitK = 0;
String mb_radon_live_32bitK_s = "--";
uint32_t mb_radon_live_32bit_m[11];
uint32_t mb_radon_24h_32bit = 0;
uint32_t mb_radon_long_32bit = 0;
uint16_t mb_radon_F3_eintrarge = 0;
String mb_Seriennummer = "";
char mb_Seriennummer_char [20];

uint32_t radon_tag = 0;
uint32_t radon_temp = 0;
uint16_t  radonTagCount = 0;
uint16_t  radonTagEintrCount = 0;
uint16_t  radonTagCountvorgabe = 96; 
uint16_t  radonMore14Day = 0;

uint32_t radon_tag00 = 0;
uint32_t radon_tag01 = 0;
uint32_t radon_tag02 = 0;
uint32_t radon_tag03 = 0;
uint32_t radon_tag04 = 0;
uint32_t radon_tag05 = 0;
uint32_t radon_tag06 = 0;
uint32_t radon_tag07 = 0;
uint32_t radon_tag08 = 0;
uint32_t radon_tag09 = 0;
uint32_t radon_tag10 = 0;
uint32_t radon_tag11 = 0;
uint32_t radon_tag12 = 0;
uint32_t radon_tag13 = 0;
uint32_t radon_tag14 = 0;

uint16_t  mb_radon_ist_word_long0;
uint16_t  mb_radon_ist_word_long1;

uint16_t  mb_radon_live_word_0;
uint16_t  mb_radon_live_word_1;

uint16_t  mb_radon_live_word_0_m[11];
uint16_t  mb_radon_live_word_1_m[11];

uint16_t  mb_radon_word_long0;
uint16_t  mb_radon_word_long1;

uint32_t received_size = 0;
uint32_t received_count = 0;
uint32_t response_size = 0;
uint32_t response_ServerID = 0;
uint32_t received_response_size = 0;
uint32_t received_response_size_k = 0;
uint32_t received_response_size_m = 0;
uint32_t received_response_size_g = 0;
uint16_t  received_response__g = 0;

uint16_t dataRequest =0;

String s_response_size = "";
String s_received_size = "";

String MBbridge_localRequest = "";

int b_clint_status = -1; 

uint8_t measurement = 0;
uint16_t measurement_lage = 0;
uint16_t measurement_temp = 0;
boolean sensor_vals_read = true;


  // Öffnen der von uns definierten Datei nur mit Leserechten
  // r - Read - nur Leserechte
  // w - Write - Schreibrechte
 // const char* dateiGr01 = "/graph01.txt"; // tvoc            charInts4[42]     dateiGr01   /chartdiv4.js
 // const char* dateiGr02 = "/graph02.txt"; // co2 Daten       charInts3[42]     dateiGr02   /chartdiv3.js
  const char* dateiGr03 = "/graph03.txt"; // radon Daten      charInts[42]     dateiGr03   /chartdiv.js
  //const char* dateiGr05 = "/graph05.txt";//  Hz              charInts5[42]     dateiGr05   /chartdiv5.js
  //const char* dateiGr07 = "/graph07.txt";//  Radon FAN       charInts7[42]     dateiGr07   /chartdiv7.js

  //const char* dateiGr08 = "/datamqtt.txt"; // radon mqtt lost Daten      charInts8[42]     datamqtt 
  const char* dateiGr09 = "/datamqtt2.txt"; // radon mqtt lost Daten      charInts8[42]     datamqtt 
  const char* dateiGr10 = "/datamqtt3.txt"; // radon mqtt lost Daten      charInts8[42]     datamqtt 

  //const char* dateiGr06 = "/log06.txt";//  Hz              log_list[xx]     dateiGr06   

  const char* dateiGr11 = "/cloud11.txt";//               log_list[xx]     dateiGr11   
  const char* dateiGr12 = "/cloud12.txt";//                                dateiGr12  
  
  const char* dateiGr13 = "/things13.txt";//                               dateiGr13  
  const char* dateiGr14 = "/things14.txt";//                               dateiGr14  
  const char* dateiGr15 = "/things15.txt";//                               dateiGr15  

 //#define LOG_LEN   42
 //String log_list[LOG_LEN+1] = "                    ";
 //uint8_t log_list_count = 1;   //start bei 1
 //bool g_save_loiglist = false;

 #define CLOUD_LEN   42
 //String cloud_list[CLOUD_LEN+1] = "                                                                                                   ";
 uint8_t cloud_list_count = 1;   //start bei 1
 bool g_save_cloudlist = false;
 bool g_write_cloudlist = false;   // gerade wird angefangen schreiben in cloud
 bool g_abort_cloudlist_2 = false; // abbruch beim schreiben

//String cloud_list_t = "                                                                                                   ";

String sendValueStr2 = "                                                                                                   ";
 
//String client_send_str2 = "                                                                                                                                                                                   ";

uint16_t charcount11, charcount11_t, charcount11_w,must_transfer,i_re,i_sendt,i_write_line,i_write_line_t;
bool gcharcount11Del = false;
bool gdata11Resave = false;
uint8_t i_secure;
bool g_i_secure = false;

bool gcharcount12Del = false;
uint16_t charcount12, charcount12_t,charcount12_w,count12fehlt,g12FileRead;



String things_list_t = "                                                                                                   ";
uint16_t charcount13, charcount13_t,charcount13_w,count13fehlt,g13FileRead,must_transfer3;
bool gcharcount13read = true;

uint16_t charcount14, charcount14_t,charcount14_w,count14fehlt,g14FileRead,must_transfer4;
bool gcharcount14read = true;
uint16_t charcount15, charcount15_t,charcount15_w,count15fehlt,g15FileRead,must_transfer5;
bool gcharcount15read = true;


 bool g_save_thingslist = false;
 bool g_write_thingslist = false;   // gerade wird angefangen schreiben in MQTT
 bool g_abort_thingslist_2 = false; // abbruch beim schreiben


uint32_t  len_file1 = 0; 
uint32_t  len_file2 = 0; 
uint32_t  len_file3 = 0; 
uint32_t  len_file4 = 0; 
uint32_t  len_file5 = 0; 
uint32_t  len_file6 = 0; 
uint32_t  len_file7 = 0; 
#ifdef old_option
uint32_t  len_file8 = 0; 
#endif
uint32_t  len_fileca = 0;

 byte toggle_client = 0; 

  WiFiClient wifiClient;
  PubSubClient client(wifiClient);

  long lastMsg = 0;
  //char msg[50];
  uint8_t value = 0;
  uint8_t ledState2 = 0;
  uint8_t mqttReconCount = 0;
  bool mqtt_con_err = false;
  bool mqtt_con_err2 = false;
 //**************************************************************************************



 //**************************************************************************************
       // void updateFreshbox(){ 

       // Freshaa
      //================== Spezialbefehle ===================//
      #define BGCP_CMD_PAGE 0xFF
      #define BGCP_CMD_FUNC 0xFC
      #define BGCP_CMD_SIZE 0xFE
      #define BGCP_CMD_NOT_SUP 0xFD    

      #define Fresh_Code_R 0x01
      #define Fresh_Code_W 0x02

      //#define RegelungImStandard 0x68 //Regelung Temperatur aus/ein
      //#define FunktonAus 0x00 //aus
      //#define FunktonAus 0x01 //ein

      #define W_Lueftungsstufe 0x02 //Lüftungsstufe
      #define S_Stufe_1 0x01 //1
      #define S_Stufe_2 0x02 //2
      #define S_Stufe_3 0x03 //3
      #define S_Stufe_4 0x04 //4
      #define S_Stufe_5 0x05 //5
      #define S_Stufe_6 0x06 //6

      #define W_AnlageEA 0x01 //Ein aus
      #define S_AnlageAus 0x00 //0
      #define S_AnlageEin 0x01 //1

      #define W_Boostbertrieb 0x14 //Boost-Betrieb.aus/ein
      #define S_Boost_Aus 0x00 //aus
      #define S_Boost_Ein 0x01 //ein

      #define W_Kalenderbetrieb 0x72 //Kalender betrieb.aus/ein
      #define S_Kalender_Aus 0x00 //aus
      #define S_Kalender_Ein 0x01 //ein


     //--------- Read -----
      #define R_AnlageEA 0x01 //Ein aus
      #define R_Lueferstatus 0x02 //Status Lüfter
      #define R_RegelungImStandard 0x68 //Regelung Temperatur aus/ein
      #define R_Heizregisters 0x81 //Zustand des Heizregisters
      #define R_Umluftklappe 0xF0 //Zustand Umluftklappe Rückgewinnung

      #define R_Timerbetrieb 0x07 //Status Timerbertrieb
      #define R_TimerLueferstatus 0x08 //Status Lüfter im Timerbertrieb

      #define R_Calenderbetrieb 0x72 //Status Calenderbertrieb
      #define R_CalenderLueferstatus 0x73 //Status Lüfter im Calenderbertrieb
  
      #define R_Zeitplanstatus 0x77 //Status Zeitplan Einstellungen


      //======================================================//
      #define BGCP_FUNC_RESP 0x06
      uint8_t receive_data[256];
      uint16_t receive_data_size;
      uint16_t packetSize = 0;
      uint8_t State_Power;
      uint8_t State_Speed_mode;
      uint8_t State_Timer_mode;
      uint8_t State_Timer_Speed_mode;
      uint8_t State_Calender_mode;
      uint8_t State_Calender_Speed_mode;

      uint8_t State_TempRegelung_mode;
      uint8_t State_Heizregisters_mode;
      uint8_t State_Umluftklappe_mode;
      uint8_t State_Leseanforderung_mode;
      bool State_Leseanforderung_bit = false;
      bool State_schreib_ID_bit = false;
      bool State_anf_schreib_ID_bit = false;
      bool State_ID_ok = false;
      bool m_boost_aktive = false;
      bool m_kalender_aktive = false;

      uint8_t w_dummy_data;
      uint8_t w_dummy_data_boost = 0; // 0=nur lüftungsstufen   2=Boost AUS     6=Boost EIN
      uint8_t w_dummy_data_ein = 1; 


      uint8_t receive_data_01;
      uint8_t receive_data_02;
      uint8_t receive_data_03;
      uint8_t receive_data_04;
      uint8_t receive_data_05;
      uint8_t receive_data_06;
      uint8_t receive_data_pos;

      uint8_t State_Zeitplan_b1_mode;
      uint8_t State_Zeitplan_b2_mode;
      uint8_t State_Zeitplan_b3_mode;
      uint8_t State_Zeitplan_b4_mode;
      uint8_t State_Zeitplan_b5_mode;
      uint8_t State_Zeitplan_b6_mode;
         
      

      uint8_t receive_d_len_id;
      uint8_t receive_d_pos_pwd;
      uint8_t receive_d_len_pwd;
      uint8_t receive_d_start_pwd;


      String State_Power_s = "---";
      String State_Timer_s = "---";
      String State_Calender_s = "---";
      
        
      #define Fresh_St1_LEN     5
      String p_inputStufe1 = "50";
      char p_inputStufe1c[Fresh_St1_LEN+1] = "50"; //  p_inputledorange
      
      #define Fresh_St2_LEN     5
      String p_inputStufe2 = "100";
      char p_inputStufe2c[Fresh_St2_LEN+1] = "100"; 
      
      #define Fresh_St3_LEN     5
      String p_inputStufe3 = "150";
      char p_inputStufe3c[Fresh_St3_LEN+1] = "150"; 
      
      #define Fresh_St4_LEN     5
      String p_inputStufe4 = "200";
      char p_inputStufe4c[Fresh_St4_LEN+1] = "200"; 

      #define Fresh_St5_LEN     5
      String p_inputStufe5 = "300";
      char p_inputStufe5c[Fresh_St5_LEN+1] = "300"; 

      #define Fresh_St6_LEN     5
      String p_inputStufe6 = "130";
      char p_inputStufe6c[Fresh_St6_LEN+1] = "130"; 



     uint16_t b_inputStufe1;
     uint16_t b_inputStufe2;
     uint16_t b_inputStufe3;
     uint16_t b_inputStufe4;
     uint16_t b_inputStufe5;
     uint16_t b_inputStufe6;

     String p_inputfunktion = "off";

     bool senden_Lueferstufe = false;



      uint8_t toggleAbfrage;
      #define toggleAbfrage_vorgabe     6
      uint8_t toggleSchreiben = 1; // 1=lesen  2=schreiben    start lesen
      uint16_t var_fresh_t = 0;

      // 0=Anlage Stufe_1-5      1= Anlage EIN/AUS     2=Boost EIN    3=Boost AUS   4=Kalender EIN   5=Kalender AUS
      uint8_t caseFreshSchreiben = 0;  


      uint16_t localPort = 4000;
      // Recipient IP
      IPAddress udpAddress(192, 168, 178, 146);

      String p_inputfreship = "192.168.4.1";
      String p_inputfreshid = "0034003F59525307";
      String p_inputfreshpwd = "1111";

      String p_inputfreship_temp = "";
      
      String strF1 = "                ";
      String strF2 = "    ";

      //IPAddress udpAddress(192, 168, 4, 1);
      // Recipient UDP Port
      unsigned int RecipientPort = 4000;

      //char udpAddress = "192.168.178.146";      // Adresse und Port vom Empfänger einstellen

      uint16_t udpPort = 4000;

      byte buffer[30];       //buffer[30]={0xFD,0xFD,0x02,0x10,0x30,0x30,0x33,0x34,0x30,0x30,0x33,0x46,0x35,0x39,0x35,0x32,0x35,0x33,0x30,0x37,0x04,0x31,0x31,0x31,0x31,0x02,0x02,0x01,0x23,0x04};

      //char current_id[17] = "002D6E1B34565815"; // ID-Nummer der Steuereinheit
      //byte current_id_hex[17] = {30 ,30 ,33 ,34 ,30 ,30 ,33 ,46 ,35 ,39 ,35 ,32 ,35 ,33 ,30 ,37};// ID-Nummer der Steuereinheit

      char current_id[17] = "0034003F59525307"; // ID-Nummer der Steuereinheit
      byte current_id_hex[16] = {30 ,30 ,33 ,34 ,30 ,30 ,33 ,46 ,35 ,39 ,35 ,32 ,35 ,33 ,30 ,37};// ID-Nummer der Steuereinheit
      
      byte send_crc[2];

      uint16_t s_i;
      uint16_t s_chksum1;
      uint16_t s_size;

      uint8_t PWD_blockgroesse = 4;
      byte send_pwd[4] = {0x31, 0x31, 0x31, 0x31}; // PWD

      byte send_data_udp_1[3] = {0xFD, 0xFD, 0x02}; // Start

      //byte send_data_udp_2[8] = {PWD_blockgroesse, send_pwd[0], send_pwd[1], send_pwd[2], send_pwd[3], Fresh_Code_W, RegelungImStandard, FunktonAus}; // End

     String werteaktual_f = "L&uuml;fterdaten noch nicht aktuell";

     // lese Anforderung   Anlage Ein/Aus   und   Betrieb der Lüftungsstufe
     // FD FD 02 08 00 2D 6E 1B 34 56 58 15 04 31 31 31 31 01 01 02 83 02
     //          |  |                       |  |           |  |  |  |
     //          |  |                       |  |           |  |  |  |CRC 
     //          |  |                       |  |           |  |  |DATA= lese 02
     //          |  |                       |  |           |  |DATA= lese 01
     //          |  |                       |  |           |Funktion  01=lesen  02=schreiben
     //          |  |                       |  |PWD
     //          |  |                       |PWD länge
     //          |  |ID
     //          |ID länge



     // lese Rückmeldung  Anlage Ein/Aus   und   Betrieb der Lüftungsstufe
     // FD FD 02 08 00 2D 6E 1B 34 56 58 15 04 31 31 31 31 06 01 00 02 03 FF FF
     //          |  |                       |  |           |  |  |  |  |  |
     //          |  |                       |  |           |  |  |  |  |  |CRC 
     //          |  |                       |  |           |  |  |  |  |DATA2
     //          |  |                       |  |           |  |  |  |Bock2
     //          |  |                       |  |           |  |  |DATA1
     //          |  |                       |  |           |  |Bock1
     //          |  |                       |  |           |Funktionsnummer
     //          |  |                       |  |PWD
     //          |  |                       |PWD länge
     //          |  |ID
     //          |ID länge


     byte freshbos_send[30] = {0xFD,0xFD,0x02,0x10,0x30,0x30,0x33,0x34,0x30,0x30,0x33,0x46,0x35,0x39,0x35,0x32,0x35,0x33,0x30,0x37,0x04,0x31,0x31,0x31,0x31,0x02,0x02,0x01,0x23,0x04};    



     //   send_data_udp_1[4]   current_id_hex[8]   send_data_udp_2[8]

      //********* Anfang der Prüfsumme und Beginn des Pakets ***********//
      uint8_t check_protocol(uint8_t *data, uint16_t size)
      {
          uint16_t i, chksum1 = 0, chksum2 = 0;
          if((data[0] == 0xFD) && (data[1] == 0xFD))
          {
              for(i = 2; i <= size-3; i++)
                chksum1 += data[i];
              chksum2 = (uint16_t)(data[size-1] << 8) | (uint16_t)(data[size-2]);
              //Serial.println("IST : " + String(chksum1));
              //Serial.println("Soll: " + String(chksum2));
              if(chksum1 == chksum2)
                return 1;
            else
                return 0;
          }
          else
              return 0;
      }
      //****************************************************************//

 //**************************************************************************************







//void sendUdp(const String &message) {
 // WiFiUDP Udp;
 //const char* addr = "192.168.178.146";      // Adresse und Port vom Empfänger einstellen
  //const char* addr = "192.168.4.1";      // Adresse und Port vom Empfänger einstellen
  //const uint16_t port = 4000;
  //DEBUG_P("UDP Nachricht: " + message);
  //Udp.beginPacket(udpAddress, udpPort);
  //Udp.printf("%s\n", message.c_str());
  //Serial.println(message);
  //Udp.endPacket();
//}




// testOutput:  takes the test function name called, the test case name and expected and recieved messages,
// compares both and prints out the result.
// If the test passed, true is returned - else false.
bool testOutput2(ModbusMessage expected, ModbusMessage received) {
  testsExecuted++;

  if (expected == received) {
    testsPassed++;
    //if (printPassed) Serial.printf("%s, %s - passed.\n");
    return true;
  } 

  //Serial.printf("%s, %s - failed:\n");
  //Serial.print("   Expected:");
  //for (auto& b : expected) {
    //Serial.printf(" %02X", b);
  //}

  if (expected.size() == 1) {
    ModbusError me((Error)expected[0]);
   // Serial.printf(" %s", (const char *)me);
  }
  //Serial.println();
  //Serial.print("   Received:");
  //for (auto& b : received) {
    //Serial.printf(" %02X", b);
  //}

  if (received.size() == 1) {
    ModbusError me((Error)received[0]);
   // Serial.printf(" %s", (const char *)me);
  }
 // Serial.println();
  
  return false;
}




  // mb_response_size_rtu = mb_response_size_rtu + MM_data.size();
  //  Serial.println(String(mb_response_size_rtu));
  //Serial.println(mb_response_size_rtu);

// testOutput:  takes the test function name called, the test case name and expected and recieved messages,
// compares both and prints out the result.
// If the test passed, true is returned - else false.
uint8_t bb;
bool testOutput( ModbusMessage expected, ModbusMessage received) {
  
  //Serial.println("------testOutput------");
  testsExecuted++;
  count_in = 0;
  count_out = 0;
  mb_Acknowledge = false;
  
   //if (expected == received) { }
  
   //Serial.print("   Expected:");
  for (auto& b : expected) {
    //Serial.printf(" %02X", b);
    bb = b;
    count_out ++;
  }

  if (expected.size() == 1) {
    ModbusError me((Error)expected[0]);
    //Serial.printf(" %s", (const char *)me);
  }
  
   //Serial.println();
   //Serial.print("   Received:");
  for (auto& b : received) {
   // Serial.printf(" %02X", b);
    bb = b;
    count_in ++;
  }

  // Serial.println("received.size() " + received.size());
  
  received_size = received_size + received.size();
 // s_received_size = String(received_size);
  

  if (expected == received || received.size() == 1 || count_out == count_in) {  
    ModbusError me((Error)received[0]);
   // Serial.printf(" %s", (const char *)me);
    mb_Acknowledge = true;
    mb_Acknowledge_s = (const char *)me;
  }
 
  return false;
}


uint8_t Tokenb = 1;
uint8_t mb_idscan = 1;
bool gModbusValupdateFlag = false;
uint8_t mb_afrg_Radon = 0;

// Helper function to convert hexadecimal ([0-9A-F]) digits in a char array into a vector of bytes
ModbusMessage makeVector(const char *text) {
  ModbusMessage rv;            // The vector to be returned
  uint8_t byte = 0;
  uint8_t nibble = 0;
  bool tick = false;             // Counting nibbles
  bool useIt = false;            // true, if a hex digit was read
  const char *cp = text;
  //Serial.println("-------makeVector-------");
  // Loop the char array
  while (*cp) {
    // Is it a decimal digit?
    if ((*cp >= '0' && *cp <= '9')) {
      // Yes. Convert it to a number 0-9
      nibble = (*cp - '0');
      // Flag to use the digit
      useIt = true;
    // No decimal, but a hex digit A-F?
    } else if (*cp >= 'A' && *cp <= 'F') {
      // Yes. Convert it to a number 10-15
      nibble = (*cp - 'A' + 10);
      // Flag to use the digit
      useIt = true;
    // No hexadecimal digit, ignore it.
    } else {
      useIt = false;
    }
    // Shall we use the digit?
    if (useIt) {
      // Yes. Move the previous 4 bits up
      byte <<= 4;
      // add in the digit
      byte |= nibble;
      // Are we at the second nibble of a byte?
      if (tick) {
        // Yes. put the byte into the vector and clear it to be re-used.
        rv.push_back(byte);
        byte = 0;
      }
      // Count up used nibbles
      tick = !tick;
    }
    cp++;
  }
  return rv;
}


//**************************************************************



//**********************************************************

#define FORMAT_SPIFFS_IF_FAILED true

#ifdef old_option
void listDir(fs::FS &fs, const char * dirname, uint8_t levels){
    Serial.printf("Listing directory: %s\r\n", dirname);

    File root = fs.open(dirname);
    if(!root){
        Serial.println("- failed to open directory");
        return;
    }
    if(!root.isDirectory()){
        Serial.println(" - not a directory");
        return;
    }

    File file = root.openNextFile();
    while(file){
        if(file.isDirectory()){
            Serial.print("  DIR : ");
            Serial.println(file.name());
            if(levels){
                listDir(fs, file.path(), levels -1);
            }
        } else {
            Serial.print("  FILE: ");
            Serial.print(file.name());
            Serial.print("\tSIZE: ");
            Serial.println(file.size());
        }
        file = root.openNextFile();
    }
}

void readFile(fs::FS &fs, const char * path){
    Serial.printf("Reading file: %s\r\n", path);

    File file = fs.open(path);
    if(!file || file.isDirectory()){
        Serial.println("- failed to open file for reading");
        return;
    }

    Serial.println("- read from file:");
    while(file.available()){
        Serial.write(file.read());
    }
    file.close();
}


void readFile_web(fs::FS &fs, const char * path){
    Serial.printf("Reading file: %s\r\n", path);

    File file = fs.open(path);
    if(!file || file.isDirectory()){
        Serial.println("- failed to open file for reading");
        return;
    }

    Serial.println("- read from file:");
    while(file.available()){
        //Serial.write(file.read());
        //client.println(file.read());
    }
    file.close();
}

void writeFile(fs::FS &fs, const char * path, const char * message){
    Serial.printf("Writing file: %s\r\n", path);

    File file = fs.open(path, FILE_WRITE);
    if(!file){
        Serial.println("- failed to open file for writing");
        return;
    }
    if(file.print(message)){
        Serial.println("- file written");
    } else {
        Serial.println("- write failed");
    }
    file.close();
}

void appendFile(fs::FS &fs, const char * path, const char * message){
    Serial.printf("Appending to file: %s\r\n", path);

    File file = fs.open(path, FILE_APPEND);
    if(!file){
        Serial.println("- failed to open file for appending");
        return;
    }
    if(file.print(message)){
        Serial.println("- message appended");
    } else {
        Serial.println("- append failed");
    }
    file.close();
}

void renameFile(fs::FS &fs, const char * path1, const char * path2){
    Serial.printf("Renaming file %s to %s\r\n", path1, path2);
    if (fs.rename(path1, path2)) {
        Serial.println("- file renamed");
    } else {
        Serial.println("- rename failed");
    }
}

void deleteFile(fs::FS &fs, const char * path){
    Serial.printf("Deleting file: %s\r\n", path);
    if(fs.remove(path)){
        Serial.println("- file deleted");
    } else {
        Serial.println("- delete failed");
    }
}

void testFileIO(fs::FS &fs, const char * path){
    Serial.printf("Testing file I/O with %s\r\n", path);

    static uint8_t buf[512];
    size_t len = 0;
    File file = fs.open(path, FILE_WRITE);
    if(!file){
        Serial.println("- failed to open file for writing");
        return;
    }

    size_t i;
    Serial.print("- writing" );
    uint32_t start = millis();
    for(i=0; i<2048; i++){
        if ((i & 0x001F) == 0x001F){
          Serial.print(".");
        }
        file.write(buf, 512);
    }
    Serial.println("");
    uint32_t end = millis() - start;
    Serial.printf(" - %u bytes written in %u ms\r\n", 2048 * 512, end);
    file.close();

    file = fs.open(path);
    start = millis();
    end = start;
    i = 0;
    if(file && !file.isDirectory()){
        len = file.size();
        size_t flen = len;
        start = millis();
        Serial.print("- reading" );
        while(len){
            size_t toRead = len;
            if(toRead > 512){
                toRead = 512;
            }
            file.read(buf, toRead);
            if ((i++ & 0x001F) == 0x001F){
              Serial.print(".");
            }
            len -= toRead;
        }
        Serial.println("");
        end = millis() - start;
        Serial.printf("- %u bytes read in %u ms\r\n", flen, end);
        file.close();
    } else {
        Serial.println("- failed to open file for reading");
    }
}
#endif
//***********************************************************


String divonc01 = "<div class='zonehead'><a href='#Status'>Status<img></a></div>";
String divonc01h = "<div class='zonehead' style='display: none;'><a href='#Status'>Status<img></a></div>";
String div_c01 = divonc01;

String divonc02 = "<div class='zonehead'><a href='#IP Setting'>IP Setting<img></a></div>";
String divonc02h = "<div class='zonehead' style='display: none;'><a href='#IP Setting'>IP Setting<img></a></div>";
String div_c02 = divonc02;

String divonc03 = "<div class='zonehead'><a href='#TCP Setting'>TCP Setting<img></a></div>";
String divonc03h = "<div class='zonehead' style='display: none;'><a href='#TCP Setting'>TCP Setting<img></a></div>";
String div_c03 = divonc03;

String divonc04 = "<div class='zonehead'><a href='#RS485 Setting'>RS485 Setting<img></a></div>";
String divonc04h = "<div class='zonehead' style='display: none;'><a href='#RS485 Setting'>RS485 Setting<img></a></div>";
String div_c04 = divonc04;
//   style='display: none;'

String divonc05 = "<div class='zonehead'><a href='#Sensor Values'>Sensor Werte<img></a></div>";
String divonc05h = "<div class='zonehead' style='display: none;'><a href='#Sensor Values'>Sensor Werte<img></a></div>";
String div_c05 = divonc05;

String divonc06 = "<div class='zonehead'><a href='#Mesh'>Mesh<img></a></div>";
String divonc06h = "<div class='zonehead' style='display: none;'><a href='#Mesh'>Mesh<img></a></div>";
String div_c06 = divonc06;

String divonc07 = "<div class='zonehead'><a href='#MQTT'>MQTT<img></a></div>";
String divonc07h = "<div class='zonehead' style='display: none;'><a href='#MQTT'>MQTT<img></a></div>";
String div_c07 = divonc07;

String divonc08 = "<div class='zonehead'><a href='#Cloud'>Cloud<img></a></div>";
String divonc08h = "<div class='zonehead' style='display: none;'><a href='#Cloud'>Cloud<img></a></div>";
String div_c08 = divonc08;

String divonc09 = "<div class='zonehead'><a href='#LED'>LED<img></a></div>";
String divonc09h = "<div class='zonehead' style='display: none;'><a href='#LED'>LED<img></a></div>";
String div_c09 = divonc09;
#ifdef old_option
String divonc10 = "<div class='zonehead'><a href='#Push'>Push Setting<img></a></div>";
String divonc10h = "<div class='zonehead' style='display: none;'><a href='#Push'>Push Setting<img></a></div>";
String div_c10 = divonc10;

String divonc11 = "<div class='zonehead'><a href='#Fan'>FAN<img></a></div>";
String divonc11h = "<div class='zonehead' style='display: none;'><a href='#Fan'>FAN<img></a></div>";
String div_c11 = divonc11;
#endif
String divonc12 = "<div class='zonehead'><a href='#Tools'>Tools<img></a></div>";
String divonc12h = "<div class='zonehead' style='display: none;'><a href='#Tools'>Tools<img></a></div>";
String div_c12 = divonc12;
#ifdef old_option
String divonc13 = "<div class='zonehead'><a href='#Logs'>Logs<img></a></div>";
String divonc13h = "<div class='zonehead' style='display: none;'><a href='#Logs'>Logs<img></a></div>";
String div_c13 = divonc13;
#endif
String divonc14 = "<div class='zonehead'><a href='#Freshbox'>Freshbox<img></a></div>";
String divonc14h = "<div class='zonehead' style='display: none;'><a href='#Freshbox'>Freshbox<img></a></div>";
String div_c14 = divonc14;

String divonc19 = "<div class='zonehead'><a href='#LED'>AO<img></a></div>";
String divonc19h = "<div class='zonehead' style='display: none;'><a href='#AO'>AO<img></a></div>";
String div_c19 = divonc19;

//-------------------------
// on off
String divonc15 = "<div class='zonehead'><a href='#Freshbox'>Freshbox<img></a></div>";
String divonc15h = "<div class='zonehead' style='display: none;'><a href='#Freshbox'>Freshbox<img></a></div>";
String div_c15 = divonc15;


// p_mesh_in = "meshin' onclick='meshin()'>";
// "var s_mesh_in =  \"<div id='"+ div_c01 + "</div>\";" +        <div id='"+ div_c01 + "</div>


// Auxiliar variables to store the current output state
#define DNS_INPUTNAME_LEN   10
#define MB_PORT_LEN   4
#define ntp_LEN 30
String output26State = "off";
String output27State = "off";

uint8_t tempgetmode;  
String pvalue_t = "";
String p_inputstaticip = "152.158.158.251";
String p_inputipchange = "0";
String p_inputsubnetmask = "255.255.255.0";
String p_inputgateway = "192.168.178.1";
String p_inputwifidns = "192.168.178.1";
String p_inputntp = "pool.ntp.org";
char p_inputntpc[ntp_LEN+1] = "pool.ntp.org";
char p_inputntp_char[30] = "pool.ntp.org";

char p_inputnamec[DNS_INPUTNAME_LEN+1] = "tracer";

#define APname_LEN   22
char p_APname_c[APname_LEN+1] = "Radon Tracer";
String p_APname_p = "Radon Tracer         ";

String p_inputname = "tracer";
String p_inputtcpport = "502";
char p_inputtcpportc[MB_PORT_LEN+1] = "502";
String p_inputwebport = "80";
char p_inputwebportc[MB_PORT_LEN+1] = "80";
String p_inputbaudrate = "9600";
String p_inputdatabits = "8";
String p_inputparity = "none";
String p_inputstopbit = "1";
String p_inputrestimeout = "1000";
String p_MB_scan_resault = " -- ";
String p_MB_scan_resaulta = " -- ";
String p_MB_scan_resaults = " -- ";
String p_MB_scan_resault2 = " [-] ";
String p_cloud_ID_resault = "00000000";
String p_mez_resault = "----";
bool g_mb_sensor_online = false;

String p_xml_html = "<a href='http://modbus.local/radon.xml' target='_blank'>XML</a>";
String p_xml_html2 = "<a href='http://modbus.local/radon.html' target='_blank'>HTML</a>";


String p_uhrzeit = "00.00.00 00:00:00";
String p_time = "00:00:00";
String p_uhrzeit_last = "00.00.00 00:00:00";
String p_uhrzeit2 = "00.00.00 00:00";
String p_time_mesh_uplod = "--:--:--";
String p_time_mesh_uplod_s = " Last Upload --:--:--";

#define IP_ROOM_LEN 15
char p_inputip01c[IP_ROOM_LEN+1] = "000.000.000.000";
char p_inputip02c[IP_ROOM_LEN+1] = "000.000.000.000";
char p_inputip03c[IP_ROOM_LEN+1] = "000.000.000.000";
char p_inputip04c[IP_ROOM_LEN+1] = "000.000.000.000";
char p_inputip05c[IP_ROOM_LEN+1] = "000.000.000.000";
String p_inputip01 = "000.000.000.000";
String p_inputip02 = "000.000.000.000";
String p_inputip03 = "000.000.000.000";
String p_inputip04 = "000.000.000.000";
String p_inputip05 = "000.000.000.000";
String p_mesh_IP_resault = p_inputip01;
String p_ipparson = "0";
String p_room01 = "----------";
String p_room02 = "----------";
String p_room03 = "----------";
String p_room04 = "----------";
String p_room05 = "----------";
byte ip_write_sel = 0;

String divhidden = "<div id='hidden' hidden>";
String divhidden2 = "<tr style='display: none;'>";   
String divon2 = "<tr>";  
String divon = "<div id='on'>";

String div01 = divhidden;
String div02 = divhidden;
String div03 = divhidden;
String div04 = divhidden;
String div05 = divhidden;

String divpw = divhidden2;
String divsetting = divhidden2;


String tr_h_1 = divhidden2;  // divon2  Cloud
String tr_h_2 = divhidden2;  //   MQTT
String tr_h_3 = divhidden2;  //   Mesh
String tr_h_4 = divhidden2;  //   Lüfter Alarm
String tr_h_5 = divhidden2;  //   Push
String tr_h_6 = divhidden2;  //   Freshbox
String tr_h_7 = divhidden2;  //   html  xml

String tr_h_1a = divhidden2;  // divon2  Cloud
String tr_h_2a = divhidden2;  //   MQTT
String tr_h_3a = divhidden2;  //   Mesh
String tr_h_4a = divhidden2;  //   Lüfter Alarm
String tr_h_5a = divhidden2;  //   Push
String tr_h_6a = divhidden2;  //   Freshbox
String tr_h_7a = divhidden2;  //   html  xml

String plattern_sum = "";

String divrn = "<div id=\"webpage\">";
String divr = "<div id=\"webpager\">";
String divg = "<div id=\"webpageg\">";
String div01rg = divr;
String div02rg = divr;
String div03rg = divr;
String div04rg = divr;
String div05rg = divr;

String request_remoteIP_temp = "192.168.178.100";
String request_remoteIP_01 = "192.168.178.100";
String request_remoteIP_02 = "192.168.178.100";
String request_remoteIP_03 = "192.168.178.100";
String request_remoteIP_04 = "192.168.178.100";

String divGateway_hid = "<div class='toggle text'>";  
String divGateway_hid0 = "<div class='toggle text' style='display: none;>";     
String divGateway_hid1 = divGateway_hid;

String divGateway_hid_2 = "<tr>";  
String divGateway_hid0_2 = "<tr style='display: none;'>";     
String divGateway_hid1_2 = divGateway_hid_2;

String divGateway_hid_3 = "<tr>";  
String divGateway_hid0_3 = "<tr style='display: none;'>";     
String divGateway_hid1_3 = divGateway_hid_3;

String divGateway_hid_4 = "<tr>";  
String divGateway_hid0_4 = "<tr style='display: none;'>";     
String divGateway_hid1_4 = divGateway_hid_4;

String divGateway_hid_5 = "<tr>";  
String divGateway_hid0_5 = "<tr style='display: none;'>";     
String divGateway_hid1_5 = divGateway_hid_5;

String divgrau = "<div id='webpagegrau'>";
String divgreen = "<div id='webpagegruen'>";
String divred = "<div id='webpagered'>";
String divorange = "<div id='webpageorange'>";
#ifdef vent_option
String divfan1 = divgrau;
String divfan2 = divgrau;
String divfan3 = divgrau;
String divfan4 = divgrau;
String divfan5 = divgrau;
String divfan6 = divgrau;
String divfan7 = divgrau;
#endif
String divfan_hid0 = "display: none;";
String divfan_hid1 = "";
String divfan_hid = divfan_hid0;
String divfanq_hid = divfan_hid0;


String divstatus1 = divgrau;  //cloud
String divstatus2 = divgrau;   //mqtt
String divstatus3 = divgrau;   //mesh
String divstatus4 = divgrau;   //MB
String divstatus5 = divgrau;  //wifi
String divstatus6 = divgrau;  //ntp
String divstatus7 = divgrau;  //lüfter
String divstatus8 = divgrau;  //push
String divstatus9 = divgrau;  //Freshbox
String divstatus10 = divgrau;  //Freshbox Wächter

#ifdef vent_option  
  String divpwgrau = "<div id='divpwgrau'>";
  String divpwgreen = "<div id='divpwgreen'>";
  String divpower01 = divpwgrau;
  String divpower02 = divpwgrau;
  String divpower03 = divpwgrau;
  String divpower04 = divpwgrau;
  String divpower05 = divpwgrau;
  String divpower06 = divpwgrau;
  String divpower07 = divpwgrau;
  String divpower08 = divpwgrau;
  String divpower09 = divpwgrau;
  String divpower10 = divpwgrau;
  String divpower11 = divpwgrau;
  String divpower12 = divpwgrau;
  String divpower13 = divpwgrau;
  String divpower14 = divpwgrau;
  String divpower15 = divpwgrau;
  String divpower16 = divpwgrau;
  String divpower17 = divpwgrau;
  String divpower18 = divpwgrau;
  String divpower19 = divpwgrau;
  String divpower20 = divpwgrau;
#endif


byte charcount = 0;
byte chartumlauf = 0;
byte charcountTime = 0;
//String chartime[51] = {"2021.06.01 14:30"," "," ","2021.06.01 14:30"," ","","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," ","","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," "," ","2021.06.01 14:30"," ","","2021.06.01 14:30"," "," "};


uint16_t charInts[44];
#ifdef old_option
uint16_t charInts3[44];
uint16_t charInts4[44];

uint16_t charInts5[44];
uint16_t charInts7[44];
uint16_t charInts8[44];
String charInts8_s[64] = "                                                                                                                       ";
#endif




byte charcount8 = 0;        // Zeilen inhalt der MQTT nicht übertragenen Dateien
bool gcharcount8Del = false;

uint16_t charInts9[64];
uint16_t charInts10[64];
String tempchar = "         ";
byte charcount9 = 0;        // Zeilen inhalt der MQTT nicht übertragenen Dateien
byte charcount10 = 0;        // Zeilen inhalt der MQTT nicht übertragenen Dateien
bool gcharcount9Del = false;
bool gcharcount10Del = false;

String chartimexx = "              ";
String chartime00 = "00.00.00 00:00";
String chartime00a = "              ";
String chartime00b = "              ";
String chartime01 = "              ";
String chartime01a = "              ";
String chartime01b = "              ";
String chartime02 = "              ";
String chartime02a = "              ";
String chartime02b = "              ";
String chartime03 = "              ";
String chartime03a = "              ";
String chartime03b = "              ";
String chartime04 = "              ";
String chartime04a = "              ";
String chartime04b = "              ";
String chartime05 = "              ";
String chartime05a = "              ";
String chartime05b = "              ";
String chartime06 = "              ";
String chartime06a = "              ";
String chartime06b = "              ";
String chartime07 = "              ";
String chartime07a = "              ";
String chartime07b = "              ";
String chartime08 = "              ";
String chartime08a = "              ";
String chartime08b = "              ";
String chartime09 = "              ";
String chartime09a = "              ";
String chartime09b = "              ";
String chartime10 = "              ";
String chartime10a = "              ";
String chartime10b = "              ";
String chartime11 = "              ";
String chartime11a = "              ";
String chartime11b = "              ";
String chartime12 = "              ";
String chartime12a = "              ";
String chartime12b = "              ";
String chartime13 = "              ";
String chartime13a = "              ";
String chartime13b = "              ";
String chartime14 = "              ";
String chartime14a = "              ";
String chartime14b = "              ";


String stringtime = "labels : ['2023-01-01 00:12','','2023-01-01 00:11','','2023-01-01 00:10','','2023-01-01 00:09','','2023-01-01 00:08','','2023-01-01 00:07','','2023-01-01 00:06','','2023-01-01 00:05','','2023-01-01 00:04','','2023-01-01 00:03','','023-01-01 00:01','','023-01-01 00:01','',],";
String stringdata = "data : [38095, 35056, 35056, 33507, 33057, 35307, 35005, 30055, 25090, 29055, 34057, 30750, 37050, 35700, 35045, 31054, 30145, 31504, 28506, 28056, 28650, 28605, 28052, 28052, 35005, 30055, 25090, 29055, 34057, 30750, 37050, 35700, 35045, 31054, 30145, 31504, 28506, 28056, 28650, 28605, 28052, 28052, ],";

String stringtime2 = "labels : ['1','2','3','4','5','6','7','8','9','10','11','12','13','Now',],";
String stringdata2 = "data : [2550, 4241, 4141, 1422, 4554, 4278, 3232, 4225, 4120, 3614, 5025, 5056, 4643, 4114,],";

String rgbchartvorgabeNor = "rgb(62,149,205)";
String rgbchartvorgabeSel = "rgb(51,255,0)";
String rgbchart01 = "rgb(62,149,205)";
String rgbchart02 = "rgb(62,149,205)";
String rgbchart03 = "rgb(62,149,205)";
String rgbchart04 = "rgb(62,149,205)";
String rgbchart05 = "rgb(62,149,205)";
String rgbchart06 = "rgb(62,149,205)";
String rgbchart07 = "rgb(62,149,205)";
String rgbchart08 = "rgb(62,149,205)";
String rgbchart09 = "rgb(62,149,205)";
String rgbchart10 = "rgb(62,149,205)";
String rgbchart11 = "rgb(62,149,205)";
String rgbchart12 = "rgb(62,149,205)";
String rgbchart13 = "rgb(62,149,205)";
String rgbchart14 = "rgb(51,255,0)";




byte chart_page = 0;
bool gauge_page = false;
byte pauseWebpage = 10;
byte pauseErrorFan = 0;
bool timeSyncron = false;

#define MQTT_CLIENTID_LEN   48
#define MQTT_SERVER_LEN     40
#define MQTT_PORT_LEN        4
#define MQTT_USER_LEN       40
#define MQTT_PASS_LEN       40
#define MQTT_TOPIC          50

char subTopic[]         = "ledControl" ;     //payload[0] will control/set LED
char pubTopic[]         = "ledState2"  ;       //payload[0] will have ledState value





bool gMQTTUpdateFlag = false;
bool gMQTTConnectFlag = false;
//bool MQTTFailUpdateFlag = false;

bool gLEDColorUpdateFlag = false;
bool gGRAPHUpdateFlag = false;
bool gGRAPHReadFlag = true;


bool mqttdAktiveConfig = false;
bool freshdAktiveConfig = false;
bool freshdAktiveRead = false;

bool freshdAktiveRead1 = false;
bool freshdAktiveRead2 = false;
bool freshdAktiveRead3 = false;
bool freshdAktiveRead4 = false;
bool freshdAktiveRead5 = false;
bool freshdAktiveRead6 = false;

bool freshdUDPIncomming = false;
byte freshreWriteafteron = 0;
bool freshreWriteOffAfter = false; 
bool g_senden_ferig = false;
bool m_analge_war_aus = false;
bool m_analge_war_kalendermodus = false;
bool m_analge_muss_aus_schalten = false;


String p_mqonoff = "off";


String p_freshonoff = "off";


String p_inputmqclient = "";
char p_inputmqclientc[MQTT_CLIENTID_LEN+1] = "";

String p_inputmqserver = "dashboard.livair.io";
char p_inputmqserverc[MQTT_SERVER_LEN+1] = "dashboard.livair.io";  // (207,154,203,193);  // livair.io

String p_inputmqoptions = "1";    //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
String p_inputmqoptionst;
uint8_t p_inputmqoptionsi = 1;

String p_inputmqmesh = "0";    //0 = aus    1-10 = Anzahl
uint8_t p_inputmqmeshi = 0;

String p_inputmqport = "1883";
uint16_t p_inputmqporti = 1883;

String p_inputmquser = "usertoken"; //TOKEN
char p_inputmquserc[MQTT_USER_LEN+1] = "usertoken";

String p_inputmqpass = "";
char p_inputmqpassc[MQTT_PASS_LEN+1] = "";

String p_inputmqtopic = "radon";             //radonvalue/feeds/radon.radon
char p_inputmqtopicc[MQTT_TOPIC+1] = "radon";

String p_inputmqtopic1 = "eintraege";             //co2value/feeds/radon.radon
char p_inputmqtopic1c[MQTT_TOPIC+1] = "eintraege";

String p_inputmqtopic2 = "sernr";             //TVOCvalue/feeds/radon.radon
char p_inputmqtopic2c[MQTT_TOPIC+1] = "sernr";

String p_inputmqtopic3 = "radonvalue/feeds/radon.deviceid";            
char p_inputmqtopic3c[MQTT_TOPIC+1] = "radonvalue/feeds/radon.deviceid";

const char publishTopic[] = "v1/devices/me/telemetry"; 

const char publishTopic2[] = "/provision/request";    //client.publish        
char PROV_RESPONSE_TOPICp[] PROGMEM = "/provision/response";  // client.subscribe

//char subTopicOK[]         = "activityMsg" ;     //payload[0] will activityMsg
char RESPONSE_SUBSCRIBE_TOPIC[] PROGMEM = "v1/devices/me/attributes/response/+";     // client.subscribe    "v1/devices/me/attributes" -u "$ACCESS_TOKEN" -m "{"attribute1": "value1", "attribute2": true}"
const char publishTopic3[] = "v1/devices/me/attributes"; 
const char publishTopic3s[] = "v1/devices/me/rpc"; 
const char publishTopic4[] = "v1/devices/me/attributes/response/+"; 

const char publishTopic5[]  PROGMEM = "v1/devices/me/rpc/response/+";
const char publishTopic6[]  PROGMEM = "v1/devices/me/rpc/request/1";
const char publishTopic7[]  PROGMEM = "v2/fw/response/#";
const char publishTopic8[]  PROGMEM = "v1/devices/me/attributes/SERVER_SCOPE";
const char publishTopic9[]  PROGMEM = "v1/devices/me/attributes/SHARED_SCOPE";
const char publishTopic10[] PROGMEM = "v1/devices/me/attributes/response"; 

const char publishTopic11[] PROGMEM = "v1/devices/me/attributes/request/1"; 
const char publishTopic12[] PROGMEM = "v1/devices/me/attributes/response/lastSync"; 

//constexpr char ATTRIBUTE_RESPONSE_SUBSCRIBE_TOPIC[] PROGMEM = "v1/devices/me/attributes/response/+";
//constexpr char ATTRIBUTE_RESPONSE_TOPIC[] PROGMEM = "v1/devices/me/attributes/response";



uint8_t gACCESS_TOKENFlag = 0;  // provision fertig
uint8_t gReboot_TOKENFlag = 0;    // nur neu Speichern wenn Zeit abgelaufen ist
uint8_t gReboot_TOKENFlag2 = 0;   // MQTT nur neu Speichern wenn Zeit abgelaufen ist    1= Sensor abgefragt
bool gLostvaluesFlag = false;
bool gLostuploadlag = false;
uint8_t gALast_DataentryFlag = 0;

String p_inputmqtopic4 = "speed";
String p_inputmqtopic5 = "power";
String p_inputmqtopic6 = "score";

String p_uptime = "--------";
String p_uptime2 = "--------";
unsigned long esp32_uptime = 0;

String p_rs485_data = "0";
String p_rs485_data_b = "0";
String p_rs485s_data = "0";
String p_rs485s_data_b = "0";

String mb_werteaktual = "Messwerte &auml;lter als 10min";
String mq_werteaktual = "MQTT deaktiviert";
String cloud_werteaktual = "Cloud deaktiviert";
String p_clouduploud = "          -          ";
String cloud_aktiv = " class='Stil1' ";
String mesh_aktiv = " class='Stil1' ";
String mQtt_aktiv = " class='Stil1' ";
String lEd_aktiv = " class='Stil1' "; 
String ao1_aktiv = " class='Stil1' "; 
String push_aktiv = " class='Stil1' "; 
String led_werteaktual = "LED deaktiviert";
String ao1_werteaktual = "AO1 deaktiviert";
String mesh_werteaktual = "Mesh deaktiviert";
String mesh_01_val = " class='Stil1' ";
String mesh_02_val = " bgcolor='#00CCCC' ";
String mesh_03_val = " class='Stil1' ";
String mesh_04_val = " class='Stil1' ";
String mesh_05_val = " class='Stil1' ";
String cloud_link = "<a href='http://www.auto-steuerung.de/wetter/air9/chart.php?streamid=1gh78569edKL&messid=13' target='_blank'>Cloud Anlalyse</a>";
uint16_t cloud_connect_error_count = 0;

String fresh_aktiv = " class='Stil1' ";
String fresh_werteaktual = "Freshbox deaktiviert";
String s_freshbox="                                                                                                       ";


String push_werteaktual = "Push deaktiviert";
String van_werteaktual = "FAN deaktiviert";
String van_aktiv = " class='Stil1' "; 

String splitAdress = p_inputstaticip;
uint8_t count_split = 0;
uint8_t ones,tens,hundreds;

//String strings[10]; // Max amount of strings anticipated



String zone_view = "";
//--------------------------------------------------------------------------------------------
//#ifndef WIFI_nur_LED
  bool ledAktiveConfig = false;
//#else
  //bool ledAktiveConfig = true;
//#endif
 bool ao1AktiveConfig = false;
bool gledUpdateFlag = false;
bool gao1UpdateFlag = true;
bool vanAktiveConfig = false;
bool gvanUpdateFlag = false;
bool b_WriteLedValue = false;
bool b_Writeao1Value = false;
#ifdef vent_option
bool b_WritevanValue =  false;
#endif
bool b_WriteCloudValue = false;



#define ao1_OG_LEN     7
String p_inputao1og = "5000";
char p_inputao1ogc[ao1_OG_LEN+1] = "5000";

#define ao1_UG_LEN     7
String p_inputao1ug = "50";
char p_inputao1ugc[ao1_UG_LEN+1] = "50";

#define ao1_OPTION_LEN     1
String p_inputao1option = "0";
char p_inputao1optionc[ao1_OPTION_LEN+1] = "0";

#define ao1_KORR_LEN     7
String p_inputao1korrektur = "0";
char p_inputao1korrekturc[ao1_KORR_LEN+1] = "0";

#define ao1_KORR2_LEN     7
String p_inputao1korrektur2 = "0";
char p_inputao1korrektur2c[ao1_KORR2_LEN+1] = "0";

#define ao1_NAMUR_LEN     1
String p_inputao1namur = "0";
char p_inputao1namurc[ao1_NAMUR_LEN+1] = "0";


//#ifndef WIFI_nur_LED
   String p_ledonoff = "off";
//#else
  // String p_ledonoff = "on";
//#endif


#define LED_RED_LEN     5
String p_inputledred = "600";
char p_inputledredc[LED_RED_LEN+1] = "600";

#define LED_ORANGE_LEN     5
String p_inputledorange = "300";
char p_inputledorangec[LED_ORANGE_LEN+1] = "300";

#define LED_GREEN_LEN     5
String p_inputledgreen = "100";
char p_inputledgreenc[LED_GREEN_LEN+1] = "100";

#define LED_Funktion_LEN     5
String p_inputledfunk = "radon";
char p_inputledfunkc[LED_Funktion_LEN+1] = "radon";

#define LED_06_LEN     5
String p_inputledgamma = "200";
char p_inputledgammac[LED_06_LEN+1] = "200";


#ifdef vent_option
String p_vanonoff = "off";
String p_inputvanmax = "600";
String p_inputvanmin = "300";
#endif


//Pushover  Pushsafer
String PushsaferKey = "11111NoaO1ohRpg222226677     ";
bool pushAktiveConfig = false;
bool gpushUpdateFlag = false;
bool gpushUpdateFlag_SR = false;
bool gpushOnlineUpdateFlag = false;
String p_pushonoff = "off";

#define PUSH_KEY_LEN     30
String p_pushkey = "11111NoaO1ohRpg222226677     ";   //XqLUBNqaO1oaRpggaX0h
char p_pushkeyc[PUSH_KEY_LEN+1] = "11111NoaO1ohRpg222226677";   //XqLUBNqaO1oaRpggaX0h

#define PUSH_MESSAGE_LEN     100
String p_pushmessage = "ESP Push Message                                                                                   ";  
char p_pushmessagec[PUSH_MESSAGE_LEN+1] = "ESP Push Message";   

#define PUSH_TITEL_LEN     30
String p_pushtitle = "ESP Push Titel               ";  
char p_pushtitlec[PUSH_TITEL_LEN+1] = "ESP Push Titel";   

#define PUSH_SOUND_LEN     3
String p_pushsound = "8";  
char p_pushsoundc[PUSH_TITEL_LEN+1] = "8";  

#define PUSH_Vibration_LEN     3
String p_pushvibration = "3";  
char p_pushvibrationc[PUSH_Vibration_LEN+1] = "3";  

#define PUSH_ICON_LEN     3
String p_pushicon = "91";  
char p_pushiconc[PUSH_ICON_LEN+1] = "91"; 

#define PUSH_Iconcolor_LEN     7
String p_pushiconcolor = "FF0000";  
char p_pushiconcolorc[PUSH_Iconcolor_LEN+1] = "FF0000"; 

#define PUSH_Priority_LEN     3
String p_pushpriority = "2";  
char p_pushpriorityc[PUSH_Priority_LEN+1] = "2"; 

#define PUSH_Device_LEN     8
String p_pushdevice = "41828";  
char p_pushdevicec[PUSH_Device_LEN+1] = "41828"; 

#define PUSH_VALUE_LEN     5
String p_pushvalue = "300";  
char p_pushvaluec[PUSH_VALUE_LEN+1] = "300"; 
uint16_t p_pushvaluei = 300;

uint16_t push_val_vorgabe = 0;

bool gSensorLogFlag = false;
bool minUpdateFlag = false;
bool cloudAktiveConfig = false;
bool gcloudUpdateFlag = false;  
bool gSensordRadonFlag = false;
bool gSensorReRadonFlag = false;
bool g_clod_time_upload = true;
String p_cloudonoff = "off";
String p_ao1onoff = "off";
bool b_secure_flag = false;

bool g1_15minRadonFlag = false;
bool g2_15minRadonFlag = false;
bool g3_15minRadonFlag = false;

#define CLOUD_SERVER_LEN     40
String p_inputcloudserver = "rec.radoncloud.com";
char p_inputcloudserverc[CLOUD_SERVER_LEN+1] = "rec.radoncloud.com";

#define CLOUD_USER_LEN     20
String p_inputclouduser = "user";
char p_inputclouduserc[CLOUD_USER_LEN+1] = "user";

#define CLOUD_DEVICE_LEN     5
String p_inputclouddevice = "5487";
char p_inputclouddevicec[CLOUD_DEVICE_LEN+1] = "5487";

#define CLOUD_KEY_LEN     40
String p_inputcloudkey = "3as44643euW";
char p_inputcloudkeyc[CLOUD_KEY_LEN+1] = "3as44643euW";

#define CLOUD_inter_LEN     2
String p_inputcloudinter = "15";
char p_inputcloudinterc[CLOUD_inter_LEN+1] = "15";
uint16_t p_inputcloudinteri = 15; 

#define DB_PAGE_LEN 80
String p_inputcloudpage = "s_get.php";
char p_inputcloudpagec[DB_PAGE_LEN+1] = "s_get.php";  

#define DB_PRE_LEN 40
String p_inputcloudpre = "submit=Daten";
char p_inputcloudprec[DB_PRE_LEN+1] = "submit=Daten";  

#define DB_PORT_LEN 4
String p_inputcloudport = "443";
char p_inputcloudportc[DB_PORT_LEN+1] = "443"; 

int16_t p_inputcloudporti = 443;

bool b_RadonCloudUpload3 = false;
bool gcloudWIFIFlag = false;

bool b_RadonCloudUpload4 = true;

#define DB_CHAIN_LEN 6
String p_inputcloudchain = "&p";
char p_inputcloudchainc[DB_CHAIN_LEN+1] = "&p"; 

String cloud_result = "https://loragate2.de/LoRaWAN-Live-Link-K1-W64rt39bd41np75L/loraradon.php?submit=Daten&p0=1680496727&p1=127&p2=74:42:7F:4A:A5:4B&p3=TD474968&p4=121&p5=123&p6=2880";




String p_inputpasswort = "";
String p_inputpasswort_vorgabe = "tracerroot";
#define PW_VORG_LEN 15
char p_inputpasswort_vorgabec[PW_VORG_LEN+1] = "tracerroot"; 

String p_inputpasswort_vorgabe2 = "";
uint16_t p_inputpasswort_vorgabe_calc = 0;  
String p_inputpasswort_admin = "admin#x2";  
String p_inputpwchange = "         ";

bool g_restart_pw_change = false;
uint8_t g_restart_pw_change_t = 3;

String p_inputsavebit = "savebit";
String p_inputsavebit_txt = "";
String p_fansavebit = "savebit";
String p_fansavebit_txt = "";
String p_logout = "logout' onclick='logout()'>";
String p_login = "login' onclick='login()'>";
String p_logout_or_in = " style='display: none;>";  

String p_chartout = "chartout' onclick='chartout()'>";        // get?inputchart=7
String p_chart2out = "chart2out' onclick='chart2out()'>";
String p_chartin = "chartin' onclick='chartin()'>";
String p_chart2in = "chart2in' onclick='chart2in()'>";
String p_chart_or_in = p_chartin;
String p_chart2_or_in = p_chart2in;
String p_chartco2 = "chart2in' onclick='chart2in()'>";

String p_co2_in = "co2in' onclick='co2in()'>";


String p_mesh_in_h = "o'>";
String p_mesh_in_v = "meshin' onclick='meshin()'>";
String p_mesh_in = p_mesh_in_v;

String p_meshchart_in2_h = " "; 
String p_meshchart_in2_v = "<div id='chartout4' onclick=\"top.location.href='/get?inputchart=4'\"></div>";  
String p_meshchart_in2 = p_meshchart_in2_h; 


String p_home_in_h = "o'>";
String p_home_in_v = "homein' onclick='homein()'>";
String p_home_in = p_home_in_v;

String p_homechart_in2_h = " "; 
String p_homechart_in2_v = "<div id='chartout7' onclick=\"top.location.href='/get?inputchart=0'\"></div>";  
String p_homechart_in2 = p_homechart_in2_v; 


String p_van_in_h = "o'>";
String p_van_in_v = "vanin' onclick='vanin()'>";
String p_van_in = p_van_in_v;

String p_vanchart_in2_h = " "; 
String p_vanchart_in2_v = "<div id='chartout6' onclick=\"top.location.href='/get?inputchart=6'\"></div>";  
String p_vanchart_in2 = p_vanchart_in2_h; 
String p_vanconf_in3_h = " "; 
String p_vanconf_in3_v = "<div id='chartout5' onclick=\"top.location.href='/get?inputchart=5'\"></div>";  
String p_vanconf_in3 = p_vanconf_in3_h; 

#ifdef vent_option
String p_vanchart_in_h = "o'>"; 
String p_vanchart_in_v = "chartout6' onclick='chartout6()'>";  // s_van_onoff  p_vanonoff
String p_vanchart_in = p_vanchart_in_h;   // \"<div id='"+ p_vanchart_in + "</div>\";" + 
#endif
 
String p_tr_hidden0 = "<tr id='result_tr' style='display: none;'>"; 
String p_tr_hidden1 = "<tr>"; 
String p_tr_hidden2 = p_tr_hidden0;
String p_tr_ad_hidden2 = p_tr_hidden0;
String p_tr_pwm = " off ";
String p_tr_pwm_i = p_tr_pwm;

String p_tr_hidden3 = p_tr_hidden0;


String p_co2chart_in2 = "<div id='chartout' onclick=\"top.location.href='/get?inputchart=7'\"></div><div id='chartout1' onclick=\"top.location.href='/get?inputchart=1'\"></div><div id='chartout2' onclick=\"top.location.href='/get?inputchart=2'\"></div>";
String p_co2chart_out2 = "<div id='chartout' onclick=\"top.location.href='/get?inputchart=7'\"></div><div id='chartout1' onclick=\"top.location.href='/get?inputchart=1'\"></div>";
String p_co2chart_hid = p_co2chart_in2;

String p_getapmodus = "";
String p_getreboot = "";
String p_getsearch = "";
String p_getscan = "";
String p_getdelete = "";
String p_getdeleteup = "";
String p_getgetgauge = "";
String p_getradonaktual = "";
String p_getTG1 = "";
String p_getTG2 = "";
String p_getTG3 = "";
String p_getTG4 = "";
String p_getQuitt = "";

String p_getfreshlearn = "";
String p_getwerksreset = "";
String p_getwerksportal = "";

uint8_t p_sett01t = 1;
uint8_t p_sett02t = 0;
uint8_t p_sett03t = 0;
uint8_t p_sett04t = 0;
uint8_t p_sett05t = 1;
uint8_t p_sett06t = 0;
uint8_t p_sett07t = 1;
uint8_t p_sett08t = 0;
//#ifndef WIFI_nur_LED
uint8_t p_sett09t = 0;
//#else
//uint8_t p_sett09t = 1;
//#endif
uint8_t p_sett10t = 0;
uint8_t p_sett11t = 0;
uint8_t p_sett13t = 0;
uint8_t p_sett14t = 0;

uint8_t p_sett15t = 0;
uint8_t p_sett16t = 0;
uint8_t p_sett17t = 0;
uint8_t p_sett18t = 0;
uint8_t p_sett19t = 0;

uint8_t p_sett20t = 1;
uint8_t p_sett21t = 1;
uint8_t p_sett22t = 1;
uint8_t p_sett29t = 0;

uint8_t p_sett01 = 1;
uint8_t p_sett02 = 0;
uint8_t p_sett03 = 0;
uint8_t p_sett04 = 0;
uint8_t p_sett05 = 1;
uint8_t p_sett06 = 0;
uint8_t p_sett07 = 1;
uint8_t p_sett08 = 0;
//#ifndef WIFI_nur_LED
uint8_t p_sett09 = 0;
//#else
//uint8_t p_sett09 = 1;
//#endif
uint8_t p_sett10 = 0;
uint8_t p_sett11 = 0;
uint8_t p_sett13 = 0;
uint8_t p_sett14 = 0;

uint8_t p_sett15 = 0;
uint8_t p_sett16 = 0;   // MQTT on/off Setting   
uint8_t p_sett17 = 0;
uint8_t p_sett18 = 0; //cloud
uint8_t p_sett19 = 0; //AO Setting

uint8_t p_sett20 = 1;
uint8_t p_sett21 = 1;
uint8_t p_sett22 = 1;
uint8_t p_sett29 = 0; //AO on/off

String p_settxx = "  ";
bool bit_settx = false;
bool bit_setdiv = false;
bool bit_set_fan = false;
bool b_fan_Notmesh = false;
bool b_logoff = false;


String p_sett20_1 = "<input type='checkbox' id='setting20' name='setting20' value='1' checked='checked'>";
String p_sett20_0 = "<input type='checkbox' id='setting20' name='setting20' value='1'>";
String p_sett20_s = p_sett20_1;

String p_sett21_1 = "<input type='checkbox' id='setting21' name='setting21' value='1' checked='checked'>";
String p_sett21_0 = "<input type='checkbox' id='setting21' name='setting21' value='1'>";
String p_sett21_s = p_sett21_1;

String p_sett22_1 = "<input type='checkbox' id='setting22' name='setting22' value='1' checked='checked'>";
String p_sett22_0 = "<input type='checkbox' id='setting22' name='setting22' value='1'>";
String p_sett22_s = p_sett22_1;

String p_sett01_1 = "<input type='checkbox' id='setting01' name='setting01' value='1' checked='checked'>";
String p_sett01_0 = "<input type='checkbox' id='setting01' name='setting01' value='1'>";
String p_sett01_s = p_sett01_1;

String p_sett02_1 = "<input type='checkbox' id='setting02' name='setting02' value='1' checked='checked'>";  // IP Setting
String p_sett02_0 = "<input type='checkbox' id='setting02' name='setting02' value='1'>";
String p_sett02_s = p_sett02_0;

String p_sett03_1 = "<input type='checkbox' id='setting03' name='setting03' value='1' checked='checked'>"; // TCP Setting
String p_sett03_0 = "<input type='checkbox' id='setting03' name='setting03' value='1'>";
String p_sett03_s = p_sett03_0;

String p_sett04_1 = "<input type='checkbox' id='setting04' name='setting04' value='1' checked='checked'>";
String p_sett04_0 = "<input type='checkbox' id='setting04' name='setting04' value='1'>";
String p_sett04_s = p_sett04_0;

String p_sett05_1 = "<input type='checkbox' id='setting05' name='setting05' value='1' checked='checked'>";
String p_sett05_0 = "<input type='checkbox' id='setting05' name='setting05' value='1'>";
String p_sett05_s = p_sett05_1;

String p_sett06_1 = "<input type='checkbox' id='setting06' name='setting06' value='1' checked='checked'>";
String p_sett06_0 = "<input type='checkbox' id='setting06' name='setting06' value='1'>";
String p_sett06_s = p_sett06_0;

String p_sett07_1 = "<input type='checkbox' id='setting07' name='setting07' value='1' checked='checked'>";
String p_sett07_0 = "<input type='checkbox' id='setting07' name='setting07' value='1'>";
String p_sett07_s = p_sett07_1;

String p_sett08_1 = "<input type='checkbox' id='setting08' name='setting08' value='1' checked='checked'>";
String p_sett08_0 = "<input type='checkbox' id='setting08' name='setting08' value='1'>";
String p_sett08_s = p_sett08_0;

String p_sett09_1 = "<input type='checkbox' id='setting09' name='setting09' value='1' checked='checked'>";
String p_sett09_0 = "<input type='checkbox' id='setting09' name='setting09' value='1'>";
//#ifndef WIFI_nur_LED
String p_sett09_s = p_sett09_0;
//#else
//String p_sett09_s = p_sett09_1;
//#endif

#ifdef old_option
String p_sett10_1 = "<input type='checkbox' id='setting10' name='setting10' value='1' checked='checked'>";
String p_sett10_0 = "<input type='checkbox' id='setting10' name='setting10' value='1'>";
String p_sett10_s = p_sett10_0;

String p_sett11_1 = "<input type='checkbox' id='setting11' name='setting11' value='1' checked='checked'>";
String p_sett11_0 = "<input type='checkbox' id='setting11' name='setting11' value='1'>";
String p_sett11_s = p_sett11_0;

String p_sett13_1 = "<input type='checkbox' id='setting13' name='setting13' value='1' checked='checked'>";
String p_sett13_0 = "<input type='checkbox' id='setting13' name='setting13' value='1'>";
String p_sett13_s = p_sett13_0;
#endif

String p_sett14_1 = "<input type='checkbox' id='setting14' name='setting14' value='1' checked='checked'>";
String p_sett14_0 = "<input type='checkbox' id='setting14' name='setting14' value='1'>";
String p_sett14_s = p_sett14_0;


String p_sett15_1 = "<input type='checkbox' id='setting15' name='setting15' value='1' checked='checked'>";
String p_sett15_0 = "<input type='checkbox' id='setting15' name='setting15' value='1'>";
String p_sett15_s = p_sett15_0;

String p_sett16_1 = "<input type='checkbox' id='setting16' name='setting16' value='1' checked='checked'>";
String p_sett16_0 = "<input type='checkbox' id='setting16' name='setting16' value='1'>";
String p_sett16_s = p_sett16_0;   //

String p_sett17_1 = "<input type='checkbox' id='setting17' name='setting17' value='1' checked='checked'>";
String p_sett17_0 = "<input type='checkbox' id='setting17' name='setting17' value='1'>";
String p_sett17_s = p_sett17_0;

String p_sett18_1 = "<input type='checkbox' id='setting18' name='setting18' value='1' checked='checked'>";
String p_sett18_0 = "<input type='checkbox' id='setting18' name='setting18' value='1'>";
String p_sett18_s = p_sett18_0;   //

String p_sett19_1 = "<input type='checkbox' id='setting19' name='setting19' value='1' checked='checked'>";
String p_sett19_0 = "<input type='checkbox' id='setting19' name='setting19' value='1'>";
String p_sett19_s = p_sett19_0;

String p_sett29_1 = "<input type='checkbox' id='setting29' name='setting29' value='1' checked='checked'>";
String p_sett29_0 = "<input type='checkbox' id='setting29' name='setting29' value='1'>";
String p_sett29_s = p_sett29_0;

bool tG1_page = false;
bool tG2_page = false;
bool tG3_page = false;
bool tG4_page = false;
bool quitt_page = false;
uint8_t  tG_x_page = 0;
byte msg_TG[3];
byte msg_TGt;
byte msg_TGp[3];
byte msg_TGm[3];

uint8_t  select_reboot = 0;
uint8_t  select_apmodus = 0;
uint8_t  select_slave_scan = 1;  //0= aus  1= scan start  2= ohne Scan   
uint8_t  slave_scan_until = 10;
uint8_t baud_chance = 0;

uint8_t g_mb_tracer_online[11]; 
uint8_t g_mb_tracer_online_fail[11];
uint8_t g_mb_sensor_abfrage[11]; 
uint8_t g_mb_tracer_radon[11]; 
uint8_t g_mb_tracer_abfrage[11]; 
String g_mb_tracer_result[11];
uint8_t g_mb_sensor_found; 


uint8_t mb_tracer_number = 0;
uint8_t scan_ids_mb =0;

uint8_t mb_scan_id = 0;  
uint8_t start_slave_scan = 0;    //MESH 1= scan gestartet  0 = erneut starten
uint8_t scan_max = 11;
bool g_mb_mesh = true;

uint8_t  val_sensor_aktual = 0;
uint8_t  abfrage_eingabe = 0;
uint8_t  abfr_mb_finish = 0;
uint8_t  abfr_mb_finish_f4 = 0;
uint8_t  sensor_mb_ok = 0;
uint8_t client_id = 1;
uint32_t id_sec_time = 0;

uint8_t page_select = 1;
uint8_t web_write_ok = 0;
uint8_t Web_logout_time = 0;
uint8_t web_write_green_red = 0;
uint8_t web_reload = 0;
uint8_t MB_scan_resault = 0;

const char* PARAM_STRING = "inputString";
const char* PARAM_INT = "inputInt";
const char* PARAM_FLOAT = "inputFloat";

// Assign output variables to GPIO pins
const int output26 = 26;
const int output27 = 27;

uint8_t m_max_clients = 4;
uint32_t mbus_baud = 9600;  
uint16_t resp_tim_out = 1000;  
uint32_t mbus_baud_last = 9600;  


//************************************************************
  unsigned long millissave = millis();
  unsigned long  millissave_t;
//************************************************************

// Current time
unsigned long currentTime = millis();
// Previous time
uint32_t previousTime = 0; 
// Define timeout time in milliseconds (example: 2000ms = 2s)
const long timeoutTime = 2000;
//************************************************************


uint32_t lastMs = 0;
uint32_t boot_min = 0;
uint32_t boot_hour = 0;
unsigned long ms_timer = millis();
unsigned long ms1 = millis();
unsigned long ms2 = millis();
unsigned long ms3 = millis();
unsigned long ms4 = millis();
unsigned long ms5 = millis();
unsigned long ms6 = millis();

unsigned long ms7 = millis();
unsigned long ms7erg;

unsigned long ms8 = millis();
unsigned long ms8erg;

unsigned long ms9 = millis();
unsigned long ms10 = millis();
unsigned long ms10_t;

unsigned long ms12 = millis();

unsigned long currentMillis = millis();

uint32_t msLed = 0;
uint32_t msPush = 0;
unsigned long msRs485 = millis();
unsigned long msRs485_start = millis();
float msRs485_diff = 0;
uint32_t msRs485_eintr = 0;
bool gbootUpdateFlag = true;

bool g_01sec_UpdateFlag = true;
bool g_02sec_UpdateFlag = true;
bool g_10sec_UpdateFlag = true;
bool g_60sec_UpdateFlag = true;
bool g_05min_UpdateFlag = true;
bool g_8_05min_UpdateFlag = false;
bool g_60min_UpdateFlag = true;
bool g_1440min_UpdateFlag = true;

bool gLedIPSearchFlag = false;

uint8_t g_2sec_count = 0;

#ifdef old_option
unsigned long runMillis= millis();
unsigned long allSeconds=millis()/1000;
int runHours= allSeconds/3600;
int secsRemaining=allSeconds%3600;
int runMinutes=secsRemaining/60;
int runSeconds=secsRemaining%60;
char tbuf[21];
#endif


#ifdef old_option
const char* PARAM_INPUT_1 = "output";
const char* PARAM_INPUT_2 = "state";


const char * html = "<p>Temperature: %PLACEHOLDER_TEMPERATURE% ºC</p><p>Humidity: %PLACEHOLDER_HUMIDITY% %</p>";
String processor3(const String& var)
{
  //Serial.println(var);
  if(var == "PLACEHOLDER_TEMPERATURE"){
    return String(random(10, 20));
  }
  else if(var == "PLACEHOLDER_HUMIDITY"){
    return String(random(0, 50));
  }
  return String();
}
#endif






 //**************************************************************************************
#ifdef o_ThingsBoard3



#define THINGSBOARD_SERVER  "dashboard.livair.io"
#define THINGSBOARD_PORT    1883

String provisionDeviceKey = "ieud31u7dfmd5op9uhvg";   // key: ieud31u7dfmd5op9uhvg   YOUR_PROVISION_DEVICE_KEY
String provisionDeviceSecret = "3y14907oc7p0lmo2d8zw";  //secret: 3y14907oc7p0lmo2d8zw   YOUR_PROVISION_DEVICE_SECRET
const char* deviceName = "TF18855C";
   
TaskHandle_t provision_task_handel = NULL;
TaskHandle_t ota_task_handel = NULL;
TaskHandle_t sensor_value_task_handel = NULL;
TaskHandle_t check_update_task_handel = NULL;
TaskHandle_t update_task_handel = NULL;
TaskHandle_t network_status_task_handel = NULL;
TaskHandle_t send_telemetry_task_handel = NULL;
TaskHandle_t timer_handel = NULL;

#define CURRENT_FIRMWARE_TITLE    "LIVAIR"
#define CURRENT_FIRMWARE_VERSION  "1.0.4"

bool gThingsboardUpdateFlag = false;  //ThingsboardUpload
bool gThingsboardGETFlag = false; 

#define THINGS_SERVER_LEN     40
String p_inputthingsserver = "dashboard.livair.io";
char p_inputthingsserverc[THINGS_SERVER_LEN+1] = "dashboard.livair.io";

#define TH_PAGE_LEN 40
String p_inputthingspage = "api/plugins/telemetry/T3052900/";
char p_inputthingspagec[TH_PAGE_LEN+1] = "api/plugins/telemetry/T3052900/";   //'https://thingsboard.cloud/api/plugins/telemetry/DEVICE/ad17c410-914c-11eb-af0c-d5862211a5f6/SERVER_SCOPE' 

char device_id[9];
String device_id_s = "00000000";


int16_t score_value = 0;
int16_t radon_score = 0;


// Initialize ThingsBoard client
//WiFiClient espClient;
// Initialize ThingsBoard client provision instance
//ThingsBoard tb_provision(espClient);

// Initialize Thingsboard instance
//ThingsBoard tb(espClient);

bool State_anf_werksreset = false;
bool State_anf_werksportal = false;

unsigned long previous_processing_time;

// Statuses for provisioning
bool provisionRequestSent = false;
bool provisionRequestfinish = false;
volatile bool provisionResponseProcessed = false;

// Struct for client connecting after provisioning
struct Credentials {
  String client_id;
  String username;
  String password;
};

Credentials credentials;

bool provisioned = false;
char timeHour[6];
char date[20];
//static bool check_update_state = false;
String firmware_version;
bool update_panel_exists = false;
uint64_t time_milli = 0;
char output[384];

String payload_respone;
String payload_token;

// the Wifi radio's status
int status = WL_IDLE_STATUS;

/*
struct ConfigStore_t {
  char ssid[40];
  char password[40];
  int wifi_encryption_type;
  int turned_on;
  char access_token[21];
  int provision;
  int wifi_details_exist;
  int cellular_available;
  char device_id[9];
  int device_id_exists;
  int device_initialised;
  int device_reset;
  int reset_count;
  int language;
};
struct ConfigStore_t configStore;
*/

int create_task_no;

#endif
 //**************************************************************************************






// Replaces placeholder with LED state value
#ifdef old_option

// Set LED GPIO
const int ledPin = 2;
// Stores LED state
String ledState;

String processor2(const String& var){
  //Serial.println(var);
  if(var == "STATE"){
    if(digitalRead(ledPin)){
      ledState = "ON";
    }
    else{
      ledState = "OFF";
    }
    Serial.print(ledState);
    return ledState;
  }
  return String();
}
#endif
//--------------------------------------------------------------------------------------------------------

#ifdef old_option
String pSTR1 = R"=====(
iVBORw0KGgoAAAANSUhEUgAAACAAAAAiCAYAAAA+stv/AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAAB0cHJWV3ic7c+hDYBAFETBbwnN4CgKg8UhaIFeUBRA6IUOOILF3yFuJln9sse9XzHGmF5npAizKleavr6+vn6d/eHn/t//9fX19fX19fX19fX19fX19fX19fOZP9PX19evor9NS9P1a1u6CwAAAAAAAADk8wCm97HKNGcVPwAAAEhta0JG+t7K/gAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKaQzoQAAHeRta1RTeJztXUtz20iSxvS0H5Jl2e7u6Y2d3YMiNnb35G68CIJHUhQltfXgkJQt++IAQcLmWpY8kiyvh8HfOpf+GXvYzKwCCBQKIACRouSGZKtAFB6FL7O+zMrKAvdfNK7Grc7maKxNOn87GI0N1eibpmFNjvc2vbE6ec2KV7tNb2zok53dHpTmpLPV9cZVfdLpHo2gurENV/DoZ9Le27saN9rwZ7PeuxgrD5W+4ipvlYbiKBfKSHEnuwf7sP8J7D+F/Tuw/1wZKBtKRzlTPsO+gTJUBpNO87CPl64f0B3qXWjc0J40mrujsTlp7O+PxkMoYLczaXS36KBuCx+k0d2horFHOxsvqNg84BfYatHnTo8OajXoU6tDxQHb2W3Dse6k0WOVPXb1XpfdZJ9djxW7dWzlAbZKnTQPNWxO81DHyzQPDSpasFOHQmeFgcUkA0JrMYT2oPZUGV4XG/XuY+NrTxd0xlMur689mmcW1h/tmhhpi9WfKUaF9UdEJ48GLRmdNY5OHZ79HDBowN/PgNN7jtJDjtIUvTR0sN0heCyT4UP1M7XHNiP4qBF8DD2K0OCafUxnCOkMIZMhZDKEzEm3/YZJtduFDbcPOw7ZY3S7h7QjD4aPOIY96Hv/C5r2Gepn9UKwJhJFSwdSq3Eo9b6bA0rXZlDS/oWBqdeygbnCwWwDRKewNVJOOIyrHEZNeQ61I4ByCHVpIGoMQ2+RhrBmFVREO29XTUbmX2TIgCLWYe8lfH4OWydQYheepXhzxkxKbzkw0xaF2TOO2SbQ/wn8py4JmIWPDONUcRhQeiXNEjj57YCaHShnvspF/dGyWH/U4QGpP9JGu8FquqzMBqnPc9sApqN8Ut5D3eWi/DE3jeKuQXBRhdNMBqTDgHQYkDYD0mZA2ozhkNjCBBcBNAzgIw5gi3opOh49AOoTB3Gdg9gkt/YD1O7zraFyngqlHYGSbMCsvqtVhlmMbxROs2jv1W2ZubBiYDZ829uIWYd07B4EhhZV73S+g6SM1nVOTJcDK73vMazyKZo/RkCv9x0AdpmiatUBQ6/KwXOlzome0m013c1PfwvXtHA3NbSBgKdmDwt03B2O50mAq4imb0o0V+c2V2V41njXRRMTUkc1hQdp6JERTrzvAuGUGYkm+RzvyeuIql2ohkAbwucr5eudHJpqUWNRYTBVGEwOg8lhMDkZYXoqhalJo/g+6Fa6VZUOHm4BUHrBUWpenHrAYtAz7yxOxtxxkne7bKP624qSNneUVgKUzoC3L28wVpbqRLhmQeJWGTQqg0Zl0KgMGpVBo2aEZj2Btyn4ml99srj4Cw25pilPhSFUYQhVIgitc4Q24clPuJH3hztfBTXC7vURts+Us/QxN9cjzcjujapmfkWqqAwl0lDEyUsbUWbxAaSxHsPmY0t0qYpi14HaPmF3KnVFbZdjV5uTeqUBVzgemw21vBilB2VFhIbzBUje//RbCdDfwFsa4VERgMwK97/7Qv/zg14qw8hNC7Zi15mtRjSuDuFkcSanjrcAoOL9Lwi25sXwPsfwFVD9ZepoUJObwbQ5ETw1gp6+9E5IYz8K4iSHHTYBHzR4LtCSE8S9fMrapCAiUn76MEbAi4bGEsQEwq9eYwDtcMyMgZk5hFhc4Rr+qJqbmvxItonYLmcH+AUkPTOD5fR8y4nhwIxABv2WA0khxfnjiPB1/dkS7Lhs2sTfQGTZvIm/0ckNcZHJKHkHZ2GKRJgxuJFXX4NIbUVnOFPfyAi0NszczQMQdS8HdH54kc8Y54HMtbOMDaZBsjyqOeROHUG1xWOOc9XNDqikPhwydRNtyUqAGVqQr+SwRa0wC8e6yoc8iGWKX2czwvKuTLqGnNifO17Ul0nF3vBwYifcqVk3Z1Of3c5OTAtnI5pt3O7mB7SAb+zjqdvcp6FAeUZADT0lsmgxQC0GKDMpPqARcsyN44NgkOFgtDvLtAqPzZJDF4/NFkfRZCiy3iuFEcO2iKOegmOFj/RhNMQGsjWOJNdNiyunZSaBGcTBfTC9aKjyMQfzFUBGIW0iR5o5LdTddVtqU0hJZ2knWoec2mn4BgVnvK7V2w1Zb6e50qTZ1Hww5pnE8njcwIvm23hOBhCR9hY9cSA3yboMQTbr4qtmhCbFMEJ2Vcw2rSDk2gTTL9kCeTmU0Z8NDEy1MciujXIspVPRgR85pUqaT/U3OodMUzsdDCSx7i7M8t/nGB9KEnAaFF1H/3xWfN0pmomaRTkNgTl9g+775jQfGePNLAqKeyl6zGHVbWbBiRrr1L8IVcJwh4ZZ3Q6NP2Zi+CyEIfqWmHLSpZkKh0ec0yf5HalbmQFS9N9S4hSuw0DVOaiuLqjqgDvirFPM0FVQdAarzXG1GbAuV1eXA+vaojnCjU6YBaJ5KZ1gw/fi2x3uCKAyszFRN+6kpqlzF2BHBwGTYy+yuAJ+mNanW80ZZlDpLBkWFUGlo4SL9IHIaynIW3wOkuYiDVaS1XIZ8lQaVBLOAQ14gQtFAOqzVflRgN8NqC8x5Wz1FcaRgfamBroTXKmMCDItlGoqkS0qqI8yEkdW9fxRPlDn+aXZ+LdakH8zpbhwz9VzhEkFrq1mP0K/pox+fW0VeaLC56gqfJIKymgWKRtLdZi+djucmvln1GPNk1Kyn6p7BNCeks5+pr7vg36Pg24ozQIRkWqWNOcsgwIj6rxGaUCryoDNpsS6LbFsO8xRyIPT6hQnUMhtcr6+pCNm5E9oFiHTZmuj3/MFyIYRyAyZLi4aMn+9AYstfaQcomFsekuEzSrqQWnZ84ICt9Sw8o/gfQ9qVobkjk+QO/FB0SzofKcJw8IjymnO5zTJ09VSVS8WWTKkdqdmR90mT9pj5Z6oEAlx5epX48GQGo+G1Kx4uunUYeJMGGZEzGIjha1WGCUKnn5W8FsAN86m5fVYC4Cfqd/TXEYIe0c6SPV7fhafSbRC0p7/xkc08DvZACAPpOuBaT8D046xkg0azF7MTJfWokNVihPnWBgSIGrOntItvLBBNzIxArn7blUSyqMEYNrhb/iWHVmE9HvH9/X5DplTldWGHcL+S5oEnbX4ax42rJLdoxI0uTZ7OOuHU6PQz8uCPQ6pLeZHvQcWKKC0c0+T4t6SLc1BwDhjCDY9z6ApCTiKr5DKCZGpWQj+zBF8Sf67S9mcF7RQB9UP11NsTI1cflZlM8lZIZVatCikgjdFQdS4PcvlgRo8+mfw1DwoyZ5xRghTbJvzQSRuRQQRcvztqN+fsJqsw8f3Z8pHIcz6mib60p2waKg60yyzD3aWZSq82/elvoMwjJJ2+yT9TYr+R+frwxyaGb5HgTcLHqziYY4ILjWTwahVzIgvq0XXlmUKVlvSIKvUbjHntZDhsqXsyQP+VBpUMuNvqVM2yAba/cCV+ix3mvpmJEziI5UnTpKqcBTals06RbHyA03R4VIULNeWO00yfxVjpqRh/vRSY+qe+tNNuTsuy9FND9hJ7bWQ1qVKYVSz91sCNQ5i35zt9AcdV5i2Q7kQimzDYBssBILM2A0o0lfErh9d6vhcGXdLkzGdhkL/DqrpUKQpHdlK0aTCHNMlwWjKj+znyGwA2pQii/tbfH+L7Q/UkxzRKrc31eloKojc7TB3dDJp7TWvxq1wPp3HZ5rPaHh6RnafrYOcJlB7IcYUjznKcAyXR4vpWouh2GI61toi3FqdJh3S6bA6pCcojqEOKreDBj+D5rrBUs0Bdz4uQ6thLwKnz+UTFjjgc5UPMFLxF3a2tl8CDAeb1IDtXdjebuP7UFrshScq/UxCVZpfxd+GgnWvsU69/nW0gpfwq/BHItIOIOPC02KXeQfiQBTOBZHKjznKcEwxkTpMpE4p0TwSXeES5a/5CMlxhcsoXHOUWFNMZjqTmV7KLI/MHnKZdQmRUWihDpPLAaH0kYZYR4k1xSSmMompkQatRpgeQzfhgEKYvf26o5S6Yg0zWcPMUpXyqNKjQHIjyhiJUvlKQNMMvbhChWuuZYmNUm555PaYy22Lr1T4RK80Cfe7x1xCsiOOZh5RTJY1JstaKcs8slzjssQ1JX0YwY0oijgMeuEal1O8/mhGfTEpapzjsWxqoYa3mnrkkxH5ZEY+9foJNqI9nSEJMk99OxCtO0qpK/ZkHnswT2pNW6SQg0AdH/IbT/cfJewv1hibNcYuO0sR3+cVpTAOY9Ka7j9K2F9MWkMmrWEprWKeqkPG5VSQ1nT/UcL+YtKqMGlVSmnlkdYDLq0GBbsugtCiFyyvOA/6lbi3mJxcJie3lFORXtWm8bcbei2lbyr9/UcJ+4tJq8qkVS2lVSTC0iEXm71+RRxeTWvE4dW0ppjMBkxmg1JmM2U22aYAdhGcVjhOWIPyQud7io8pa1StalqaE26U+osRPFl/YLuVaKUd1FquPtQs6fMMvUHfHcShXU4T5iCVa4mjS+85uBLEYUmxMGpqTY0+rm77taaOv9Fas+LX9it9o69Fa60AKfqJVlaDUwdD/JWCYKv4Gxfl3Wv+stRgPdQr+/RSh0tKFMeUveEshVBVw0ZykSOqqnrNqSYhqqp9SzzXSju1mnKqJrYok0Lc6uYvSyGehswZqABNPw2U15R1zJK1p0phSNtWgwcUOlLw7Kx9SZbKVSV9eVE3WRbATzjAmMp1Rqncl8ohX0f0brbPoNdUp1JLeLiqFMFrXGdZID0TtDCkfxJyiqjIL9NG9FXdcZKUZOBBdbSyJp6ZqotzvtGyO/wWLS2gpENK1d6mZA44a5YV0FXDVRPtqtavVbV+Eo1qQ9MzKwk0ajlDV9WSaDR+YU1sUSYrcKubv2ySYuwfqMKsvpfMwKEOoar4P7HZMvO9qJssC15/zBiMFKejx1n87w/o0lqVhf+zXWdZAK1ygELvc4K6GUTEPPGknoyutuixTXuyZYlwhHoynlj1knoyu3GSJYV/GYnoVjd/WYrwKBimfuJ5UPgVKR9nq0KcG/RwZQzKaYN1J8WxF1kFBvxhIBPdTnnPvGNtXzYbMGsUt0EJBJfcHj56yEiUWa6zbEvyh4g+brWaV+OtVijDY0gw7dKqGXReG/D3it7+x+D5gYBD+vgYrD1ix1PEi7+peavdvRo3N7fwzwu6bp0GYzg487/lC69/AbA3N1/CEX9SjMkkdMYjOO49iQpHKIGY+NEPlP9Q1Olv5MzV0PcoBHfl5/1Z0RRDqQh32qGIHXMbZHfypr+RMx/TmZekKkPK4xbPXomeDff2hHs3aMnbJeWidSkp9TJo7Z+EJ3scerImf++AQ5Mr4ecT8XgMA5EBDoTpPUaUTw4lpREk3GeVsEfcD5W+8j/MTPBj78FT4IDmAu4ZfZItekJmUvbpjSq7SpOf9Z/KWKlSrQUtxDbqynPYhpbTFu4b0Jcm2bCvCjVMshU6sgp/NajBT5PIXdfoezIuoJMmaZWIRaDPQWb3OfOI+Bnfwd0qAhrTc17RqlvQ+eBoTbjDCrTkhALyiPdXLIO26MKRfLF+7Kpiq1dCLRCvGT3yWXBNpkvniZoinrlOqzi+8BFJsjaHel1Mm5/wBZwR3pD2qAHIStZ3n4TQ26e8wEv+7QEjiqf7bdeEs8K6twtPy1b1jfj3M7CzvueuzjB2LnsxOGiN0iLKj7OA+ORiu/8brvEBrtIiJhnSQOScM8ohYHkCUmPvD/kIT3NGOncO+8LtPoLjD9j7CPhdnwU8jKsR35Fmu/z7TNh5p4zEc/D3A87fLbZqvGTqkqlLpp7BqiVTl0x980y9wpn6DTHJG7jfu5KtS7Yu2TrGrEbJ1iVbL5mtV+NsDeO9kq9Lvi75WuRWs+Trkq9viXcdimOXbF2ydcnWMWbVSrYu2fqWRK07tJiojIOUTF0ydZypKyVTl0x9S/zqDiCB10B8SrYu2bpka5FZrZKtS7a+EbaWyKHM5iv5u+TvW5fNp5X8/Q3zdx3a+8+58neZzVcydcnUs5h6Edl8JVOXTJ2HqctsvpKtS7bOwtaLyOYr2bpk6zxsXWbzlXxd8nU2vl5ENl/J1yVfF/Guy2y+kq1Ltr7pbL6SrUu2LhK1LrP5SqYumfoms/lKpi6ZuohfXWbzlWxdsvVNZ/OVbF2ydZytm3B1RDHEocE7hhlbT19d+DZylMjc6Tws4uIIGU+zWcGB/lZTTPgdAH72XFjhOvqwHnnepL5TlfClf056ZkEUz7h9MuCZRP4Jn8HewzntCeYN6CFiwvQO5ziYDvrfeZhfA/2RHWfsa2qcJbDqt6lxaGf0W6Nz9i3TuXWuc2EmF73Uh1zrMG8ZfJcyD670UW+Nj6oLWMzXR41nId9sFly0z5Qe6s14qJpwlcWwNDIgSuIDnHOu/A49+DNFa4vzM35v+4h6bsnPJT+X/Lx4ftZLfv5mIwiP6dsb2LN7qRz9JMKVGyRr9oVUJ6Gx22poVfe0Lj6Cm9WPdfraQxv6CYxrQAuwz+rwqwb9GPfhMdgiHzGber5HIzfszXn7sZm7H1s5ZljMOfWj7H0gSZeuo82LGs1N9QZlwnTn/0Dj4qO5bJq4FtHEeUawRMs+S5cr3NJ4ZGPQElXh14Tji+tyGcGar/49jegf05i0iEI2HXxCTHNCTBDRQeUX/C3Ai32lBtrgwl/0U4bk35hk63xdwngVapJHbMk0Fo9G/kQNHMDxUV36N7hTAzDzCFHGK2/JFiC3oGX4Ap8vA7xRy/4RIHeP7ryBfyNXvac4guS/gztXhGPcGb6syFwPlUHG+Ndi9OQvUI/5Jh4d3SdPWaovG/8laMwa9IQB+LmfqfUbIZ7xv1KrTqx+BnV7AatfFNAR5AuT7Dn6uRrxjQZtNWM+sM11xCFeQkYawH/0umo3oiNrcL8h4fGW28K3cMV3Sj+BWeTHDxPHGI9Dx7/no5roGX+G564IWvlYcpe+wr7dKmks84605CP8jR+rCewYPvad4n+dp/zopCeYYiR7gqdwxhlyKHma06eI301810f0vOkdxTNld32ScNd07MS2Tu8ZPS/LHbMjtJ7Q1jRtWpfoxSxEk++TrOXrUplnQUN2XhHJZe8rKxFtjqInZolGjww/v3YDzL0a8Otz8rgxF2WYk6N/Bg48D6IjfPSg/CqODgpbdwM4GLm3T/4f8w9rgLoW8RSxHiWtkgeAzF2jaMeArLwYvVgMcz8hyx1+5reE9hmNHS8T+aUvwS/LmYvRiZ+VHYV9gzW26QNs4xV/VV5I5ZlPV1ZDXwu4wdt9Usiao1xN8hxdGv86FK2qCaMH1BMnEtGiSCDNYQ4FnXgAmH2iOAQ+79egf8fjeiuhWA3KaJDI4/cSo5p3YwT6iCIz6NN5MO48IbaNR0FmSX0F9iCPXpFuz4cHhgEPGLeOB9am9oWudkbe8SX4rdttAG273bsaH+9t4pdKvmbFZLpPr1TYXtyYCB4VWYi5XxO/qXSe13zk2+W5XnUxGr4CvObr5mkhTnsGfInP+itYUIds6DmVI+LL+Wj7INB2/dZp+yrYLSbr2RZrjXIT0LoFY1zhHvI5DvTB49hmueNTbsduh239KeBTNu+EOvM7jY5HfoS5kA7eD79ZrpA91cmealyDnlNUbqBYktGxHz9Zzuh4MXJ5CPs+kq/D5unEyNZsCxeKThTu89EYhR7EKCpljKKMUZQxijJG8YeMUaxMIxMJHto9uPolzYr5fPyURx/8d61u8BhyHdrwCSPShWZfa8CvOvlWDrGzC6VJcwthdq7QHFW2LIq7ZCP/Sj5GCEO4B843oL+2AdthvClrQGJH45JapVayeSI/W6ZIfN+j7BWVZOSRJDya4ZnOJ6okHRz3L9d2Li5n4XfCkc28XECPcaUzxd8Hc4lMAtPPRVDXoM4j9jGDWRV/dH6bPJZFof5KwfgYIv2PYOs0A+or/mdo6z7dL567lxd//Q+H/1/INvwOR37gev+loDyeKttw5c80PhwRr20EEpqPP68G/rxx66TzE9n48NP7fss52XyHZpg/B1lBP0AbfyG2Tf61bkD+P3Cp/ROe6CVh8YUippz5pN6CKPl1kp0fU7i+1CsgNZssvgXPa5El8vhY2qTe6VG8WqOchQrlLmB2Jvp6Nh3hKGJselFS/xh68rDEk/MJxHFH0hXieQ61G4mw/JWyv5AF/HjKBTx3Iktn1JAO7wHM17k+LyBrG5Tzw1hbp+vbpCE4s1UhDcHe75GODMivMYkpPGIG90Y05Ieg7+OTR+UrRtC+gxZGJfxj4tl/h9JRTiIzLd8hB96AhvxrRJosr+56+rGmvFHw3Vgf56AbNb7CDvnCCmK8Oll0XH3XJ/ZAfrFo/qtPzOHRjJhOUWEcb9yEbjyFY9hT59WLZ9Izl6kT/w4SHPLZzZHifz9Hfs14wPPZzimT+jRYuxndm18rXPIPcDyDOcBsdMOy9eOjm+o36OetB5lk53DUBtkmNkcd9+zkMliL7r2W161RHqFHURUWLa9Rn63G/Do/d/XbksZTLo3fSRr+eDOvRJ7AlU9pRQyr2Qgy0YtyZ3Q0ZN7i0dDPxJDTZ39L0bULeq/AZca1Qj+mXGMeHnva9WUsX7mh7BRfS4Zpo72EOOEBzUbj7KLPCnWynBvTmsLaNyQ9wox2tNIuxQdV8uKeU02f56QYgJRGYwS2dgPt9ZCsPnp7N6F9P5J24Jz/afDUb2n0h6WYfZw0J/tUepXlacZPJBWcJx7B1TcoFn4KaHym3JV3iVpxX9mk5/0Mz3IRzKeG9xVhIo/Gcoz9Xe671ULZxiwjXQXZLzcjfTGyiOIXnU3AvvtVomeYGVWjPoCR25ow9+YG10s+s0ajJCODfJ/RCg+PW68hG+XSvO51pD4gP71KflmNpG7RqK0WkXqfxvu1iNTxv0fH3szIf1Fv3pmN6nJ14QeaZfjKW8XWp3yFbZNLA1cZbHEdCa90w3EdW6lYfMxvU8RnSD2cefA2RYjCHrxFs0cGRYHwL/tskj7dbd1IQ7O4jFbIGzhn+ZFLk82A9t1d2chQLC6TJ0I8tUetwPYuTz6VO21NZyEaldWPNEM74qPcLrRnxLdwPbdDs+FTaT2czrouWD5VkEqVIp5VinziX4tsZYW8o7srnziG4viXvckjug7SfwPoAd0Hx1bxTPjZb+/ACJm49rZ8f8fNvb9DzIX9Vt7fEV87WmTl/zK+aVDMc0p+h8e83j1QvsPj9r3D437KuxLkfOy/YXGHeulZycUlF98SLhY5LRsTi/p080wsfn/VIpjYLpn4rjHxZL8LVDxp13tX48bm3mjseZZnWoY3abFPg2HN1AaTVjtg7Ic0q/N2+uaQwIf2Yj70UWJNp3nYH6uTVq8xwmKrRUV3fzTW4VNvNNYmrU6TDul0WN0OK46xmPSOG1djP2kS041gYAUP8+Jq/KoNR1jqZIeXve4buJoKG7vwDL3d5mhc9fqmZuHj945b87jMZOu4fTVu7few+Zt7HSzae/QU7ToBvHeAzW5jFV6k3eOfAQVtUm/vsaKLD1yvb9KnepOKLlxmCEc28YRtvKg6+a39t9G4gmWXfTxkRRvP327tYvFbF49xoNxiH3t4ud+6DQJ1r01oHmDjtrt7uG+ve4RFkxV7XUJ/s7uPp21tdvFhDl538dNelz7t9PbxIju9HtF1k0wBqtsXKikBeXLcoiYe71P7ex26HJyJxXGzThdvHcMFlMnBvnk1hj+A94QKjxUaK1ShgLKFx4PqVCZUQCfeOtjEslffo9u1X9HNsaFQuX8AJ+wfNOluk73X8PB79deg+S+28VmPOgwH/rqTHYUtlkTyeUcdHSgMOwwetL9JRXOXANncw+6xhdfbfIH7t/b2Qa/2t4Mdx4ctWmXJClpf+dxgyyu1CemabjBd0zWma3ZU1VzPdIVY+hH0qCPoh1tgFf25kvC+b3ml40Oa0cervSNW8bNU1oNVfUP+1qNPZI0vGOOFrvA95csXWg84J0uRtloT38AorvNa9HrNeHZQ1hWbMi/xFqzabPbqQG+TGf3Q4v2warCOqNk664maNRS64v4m2kT8mfBuWRkMgm1LrVUnkmPsiqqzbVtV+1bV39+3ajXZ8Y5n94NrWo7nn6sZVXt6TccKHhB+Xu4Ctb1kbATUlsRqDwDePjlj2D20CJtp6Ww2+yYav8kKZWphxDG4GbuRlok2YzeabHeaV+Ptw2MU2fbhayq68MmwoHzNSu680A+c0QTq227SzbabL7BKVfE/fNpBk9d8iTc67JL7cditk0H5fxXT9Au9MLh9AAAAvm1rQlN4nF1Oyw6CMBDszd/wEwBTwCOUV0OrBkoEb2BswsWLSS+b/XdbQA5uspnJzM5mZJ0aKBo2g4+9YBo8HFa480xDQEOsuNLgRwE2eavBYdvN9iAtbUpvg2IQBkQyGEjrcrJ21wgH4iI/QA4kJxN5kbfdI/FRtovJhA2x3CVZ7YRcSANclrvQX4ul0wp/DW+9re15WDkyPlG1jxliDxW3HxXPZoj0OYh93DiNpvHHx+AU7pzGFDFTiQHc5guTpF877yZ9sgAACrVta0JU+s7K/gB/V7oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHic7Z2Nkds4DEZTSBpJISkkjaSQFJJGUkhukJt38+4LSMlZrx3beDOe1eqHpAgSogCQ+vlzGIZhGIZhGIZhGIZheEm+f//+2+/Hjx//HbsnVY57l+HZ+fDhw2+/r1+//qr32r5n/Vc5qgzD+4G8z+L28Jb+ubu2jtVvJ3+uR1cNez5+/NjW1Ur+7v9sf/r06dffb9++/fzy5ct/+qL2F7Wv8ikqL87lGOeRTv1crtrPsdpv+ZN2nVtpWl/VsWHPSs6d/i86+X/+/PnXNvVP/y25lAyQOTJiP+dU/sgUmdf+bBf0a84lP7cT2gLlG/bs5F8y8viv6OTPMeRCf7UMkXO1FfdZ5Mc14D6+OoY+AMpjPTHs2cn/rP5P+XfvDOh55F5/qy0g19q2LP3MWMnfegDo+5WedcPQc035I9eSVV3rPkhf95jAefhZksd2uiHbifWM5V9txGkM/1J14v5ztB9dzVicbR+nX2f7KVlZ3ikP+m3mXdd5LJeyrG3aIHqGMcnqmmEYhmEYhmF4RRjH35NHsNen//NvL+9Z8t36Hlzqa7o29a54hMvo7WoHz+ZnSJ3wlva+u5b38538z9jxj3yGeZ73db7ELr2V/P+G/vMWXP70s2HPw6aOTSb9d+nbwxfka+kjnc+Q+iQ/zl35A03nb6SMXI/9yL4s2y/t39qll/K3H+JR20DK3342H3M/KX2Jziy5IBtsvuznnPQL2GdYICPsdgXnUee0D5P2Z7cd2gz3Qp6ZFvLu7NmZXsrfdfSo44Gu/wN1aL3gvm0/jn17XYzQLn7IfdB2X/f/SjvreOdvzGdK9uv0WV2S3rPrf0C26QMu7KspmeFvcX9Dlvy/kz993z5Ax/tYn8DO35jyJy38AOTTyf8ovVeRP8/2+puysbyL9MXbF+f63ukG9InbCbrFuhh2/saUv8/r5E+cypn0Uv6c1/nD/nbsW0s/W0F9pT8t/Xf27eW11G3R1ZH9fTxHyGPlS4SVvzF9iLyndeXxeOZMet6mHh5V/sMwDMMwDMNQY1vsm/w8Pr9nXD32gBljvx+2ffGzTb6LC70Vf8P8w2dnZ9Pq/ODWCegOx4Tn3MD0LUJe6/NrX2c/zPKgr0Y/nKOzqyD/ld3XdjB8fNiO0BvYfz3Hp0i/UMbu22fnc+y34y/HaB/YkfFJDcd0/dx+F9d7kfLn+m5ep32Btu9a5vgPunlEnuuX88/st/M16Ijp/+dYyX+l/1d28PSlp08dGyntIvuxYzDOHMt2WeCT2MULDP/nWvLvfH7guV8lL88FLM70f3BcgMvJuXnOsOda8i/Qyek7L3iGF9bhznP1/F/pBrc5P/8dq1DM3K813btc7Vu943l83tkCGMPn9cSNOJ3Uz934n2cA5Pu/y8qxTHvkPwzDMAzDMAznGF/gazO+wOeGPrSS4/gCnxvb3MYX+HrkGqvJ+AJfg538xxf4/FxT/uMLfDyuKf9ifIGPxcrnN77AYRiGYRiGYXhuLrWVdOuGHGF/Ej9sxPdeQ+OV3xF2a62s2L0jruD93H5l+5DuKf+0MzwzXtcH2xu2ucJr8KxkbPljf8Emt2pLK5uc5W9/ImXy+jwu48qeYJvB6l4oM3rM8s/26HUKn8GmbNsrNrv633a07ps8mYbXEMOvhw2+azdd/y9s02MbW2D9T9r2+dBufb3X5/KahKvvC5FHyt/rjrEGmtfEenSQEbhedt/kMil/PztXbcZy9TWd/B1v5GP2H7Of/kl67D/6vpiPkU/u93p494x7uSbYxyH7hWW5ei7+qfy7/Z380xfUxSLRr9HtpH/0DbndMfwU1vPkwfFHZ9f/7Xsr0o8Dt5J/1x5s+3c8Af09fUfdvezaRsaokF76KR/1nYG27HpJHXDkR7+V/Auv40vsAKzWnM57zXvZyd9lyO8L+5pHlX+RMTLpx9utr89xr6eZaXVtZheXkz6/Lr/V/t19rK7N6/Kcrn6eYew/DMMwDMMwDLCaW3W0v5sr8Df4U3ZxrMPv7ObWrfZ5zoXnCh29P96CkX+PfRi2oeWcGlj553ftxbaR2nbMP9/lsN+p8PdE8P+Bj/la25PwLXEvlj/fs/E9v+o8EcvMfraMm4cj/d/Z5q3/2ea7PrbT2UZr/4zbInH++HqwAXKtv1Hobwk5xsRypiz4iO6tp27NWVs7HO2nb+Y6ASl/QA+4LWDXpy3YN4v8KHvOG7Hfr5tT0u2n3fq7QK/CteXf9Z9L5O85H+ju/Nagv8m4k38+DzqfbsEz6RXnCl9b/18qf+ttdLBjbezDQz7kcaT/U/60jUyT+BDHCDyyP+cSPG6ij9GvbiH/wj499+fdPPK8Nsd/O/njx6v0c/z36P7cYRiGYRiGYRiGe+B4y4yZXMV/3ord++pwHXjntj8w14u8FyP/NZ7f4Ph65sfRj5mDY79dprOyoXgOXvrqbIfyvKCVD9DHKBPXZvmx/zp+H5+my9PZo14BbKBpD8Vu5zUaOa+zqReeV8fPfrdcOxTbP3b+bo6X7bv255I2Zcxypd/R/b/zVWJTfnb5p/6jXrn3VQxPN08o6Xw7K/lTz+lH9Pw0fD/YZu0ftP/Q97YqP8dyjpf3V37PMs9vxU7+ltmfyn+l/1P+Of/XfmSOYavnmOfy7taH3MnfbRRIizb27G3AWP9b/91K/oX9kH7Ocy7jEtoDeZzR/5BtgzTZtk/c7e8VfEIe/61k/J7y9/gv5/jZB5j+wWI1/tvJv8h5/t3471XkPwzDMAzDMAzDMAzDMAzDMAzDMAzDMLwuxFAWl34PBB/+KtbOMUBHXOKfv+TcS8rw3hDfcktY/5i1czJ/4rEo36Xy57qOSuvstxa6OJSOjCc+4pJYQOKWvA7OUaz7Uf0aYqPg2nH0jp3yd3iJC+xi9ymTv+vuuF/KS3yVj5F2zhcg3twx547VTbw2EGsIZZ9lLTLHm+/6NfmfOZfzHT9LXo5FuqR+iTnyz7FR77GuWa7XRrk4lut/EQ9OP+V+Ozo9SjyX79vf/qEt7HQA8brEknlOQd4bx+lnu/5D/o4JXOH7Tv3iWMpL6pdzKSfpXkv/Z1x+4ucyfZs27X3Us7+34e8puR7cbl1Pu/ty3h1eG8z3s2qHfoYit+57H3DmueL5Mjl3gDaUHNUv0C4cn3otdu06+yv9x/+j87JNe95Xlx79j/tKWbmvWvetyuq1omAlt4wN7dKkbDmPhbwS55XtnraZHNWvzyNPz1V6K+jBVf8/O+79E/lzjufcZJp+Hnbx4E63m4dEnec3Ki5Z56sbK3Y603llO/T4OMt9pn7p/918hbeyK8OR3oVO/jl/o+DdwH2Ve0LGniN0Bq/pmNd47pDj1a1zj1jJv2uvjFOsH1btm/wv1ee7dUo9b+oMR/2/8DyL1btMJ/+jsvNMrPI6D+REXbI23GqsZp2Z8mdMmOsEep0vryvYvVt7jpnfHbpy8N1D9E2uWddxpn7h6Fu7HHuPeYu8o67yzXkaCWMFyHpBv6fe9Lv0kd470+5374SrsYDHOZesE3rJc3pXv5T7SK6c8+zzVodheDP/AKCC+iDgvyWjAAAE6W1rQlT6zsr+AH9d3wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeJzt3VuIVVUYwPFl2qSmJKZhdy8PJigiUiKhhJcIghA0CAkSkaB5CIkEsScLBuylqJcwoyAfBC9BYi+FDxWhoAkmSBoUoqiRDplmWjp9HzObNoPknDlrfftbZ/2F3/tm/8c5Z9Y19PX1BQAAAAAAAAAAAAAAkK3pQf45eA7YmS/J3xJHNT39O94oSbxMvC9ODTSva/r5EN84ybpKbBe9t2hO/840V3JuFVdu05z+nWWSZNzZQnP6d46nJeH5Ybanf970e91fbbSnf770s/5ym+3pn69vIrSnf55WRmpP/zx9Qv+iHaN/se6WZDfoX6wnI7anf35m0b94v9K/aHvoX7T19C/aRMn2M/2LNk/SXaV/0dbQv3hvS8Kb9C/aAsl4gP5FGyEpXxSn6V+0uySp/j7oFtvEEXFd6JjRQbFD9Ii14iH6F2EEnQEMMo7fC0XbRf9ibeT7f7GWh//WEDX9LLA1VZJf4O//Io0ZGA9g/KdMnzL+V6xXGf8t1mLJ/Df9i/SgJD7H/E+RuoYwL9z0MyKdrcz/Futl5v+L9cz/fN+jf2fT8x3/YP1PkfQ811bPgmr6mRHHZEl5ssX29O8MeibAwWG0p3/+9HzffcNsT//8fdRGe/rn7c0229M/X0Md36F/53lOsv1D/yItlGR/RmpP/7zMlFy/RWxP/3xMCfHO/KB/XsZLpu8TtKe/f3dKoi8Ttae/b7pv91Zrdulfhi2J29PfrzcM2tPfpw1G7envT8yzPemfl27j9vT3Y11o7xw/+ufrpYba0795q0Pc+1zon4/nQ7x5XPrnZUUY+h4N+neWZ+W1X3PQ/ib9zel93e3e2RzLa/Q3tSTEXbvTjh7am1oU4tzXHcO7tDela/Za2ZOZ0oeC86DtPC6v+ncH3dV2cQftzegdTRcddFe7xSjam5kT4q/VHa4vRBftzcx31H6/GE17M3o/t5fP++8EZ/zbWSav+oqD7uqwuIf2ZnRPnpdxvWPiXtqbeSH4mMtRJ8QU2pvRe9SanL+v+0U8THszeqZ2U+t2BjsjZtDezCYHzSt6t+Ms2pvpcdC8ouOLc2lvQudN3nPQvHJJPEF7Ezpv0u5ZWzHpOMNi2pvQeZMdDppXrorltDeh92l/7qB5/f/9Utqb0HNVU5690Cr9vF9EexM6dv6tg+aVXrGA9iZ07PyQg+YVnUueR3sT94f++ZOmm1f07q7ZtDfxWOgfQ2+6eeW0mEl7EwuDnzU7fQM/h4zn29C5ey/7MtRP4hHam9BztJveg1t3XDxAexObHfSuOyruo31yI0P/Ppime9fpej3WbKU3Vl7xXge96/SO3gm0T25SuP19yNa+FuNpn9w0ecU/Ouhd95UYS/vkdOz0rIPedXpnG/ty0tM9GZcc9K77LLAfz4KerXbdQe86XUfCPtz0Xg9+1mZXPgjsv09N12i+46D1YJvpnlxX8LVOT+neoFdon5yu19nvoHed7gddSfvkHpVX/IOD3nV6BsBTtE9O9z+cc9C7Tsca2JOTnp6f7GneXp0U02ifnO6/9Pb3na4ZZf42Lf2O/7GD1oPpPoEcz9r5F4RU7CqhiekaAAAEuG1rQlT6zsr+AH9glwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeJzt3VuITVEYwPE97pcQZsold/GAeCCjKIlCbuXFJQ8e5JrEgxohL4jkyeWBGiHJpZQHpCmXCBFJiFCKBuWS+218XzNynM6wzzl7r7Vmvv/D/8nUXnv9tplz9jl7raimpiZqoHWJomiC5Hsc5K6Bwr1auiz9lO7j36grEd5yabN0V6mz+iI14RpoVLUQzonSbulZDvPseuHf4OsghLOlw9K7GOaZjcO/QdZd2JZIZ6SveZpntgD/BtMgoVojXa17/VaoeWab8Q82fW02WtoqPUjIO7sj+AdVK+GYIu2RqlMyz+wG/t7rJATzpGPSewfmmb3F30v6vmu5VCV9c2yeXSnXgJOGyjSvr/ud69M7u5H4p1JTmdax0nbpcQDO9TUH/8RqI1M5Q6qUXgVgG6e1+BeV/v2cL52QPgbgmW+V+BfUSpm289L3AAyL6QL+BeXbLame4W/aX2vDNWDafzD+pv2n42/afyX+pv134G/a/xT+pv0f4G/aX79D1pRrwKy/1gd/0/7j8Tftv9Chf5kcaliAdc1jDnx7Jd0Wh/4rAjjfXOXzfWjfY026Y/ib9r+Jv2n/d/ib9tfKHF0D+IdZOf6m/efib9p/Hf6m/ffhb9r/Iv4F+T8PYOxJ9Bz/2Od/TX60QtJ1GU4GMPakauvgGmgM/r/bEMC4k2wI/rHPY2qU3FosoTQD/1jnMEB+9E0AY066VfjHOoc7AYw3jXbiH+scfI81rU7jb9r/If6m/XU9omYpXwP4h11f/IPy1/eYZx0eL+29AfDPL73HNMfh8RbhH4y/Ppuna8GOcTgPW/EPwv+J1LluTL0dzsNx/L37f5aGZ4yneeTuXvMt/L3753oeJ86eHkn0An+v/pX1jOOKo3l4hL83f30Oo3U94zjqaB7SXhce/9y9lvr9YwwVjuahCn/n/vrabup/jt9D/vmHg3nYhb9z/40xj3065TnQ+///+h2Ef/L+em837vors1Keg70p2+P/d0+j/J670z0eq1I6f/2/72IdGPxr0z1YC3nmrl1Uuw9c0ue/2IE9/n9aWsR8633hJL+DttyRPf61HUhgvnW9moNRce8J9O/PJIf2+EfR7SjZNdf1GRTdyzGfzwd0fxr9nK+9Y3vr/rrn3oCU5lz3GNN7RPul69KHjOPqGo/6uY4+46nvIVp6cLfur3vFTHY47yVyqJ5SN6m5R2/8a3O5xl7IWfTfhL1Z/0NSCf4m/c9Ffl9rhZgV/7tSR+xN+ldHrKlu1V/fd4/A3qS/3oudhr1Z/2XYm/Xfhr1Zf/1ubhP8Tfpfklphb9Jf984rxd6k/0upP/Ym/T/Jj47C3qz/TOxN+xP+hD/hT/gT/oQ/4U/4E/6EP9n21+/+lwfYUI/XuiX/3gGcV67u4Y8//vjjjz/++OOPP/74448//vjjjz/++OOPP/74448//vjjjz/++OOPP/74448//vjjjz/++OOPP/74448//vjj7/288Mcff/zxxx9//PHHH//i/H8BaAincveZq7kAAAGDbWtCVPrOyv4Af2avAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4nO3bsQmEQBRF0V+AJWxkBbIVbEmWYUmWYFejC4LJRIL+EU9wwUh8cyIFo5QSe0NElAZb4n9xPOedTQ3srzVecCb8+Wfv4s+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnn7+LPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz55+/iz58/f/78+fPnz58/f/7X+3fbLX8N9k307xvYX+uTeCaSJEmSpOc1b6+Rem/Z37EkSZIkSZIkSZIkSZIkSZIkSZIkSfVGvbrs/08lSZIkSZIkSZIkSZIknW8Fj1o9w37ZthsAAATGbWtCVPrOyv4Af4UCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4nO3dW4hVVRzH8ZWmaTcVQ9MsLKgIpOilECGkqAZFDEOoBkqRejF8EHwqoqCITCmlsPuFolKiIOqhC0UkXeghFUpIDLIL2c3UKKXL9PtzZkBsPHt7/O+1/ufMd+DzPqwvrDmz93+tkwYGBhIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACyuDTpJ8DvgfyWKf0B+o84Y5R8g2UfVPr3QT6nK/fmQ9rTf+S4TKm/O6w9/XvfKCW+Tf4epj39e9sU5X3rCN3p39vmKu33Fe3p33tsv7+jzX5P/941VTnfqdmd/r3lCqX84Sjb07/72X5/l/zTQXv6d7dpyvdeh93p392uVLrdx9ie/t1ntJLdfQz7Pf271xnK9b5Td/p3lz6l+sm5Pf3jO16J7pV/G2hP/9hmpP+/r6X/yDBfaX5uuD3947H9fnWD+z394zpLOT7M1J3+sSxQil8yt6d/eTaPubZAd/qXN1PL/3HB9vQv5xot/Z7C7emf31gt+YMButM/v7O13J8GaE7//K7VUv8WoDf98xqnJX4oQGf653eRlvfzAI3pn9dxWtaVqXW+tnTfdh6hv7vpWtK3A7RtZ59cT3t3i1KZZ7hHY4ucR3tXJ2s5nwjQtsqjMo72ri7Rcu4I0Lad/Yn93pvN4d4ufwXo287WxH7vbaaW84MAbas8ltjvvfVrOfcGaFu1399Ad1cTtJwvBGhbZ78/n/au7O6crwO0rfK4jKe9G5vNuSf5nbVqcr/vp7sr+8wc7V3tcLYl9ntvN2s5fw/Qlv0+r8laylcDdK1iz+/Z731dlerdl1XaR3IO7d2coKV8IOU7b9Mpu8/rThlNezezUuvzU+m2VXbKbLq7sfmMFfJngLZVnpFTaO/mTC3lmwG6VvlVFtPd1dIUcwb3cO/KDNq7sXvSXg/QtcpBWSWjaO+mf3AvLd22yhdyMd3d2N3nrwToWsfDied4nuxzUxN3ZXmz+xvn092NPb/dGKBrHW/IFNq7sfPUndx/ndsfspzubiZpKZ8L0LWOz+QC2ruZl4b/Tqto7N3C/TKW9i5O1TI+GaBrHd/I5XR3Y/ee7wrQtY5NMon2LuyM1YbM/Tpl8xlL6O5mrpbyqwBd62A+w8+JWsb1Kf5shmE+w9ecFP9c5RDmM/zYebU1Kf7M/RCbwWU+w4edpd4eoGkd9n/d1XR3Y/NY0c9SD3lKJtDehc06PB2gaR3fyjy6u7ovQNc6npWJtHe1OEDXKnYmZAHd3dn3nOwM0Led5xPPb5tyU4C+R2JzBAvp3qiXAnQezosymfaNi/YOz2bxFtE9m9K9D2XvaU+j/YjrbzPCnLEqo/R337ycmL8tqdR5LPtO1evoXtytBdrb3S5TaR+CzXbsztTdzv9xX048yzO0f02m0T6spp4D2efLG+ke3kmpdd+BZ3s7Wzed9l3D3gWtc+hud3sspXvXsnmqTzrsvpq/8z2jL7XuvfqxTXObD/0ytb5njfnL3mSzYRdK3+BnuVtSa+by3MRZSgAAgE79B175AZdx303MAAAA8G1rQlT6zsr+AH+FpgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeJzt0UENgEAQwMBVgw1sIAN5uDvOBSGdx/ybdNZaAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPBjz8yc29cdfGPt9Zf/Wf63+d/mf5v/bf63+d/mf5v/bf63+d/mf5v/bf63+d/mf5v/bf63+d/mf5v/bf63+d/mf5v/bf63+d927/WH/wAAAAAAAAAAAL/zAqLzw4v0CnmQAAAO121rQlT6zsr+AH+SgQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeJztnY2RHCkMhR2IE3EgDsSJOBAH4kQcyF7p6j7Xu2dJQM/P/livampnu2kQEgjQg56Xl8FgMBgMBoPBYDAYDAaDweA//Pr16+Xnz59/fOI696rn4nOlrABl+PfB/1Hp+Yr+M3z//v3l06dPf3ziOvcyfPny5d/PLr59+/Y777A3ZQT0+0dG1Pu0npWeT/W/AjbR/q72X/VR+naVppPX7d/5nV1U8qzkBF0avV6ly65n7bx7PnBq56t66+wf5Wvfdbm0b3semg95Bar+r3ll9Y77nz9//vd76C3S/fjx4/e9eIa6qC8LRDq9HukzRP6eJvKIvLkXZateSBfX9XnqoGkjL09HHfR6/I3Pqv/H369fv/5+7go6+3NNZdHyI02UzzNZnyM99zL7uwxRntsIm8ff0Jmmie+MW1xzPUUanfM4tH1FPqRHF8ip6VTu+KAL2rLKHddUH6pnLZ/xfdf++swVrPx/VmbW/+l/nbyBzP7qb6hTVnfsHHpWfdEu4oMv0D6ofoE8VnJ2ukA+yiE/9xVVnf35kM/L3xn/7zEXuMX+6Dz6I/Xu5KX+lf19HeLAttg9/kZbIH/+936GrPRR2otC86FOmS7wty4r7ZG5XmV/ZNTnvfxMbytbXMUt9qcda7vv5A1k9ld/h+/N+ih93f2P6jbucd39JL4jsz960DaW6ULTqc1pF8jv9sc/8kz85RnNN64h4zPsT19RfdCfAXX17+pvGd8cmh6Z6Vv6PZ6lD3RrpciL+/hNwP+Rxu8hJ30vA/XGh2S60HIy+clfx0P6h//vsqj8Opep9Om6HQwGg8FgMBgMOjj3l91/zfJvwT24hCs4LfM0fcXbnsJj5cSlWM9kcYF7YlX+6tkVn9ZxmI/Cqc6u6Ljibe8hq8a2q2cqzqryH1Vcerf8W/m0R0Hl1j0TXqcrcnXx/Hu160xW5dX8/gnnVaU/Kf9WPq3Sk/OGzin6HgXneJCFfJwDWems0oHGFbtnHml/9OOcXMV5adxeY+ZV+tPyb+HTKj0RowvAs8LzIfPK/sTtVBaVs9NZpQO1P3Jm8mf+/8oemhP7V5yXc9bKvVYc2W751PUqn1bZH+5Y+SPlFD3/zEbI3P1/qgPPq5J/lytboRqr4Eb0fsV5BUirXEyXfrf8W/m0zk/Sh6OMaA/0NZ7dtb+OGZ72VAen9r8V6m/gGpR3r3xTZheu+9zB05+Ufyuf1ukps7fOOxkXtOzMRgHlFrO0Ozp4Dfvr2MnH9+IpL4hPU84LebLrVfqT8m/h0zLezmUDyilWZTMnd66U55FnR2eZjj3vSv6uXoPBYDAYDAaDwQrEvoj5nIJ1IGuYVSyqSxNz2x3+5x7YkTWAbh5Z5q4s9wbnYlh3ewx/BeIfrL931ibd+vWZ+xkzrlHXlIH4TqzwUWV21x8Jj10HqK/Gt7r2r2djSK/6y57nGe5pvZ33invul/TMQaYznun0SX/zOIbHaLPyd/LKZMzSddd3y8j0uINVHEn35FfncZSD8Dit7tXX50mjPgedK5ej8UDl7JQPcJn0HFHFn+HzyEdj/lqXqvyd8lzGqszq+o68xBtVxhOs7N+dtwRdzNL5L/g67f/oys8zZOc7yas6Z0I5yFKdjcj073xHV36Vl+7XdxmrMqvrO/JmejxBx4+R34pn7Oxf6X/nbBH5+qfLF3nQ/Y7P0v6exeKz8j2vnbOEVZnV9R15Mz2eIBv/lVv0Nl/t+7na/zNdVf1fy+7s7xz0qv9r3l3/r+Z/Xf/Xsqsyq+s78t5q/4COLT6G4Z90fOn4K5dpNf6r3G7/gJ7hq86fZ7pazVl8PPUxTnnFrHxFN/5r+qrM6vqOvPewP/Wu1v96L2ub3Nc+5Dyaz/89jc6RfU6fzeW7GIHOhfmeARn8PuV15Vd5rWSsyqyur9JkehwMBoPBYDAYDCro3Fw/VzjAR6OSy9cfHwHP4gJZu/sezNU6gv3Sz0QVZ6v2Y75nPIsLzPYyK7K4gO7Z1f3/J+tXtRWxNr2ecW7Yn3ueB3Lodecid7g80lRr9M4umR70XKBypJW+buUbT+D779U+VeyPmBN+Y4cjVD+j8Suu65559u97vFH5wiyPLF6dcUYdL1jF+3Y4ui7WqWcT4dczfe3IuOICT1D5f+yPDH5uJeNoVQfeRzQOp+f4KF/7hXNufFd9VGcmeF5j6/STLEbt/YW2x/kVsMPRrbgO8qv0tSvjigs8wcr/Iyt9L+NVdzhCzlJoX8/K7+TRfLszMyEPbZZyXDdVOYxt6t8oe8XRnXCdmb52ZdzlAnfQ6Vv7rPp4r+sOR6jvtcz6v47fXf/fsT9nO/Us527f0r0D2m93OLpdrrPS15X+r8/fYn/3/8ju4z/6x09W6bw9+bha2V/zzsb/HfujI792Zfw/4eh2uc5OX1fG/52zjhWq9b9y3llMgOvabzuOEPmwn84xs2eyOXBWXpVHtX4+mVtf4eh2uE5Pt1P3HRmfFTMYDAaDwWAwGLx/wOfo2u9RuJK3vlvjHu++19jACXZlf09cFGteOADWlI+oA3Y8AetaYnq6r7LbB1wBjuEUGk/scKWOrwViFr5uJH4W8H2svg7Hb+h6lTMY8dGYDW1L4wvoq+N2VcbO/l1eu2m0TroP3uW4Vx1B9rsjtPd4juuUq+kCkeZq38p0xPXsHAtxC42zOgejv89FPdANeiXWhd9x+SlDY/HVWQG1RcXR7aRxmbSuynlSR/0toSt1DCgPS1wP+2isUNMRJ6XcKl7YobK/Xq/sr/Fx2j1tEj15fEvz8vh2xatl/InbXP2YcsiKnTQBtZ/HHz2Om/F7V+q4+t0x0vv7BJ07Pd235fJ4HNrrE3D7O29APvqblMiY6QZUXNSO/SseQ7GTBj0q75nJq3yYv0fwSh1PuEPK5QNXXfmWFXiOMS6zme+1oA85X0Wf0LGp4g29/Vb9ccf+AfV/yuMpdtIo56jjoMqRfc/sv1tH5QTx+R13qJyf7se6Ah3b9ON7LeKDb/S9HNxTHWTXlV/Lnu/O14PK/vgy5dQdO2lUJp93Kt/Od/qHt5mTOgbUBrqnx8dn1622k1P+T6HjB3PM7N5qj93quu8lWo1bfl/Lr2Tp1q63pPGyK52c1vH0ucx3Xdn/NxgMBoPBYDD4u6DrGF3P3Gse2e1JjHWQvitlp0xdqxLvztaC7wFvQV6P57DuOz1HUqGzP5wA6Xbsr7EW1js89xb0eYK3IG8WjyRO7jEb57SIPTrfpVDuVuMVAZ51n6M8tMcgPCar/L/qM0ureRNDqbgYLxf5NJajHHLHKWk9tf4qL3zOjl6QXctRuU7QnTFxjke5CI2ldz7DuXvlleELPEaq9fPzjc7BVv6fcrIyvW7Z3mxv/9iN2KfHfLFttm+btgIn4nFi7K3totOLy+5ynWBlf+zqZWax/xWP6DYKMAeobHqSn3NB3l+yvKsYsO4P0ng3sdbst6Mq7lV9je6tUq4l8xkrvbi/Q64TrPy/21/nCbfan35JXP1R9td+sWt//AZ5qc8jX7f/am8HfkR5VeUPwK5eqvqeYDX/o55wjLoH5Rb7a7nuh2+1PzqkHNXLrv3JQ8cOtbnud9nJB3+u/J/L6z4/00t2z+U6Qbb+831FOrfIzl+rbhwre9H+df/DPeyv87/q3HKgs5v3cc2TvsyzXT4+/8tk0X0YK734/M/lGnxMvIX14uD1MPb/uzH8/mAwGAzuhWz9t4plgLf0rvmOZzqFrte68baKnZ5gV9f3LDPLT+M/q72RAV2XvgVcOftQgfjX7n7NW7Cja0//CPtX+WnsR2MVfsYp4wgdxC08ng53prwu/Y8zccx9lQ/jnn8ndqp18HckVrGSrG4ak9F24fIosnKyusL/uK41ju8yqb2IUztXuIvK/2uMX89L0c+U8604Qi8H3cGdaPnoRc/VoB+XJ4s56nc/f0s70ng68ngb8LoFPJbsfEC2D9tjs8TPva4Vh6f5VvrgeeLGFQe7Y3/3/0Dblo5THnfNOEIHHJXyca7D7v9d+6MXPY/pMgf0bI9C02U2Vn1l9ve5iJ6tq/JS/Si32OnDy+HeCVb+32XK9lpUHKHrhDTd+x/vYX9koq1lMgfekv0rbvFZ9s/mf/hC9Ze6jwKfVHGErlP8f9f/A7v+Dt+U6Tybw+/4f61bJs89/H9m/45bfIb/9w/193Oweu5Q5ykZR+jl6NnBqn17WteFzjOrs5luN8Vq/hdw+1fzv853ZuV09u+4Rb93z/nfW8e91zuD94Wx/2BsPxgMBoPBYDAYDAaDwWAwGAwGg8Fg8PfhEXvR2fv0kcF+E/+s9r2zx9LfaRFgb0z2eYQ+dW+pw99pXHGJ7EvzfH3/CO8A0g/7N57JU3Z1Oc1H9+3xqeyvv2PCviP22ek+tyzPam/wrfJ3e/XVhvoeEIfWG92yh0z7BPk9q21X6OryyDJ1X6T2jaz/ONivluXpn2pvnj+72huya3/ey0T6+N/fsaH2f228hv39dwfUPvTDDuwjrqB9qdvLFtf1t0U6rOxP26FPOzz/rP9znfx5l5vuodR9mwHam75riX1++ozusdV8tU2Shu8nOBlDVBf+rqGsbyuoW1ee+oLM9oy9+IZVmeSp7+9RmfX9cif2973uXOd/rSfnknScVFm4z3f0isx6LkTzpT2o3Fd808l+cT1fob4Aeaq+Tbvc8efZ2QHNx/eWr+THj2v+AXSn72JTPTLm+3yl0rHPebRO2l99T6/uZdf5lOaRvduP9uD98HRM4JxTNp9xYEP/7cxqHGb9tDOWI8vp3LCzP3rVMQv/6e1I7a/+Xfeak+eJ/fVcIu1Xy8zeXeXzrMr+/E87vjInQL7s40B+dEcbzvw6uqv8qud75d11gcr+6jcBbTGLFeiZUV3fUFedH1bnGzL7U66O5Xpdz6V6n9JzH539kcnb1zPQxV125xaR7qrc3Xh30p703Tralz7aeYrBYPCh8Q+IJGqi63e9FgAABHlta0JU+s7K/gB/ojYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHic7ZqJbeswEAVdSBpJISkkjaSQFJJGUog/NvhjPGxI2bFk+JoHDHSQ4rHLQyK13yullFJKKaWUUkr91/f39/7r62tKhd+Dsh6XTPsS6V9TVZ/dbjfl8/Nz//r6+nN+y3WnHlXWLVW+f3l5Odhj6/SvrfT/+/v7L0p1rHo/o/9p+8/g/5k+Pj5+2gBzAW2jriuMdsF1hdWR+BXOvVmadcw4s7T6s3VOGdI/pFdQPsoxSnOkildpVv/n/JH9X3VL8EUf/4nPuIgvcpzM+aPCiF/immdLlVdd17Gemc1FWR7yY2zK8yxbpp9UnFkbSLtUvs/g/w62m/n/7e3t8I6IfXim98dMI31BmyC80uKc9kf8nlYdyze8l5Fe930+k2nSnrqyLecc+Oj+n2nm/+w7fZ5MSviw7FjtJsdUylD3M/1U3iOv9N+oHWf/rvBKHx/W+WwOIB5l5P0n7z2K1vg/hc2Yb+nn+W6A7bFh9uvsm/S9fDcYjRX5Ppr9P8eQ9FWWJcs7q+8Sj6Kt/I8v8W32tZ5Ofy/o40mOtdn3ZvNR1oP8envI8TzTZMzpNulkmW75O+iv2sr/pbJRvgOWbft7e/c17ST9wPsEadGmeOYU/2c8xiTyIs1eviU96vyvlFJKKaWeU5fa581072Uv+daU6yCXsGF9G82+a/r31F+19nm1P6w51JrJbM16jdL/fW0jv/NH3/xLayGsm/TzayjLOepH/OMxu7+U3uh6ltcsrVG/Ju5szWlW5r+K/bLc+yNf1jzynPbCM7nOnm0k9145Zw2XezkmsHezJrzbOsuZ64l1j/Vm1pr6ulKF9zrWvUwrbVfH9BmQV16jHqfEeiX3SZe97qUyn6Pul2xvo/7PWhu2Zj++azT2V7zcxy3oI6zzrQk/Vi/sl2Ne/7ch9yEQexl1zLXKtFWm2fMa2bf/E0Gc0f2R/0dlPkd9/j/F/xl/9v6QduKcvRmO+DP/yVgTfmq9+pyXewL4elSn9EG3T17P8sqw0T4T97M/c515j8p8rrbwf99HKZ9QpjwvMdYxfjKW0Z7Xhp9SL8IYN/iPABvTvhBzbfd/H3Nyj/KY//l/IvMo9fvd/7Myn6tj/s+5HTv0fpJ1LfXxKX2Dv4jLPLZV+DG7Zxi25P0652HGcOJi57Q1e534M/coj5WDf2vxIW0nbcqe2cj/ozKf8y7IflvWKX1H3866Yo/RWEXcTK/n1/3Z+8GacMKW6pVh1IO5pPs35/LRNxjP9+dGefUw2kDfi0wbEz/znpW597VLaGm9QD2+9L9SSimllFJKKaWUUkpdTTsRERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERkTvkH4eXjmrZO46cAAABU21rQlT6zsr+AH+lhQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeJzt1uFpg2AUhlEHcREHcRAXcRAHcREHsbyBC7emIf+KCeeBQ5tP++tNbM5TkiRJkiRJkiRJkiRJkiRJkiRJH9FxHOe+70/nOcu1d/e/uk/3b13XcxzHc5qmx8/sGP0s99S9dRbLsjxexzAMf76HdO+yY5V9s2F2rc37PbV/1Te//o3uX7bre1Y565/lep19+8bZv7pe0/3Lc77vX//X53l+2j/X7P99Zdt67tfv27b9+sz357/9v6/6Htf3q/dArtV3+5xF1Z8d12uSJEmSJEmSJEn69wYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPhAPwr5rLhS2ipmAAABeG1rQlT6zsr+AH+viwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeJzt2zENAkEURdGpEUIQQA8ykIE8LNAhh25ZLJCQWbinOAberf4kM5ZlGQAAAAAAAAAA8APuY4znBu1Xs7cpeLxn3qCD/vpvYJ9/p3+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn+b/m36t+nfpn/bcZ35vEE7/QEAAPiy03p63si6jPnvX8yjf5v+bfq36d+mf5v+bfq36d+mf5v+bfq36d+mf5v+bfq36d+mf5v+bfq36d+mf5v+bfq36d+mf5v+bfvVlazZ/08BAAAAAAAAAIDPvQCVZ0O4iZR6AQAAFCFta0JU+s7K/gB/tBYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHic7VytuussE62M5BaQSCwSiURyC8jIWGRkbiEyMjIyNjIytxCJ5JsZoN3nNZVtv4f17PPX7p5nLxhm1vyQ44iXfQilOGNSq46pYdjvdMeU0jVs6XSScQlQSmutlJpi3LU28AW/5DAIyTl8HF4xxloLLyopmMAPyDHFx5eD9/s9cPhZpZJcOMHMfqxnWpYU033EOy2cSQkEAUhfmbAV/rges1Xi8WAS3yX+lhZJ0CekGdSn+b1DJ+SwMOQPHIQ2vE+4+Ys/9nTfe0wz0jdD0FLlRdDuHHTefmVHJTvOu8IfFoBexheRv+w+Te8tuq5ToQOTJSMXgk8JLb/XoR+cVmdynHFhx8tn/hp2eDzI2o1RbobPZPPQ9AoBTgCcGeAPf36a3zswxmyPW8g4eICuM7DtZxyBjzTw409Rcf6Q/Tjn3Zc2jG6+kCTa/3gomYkif9x9UwwAjAm/nX+a3zuA7woDWgEXvAMj8Fu8lzk4LfVgJDMTLAT32zlwQQZgpn2abzjleAT8iW/Xc5HJG3oLmDMyqE/zewdgbcOje8DWd3IQxi9w+FUPCzA68grSej9P3rLMX/t1Xo5MUi8r0FWV/wt4BODYwBmQn+b3DkDQDx3yByMQnXchplWDIdu9x5gHfwvTaNCfoV1rpaf1OsjKtdkd8s8nQP8DjBX0+qf5vQN4PnDtQnToCh/cax2uY0DzX0cgpbz3o4dvkmWHlbLzuGOkg+C35yhQt//fNaAA8PXxD3Zu0hCvWSeE0P2gpQxxswrtHvkY7Qf71D9IC/za3IOz0/6eSfaQXWTCZPz/LMGn+b0D/Iy7pfBH2m5E1XKdmjGufNE4xgp8u3JCJ7ki7SVN6g/bpxOsLoDW5dP83gHogcSlgCXVnDb8qZfkGMR0a7KaAVcuuCieDf/JxQa+UW/gKCEgZJ70P7yigK7L8Gl+72CUvZ3M0Hs80HOFe1O44VnLoJjre0HGjZpHSqZn+LeH5CD7vSINpCzfYqwp58B8PX8t5xV+cBDsrOsx9CGHMfbkzogHvNlpKwt/rQVkPP4I03al26hX9CtB4CkC6Sh8P//1QN8GHkCr8T7A3QOTkLZ19mDbhuI7yJhO/DnncAb8faVzP516en9T/F+hDkuHv77e/y2r7RhKVR56uy5mmSGr2S/I+6wqSQ4S4/KpbSjMiT4dEAE0GsAzNGYfSfwxESYX8Gl+7zAJVH4dl5gA+NGel9NuHbe4gATI3h1lPOP/UTjC4Puofl+RUdZFykkA/lo/ze8dhOKgezpMBAD+SJfVYUADXzIdOhtgIqJWAOhlhYLhdfiLo6wyqAZFucyf5vcOTFDmB9IPsvXOpLRrbXHHx3tRsCJScrQOYRWnPI9jHqRpTUA7g0wQz5NBGinbgsnRsF+/Pv9DfkCd9A8swpFA00ltgYyPM2NYywKS8E/IZgQnvsXZY1kMU2ZRK2OKAmBJE3AxwvUD+h+3FItf+Euo8w5m6AeU/O5euHxGdsjnOc+bT+mdyo5Psgcv4b/kh+UtkExjGvjX+/9Kjxjq5Vr8cMdz9MYsydOySDwF+dtyBcBU/vgh8IzFGpior+FisE6egf/A/svqxeBnVnechz1uaQ9hvQ9YEUgD0P6JvKwJjqkpDy4OFr/gD1YWsZwR0XV+xpc+ze8dZNky2mp/rhj5tT+PPUVHRXHewQJILlRN854qCI86+AT6MOflv4EjAuFEgC+Ze/w/P83vHZSstg1/uQam+xH21MZ0J0z7gQ7woVKW+od6NRpMG+A90lBUQsd84SH4Q536J/hn+EHDHl5wYrXGSrAPx+0FM2DXimN9/1UA+Mu/pH5w/A0YAn0XutGOu3Ej7/H1+i/HMjcvFuL/OJrR5LKdGTzEbvBuDBRCJzJ9o7AaIEkA/M37KUOWJQTiP+U9Gw7G8wP5PzGY1hGsWB8epBC6MhA1io+9EFgYRwcASgDV8Lg4Nea1UDU9wCo/SghZTwQ6gv7BvIY1+Xr+yswzKN4VNZ+NMya34MJVrzxogVVABAByDKvZ2PmZ51m5kudX1QvbTVI4x4fiTC3qafYD+29CSsc0LA637TgklUI7wex17PNpMPXt2MNKMAqtBq9XB5mwNDUXJOuptp9jIrZOnIfThOL56+NfuNOV7m0PGvZ4mUTWtA9xpHQe8bBg3NJSawglsZNmldaWVKief8lzSkAvkAaeXfaYxn+a3zvMKcUUTzjX8sE3w7C8BQfeHvN5g2X0cIgHw7A9BMmOh7zGgeD52/IBxozJqv5LdMDjpCAxmvZP83uHaQP+KQ4YwoedC4pfTLhz2GKMHmxZWHyVYvsoKLpVvVwKhOAy9Ys/ecXV5mRgvz/N7x32LeIC7O4ht7hjoAP2Qrp43nEJmhRe9ex+xUzJFPbPqldHvvHVAzJWj3RElNnTp/m9w7GdexzHeJhtO6OkJBd8gNpTmsijc8NlKfP2c4lysmY6edYhJ/7FALBDbr0n8zfr1+9/AKG2yMe4g+930QmU/BDxhF2nTBIjH1XCjLKLrlH+uQjYP8vNAVUzJDgUzmXzWI9P83uHaZ/BooUjGe9AA3NGqk9UOUeba7Knm7H673TNheldcAc4OKT/6YAQf8iUx6+v/+33QIVb1DAY/HEEBL190XGv2QY0gMmhF9DP1zHXAXmQ6z7FIxB/sn8STJ/m9w7uWHAjGeelEoLm32X6Mm8/7j4N9oD+UWUKqoxEYc2w41xW2ZvdnzWur3Lo0/zeQa1pAQOuJTAshXZ5Fgp7wlxQskOjXWj/Vj+dX6macZygeRVR8hgMOEBVvOKn+b2Dmc5k0N7rdoL4R44CTfshRM17gb1bQzb7HBcE5fcS/cUzItIKwFnJ/H8h/++92cei37HAWY695JpyX4mTjHSq7QKilrx87hVLoWvZlMt/DQC+2WNLkf2A/reK90eeVgSdL55ZLEUA0AFelLxuXam6X0pF+YDUkmgtDarcDtfgKNFBdD/AH9JUFyc8/8IZrsqkp5L1lPeSCrtSLyW3VVTrkC+TzylQ6QpkSWz7UlL7/vovlzrEa+RMYwWryHpdQx+4AZZHGfupLomu1Y66+6R9cn1U5aansaiiqTn4aX7vIHU/3QdYuQEfaCh9NebJDTt/Ei1dLIPM8gC8AvbDStW0DkWV7kflr7Ns/IH5T9WvV5y7zsBZ18bb3L2kJJb2WAhq5vHFQVpERkItEV5Lxs/Wb+WPHza5nK4U+/7+33DHGX7ODivYNkDiluc2eouuH3WgD3CaxeKwQYzTH6VfJLscNXTNfar+U5U/2D/7fvvv46FB+8MpZ9KN65hjvZ8cHAmIYcqvxwqyd9UigxfXl92iqIHvWRMlI8jRAV/9NL93UD7ulMUyLvr1OFYyAD3hYD82/vR4xSsovcIBweQAX6rNXkVd4cr/2RnAEoEuXcOv17/aXguWMJ0R43VsB3DFXGebLZW21XCmFFfjRs3z/lM+hDUijnVPKn09u0GqOEUDX4LjyMTX81dmmzCh43KIyzxN12Zw5vcIVNyVcoop3ZPzFuscORnO3XBQAXBmeC59voIh6UON01Q4NPj9/U+lJ7raIfU5S2fNEQdltT18NmfZ33gbAqd9c0AEtjQKA4ERhYEs9BVmza8FwCsjuEDfH/+V9gG5iWGjLRzXHYj7ewDPN2B3f0npNLqOc2PLF/Ycm4XyVfLMIQELAbJYCRiAZTgE8Gl+76CU7bGC7RZD+6vDDjs6xGvf4okdrBX23+QdLqMvsP9esZrslGEIjne+8FtwmJJaiKHDHsin+b0DcHBAc1wxCKLgn1bsW4RhvuK9KOl2OP8OvR4sEkhaZXFa2HAmS66bb7xhvigkZUSCUeIoevEL9z/oADOFEogGOR5hydrfhCPdwzhuwN/jflJ6AEmiE3lmSuU5R1v232LpAFYIlG+H135UIKX0aX7vQMT46EDboX3zLpx5kE37OcVtCSf6P85RymOZTHgPGggnAsqNR7J/8AeOMWs5RgSPnc+HWyip/jS/d8g63nvJ7aR5B2ab8m7rHi1/ofjvO7whiH2xjg3gGcWDl7Nv60VIvECmUBIKaTmWkdeTcslP83uHXMzWA2yvNvzRCR1XbHcrSAxSOu4bfo/uQVqX5gR7VIJdGfWmMV8MjhAPyT9iytzRH1hXNd9f/yziZcZBdRxo5KxPPX8Ms1lj2ucL26P3qGRVvELeh8qpD0155zWocphSZuohSkwafqD+mzuXMniW67nswa6VcyuY2eKy0mXQ6xxr1RPOx30tqkgBqvXkAFBugMjnfUiIp/oH+BfFZkPO1+AEsPXWOPWgj3tZUf2Gde2fwy1yua/b1rpPHfV/zkTJZ9tknqly/ml+70A7JvASGP3kELvEnAKd4ineF/Bf7UBZf14Au133ISvd0u95jkLoqn+VMLvCEuqn+b0D1amBtJ0oZe8eat3hhEN09zM+AwD4D321axC/PfAPXFZ7f43EPW8CYvMAL9MO+gEe8dP83oHmXbDGN54G/btQWwThK914xAMXAJM/52qBS9r53OWz/vlKe/NhyH9nHFuI08h/oP+R57phe81Nx1r2OA7S+2lP+SEQp2A6OEPBDfbVTttCdQ9K/v52PurkN85CQ9706Gf+C/qnBjbl932Yln5Gmz+Pk8ZC4GsTDKIj5fKoANy4LnQnkMa7/jwX4lUGkHiXmD/swn+h/vWcY5B6vlMc1hSvVBHX0cJeDwbvydOoowvrQk84kAbHwovpZ/71UND0O+uPX5j//qdzCXu/XCne9+TBCwD/jUoZHaY0peHhxmWmRz8ARybVswFQKx+lMYB3BNP0C/2PPxto/AVy91iOGQ42zYUtZM+Q26MDpLK2n+aFelxl6u01BJxdXyeKDhRTupT4gf2vl7ZAxtjzOtNAtUs5oP3vWRVoYbCqFwx817TO+QKM58/tf1kAZcBkUfbeww/kv39UDChZHIbrBTa9pLtR+roS9ujpF6NT2q1HoDFPPPxC1jnQegAg9S1XIvoTZ4q+f/+1ftE3DhZgoqq+nO4D3J/Ngrb4eUOVMUsNDjjibt2s/Bv5cOvzZRklp5Xe+TS/d6jTHeXhTcMWN0pz5BmH61Cs8Oc1xId0qHwNXo/gLJa/IojCKC/88dEwP8Bf5oFVUxJZN96rpsGW7Z6u/dFlUiKPuAJ8nPATkNsf6XR7vuTymoOQMo/QgumfHjvgn+b3DtWH0/bDAkxxod0VJsD+a1HGXXi932XoXrRWIkyDlfOpnxOhZRkqfxbWX4j/2b5pwAf46/5KY1EyfkyZP031M0oOcAHoHozUkC/BZ/bXLCxGiNwkIg3M9K7499d/WW3jW4fH4DhmQ1SMByW0dRjPyx3o17gPRssJnwgh2WhyIRxXRtjzHssEkWRabSN86NP83iGPacBPPB9Oa3yyFUkd5XrI/uYHq/3dOu+JNoBVnzGXi/yA4+GS01hAwFZRPiYYQrfAu6+3f178lrnA8etzU2ammObdmXayevUHeOGbUv3QU0tE8d5iJ1D1uBrAP2XBAPrRqtOJ7usfACeKXPfnBoHtXqQKDi892v5O4ZEfDaFqXqMUp1lwo+e+mLnvwcd3HBWC9JAym2xPTPYhesG/nn8O7KDm5vFU4dQPYfBhJ0JDHjhw3gn5nHUjXmXIb+5z2JByjjGURNDGdCpV5yfPo1Pj1z//BG/74+1+5u8jnIFj5Uq7wXnwZVbRZbjniCOmgrnap5Yex5xoLUI4vDRUADrvSZVSKDfHynv99fvvTRnk5s4viaY9cfKZT+eQ/yqZUM9hR8adoSu/U9D12VdgAmsuf9nJobvU9IwgNQdnvz//3azIp1swfUZborfqT6ryYDpf7/9Qn5+XEdlpVM9HXSl31Mf+idwWRccgD6+53j7N7x3GzWTLFhykbSliqDXeNhezyZdn/jUMYpsb9h8FM9B26zKckDPj5WCJfcI6EbG6Tixff/+FD9s+g1FDyhdSL7HGte57itE8x5qy7qtJPpb3hFtsyZrMGq+YdpO3nb+ekycGL8bp+/UPHOnrcDj+uKVAkua6Yjxo/2Wd935WSbDt7Ydlctrm9lfYnQlncvRosHLpIS/ANo3798c/HPFfcqTf7gvOAh+PcQ9mC9Xga35TzvowDQPYSX7MldbLgNo5mPJUFNLS9J691t18//wrHG4RkoI4r8M4reC3923aenVM+abHk34xAGCGpf/6iDO92loBy36PHpRBEwFLWiFr/jS/d0D9P22Yt2HYAke2pz6k2d4rJfOvhzy9Cr1k4/R4M8DutH4aQ346Il2TgC9n8DLdlwOntkDM0tSWFNN93VtY0zrekPvCS/p1BDJ5U8iVe06GnoRYH3eH8/McrwKUT2En5MvBIO9fUedwyNiEviH9n4907ukClzYf82ipKfiEc+ZPwdTqxefen6nTMFI9U0b1A/Of532lVTAQvRJT/WUf5XTe5xnjdd8bWIOnoUZVm9t28HnySVsqmC054dPloXeGLkzzoheE//r4f2wphQ7yXMEYfGnv3BAxpCPgJOx9cYLlnofsj3koD7/ARZiVzDUi83z8O5pSTitD/Pr73w0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/w/4H/JtzuU1jDpXAAABqG1rQlT6zsr+AH+2mQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeJzt0bENgDAMRNEbJSMyBiNmGyN6ihQgR+gVJ7n9fqmqLGwkqQ03cx9rDW/v2KD/aecHP+HPv7uLP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz59/fxZ8/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPv7+LPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz58+fPnz9//vz593fx58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz5/93/wv2F46R+gePnAAAA8Fta0JU+s7K/gB/z0wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHic7dtdaM1xGMDxP0spMgvTJDOyC5NyweKGlRsvRWShyby/v9xQInFBXMmF3Lhyy40sMe/v8zKTvGyyKE1m3oYo0fE8/Z/Tnk7n5Gqdc37nu/p0Tr+dc1b7/t//vxMlEomolxVHUbRb1Ire/lvIDeWSeo44JO5rdrGH/gWhTjK/s+be8WR/+RkvJotpYijLRVC2Sc4u8S2l/1nRzzwWH8VXUU//oPSRnPPEB+v+0x7bRJkoEm/dcrGR/kEplZzXrW2zWCa6xT0x3Pq/cP3X0D8YAyTlJev6SUyyttPlodKe62taXf+19A+Cdj1nTX+I2Rm6DqR/cPQcv8Ht75da0xm2HMwVI2yM/mEZJvkareUvscp6DpKHV7Y8qNX0D06FpGty2/w617JEnr53nVfQPyhTXMcu28b732v/Dte5nv7BqLXm2q9dVKdpSP8w7Zdcf6zdLTEmQz/6h0Wv65xy3U6KYms3Sh4miKqo53o+/cOh2/cW6/Vb7HLN+srT267nQfoHZbvk+W6tXqc5ztPruU2u52H6B0G396ddpzNibJpWuv7fda87QP+8p/fv2q3PX7FP9M/QqSilP9v//KXX8o64Nk/FrP/0oX8YZkY9x3jqhCjJsL2P3Dj98582fWk9nokFaZpoz2PigjgvFttr6J//dM6Orv+bxMgMPcrcMUHCjgnoH7CULno+8MB120H/IE2UHEeNnssPsT46d+uh67aT/kFa4tqocfQvKPNdm04x2vpk2v7rseMdN568/jM4pf9yG9d5Ysz/zF0LXRudn5+8v6fr/2P3u+Q9gKKU5cJf/+104yvd+u+PI9fTP6fURPHcXfVGlLr19rL4EsXf3fDz9htsXN+z1y0XT8Rnkzxf1HONFnutLl+L6J81ek5XnqLK1kmlc/crbVy3A3pdYLPts6fauN771X3GFntPje0z9DxS54NtsGWl2sYrbFlYJ7ZG8RzxMpaBrND7dq0pdBvfaK5E8TVgHX8ubkTx9Z+LUXws2Gr78ps2ru/R73m02fhV91nNNq6fc80+Q9/zKIrvH2b7f1GIut1+OJu66Z8Vut515ADWfwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAobP8A00NYIHMjXmEAAAQ2bWtCVPrOyv4AgAtnAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4nO3dS4hOYRjA8ZcZt0gZtyyYxESIISxIipIFK4VIE8UGZaWUYqOmEJJLsrJRsrGUS4MSETYUuYzLiihyv43n6bPgzPkYfI/zfN/zX/wXs5znN/Oeb973nDOpo6MjVUkNKaU2qcNZR6WeSb8ofka1WpOM944D62x7pG7YmzZbxvvcgXW2Tbib1yIj/uDA+sc+S6uwN03X1G0OrLO9lRZib1ofGe8xB9bZXkgzsDdtqIz3sgPrbI+l8dibNkHG2+7AOtstaTj2ps2X8b50YJ2tTRqAvWlrU+kzddHW2Y4k9nUsq0ul/ZOinfPairtpupd70oFzNt1rWIG9aRNlvPcdWGfTv+9mY2/aUhnvGwfW2e5JY7A3S6/12x0453VRGoy9WQNltKccOOel+4y9sTerWUb7wIFzXq2Js1vLliWf1/pP0mrczdJr/U4HznnpHuM87M0aJKM948A5r4fSBOzNmpx8nt9oV6Vh2Ju1PJXujSjaOa8TUl/sTaqXse5yYFyu3VJ37E3Sa/1ZB8Z5fZHW427WlFT6PFW0c16vpAXYm6XnY+8cOOd1VxqHvUl6rfd6Xq+dlhqwN0nPR9ocGJdrr1SPvUlTZayPHBjn9TGxl2tZS/J7rX8qzcLepPrva2rRxuW6ITVib9IQGes5B8blOp7Yz7NqWio961K0cV5fpS2JM3urVspY3ztwzuu1tAh3k3rIWPc5MC5XuzQJe5P0ecsLDozLdT5xb6ZlTxwYl+uQ1KNge30usdVhMys0l6KN89L789Y5+Z1vdTCPvDbUqL++52eOE3v8/283pVGO7PH/f+meTj9n9vjbp8/9b3Tojr99z6S5ju3xt+uKNMK5Pf42HZZ6VYE9/pVN362xpkrc8a9seqY4vcrs8a9M+oxAte7h4/9v7ZDqqtQe/79Pz+sXV7E7/n/f7VQ778rF/8/SZ23714g9/l1Pn7fcnGrv3jz8f5+e2c6vMXf8u9Y1aWSN2uP/6/an6tnHxb9y/voOrVr42w7/P/fX9X50EHv8fy7Ceo9/5/R9KkuCueNf6rrUFNQ+uv+BxLuxI/pHXu+j+0df7yP7H0ys9xH9db1fintIf32PDut9XH/W+9j+hD/hT/gT/oQ/4U/4E/7Rwz92+McO/9jhHzv8Y4d/7PCPHf6xwz92+McO/9jhHzv8Y4d/7PCPHf6xwz92+McO/9jhHzv8Y4d/7PCPHf6xwz92+McO/9jhHzv8Y4d/7PCPXSR//d8eYx3WWODPeiT/ZgffV16X8Mcff/zxxx9//PHHH3/88ccff/zxxx9//PHHH3/88ccff/zxxx9//PHHH3/88e/UN+RGmKc6urOdAAABgm1rQlT6zsr+AIATeAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeJzt27ENgzAQhtErMwRFlCGoGYkxMlJGyTYO9C4QinUn+RWfRIX0+1VYIlprcaFnRLSCfeN8uLbh3+0F9vd6DzgT/vyzd/Hnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/78+fPnz58/f/7883fx58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/Pnz58+fP3/+/PN38efPnz9//vz58+fPnz//8f6P45VbwdZE/6XA/l6vxDORJEmSJNXsc3wqat6y76okSZIkSZIkSZIkSZIkSZIkSZIkSf12TV32/6eSJEmSJEmSJEmSJEmS7vcDg2g9wx9mp0gAAAMbSURBVFiFxdhLaF1VFAbg76apr8TGkibgs+hAoYoEQTtSig9QEASV6kAFaahSUIrgRHHgSNCZoCOd+Bw4UtSqdCIi2oE68EEVX6jUVtrYxuZha7IdrHXI8SS5zU3vtT9s9t5rr7vXf9ZaZ+19bquU4lSir4d7D+FxbG2n1N9loxtxBa7F9bgaT/xfBO7B0zi3IT+/Nt6EAazFdzjYzRAM58Z/NeQXpHwtXsMuvItb6W4OPItxzOZ8JvtLsQHzSXJY5MdZ3SYwgkey/xwPYBKH0zgcrekfp3s5MCDcex0mhCe+wC/4HQdSp1X7TatbBAbwBm7AFO5N4/Bh02ATJ0tgCK/iFhHz7SLBtogY94lw7Ft2h1LKattIKeWDEpgppWxL+bpSyvellOls4ykfLKXsLQvYXkpZtQcuxuvYLNz+IF7JtTUYxJk5n2u30WoIXIOXcBkO4n683dCpG2172HT6Gm7FO2n8R1FMmsY7QicEnhSv2gZ8jJuw52SMs7IQjOI53Jnzl/EQjuAirBNuPiBC0hFO5IHNeD+NH8djuC+N94lE/BJfiSrYMdoR2IndGMPPuB1P1dZbIuMr1McrxlIhGMXzuCPnb4mn+6GhV/w3w/9ZDYGmB27DJ2l8XiTeXUsYZ3FpXbLUngiVB0ZEfHfm/Gs8Ks7unqIfN+IZEWt4MY3/2dDts3Csdg19It5j+Ea4frxhfL14DXfhPdzdTQL92CEq25v4bQmdM3AzLsn5p90msDvbcpgTl4yKwFS3CVS4EttyPCtuuIdEdi+6yfSCwOV4uDZ/IQn0FPU6MFMb/yEvjRYXnLICuWXki/TrBOql9PTaWkvc6Sv0r0Be9+yamvy0pryuOJGN+LiortBHRSgOi4Q8kvI5cQJW1+4qOSdTXpGbzn4q1ybS+CFolVI2psKg+KarlPfg71Qew3k4Jk6/fcKFV+FCEa5v8ZM4E7bg7Hzqz5JQS5yuQ8LDH2F/q5SyN43OithXnhnNfl6c8zMiLOuTbEn5dG4+hHNSf7+FHBpO/TkLuTUvyv+xVjm1fxBM9mt3Z+89fv0X2O8gymZFGXAAAAAASUVORK5CYII=
)=====";
#endif

#ifdef vent_option
String SendHTMLe(String r0_val1, String r0_val2, String r0_val3,String r1_val1, String r1_val2, String r1_val3, String r2_val1, String r2_val2, String r2_val3, String r3_val1, String r3_val2, String r3_val3, String r4_val1, String r4_val2, String r4_val3, String r5_val1, String r5_val2, String r5_val3)
{
  String ptr = "<!doctype html>\n";
  ptr += "<html lang='de'>\n";
  ptr += "<head>\n";
  ptr += "<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'>\n";
  ptr += "<meta name=\"author\" content=\"Holger Gebauer\">\n";
  ptr += "<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n";
  ptr += "<title>Measured Air Quality</title>\n";
  ptr += "<link HREF=\"favicon.ico\" REL=\"SHORTCUT ICON\" title=\"Modbus RTU to TCP-IP WiFi Gateway-Server\">\n";
  ptr += "<style>html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: center;}\n";
  ptr += "body{margin-top: 50px;} h1 {color: #444444;margin: 50px auto 30px;}\n";
  ptr += "p {font-size: 24px;color: #444444;margin-bottom: 10px;}\n";
 
  ptr += "#header{height: 80px;border-style: solid;border-width: 1px 0px 1px 0px;border-color: black;color: white;-webkit-tap-highlight-color: rgba(0,0,0,0);background: #b0bdda;background: -moz-linear-gradient(top,  #AAB6DF 0%, #4A6B9D 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#AAB6DF), color-stop(100%,#4A6B9D));background: -webkit-linear-gradient(top,  #AAB6DF 0%,#4A6B9D 100%);background: -o-linear-gradient(top,  #AAB6DF 0%,#4A6B9D 100%);\n";
  ptr += "background: -ms-linear-gradient(top,  #AAB6DF 0%,#4A6B9D 100%);background: linear-gradient(to bottom,  #AAB6DF 0%,#4A6B9D 100%);}\n";  	
  ptr += "select {font-size: .9rem;padding: 2px 5px;}\n";	
  ptr += "@media only screen and (max-device-width: 240px) {#header{height: 70px;}}\n";
  ptr += "#select{font-size: 28px;left:20px;letter-spacing: +1px;color: white;	float: left;width: 100%;height: 100%;position: relative;}\n";
  ptr += "@media only screen and (max-device-width: 240px) {#select{text-indent: 3%;font-size: 18px;}#select!{text-indent: 3%;font-size: 10px;}}\n";
  ptr += "#webpage{background: rgba(0, 0, 0, 0.2);text-align: center;}\n";
  ptr += "#webpager{background: rgba(255, 0, 0, 0.2);text-align: center;}\n";
  ptr += "#webpageg{background: rgba(0, 255, 0, 0.2);text-align: center;}\n";

  ptr += "#chartout{height: 50px;background: rgba(0, 0, 0, 0.4);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout::before{content: \"Config\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiCAYAAAA+stv/AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAedJREFUeNrkmM8rBGEYx2dmVxtLyoXacJEkSuJCEiXlIFyWG8lFcnEUFxe//oStLVEcOCq/Dkppb46Sg4tCWu1BMnZ3fN96aDx27JqZd+awT30O877TvM8+z/t+n+dd1TAMxU8LWoz3gEXQBTIurJEA6+D416yIgIkQGAZZQ46Ns/UUlaVgCsyBdrAJtkHIYQR0MAqWwS1o+hFV5lEMpMEzKOfeOqAUPIIMiJjnNOZtAIixtAu5N1uGvqkR36YpPlvROCBS8OaVA2OgPocDk+Cea48MB2bBOWhk4xegH6RkO6BTBIQT3WzuBiS92gM1JL1RO7XAyoROdIAKkLX49RHTcxnYBbWkrI4d6AMnNqKxQWmZF+LrJAWVDlIiaswBCPspRCPgEnT6qYRhc4UNerz4KZ2KpN0IvDpYfAsMcR34bwTOwABtxlzH8AOsgWY2vkINiZKvJYtTO/ZATYSd5uPQ1ILpYOav92XugRcwAY7cVMJCrAQ8gUFwxebqqBilZB7DGOjNsXgb7aEq2RHYs+g7RE1ooN7QcyUMUgEr3p6wYAeyVC4DLjun0TcNLmB8EyaoUrWCBbDjwtXsna5m1eCOjqilEoZB1JBn0/kup18misYSaHHhiiZCfw1WwT6fVP3+g+JTgAEAk1EJ5Os+dK8AAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "#chartout1{height: 50px;background: rgba(82, 122, 122, 0.6);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout1::before{content: \"Chart Radon\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout1::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "#chartout2{height: 50px;background: rgba(6, 95, 142, 0.5);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout2::before{content: \"Chart CO2\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout2::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "#chartout3{height: 50px;background: rgba(6, 95, 142, 0.33);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout3::before{content: \"Live\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout3::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAAEoSURBVCiRY2AgAljd/w8FfxeD+Ezz/sPBSwWgANv/aWlQkPk/ASjA+VcAppnx/gSQwB+EceexCnCgCXD0/GHwSFFACPD//8Ow/u9yR7gA770/DLXv/183hAkwSv5hEI44/+863FB2kKGq+/9tB6o53wAx1D1YQGz//9MzOt6faAAbOv/vMgX1vWDffAAbWgc0VIG16+zdu3cvMDBp/mEQyTj/7xgDo6CSkpICwtBlBhDHsdcADXVmEN///9SM8vLyAoihb5YiDOV7/4eh7/3/YwKiXWffvXv3gIFJ6w+DSuZ9kKFKEENB3hcy2w90CjQMIAFkATS0HWwoLMQszkENhQeh2Ox7YEPhAoxCSsbGxgYo0QABSBGVVqaAFpW/DVAj+99igikDCAA8f8C9upF8kgAAAABJRU5ErkJggg==);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "#chartout5{height: 50px;background: rgba(6, 95, 142, 0.33);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout5::before{content: \"FAN\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout5::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiAQMAAAAEfEm8AAAAA3NCSVQICAjb4U/gAAAABlBMVEX///////9VfPVsAAAAAnRSTlP/AOW3MEoAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAfdEVYdFNvZnR3YXJlAE1hY3JvbWVkaWEgRmlyZXdvcmtzIDi1aNJ4AAAAZklEQVQImUXOsQ3AIBAEwUMOCCkBd2JKcSfQiVuhFEp4ZwSI8z9CcjLRBosRSXSviFPaAj95I0Y3hjENLh7t+M4DbN2BNS2AkRS5lXZWoEYAxcMp5QBC84oEhdngxoaKUReXrWXyA1c3TQEoUwPHAAAAAElFTkSuQmCC);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "#chartout6{height: 50px;background: rgba(6, 95, 142, 0.5);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout6::before{content: \"Chart FAN\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout6::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";
       

  ptr += "body{ margin: 0px;overflow-y: scroll;font-family: Verdana;-webkit-tap-highlight-color: rgba(0,0,0,0);-webkit-tap-highlight-color: transparent;\n";		
  ptr += "background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAJElEQVQIW2NkwAQ+jGhiPgwMDFuQBcECIEUwQbgATBBFACQIALmgBFKywiuGAAAAAElFTkSuQmCC);\n";
  ptr += "-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}\n";

  ptr += "#outLine {\n";
  ptr += "  width: 100%;height: 5px;margin: auto;\n";
  ptr += "  background-image: linear-gradient(to right, #4A6B9D, #4A6B9D);\n";
  ptr += "  border-radius: 1px;}\n";
  ptr += "#line {\n";
  ptr += "  background-image: linear-gradient(to right, #f12711, #f5af19);\n";
  ptr += "  height: 100%;width: 100%;border-radius: 1px;}\n";

  ptr += ".Stil1 {color: #000000;font-weight: bold;font-size: 18px;}\n";
  ptr += ".Stil2 {color: #000000;font-weight: bold;font-size: 24px;}\n";
  ptr += "a:link, a:visited {text-decoration: none;border-bottom: .1em dashed black;color: #000000;}\n";
  ptr += "</style>\n";

  ptr += "<script>\n";

  ptr += "function lineComplete() {let line = document.getElementById(\"line\");\n";
	ptr += "for (let percentage = 0; percentage <= 100; percentage++) {\n";
	ptr += "setTimeout(function() {line.style.width = `${percentage}%`;\n";
	ptr += "if (line.style.width === \"100%\") {undo();}}, percentage * 10);}\n";
	ptr += "function undo() {for (let percent = 100; percent >= 0; percent--) {\n";
	ptr += "setTimeout(function() {line.style.width = `${100 - percent}%`;}, percent * 4.5);}}};\n";	
	//ptr += "setTimeout(function(){$(\"#line\").addClass(\"showLine\")},700);\n";

  ptr += "function machAlles(){lineComplete();loadDoc();}\n";

  ptr += "function chartout(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=7'\",100);}\n";

  ptr += "function chartout1(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=1'\",100);}\n";

  ptr += "function chartout2(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=2'\",100);}\n";
#ifndef Freshbox
  ptr += "function chartout3(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=3'\",100);}\n";
#endif
  ptr += "function chartout5(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=5'\",100);}\n";

  ptr += "function chartout6(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=6'\",100);}\n";

  ptr += "setInterval(loadDoc,5000);\n";
  
  ptr += "function loadDoc() {\n";
  ptr += "var xhttp = new XMLHttpRequest();\n";
  ptr += "xhttp.onreadystatechange = function() {\n";
  ptr += "if (this.readyState == 4 && this.status == 200) {\n";
  ptr += "document.body.innerHTML =this.responseText}\n";
  ptr += "};\n";
  ptr += "xhttp.open(\"GET\", \"/\", true);\n";
  ptr += "xhttp.send();\n";

  ptr += "}\n";
 
  ptr += "</script>\n";
  ptr += "</head>\n";
  ptr += "<body class='chartbd' onload=\"machAlles()\">\n";
  ptr += "<div id='header' onclick=\"top.location.href='/get?inputchart=4'\"><div id='select'>Measured <br>Mesh</div>\n";
  ptr += "<div id=\"tt\"><table class='ttab'><tr><td colspan='2' id='temp'></td></tr><tr><td id='temp1'></td><td id='otemp'></td></tr></table></div></div></div>\n";
  ptr += "<div id=\"outLine\"><div id=\"line\"></div></div>\n";

  ptr += "<div id=\"webpage\">\n";
  ptr += "<p>";
  ptr += "<p class=\"Stil2\">Dieser Sensor</p>";  //<a href=\"192.168.178.77/get?inputchart=3\" target=\"_blank\">Dieser Sensor</a>
  ptr += " </p>";
  ptr += "<span class=\"Stil1\">Radon: ";
  ptr += r0_val3;
  ptr += " Bq/m&sup3;<br>";
  ptr += "CO2: ";
  ptr += r0_val1;
  ptr += " ppm<br>";
  ptr += "TVOC: ";
  ptr += r0_val2;
  ptr += " ppb</span>";
  ptr += "</div>\n";
  ptr += "<div><img src='data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAQAAABN/Pf1AAAAC0lEQVR42mNkwAIAACoAAgu1Hc4AAAAASUVORK5CYII=' width='5' height='5'></div>\n";

  ptr += div01;
  ptr += div01rg;
  ptr += "<p>";
  ptr += "<a href=\"http://" + p_inputip01 +"/get?inputchart=3\" target=\"_blank\" class=\"Stil2\">"+ p_room01 +"</a>";   
  ptr += " </p>";
  ptr += "<span class=\"Stil1\">Radon: ";
  ptr += r1_val3;
  ptr += " Bq/m&sup3;<br>";
  ptr += "CO2: ";
  ptr += r1_val1;
  ptr += " ppm<br>";
  ptr += "TVOC: ";
  ptr += r1_val2;
  ptr += " ppb</span>";
  ptr += "</div>\n";
  ptr += "<div><img src='data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAQAAABN/Pf1AAAAC0lEQVR42mNkwAIAACoAAgu1Hc4AAAAASUVORK5CYII=' width='5' height='5'></div>\n";
  ptr += "</div>";

  ptr += div02;
  ptr += div02rg; 
  ptr += "<p>";
  ptr += "<a href=\"http://" + p_inputip02 +"/get?inputchart=3\" target=\"_blank\" class=\"Stil2\">"+ p_room02 +"</a>";   
  ptr += " </p>";
  ptr += "<span class=\"Stil1\">Radon: ";
  ptr += r2_val3;
  ptr += " Bq/m&sup3;<br>";
  ptr += "CO2: ";
  ptr += r2_val1;
  ptr += " ppm<br>";
  ptr += "TVOC: ";
  ptr += r2_val2;
  ptr += " ppb</span>";
  ptr += "</div>\n";
  ptr += "<div><img src='data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAQAAABN/Pf1AAAAC0lEQVR42mNkwAIAACoAAgu1Hc4AAAAASUVORK5CYII=' width='5' height='5'></div>\n";
  ptr += "</div>";


  ptr += div03;
  ptr += div03rg; 
  ptr += "<p>";
  ptr += "<a href=\"http://" + p_inputip03 +"/get?inputchart=3\" target=\"_blank\" class=\"Stil2\">"+ p_room03 +"</a>";   
  ptr += " </p>";
  ptr += "<span class=\"Stil1\">Radon: ";
  ptr += r3_val3;
  ptr += " Bq/m&sup3;<br>";
  ptr += "CO2: ";
  ptr += r3_val1;
  ptr += " ppm<br>";
  ptr += "TVOC: ";
  ptr += r3_val2;
  ptr += " ppb</span>";
  ptr += "</div>\n";
  ptr += "<div><img src='data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAQAAABN/Pf1AAAAC0lEQVR42mNkwAIAACoAAgu1Hc4AAAAASUVORK5CYII=' width='5' height='5'></div>\n";
  ptr += "</div>";

  ptr += div04;
  ptr += div04rg; 
  ptr += "<p>";
  ptr += "<a href=\"http://" + p_inputip04 +"/get?inputchart=3\" target=\"_blank\" class=\"Stil2\">"+ p_room04 +"</a>";   
  ptr += " </p>";
  ptr += "<span class=\"Stil1\">Radon: ";
  ptr += r4_val3;
  ptr += " Bq/m&sup3;<br>";
  ptr += "CO2: ";
  ptr += r4_val1;
  ptr += " ppm<br>";
  ptr += "TVOC: ";
  ptr += r4_val2;
  ptr += " ppb</span>";
  ptr += "</div>\n";
  ptr += "<div><img src='data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAQAAABN/Pf1AAAAC0lEQVR42mNkwAIAACoAAgu1Hc4AAAAASUVORK5CYII=' width='5' height='5'></div>\n";
  ptr += "</div>";

  ptr += div05;
  ptr += div05rg; 
  ptr += "<p>";
  ptr += "<a href=\"http://" + p_inputip05 +"/get?inputchart=3\" target=\"_blank\" class=\"Stil2\">"+ p_room05 +"</a>";   
  ptr += " </p>";
  ptr += "<span class=\"Stil1\">CO2: ";
  ptr += r5_val1;
  ptr += " ppm<br>";
  ptr += "5TVOC: ";
  ptr += r5_val2;
  ptr += " ppb<br>";
  ptr += "Radon: ";
  ptr += r5_val3;
  ptr += " Bq/m&sup3;</span>";
  ptr += "</div>\n";
  ptr += "<div><img src='data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAQAAABN/Pf1AAAAC0lEQVR42mNkwAIAACoAAgu1Hc4AAAAASUVORK5CYII=' width='5' height='5'></div>\n";
  ptr += "</div>";


  ptr += "<div id='chartout' onclick=\"top.location.href='/get?inputchart=7'\"></div><div id='chartout1' onclick=\"top.location.href='/get?inputchart=1'\"></div><div id='chartout2' onclick=\"top.location.href='/get?inputchart=2'\"></div>";
  ptr += p_vanchart_in2;

  ptr += "<div id='chartout3' onclick=\"top.location.href='/get?inputchart=3'\"></div>";

  ptr += p_vanconf_in3;
  ptr += "\n";

  ptr += "</body>\n";
  ptr += "</html>\n";
  return ptr;
}
#endif
//-----------------------------------------------------------------------------------------------



//--------------------------------------------------------------------------------------------------------
#ifdef vent_option
String SendHTMLg(uint16_t fval1, uint16_t fval2, uint16_t fval3, uint16_t fval4, uint16_t fval5, uint16_t fval6, uint16_t fval7, uint16_t fval8, uint16_t fval9, uint16_t fval10, String f_alarm_s, String divfan7, uint16_t vent_max_stufe, uint16_t vent_min_stufe, String f_Rsource)
{
  String ptr = "<!doctype html>\n";
  ptr += "<html lang='de'>\n";
  ptr += "<head>\n";
  ptr += "<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'>\n";
  ptr += "<meta name=\"author\" content=\"Holger Gebauer\">\n";
  ptr += "<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n";
  ptr += "<title>Measured Air Quality</title>\n";
  ptr += "<link HREF=\"favicon.ico\" REL=\"SHORTCUT ICON\" title=\"Modbus RTU to TCP-IP WiFi Gateway-Server\">\n";
  ptr += "<style>html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: center;}\n";
  ptr += "body{margin-top: 50px;} h1 {color: #444444;margin: 50px auto 30px;}\n";
  ptr += "p {font-size: 24px;color: #444444;margin-bottom: 10px;}\n";
 
  ptr += "#header{height: 80px;border-style: solid;border-width: 1px 0px 1px 0px;border-color: black;color: white;-webkit-tap-highlight-color: rgba(0,0,0,0);background: #b0bdda;background: -moz-linear-gradient(top,  #AAB6DF 0%, #4A6B9D 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#AAB6DF), color-stop(100%,#4A6B9D));background: -webkit-linear-gradient(top,  #AAB6DF 0%,#4A6B9D 100%);background: -o-linear-gradient(top,  #AAB6DF 0%,#4A6B9D 100%);\n";
  ptr += "background: -ms-linear-gradient(top,  #AAB6DF 0%,#4A6B9D 100%);background: linear-gradient(to bottom,  #AAB6DF 0%,#4A6B9D 100%);}\n";  	
  ptr += "select {font-size: .9rem;padding: 2px 5px;}\n";	
  ptr += "@media only screen and (max-device-width: 240px) {#header{height: 70px;}}\n";
  ptr += "#select{font-size: 28px;left:20px;letter-spacing: +1px;color: white;	float: left;width: 100%;height: 100%;position: relative;}\n";
  ptr += "@media only screen and (max-device-width: 240px) {#select{text-indent: 3%;font-size: 18px;}#select!{text-indent: 3%;font-size: 10px;}}\n";
  ptr += "#webpage{background: rgba(0, 0, 0, 0.2);text-align: center;}\n";
  ptr += "#webpage2{background: rgba(0, 0, 0, 0.3);text-align: center;font-weight: bold;left: 15px;margin:0 auto;align:center;padding: 10px;}\n";
  
  ptr += "#chartout{height: 50px;background: rgba(0, 0, 0, 0.4);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout::before{content: \"Config\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiCAYAAAA+stv/AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAedJREFUeNrkmM8rBGEYx2dmVxtLyoXacJEkSuJCEiXlIFyWG8lFcnEUFxe//oStLVEcOCq/Dkppb46Sg4tCWu1BMnZ3fN96aDx27JqZd+awT30O877TvM8+z/t+n+dd1TAMxU8LWoz3gEXQBTIurJEA6+D416yIgIkQGAZZQ46Ns/UUlaVgCsyBdrAJtkHIYQR0MAqWwS1o+hFV5lEMpMEzKOfeOqAUPIIMiJjnNOZtAIixtAu5N1uGvqkR36YpPlvROCBS8OaVA2OgPocDk+Cea48MB2bBOWhk4xegH6RkO6BTBIQT3WzuBiS92gM1JL1RO7XAyoROdIAKkLX49RHTcxnYBbWkrI4d6AMnNqKxQWmZF+LrJAWVDlIiaswBCPspRCPgEnT6qYRhc4UNerz4KZ2KpN0IvDpYfAsMcR34bwTOwABtxlzH8AOsgWY2vkINiZKvJYtTO/ZATYSd5uPQ1ILpYOav92XugRcwAY7cVMJCrAQ8gUFwxebqqBilZB7DGOjNsXgb7aEq2RHYs+g7RE1ooN7QcyUMUgEr3p6wYAeyVC4DLjun0TcNLmB8EyaoUrWCBbDjwtXsna5m1eCOjqilEoZB1JBn0/kup18misYSaHHhiiZCfw1WwT6fVP3+g+JTgAEAk1EJ5Os+dK8AAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 4px;padding-left: 10px;}\n";

  ptr += "#chartout1{height: 50px;background: rgba(82, 122, 122, 0.6);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout1::before{content: \"Chart Radon\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout1::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 4px;padding-left: 10px;}\n";

  ptr += "#chartout2{height: 50px;background: rgba(6, 95, 142, 0.5);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout2::before{content: \"Chart CO2\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout2::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 4px;padding-left: 10px;}\n";

  ptr += "#chartout3{height: 50px;background: rgba(6, 95, 142, 0.33);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout3::before{content: \"Live\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout3::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAAEoSURBVCiRY2AgAljd/w8FfxeD+Ezz/sPBSwWgANv/aWlQkPk/ASjA+VcAppnx/gSQwB+EceexCnCgCXD0/GHwSFFACPD//8Ow/u9yR7gA770/DLXv/183hAkwSv5hEI44/+863FB2kKGq+/9tB6o53wAx1D1YQGz//9MzOt6faAAbOv/vMgX1vWDffAAbWgc0VIG16+zdu3cvMDBp/mEQyTj/7xgDo6CSkpICwtBlBhDHsdcADXVmEN///9SM8vLyAoihb5YiDOV7/4eh7/3/YwKiXWffvXv3gIFJ6w+DSuZ9kKFKEENB3hcy2w90CjQMIAFkATS0HWwoLMQszkENhQeh2Ox7YEPhAoxCSsbGxgYo0QABSBGVVqaAFpW/DVAj+99igikDCAA8f8C9upF8kgAAAABJRU5ErkJggg==);\n";
  ptr += "position: relative;padding-right: 6%;top: 4px;padding-left: 10px;}\n";

  ptr += "#chartout4{height: 50px;background: rgba(6, 95, 142, 0.33);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout4::before{content: \"Mesh\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout4::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAAEWSURBVCiRhZE9TsNAEIWfcWRkIXBKBAVpQoOEcgAEOQFEaSkCJ4AbJB0VhBOQcAInBwCkQIGEFB+AAqWCDiOH2Pl97ILW2k1BpnufZt+8nQH+6uoDRm2QtwZ4IEe6tgmwoIFlCU7+AzZDz3gCf84Um2TbDHL4ZGqsNheB/UdDWjfke1YPNi5vB+d6Ry5ftvUO7M3lsElOc/pQAdjSQCUEvCiVS7W6BIN1Zet8NST4PlILyERnEvQrytZKtuSCwvvUpOvKKaeJ0i6vxcaGK9Pir2P3ObhInLvXkn8ZH7+UUCX7qItQa7El+gb4JCM44qduEQfkDGLgUJk1xHAJ0gP4EogEsQJVekRA9hTYJSfY4SS9YeaNnR+Qy3/CSFPlegAAAABJRU5ErkJggg==);\n";
  ptr += "position: relative;padding-right: 6%;top: 4px;padding-left: 10px;}\n";

  ptr += "#chartout5{height: 50px;background: rgba(6, 95, 142, 0.33);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout5::before{content: \"FAN\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout5::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiAQMAAAAEfEm8AAAAA3NCSVQICAjb4U/gAAAABlBMVEX///////9VfPVsAAAAAnRSTlP/AOW3MEoAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAfdEVYdFNvZnR3YXJlAE1hY3JvbWVkaWEgRmlyZXdvcmtzIDi1aNJ4AAAAZklEQVQImUXOsQ3AIBAEwUMOCCkBd2JKcSfQiVuhFEp4ZwSI8z9CcjLRBosRSXSviFPaAj95I0Y3hjENLh7t+M4DbN2BNS2AkRS5lXZWoEYAxcMp5QBC84oEhdngxoaKUReXrWXyA1c3TQEoUwPHAAAAAElFTkSuQmCC);\n";
  ptr += "position: relative;padding-right: 6%;top: 4px;padding-left: 10px;}\n";

  ptr += "#chartout6{height: 50px;background: rgba(6, 95, 142, 0.5);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout6::before{content: \"Chart FAN\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout6::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 4px;padding-left: 10px;}\n";

  ptr += "body{ margin: 0px;overflow-y: scroll;font-family: Verdana;-webkit-tap-highlight-color: rgba(0,0,0,0);-webkit-tap-highlight-color: transparent;\n";		
  ptr += "background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAJElEQVQIW2NkwAQ+jGhiPgwMDFuQBcECIEUwQbgATBBFACQIALmgBFKywiuGAAAAAElFTkSuQmCC);\n";
  ptr += "-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}\n";

  ptr += "#outLine {\n";
  ptr += "width: 100%;height: 5px;margin: auto;\n";
  ptr += "background-image: linear-gradient(to right, #4A6B9D, #4A6B9D);\n";
  ptr += "border-radius: 1px;}\n";
  ptr += "#line {\n";
  ptr += "background-image: linear-gradient(to right, #f12711, #f5af19);\n";
  ptr += "height: 100%;width: 100%;border-radius: 1px;}\n";


  ptr += "#webpagegruen, #webpagegrau, #webpagered{height: 20px;width: 25px;float: left; margin-right: 5px}\n";
  ptr += "#webpagegruen{background: rgba(0, 255, 0, 0.6);}\n";
  ptr += "#webpagegrau{background: rgba(115, 115, 115, 0.9);}\n";
  ptr += "#webpagered{background: rgba(255, 0, 0, 0.6);}\n";

  ptr += "#divpwgreen, #divpwgrau, #divpwred{height: 20px;width: 8px;float: left; margin-right: 1px}\n";
  ptr += "#divpwgreen{background: rgba(0, 255, 0, 0.6);}\n";
  ptr += "#divpwgrau{background: rgba(115, 115, 115, 0.9);}\n";
  ptr += "#divpwred{background: rgba(255, 0, 0, 0.6);}\n";

  ptr += "input[type=button], input[type=submit], input[type=reset] {\n";
  ptr += " background-image: linear-gradient(to bottom, #c6c6c6 1%, #585858 99%);\n";
  ptr += "border: 2px solid grey;\n";
  ptr += "color: #006600;\n";
  ptr += "font-size: 1.3em; \n";
  ptr += "font-weight: bold;\n";
  ptr += "text-align: center;\n";
  ptr += "display: block;\n";
  ptr += "line-height: 2px;\n";
  ptr += "font-family: Roboto, sans-serif;\n";
  ptr += "text-decoration: none;\n";
  ptr += "margin: 5px 0px;\n";
  ptr += "cursor: pointer;\n";
  ptr += " border-radius: 1px;\n";
  ptr += " position: relative;} \n";  

  ptr += ".button {\n"; 
  ptr += "position: relative;\n"; 
  ptr += "left: -10px;\n"; 
  ptr += "background-color: #0260AC;\n"; 
  ptr += "border: none;\n"; 
  ptr += "font-size: 24px;\n"; 
  ptr += "color: #FFFFFF;\n"; 
  ptr += "padding: 1px;\n"; 
  ptr += "margin-right: 1px;\n"; 
  ptr += "width: 65px;\n"; 
  ptr += "text-align: center;\n"; 
  ptr += "-webkit-transition-duration: 0.8s; \n"; 
  ptr += "transition-duration: 0.8s;\n"; 
  ptr += "text-decoration: none;\n"; 
  ptr += "overflow: hidden;\n"; 
  ptr += "cursor: pointer;}\n"; 

  ptr += "th {text-align:left;background-color:#7E7E7E;color:white;padding:10px}\n"; 
	ptr += ".Stil1 {color: #000000;font-weight: bold; text-align: right;}\n"; 
	ptr += ".Stil3 {color: #000000;font-weight: bold; text-align: left;}\n"; 
  ptr += ".Stil6 {color: #000000}\n"; 

  ptr += "#savebit{display: none;height: 1px;width: 100%;background: rgba(0, 0, 0, 0.8);text-align: right;margin: 6px 0 6px 0;line-height: 30px;}\n";
  ptr += "#savebit_green{height: 10px;width: 100%;background: rgba(0, 255, 0, 0.8);text-align: right;margin: auto;position: relative;line-height: 10px;content: 'Save';}\n";  
  ptr += "#savebit_red{height: 30px;width: 100%;background: rgba(255, 0, 0, 0.8);text-align: right;margin: 6px 0 6px 0;line-height: 30px;content: 'Fail';}\n";   

  ptr += ".savebitpost {color: #000000;font-weight: bold; text-align: center;font-size: 20px;}\n";  


  ptr += "</style>\n";

  ptr += "<script>\n";

  ptr += "function lineComplete() {let line = document.getElementById('line');\n";
	ptr += "for (let percentage = 0; percentage <= 100; percentage++) {\n";
	ptr += "setTimeout(function() {line.style.width = `${percentage}%`;\n";
	ptr += "if (line.style.width === '100%') {undo();}}, percentage * 10);}\n";
	ptr += "function undo() {for (let percent = 100; percent >= 0; percent--) {\n";
	
	//ptr += "setTimeout(function(){$('#line').addClass('showLine')},700);\n";  
  ptr += "setTimeout(function() {line.style.width = `${100 - percent}%`;}, percent * 4.5);}}};\n";	


  ptr += "function chartout(){$(document.body).hide();try { var clearResult = document.execCommand('ClearAuthenticationCache'); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=7'\",100);}\n";

  ptr += "function chartout1(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=1'\",100);}\n";

  ptr += "function chartout2(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=2'\",100);}\n";
#ifndef Freshbox
  ptr += "function chartout3(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=3'\",100);}\n";
#endif
  ptr += "function chartout6(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=6'\",100);}\n";

  ptr += "setInterval(loadDoc,8000);\n";
  ptr += "function loadDoc() {\n";
  ptr += "var xhttp = new XMLHttpRequest();\n";
  ptr += "xhttp.onreadystatechange = function() {\n";
  ptr += "if (this.readyState == 4 && this.status == 200) {\n";
  ptr += "document.body.innerHTML =this.responseText}\n";
  ptr += "lineComplete();\n";
  ptr += "};\n";
  ptr += "xhttp.open(\"GET\", \"/\", true);\n";
  ptr += "xhttp.send();\n";
  ptr += "}\n";



  ptr += "</script>\n";
  ptr += "</head>\n";
  ptr += "<body class='chartbd' onload=\"loadDoc()\">\n";
  ptr += "  <div id='header' onclick=\"top.location.href='/get?inputchart=5'\"><div id='select'>Radon FAN<br>Control</div>\n";
  ptr += "  <div id=\"tt\"><table class='ttab'><tr><td colspan='2' id='temp'></td></tr><tr><td id='temp1'></td><td id='otemp'></td></tr></table></div></div></div>\n";
  ptr += " <div id=\"outLine\"><div id=\"line\"></div></div>\n";
  ptr += "  <div id=\"webpage\">\n";
  ptr += "<div id='";
  ptr +=  p_fansavebit;
  ptr += "'><div align='center' class='savebitpost'>\n";
  ptr +=  p_fansavebit_txt;
  ptr += "</div></div>\n";

  //"var s_inputsavebit = \"<div id='"+ p_inputsavebit + "'><div align='center' class='savebitpost'>" + p_inputsavebit_txt + "</div></div>\";" +

  ptr += "<table width=\"100%\" border=\"1\">";
  ptr += "<tr>";
  ptr += "  <th colspan='2' scope='col'><div align='center'>";
  ptr +=  f_Rsource;
  ptr += "</div></th>";

  ptr += "</tr>";
  ptr += "<tr>";
  ptr += "  <td width=\"45%\"><div align=\"right\">Radon:</div></td>";
  ptr += "  <td width=\"55%\"><div align=\"left\">";
  ptr += fval1;
  ptr += " Bq/m&sup3;</div></td>";
  ptr += "</tr>";

ptr += "<tr>";
  ptr += "  <td><div align=\"right\">Value Max:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += vent_max_stufe; 
  ptr += " Bq/m&sup3;</div></td>";
  ptr += "</tr>";
ptr += "<tr>";
  ptr += "  <td><div align=\"right\">Value Min:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += vent_min_stufe;
  ptr += " Bq/m&sup3;</div></td>";
  ptr += "</tr>";  

  ptr += "<tr>";
  ptr += "  <td><div align=\"right\">Remaining Filter Time:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += fval2;
  ptr += " h</div></td>";
  ptr += "</tr>";
  ptr += "<tr>";
  ptr += "  <td><div align=\"right\">Power Level:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += fval3;
  ptr += " %</div>";
  ptr += divpower01; 
  ptr += "</div>";
  ptr += divpower02; 
  ptr += "</div>";
  ptr += divpower03; 
  ptr += "</div>";
  ptr += divpower04; 
  ptr += "</div>";
  ptr += divpower05; 
  ptr += "</div>";
  ptr += divpower06; 
  ptr += "</div>";
  ptr += divpower07; 
  ptr += "</div>";
  ptr += divpower08; 
  ptr += "</div>";
  ptr += divpower09; 
  ptr += "</div>";
  ptr += divpower10; 
  ptr += "</div>";
  ptr += divpower11; 
  ptr += "</div>";
  ptr += divpower12; 
  ptr += "</div>";
  ptr += divpower13; 
  ptr += "</div>";
  ptr += divpower14; 
  ptr += "</div>";
  ptr += divpower15; 
  ptr += "</div>";
  ptr += divpower16; 
  ptr += "</div>";
  ptr += divpower17; 
  ptr += "</div>";
  ptr += divpower18; 
  ptr += "</div>";
  ptr += divpower19; 
  ptr += "</div>";
  ptr += divpower20; 
  ptr += "</div>";
  ptr += "</td>";
  ptr += "</tr>";
  ptr += "<tr>";
  ptr += "  <td><div align=\"right\">Aktual Fan Speed:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += fval5;
  ptr += " Hz</div></td>";
  ptr += "</tr>";
  ptr += "<tr>";
  ptr += "  <td><div align=\"right\">Alarm Level:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += fval4;
  ptr += " Hz</div></td>";
  ptr += "</tr>";
  ptr += "<tr>";
  ptr += "  <td><div align=\"right\">Alarm Status:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += divfan7;
  ptr += "</div>";
  //ptr += f_alarm_s;

  ptr += "</div></td>";
  ptr += "</tr>";
  ptr += "<tr>";
  ptr += "  <td><div align=\"right\">Operating Time:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += fval7;
  ptr += " h</div></td>";
  ptr += "</tr>";
  ptr += "<tr>";
  ptr += "  <td><div align=\"right\">ENV Status:</div></td>";
  ptr += "  <td><div align=\"left\">";
  ptr += divfan1;
  ptr += "</div>";
  ptr += divfan2;
  ptr += "</div>";          
  ptr += divfan3; //  divpower01 = divpwgreen;
  ptr += "</div>";
  ptr += divfan4;
  ptr += "</div>";
  ptr += divfan5;
  ptr += "</div>";
  ptr += divfan6;
  ptr += "</div>";

  ptr += "</div></td>";
  
  ptr += "</table>";

  ptr += "</div>\n";

   //    style='display: none;'
  ptr += "<div id=\"webpage2\" style='";
  ptr += divfan_hid;   
  ptr += "width: 100%; height: 46px;'><table width=\"100%\" align=\"center\"><tr><td class='Stil3'><form action='/get?TG1' method=get><div align=\"center\"><button class=\"button\" type='submit' name='TG1' value='1'>+</button></div></form></td><td class='Stil3'><form action='/get?TG2' method=get><div align=\"center\"><button class=\"button\" type='submit' name='TG2' value='1'>-</button></div></form></td><td class='Stil3'><form action='/get?TG3' method=get><div align=\"center\"><button class=\"button\" type='submit' name='TG3' value='1'>ENV</button></div></form></td><td class='Stil3'><form action='/get?TG4' method=get><div align=\"center\"><button class=\"button\" type='submit' name='TG4' value='1'>RET</button></div></form></td></tr></table></div>\n";	

  ptr += "<div id=\"webpage2\" style='";
  ptr += divfanq_hid;
  ptr += "width: 100%; height: 46px;'><table width='100%' align='center'><tr><td class='Stil3'><form action='/get?Quitt' method=get><div align='center'><button class='button' type='submit' name='Quitt' value='1'>Quitt</button></div></form></td></tr></table></div>\n";


  ptr += "<div id='chartout' onclick=\"top.location.href='/get?inputchart=7'\"></div><div id='chartout1' onclick=\"top.location.href='/get?inputchart=1'\"></div><div id='chartout2' onclick=\"top.location.href='/get?inputchart=2'\"></div><div id='chartout6' onclick=\"top.location.href='/get?inputchart=6'\"></div><div id='chartout3' onclick=\"top.location.href='/get?inputchart=3'\"></div>";
  ptr += p_meshchart_in2;
  ptr += " \n";



  ptr += "</body>\n";
  ptr += "</html>\n";
  return ptr;
}
#endif
//-----------------------------------------------------------------------------------------------







//--------------------------------------------------------------------------------------------------------
String SendHTMLf(float val1, float val2, uint16_t val3, uint16_t val4, uint16_t val5, uint16_t val6, uint16_t val7, uint16_t val8, uint16_t val9, uint16_t val10, String bgcolor_vorgabe, unsigned long esp32_uptime, String p_uptime2, String val3_color, String p_uhrzeit)
{
  String ptr = "<!doctype html>\n";
  ptr += "<html lang='de'>\n";
  ptr += "<head>\n";
  ptr += "<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'>\n";
  ptr += "<meta name=\"author\" content=\"Holger Gebauer\">\n";
  ptr += "<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n";
  ptr += "<title>Measured Air Quality</title>\n";
  ptr += "<link HREF=\"favicon.ico\" REL=\"SHORTCUT ICON\" title=\"Modbus RTU to TCP-IP WiFi Gateway-Server\">\n";
  ptr += "<style>html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: center;}\n";
  ptr += "body{margin-top: 50px;} h1 {color: #444444;margin: 50px auto 30px;}\n";
  ptr += "p {font-size: 24px;color: #444444;margin-bottom: 10px;}\n";
 
  ptr += "#header{height: 80px;border-style: solid;border-width: 1px 0px 1px 0px;border-color: black;color: white;-webkit-tap-highlight-color: rgba(0,0,0,0);background: #b0bdda;background: -moz-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#CCCCCC), color-stop(100%,#3B3B3B));background: -webkit-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%));background: -o-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%));\n";
  ptr += "background: -ms-linear-gradient(top,  #CCCCCC 0%,#3B3B3B 100%);background: linear-gradient(to bottom,  #CCCCCC 0%,#3B3B3B 100%);}\n";  	
  ptr += "select {font-size: .9rem;padding: 2px 5px;}\n";	
  ptr += "@media only screen and (max-device-width: 240px) {#header{height: 70px;}}\n";
  ptr += "#select{font-size: 28px;left:20px;letter-spacing: +1px;color: white;	float: left;width: 100%;height: 100%;position: relative;}\n";
  ptr += "@media only screen and (max-device-width: 240px) {#select{text-indent: 3%;font-size: 18px;}#select!{text-indent: 3%;font-size: 10px;}}\n";
  ptr += "#webpage{background: rgba(0, 0, 0, 0.2);text-align: center;}\n";
  ptr += "#webpage2{background: rgba(0, 0, 0, 0.3);text-align: center;font-weight: bold;left: 15px;margin:0 auto;align:center;padding: 10px;}\n";
  
  ptr += "#chartout{height: 50px;background: rgba(0, 0, 0, 0.4);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout::before{content: \"Config\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiCAYAAAA+stv/AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAedJREFUeNrkmM8rBGEYx2dmVxtLyoXacJEkSuJCEiXlIFyWG8lFcnEUFxe//oStLVEcOCq/Dkppb46Sg4tCWu1BMnZ3fN96aDx27JqZd+awT30O877TvM8+z/t+n+dd1TAMxU8LWoz3gEXQBTIurJEA6+D416yIgIkQGAZZQ46Ns/UUlaVgCsyBdrAJtkHIYQR0MAqWwS1o+hFV5lEMpMEzKOfeOqAUPIIMiJjnNOZtAIixtAu5N1uGvqkR36YpPlvROCBS8OaVA2OgPocDk+Cea48MB2bBOWhk4xegH6RkO6BTBIQT3WzuBiS92gM1JL1RO7XAyoROdIAKkLX49RHTcxnYBbWkrI4d6AMnNqKxQWmZF+LrJAWVDlIiaswBCPspRCPgEnT6qYRhc4UNerz4KZ2KpN0IvDpYfAsMcR34bwTOwABtxlzH8AOsgWY2vkINiZKvJYtTO/ZATYSd5uPQ1ILpYOav92XugRcwAY7cVMJCrAQ8gUFwxebqqBilZB7DGOjNsXgb7aEq2RHYs+g7RE1ooN7QcyUMUgEr3p6wYAeyVC4DLjun0TcNLmB8EyaoUrWCBbDjwtXsna5m1eCOjqilEoZB1JBn0/kup18misYSaHHhiiZCfw1WwT6fVP3+g+JTgAEAk1EJ5Os+dK8AAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "#chartout1{height: 50px;background: rgba(82, 122, 122, 0.6);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout1::before{content: \"Chart Radon\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout1::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "body{ margin: 0px;overflow-y: scroll;font-family: Verdana;-webkit-tap-highlight-color: rgba(0,0,0,0);-webkit-tap-highlight-color: transparent;\n";		
  ptr += "background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAJElEQVQIW2NkwAQ+jGhiPgwMDFuQBcECIEUwQbgATBBFACQIALmgBFKywiuGAAAAAElFTkSuQmCC);\n";
  ptr += "-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}\n";

  ptr += "#outLine {\n";
  ptr += "width: 100%;height: 5px;margin: auto;\n";
  ptr += "background-image: linear-gradient(to right, #BA1117, #1f2125);\n";
  ptr += "border-radius: 1px;}\n";
  ptr += "#line {\n";
  ptr += "background-image: linear-gradient(to right, #f12711, #f5af19);\n";
  ptr += "height: 100%;width: 100%;border-radius: 1px;}\n";

  ptr += "input[type=button], input[type=submit], input[type=reset] {\n";
  ptr += " background-image: linear-gradient(to bottom, #c6c6c6 1%, #585858 99%);\n";
  ptr += "border: 2px solid grey;\n";
  ptr += "color: #006600;\n";
  ptr += "font-size: 1.3em; \n";
  ptr += "font-weight: bold;\n";
  ptr += "text-align: center;\n";
  ptr += "display: block;\n";
  ptr += "line-height: 2px;\n";
  ptr += "font-family: Roboto, sans-serif;\n";
  ptr += "text-decoration: none;\n";
  ptr += "margin: 5px 0px;\n";
  ptr += "cursor: pointer;\n";
  ptr += " border-radius: 1px;\n";
  ptr += " position: relative;} \n";  

  ptr += ".button {\n"; 
  ptr += "position: relative;\n"; 
  ptr += "background-color: #0260AC;\n"; 
  ptr += "border: none;\n"; 
  ptr += "font-size: 24px;\n"; 
  ptr += "color: #FFFFFF;\n"; 
  ptr += "padding: 6px;\n"; 
  ptr += "width: 150px;\n"; 
  ptr += "text-align: center;\n"; 
  ptr += "-webkit-transition-duration: 0.8s; \n"; 
  ptr += "transition-duration: 0.8s;\n"; 
  ptr += "text-decoration: none;\n"; 
  ptr += "overflow: hidden;\n"; 
  ptr += "cursor: pointer;}\n"; 

ptr += "th {text-align:left;background-color:#7E7E7E;color:white;padding:10px}\n"; 
	ptr += ".Stil1 {color: #000000;font-weight: bold; text-align: right;}\n"; 
	ptr += ".Stil3 {color: #000000;font-weight: bold; text-align: left;}\n"; 
  ptr += ".Stil9 {color: #7E7E7E}\n"; 




  ptr += "</style>\n";

  ptr += "<script>\n";

  ptr += "function lineComplete() {let line = document.getElementById(\"line\");\n";
	ptr += "for (let percentage = 0; percentage <= 100; percentage++) {\n";
	ptr += "setTimeout(function() {line.style.width = `${percentage}%`;\n";
	ptr += "if (line.style.width === \"100%\") {undo();}}, percentage * 10);}\n";
	ptr += "function undo() {for (let percent = 100; percent >= 0; percent--) {\n";
	ptr += "setTimeout(function() {line.style.width = `${100 - percent}%`;}, percent * 4.5);}}};\n";	
	//ptr += "setTimeout(function(){$(\"#line\").addClass(\"showLine\")},700);\n";

  ptr += "function chartout(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=7'\",100);}\n";

  ptr += "function chartout1(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=1'\",100);}\n";

  ptr += "setInterval(loadDoc,100000);\n";
  ptr += "function loadDoc() {\n";
  ptr += "var xhttp = new XMLHttpRequest();\n";
  ptr += "xhttp.onreadystatechange = function() {\n";
  ptr += "if (this.readyState == 4 && this.status == 200) {\n";
  ptr += "document.body.innerHTML =this.responseText}\n";
  ptr += "lineComplete();\n";
  ptr += "};\n";
  ptr += "xhttp.open(\"GET\", \"/\", true);\n";
  ptr += "xhttp.send();\n";

  ptr += "}\n";
 
  ptr += "</script>\n";
  ptr += "</head>\n";
  ptr += "<body class='chartbd' onload=\"loadDoc()\">\n";
//#ifndef Freshbox
  ptr += "  <div id='header' onclick=\"top.location.href='/get?inputchart=3'\"><div id='select'>Measured <br>Air Quality</div>\n";
//#endif
  ptr += "  <div id=\"tt\"><table class='ttab'><tr><td colspan='2' id='temp'></td></tr><tr><td id='temp1'></td><td id='otemp'></td></tr></table></div></div></div>\n";
  ptr += " <div id=\"outLine\"><div id=\"line\"></div></div>\n";
  ptr += "  <div id=\"webpage\">\n";
   
  //ptr += "<p>Refresh: ";
  //ptr += val4;
  //ptr += " </p>";

  #ifdef mit_CO2
  ptr += "<p>CO2: ";
  ptr += val1;
  ptr += " ppm</p>";
 
  ptr += "<p>TVOC: ";
  ptr += val2;
  ptr += " ppb</p>";
  #endif

  //ptr += "<p>Radon live: ";
  //ptr += val3;
 // ptr += " Bq/m&sup3;</p>";
  //ptr += "<p>Radon 24h: ";
  //ptr += val8;
  //ptr += " Bq/m&sup3;</p>";
 // ptr += "<p>Radon long: ";
  //ptr += val9;
  //ptr += " Bq/m&sup3;</p>";
  //ptr += "<p>Einträge: ";
  //ptr += val10;
  //ptr += " count</p>";




	 ptr += "<table width='100%' border='0'><tr><th height='5' colspan='3' scope='col'><div align='center'>";
   ptr += p_uhrzeit;
   ptr += "</div></th></tr><tr><th width='45%' scope='row'><div align='right'>Uptime :</div></th><td width='10%'><div align='center'><strong>";
   ptr += esp32_uptime;

    ptr += "</strong></div></td><td><div align='left'> ";
    ptr += p_uptime2;
    ptr += "</div></td></tr><tr><th scope='row'><div align='right'>Radon live : </div></th><td ";
    ptr += bgcolor_vorgabe;
    ptr += "><div align='center'><strong>";

   ptr += val3;

   	 ptr += "</strong></div></td><td ";
     ptr += bgcolor_vorgabe;
     ptr += "><div align='left'>Bq/m&sup3;</div></td></tr><tr><th scope='row'><div align='right'>Radon 24h : </div></th><td><div align='center'><strong>";

   
   ptr += val8;
	 ptr += "</strong></div></td><td><div align='left'> Bq/m&sup3;</div></td></tr><tr><th scope='row'><div align='right'>Radon long : </div></th><td><div align='center'><strong>";
   ptr += val9;
	 ptr += "</strong></div></td><td><div align='left'> Bq/m&sup3;</div></td></tr><tr><th scope='row'><div align='right'>Entries:</div></th><td><div align='center'><strong>";
   ptr += val10;
	 ptr += "</strong></div></td><td><div align='left'> *10min</div></td></tr>";


   //ptr += "<tr><th scope='row'><div align='right'>Freshbox:</div></th><td><div align='center'><strong>";
 	 //ptr += val5;
	 //ptr += "</strong></div></td><td><div align='left'> Stufe</div></td></tr>";
   ptr += s_freshbox; 


   ptr += "<tr><th height='5' colspan='3' scope='row'></th></tr></table>";

  ptr += "</div>\n";

  ptr += "<div id=\"webpage2\" style=\"width: 220px; height: 46px;\"><table align=\"center\"><tr><td class='Stil1'></td><td class='Stil3'><form action='/get?getgauge' method=get><button class=\"button\" type='submit' name='getgauge' value='1'>Change</button></form></td></tr></table></div>\n";	


  //ptr += "<div id='chartout' onclick=\"top.location.href='/get?inputchart=7'\"></div><div id='chartout1' onclick=\"top.location.href='/get?inputchart=1'\"></div>";
   ptr += p_co2chart_hid;


  ptr += p_vanchart_in2;
  ptr += p_meshchart_in2;
  //ptr += p_homechart_in2;
  //ptr += "</div>";
  ptr += p_vanconf_in3;
  ptr += "\n";


  ptr += "</body>\n";
  ptr += "</html>\n";
  return ptr;
}
//-----------------------------------------------------------------------------------------------






//--------------------------------------------------------------------------------------------------------
String SendHTMLfmesh(uint16_t valm1, uint16_t valm2, uint16_t valm3, uint16_t valm4, uint16_t valm5, uint16_t valm6, uint16_t valm7, uint16_t valm8, uint16_t valm9, uint16_t valm10, String bgcolor_vorgabeg, String bgcolor_vorgaber, unsigned long esp32_uptime, String p_uptime2, String val3_color, String p_uhrzeit,String p_time_mesh_uplod_s,String AI_VSS_mv_s)

{
  String ptr = "<!doctype html>\n";
  ptr += "<html lang='de'>\n";
  ptr += "<head>\n";
  ptr += "<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'>\n";
  ptr += "<meta name=\"author\" content=\"Holger Gebauer\">\n";
  ptr += "<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n";
  ptr += "<title>Measured Air Quality</title>\n";
  ptr += "<link HREF=\"favicon.ico\" REL=\"SHORTCUT ICON\" title=\"Modbus RTU to TCP-IP WiFi Gateway-Server\">\n";
  ptr += "<style>html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: center;}\n";
  ptr += "body{margin-top: 50px;} h1 {color: #444444;margin: 50px auto 30px;}\n";
  ptr += "p {font-size: 24px;color: #444444;margin-bottom: 10px;}\n";
 
  ptr += "#header{height: 80px;border-style: solid;border-width: 1px 0px 1px 0px;border-color: black;color: white;-webkit-tap-highlight-color: rgba(0,0,0,0);background: #b0bdda;background: -moz-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#CCCCCC), color-stop(100%,#3B3B3B));background: -webkit-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%));background: -o-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%));\n";
  ptr += "background: -ms-linear-gradient(top,  #CCCCCC 0%,#3B3B3B 100%);background: linear-gradient(to bottom,  #CCCCCC 0%,#3B3B3B 100%);}\n";  	
  ptr += "select {font-size: .9rem;padding: 2px 5px;}\n";	
  ptr += "@media only screen and (max-device-width: 240px) {#header{height: 70px;}}\n";
  ptr += "#select{font-size: 28px;left:20px;letter-spacing: +1px;color: white;	float: left;width: 100%;height: 100%;position: relative;}\n";
  ptr += "@media only screen and (max-device-width: 240px) {#select{text-indent: 3%;font-size: 18px;}#select!{text-indent: 3%;font-size: 10px;}}\n";
  ptr += "#webpage{background: rgba(0, 0, 0, 0.2);text-align: center;}\n";
  ptr += "#webpage2{background: rgba(0, 0, 0, 0.3);text-align: center;font-weight: bold;left: 15px;margin:0 auto;align:center;padding: 10px;}\n";
  
  ptr += "#chartout{height: 50px;background: rgba(0, 0, 0, 0.4);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout::before{content: \"Config\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiCAYAAAA+stv/AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAedJREFUeNrkmM8rBGEYx2dmVxtLyoXacJEkSuJCEiXlIFyWG8lFcnEUFxe//oStLVEcOCq/Dkppb46Sg4tCWu1BMnZ3fN96aDx27JqZd+awT30O877TvM8+z/t+n+dd1TAMxU8LWoz3gEXQBTIurJEA6+D416yIgIkQGAZZQ46Ns/UUlaVgCsyBdrAJtkHIYQR0MAqWwS1o+hFV5lEMpMEzKOfeOqAUPIIMiJjnNOZtAIixtAu5N1uGvqkR36YpPlvROCBS8OaVA2OgPocDk+Cea48MB2bBOWhk4xegH6RkO6BTBIQT3WzuBiS92gM1JL1RO7XAyoROdIAKkLX49RHTcxnYBbWkrI4d6AMnNqKxQWmZF+LrJAWVDlIiaswBCPspRCPgEnT6qYRhc4UNerz4KZ2KpN0IvDpYfAsMcR34bwTOwABtxlzH8AOsgWY2vkINiZKvJYtTO/ZATYSd5uPQ1ILpYOav92XugRcwAY7cVMJCrAQ8gUFwxebqqBilZB7DGOjNsXgb7aEq2RHYs+g7RE1ooN7QcyUMUgEr3p6wYAeyVC4DLjun0TcNLmB8EyaoUrWCBbDjwtXsna5m1eCOjqilEoZB1JBn0/kup18misYSaHHhiiZCfw1WwT6fVP3+g+JTgAEAk1EJ5Os+dK8AAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "#chartout1{height: 50px;background: rgba(82, 122, 122, 0.6);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout1::before{content: \"Chart Radon\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout1::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "body{ margin: 0px;overflow-y: scroll;font-family: Verdana;-webkit-tap-highlight-color: rgba(0,0,0,0);-webkit-tap-highlight-color: transparent;\n";		
  ptr += "background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAJElEQVQIW2NkwAQ+jGhiPgwMDFuQBcECIEUwQbgATBBFACQIALmgBFKywiuGAAAAAElFTkSuQmCC);\n";
  ptr += "-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}\n";

  ptr += "#outLine {\n";
  ptr += "width: 100%;height: 5px;margin: auto;\n";
  ptr += "background-image: linear-gradient(to right, #BA1117, #1f2125);\n";
  ptr += "border-radius: 1px;}\n";
  ptr += "#line {\n";
  ptr += "background-image: linear-gradient(to right, #f12711, #f5af19);\n";
  ptr += "height: 100%;width: 100%;border-radius: 1px;}\n";

  ptr += "input[type=button], input[type=submit], input[type=reset] {\n";
  ptr += " background-image: linear-gradient(to bottom, #c6c6c6 1%, #585858 99%);\n";
  ptr += "border: 2px solid grey;\n";
  ptr += "color: #006600;\n";
  ptr += "font-size: 1.3em; \n";
  ptr += "font-weight: bold;\n";
  ptr += "text-align: center;\n";
  ptr += "display: block;\n";
  ptr += "line-height: 2px;\n";
  ptr += "font-family: Roboto, sans-serif;\n";
  ptr += "text-decoration: none;\n";
  ptr += "margin: 5px 0px;\n";
  ptr += "cursor: pointer;\n";
  ptr += " border-radius: 1px;\n";
  ptr += " position: relative;} \n";  

  ptr += ".button {\n"; 
  ptr += "position: relative;\n"; 
  ptr += "background-color: #0260AC;\n"; 
  ptr += "border: none;\n"; 
  ptr += "font-size: 24px;\n"; 
  ptr += "color: #FFFFFF;\n"; 
  ptr += "padding: 6px;\n"; 
  ptr += "width: 150px;\n"; 
  ptr += "text-align: center;\n"; 
  ptr += "-webkit-transition-duration: 0.8s; \n"; 
  ptr += "transition-duration: 0.8s;\n"; 
  ptr += "text-decoration: none;\n"; 
  ptr += "overflow: hidden;\n"; 
  ptr += "cursor: pointer;}\n"; 

  ptr += "th {text-align:left;background-color:#7E7E7E;color:white;padding:10px}\n"; 
	ptr += ".Stil1 {color: #000000;font-weight: bold; text-align: right;}\n"; 
	ptr += ".Stil3 {color: #000000;font-weight: bold; text-align: left;}\n"; 
  ptr += ".myTable{ background-color:#6B6B6B;\n"; 




  ptr += "</style>\n";

  ptr += "<script>\n";

  ptr += "function lineComplete() {let line = document.getElementById(\"line\");\n";
	ptr += "for (let percentage = 0; percentage <= 100; percentage++) {\n";
	ptr += "setTimeout(function() {line.style.width = `${percentage}%`;\n";
	ptr += "if (line.style.width === \"100%\") {undo();}}, percentage * 10);}\n";
	ptr += "function undo() {for (let percent = 100; percent >= 0; percent--) {\n";
	ptr += "setTimeout(function() {line.style.width = `${100 - percent}%`;}, percent * 4.5);}}};\n";	
	//ptr += "setTimeout(function(){$(\"#line\").addClass(\"showLine\")},700);\n";

    ptr += "function chartout(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
    ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=7'\",100);}\n";

    ptr += "function chartout1(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
    ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=1'\",100);}\n";

    ptr += "setInterval(loadDoc,100000);\n";
    ptr += "function loadDoc() {\n";
    ptr += "var xhttp = new XMLHttpRequest();\n";
    ptr += "xhttp.onreadystatechange = function() {\n";
    ptr += "if (this.readyState == 4 && this.status == 200) {\n";
    ptr += "document.body.innerHTML =this.responseText}\n";
    ptr += "lineComplete();\n";
    ptr += "};\n";
    ptr += "xhttp.open(\"GET\", \"/\", true);\n";
    ptr += "xhttp.send();\n";

    ptr += "}\n";
  
    ptr += "</script>\n";
    ptr += "</head>\n";
    ptr += "<body class='chartbd' onload=\"loadDoc()\">\n";

    ptr += "<div id='header' onclick=\"top.location.href='/get?inputchart=3'\"><div id='select'>Measured <br>Air Quality</div>\n";

    ptr += "<div id=\"tt\"><table class='ttab'><tr><td colspan='2' id='temp'></td></tr><tr><td id='temp1'></td><td id='otemp'></td></tr></table></div></div></div>\n";
    ptr += "<div id=\"outLine\"><div id=\"line\"></div></div>\n";
    ptr += "<div id=\"webpage\">\n";

    // #7E7E7E   6B6B6B

	  ptr += "<table width='100%' border='0'><tr><th class='myTable' height='5' colspan='3' scope='col'><div align='center'>";
    ptr += p_uhrzeit;
    ptr += "</div></th></tr>";

    ptr += "<tr><th class='myTable' height='5' colspan='3' scope='col'><div align='center'>";  
    ptr += p_time_mesh_uplod_s;
    ptr += "</div></th></tr>";

    if(p_inputmqmeshi > 0){
    ptr += "<tr><th class='myTable' height='5' colspan='3' scope='col'><div align='center'>Supply ";  
    ptr += AI_VSS_mv_s;
    ptr += " V</div></th></tr>";
    }

    ptr += "<tr><th width='45%' scope='row'><div align='right'>Uptime :</div></th><td bgcolor='#9F9F9F' width='10%'><div align='center'><strong>";
    ptr += esp32_uptime;

    ptr += "</strong></div></td><td bgcolor='#9F9F9F'><div align='left'> ";
    ptr += p_uptime2;
    ptr += "</div></td></tr>";

    
      //  mb_radon_live_32bit_m[1]
    ptr += "<tr><th scope='row'><div align='right'>Radon 01 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm1;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[1] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    
    //if(g_mb_tracer_online[2] == 1){
    if(p_inputmqmeshi >= 2){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 02 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm2;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[2] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    //ptr += "#CAFFD0";
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }

    if(p_inputmqmeshi >= 3){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 03 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm3;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[3] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }

    if(p_inputmqmeshi >= 4){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 04 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm4;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[4] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }

    if(p_inputmqmeshi >= 5){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 05 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm5;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[5] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }

    if(p_inputmqmeshi >= 6){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 06 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm6;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[6] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }
    
    if(p_inputmqmeshi >= 7){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 07 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm7;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[7] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }
    
    if(p_inputmqmeshi >= 8){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 08 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm8;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[8] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }
    
    if(p_inputmqmeshi >= 9){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 09 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm9;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[9] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }
    
    if(p_inputmqmeshi >= 10){  
    ptr += "<tr><th scope='row'><div align='right'>Radon 10 : </div></th><td bgcolor='#9F9F9F'><div align='center'><strong>";
    ptr += valm10;
    ptr += "</strong></div></td><td ";
    if(g_mb_tracer_online[10] == 1){
    ptr += bgcolor_vorgabeg;
    }else{
    ptr += bgcolor_vorgaber;  
    }
    ptr += "><div align='left'>Bq/m&sup3;</div></td></tr>";
    }


    ptr += "<tr><th class='myTable' height='5' colspan='3' scope='row'></th></tr></table>";

    ptr += "</div>\n";




 
    ptr += p_co2chart_hid;


    ptr += p_vanchart_in2;
    ptr += p_meshchart_in2;

    ptr += p_vanconf_in3;
    ptr += "\n";


    ptr += "</body>\n";
    ptr += "</html>\n";
    return ptr;

}
//-----------------------------------------------------------------------------------------------








//--------------------------------------------------------------------------------------------------------
String SendHTMLc(float val1, float val2, uint16_t val3, uint16_t val4, uint16_t val5, uint16_t val6, uint16_t val7, uint16_t val8, uint16_t val9, uint16_t val10, String bgcolor_vorgabe, unsigned long esp32_uptime, String p_uptime2, String val3_color, String p_uhrzeit)
{
  String ptr = "<!doctype html>\n";
  ptr += "<html lang='de'>\n";
  ptr += "<head>\n";
  ptr += "<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'>\n";
  ptr += "<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n";
  //ptr += "<meta http-equiv=\"refresh\" content=\"120\">\n";
  ptr += "<meta name=\"author\" content=\"Holger Gebauer\">\n";
  
  ptr += "<title>Measured Air Quality</title>\n";
  ptr += "<link HREF=\"favicon.ico\" REL=\"SHORTCUT ICON\" title=\"Modbus RTU to TCP-IP WiFi Gateway-Server\">\n";
  ptr += "<style>html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: center;}\n";
  ptr += "body{margin-top: 50px;} h1 {color: #444444;margin: 50px auto 30px;}\n";
  ptr += "p {font-size: 24px;color: #444444;margin-bottom: 10px;}\n";
 
  ptr += "#header{height: 80px;border-style: solid;border-width: 1px 0px 1px 0px;border-color: black;color: white;-webkit-tap-highlight-color: rgba(0,0,0,0);background: #b0bdda;background: -moz-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#CCCCCC), color-stop(100%,#3B3B3B));background: -webkit-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%));background: -o-linear-gradient(top,  #CCCCCC 0%, #3B3B3B 100%));\n";
  ptr += "background: -ms-linear-gradient(top,  #CCCCCC 0%,#3B3B3B 100%);background: linear-gradient(to bottom,  #CCCCCC 0%,#3B3B3B 100%);}\n";  	
  ptr += "select {font-size: .9rem;padding: 2px 5px;}\n";	
  ptr += "@media only screen and (max-device-width: 240px) {#header{height: 70px;}}\n";
  ptr += "#select{font-size: 28px;left:20px;letter-spacing: +1px;color: white;	float: left;width: 100%;height: 100%;position: relative;}\n";
  ptr += "@media only screen and (max-device-width: 240px) {#select{text-indent: 3%;font-size: 18px;}#select!{text-indent: 3%;font-size: 10px;}}\n";
  ptr += "#webpage{background: rgba(0, 0, 0, 0.2);text-align: center;}\n";
  ptr += "#webpage2{background: rgba(0, 0, 0, 0.3);text-align: center;font-weight: bold;left: 15px;margin:0 auto;align:center;padding: 10px;margin-top:-15px;}\n";



  ptr += "#chart_div{background: rgba(";
  ptr += val3_color;
  ptr += ");text-align:center;margin:0 auto;width: 300px;height:300px;padding-left:10px;margin-top:1px;left:-10px;}\n";
  
  ptr += "div.cend {height: 5px;}\n";  
  ptr += "div.bqm {height:25px;width: 300px;text-align:center;margin:0 auto;padding-left:10px;margin-top:2px;left:-10px;background: rgba(0, 0, 0, 0.3);font-weight: bold;font-size: 18px;}\n";  

  
  
  ptr += "#chartout{height: 50px;background: rgba(0, 0, 0, 0.4);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout::before{content: \"Config\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiCAYAAAA+stv/AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAedJREFUeNrkmM8rBGEYx2dmVxtLyoXacJEkSuJCEiXlIFyWG8lFcnEUFxe//oStLVEcOCq/Dkppb46Sg4tCWu1BMnZ3fN96aDx27JqZd+awT30O877TvM8+z/t+n+dd1TAMxU8LWoz3gEXQBTIurJEA6+D416yIgIkQGAZZQ46Ns/UUlaVgCsyBdrAJtkHIYQR0MAqWwS1o+hFV5lEMpMEzKOfeOqAUPIIMiJjnNOZtAIixtAu5N1uGvqkR36YpPlvROCBS8OaVA2OgPocDk+Cea48MB2bBOWhk4xegH6RkO6BTBIQT3WzuBiS92gM1JL1RO7XAyoROdIAKkLX49RHTcxnYBbWkrI4d6AMnNqKxQWmZF+LrJAWVDlIiaswBCPspRCPgEnT6qYRhc4UNerz4KZ2KpN0IvDpYfAsMcR34bwTOwABtxlzH8AOsgWY2vkINiZKvJYtTO/ZATYSd5uPQ1ILpYOav92XugRcwAY7cVMJCrAQ8gUFwxebqqBilZB7DGOjNsXgb7aEq2RHYs+g7RE1ooN7QcyUMUgEr3p6wYAeyVC4DLjun0TcNLmB8EyaoUrWCBbDjwtXsna5m1eCOjqilEoZB1JBn0/kup18misYSaHHhiiZCfw1WwT6fVP3+g+JTgAEAk1EJ5Os+dK8AAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "#chartout1{height: 50px;background: rgba(82, 122, 122, 0.6);text-align: right;margin: 6px 0 6px 0;line-height: 50px;}\n";
  ptr += "#chartout1::before{content: \"Chart Radon\";position: relative;top: -1px;font-weight: bold;right: 15px;}\n";
  ptr += "#chartout1::after{\n";
  ptr += "content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAiBAMAAADMnMbMAAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAADzSURBVCiRY2DAA8QDULhMHucLUATi/v+fwGQsgBCoe/9/A8+7BIQA6/v3F3n/IwlI/4k7iCzAuP8xi4IskoD0PwcGBiQBxv1PWVyQVUj/T5B9l4AQYDr/lEHuP5KALdAEWSQB1veXGVAE+v8ooAhI/V8I9AVCgPn8dwae/w0Igbq/DigCUv8XMSALsN7/wYAswNj/xwFFwOf/RAYUgftXGRgkdwcgBNzATmpAsZZB5n8BkoDlDAFUgfj/CmgC/3AJwALI762A9LsE7ncFPO8CgIhBySxVSTXNSDXNCUwaMtw9vfvsbQQ6w/AfFfxjuIsK7gAACPPDOOnfDQgAAAAASUVORK5CYII=);\n";
  ptr += "position: relative;padding-right: 6%;top: 8px;padding-left: 10px;}\n";

  ptr += "body{ margin: 0px;overflow-y: scroll;font-family: Verdana;-webkit-tap-highlight-color: rgba(0,0,0,0);-webkit-tap-highlight-color: transparent;\n";		
  ptr += "background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAJElEQVQIW2NkwAQ+jGhiPgwMDFuQBcECIEUwQbgATBBFACQIALmgBFKywiuGAAAAAElFTkSuQmCC);\n";
  ptr += "-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}\n";

  ptr += "#outLine {\n";
  ptr += "width: 100%;height: 5px;margin: auto;\n";
  ptr += "background-image: linear-gradient(to right, #BA1117, #1f2125);\n";
  ptr += "border-radius: 1px;}\n";
  ptr += "#line {\n";
  ptr += "background-image: linear-gradient(to right, #f12711, #f5af19);\n";
  ptr += "height: 100%;width: 100%;border-radius: 1px;}\n";

  ptr += "input[type=button], input[type=submit], input[type=reset] {\n";
  ptr += " background-image: linear-gradient(to bottom, #c6c6c6 1%, #585858 99%);\n";
  ptr += "border: 2px solid grey;\n";
  ptr += "color: #006600;\n";
  ptr += "font-size: 1.3em; \n";
  ptr += "font-weight: bold;\n";
  ptr += "text-align: center;\n";
  ptr += "display: block;\n";
  ptr += "line-height: 2px;\n";
  ptr += "font-family: Roboto, sans-serif;\n";
  ptr += "text-decoration: none;\n";
  ptr += "margin: 5px 0px;\n";
  ptr += "cursor: pointer;\n";
  ptr += " border-radius: 1px;\n";
  ptr += " position: relative;} \n";  

  ptr += ".button {\n"; 
  ptr += "position: relative;\n"; 
  ptr += "background-color: #0260AC;\n"; 
  ptr += "border: none;\n"; 
  ptr += "font-size: 24px;\n"; 
  ptr += "color: #FFFFFF;\n"; 
  ptr += "padding: 6px;\n"; 
  ptr += "width: 150px;\n"; 
  ptr += "text-align: center;\n"; 
  ptr += "-webkit-transition-duration: 0.8s; \n"; 
  ptr += "transition-duration: 0.8s;\n"; 
  ptr += "text-decoration: none;\n"; 
  ptr += "overflow: hidden;\n"; 
  ptr += "cursor: pointer;}\n"; 

  ptr += "th {text-align:left;background-color:#7E7E7E;color:white;padding:10px}\n"; 
	ptr += ".Stil1 {color: #000000;font-weight: bold; text-align: right;}\n"; 
	ptr += ".Stil3 {color: #000000;font-weight: bold; text-align: left;}\n"; 


  ptr += "</style>\n";
  ptr += "<script src='gloader.js'></script>";   



  ptr += "<script>\n";

  ptr += "function lineComplete() {let line = document.getElementById(\"line\");\n";
	ptr += "for (let percentage = 0; percentage <= 100; percentage++) {\n";
	ptr += "setTimeout(function() {line.style.width = `${percentage}%`;\n";
	ptr += "if (line.style.width === \"100%\") {undo();}}, percentage * 10);}\n";
	ptr += "function undo() {for (let percent = 100; percent >= 0; percent--) {\n";
	ptr += "setTimeout(function() {line.style.width = `${100 - percent}%`;}, percent * 4.5);}}};\n";	
  //ptr += "setTimeout(function(){$(\"#line\").addClass(\"showLine\")},700);\n";



       ptr +="google.charts.load('current', {'packages':['gauge']});";
       ptr +="google.charts.setOnLoadCallback(drawChart);";
       ptr +="function drawChart() {";

       ptr +=" var data = google.visualization.arrayToDataTable([";
       ptr +="  ['Label', 'Value'],";
       ptr +=" ['RADON',";
       ptr += val3;
       ptr += "],";
       ptr +="]); ";
       
       #ifdef mit_CO2
       ptr +=" var data2 = google.visualization.arrayToDataTable([";
       ptr +="  ['Label', 'Value'],";
       ptr +=" ['CO2',";
       ptr += val1;
       ptr += "],";
       ptr +="]); ";

       ptr +=" var data3 = google.visualization.arrayToDataTable([";
       ptr +="  ['Label', 'Value'],";
       ptr +=" ['TVOC',";
       ptr += val2;
       ptr += "],";
       ptr +="]); ";
       #endif

       ptr +=" var options = {  ";
       ptr +=" width: 300, height: 300,";
         ptr +=" redFrom: ";
         ptr += vredFrom;
         ptr +=", redTo: ";
         ptr += vredTo;
         ptr +=",";
         ptr +=" yellowFrom:";
         ptr += vyellowFrom;
         ptr +=", yellowTo: ";
         ptr += vyellowTo;
         ptr +=",";
         ptr +=" greenFrom:";
         ptr += vgreenFrom;
         ptr +=", greenTo: ";
         ptr += vgreenTo;
         ptr +=",";
       ptr +=" minorTicks: 4,";
      //ptr +=" majorTicks: [\"0\", \"50\", \"150\", \"300\", \"350\"],";



       ptr +=" max: ";
       ptr += vredTo;
       ptr +=",";

          ptr +="animation:{";
          ptr +="duration: 10000,";
          ptr +="easing: 'linear',";
          ptr +="},";

       ptr +=" };    ";

      

       ptr +="var chart = new google.visualization.Gauge(document.getElementById('chart_div'));";
       ptr +="chart.draw(data, options);";

       #ifdef mit_CO2
       ptr +="var chart2 = new google.visualization.Gauge(document.getElementById('chart_div2'));";
       ptr +="chart2.draw(data2, options2);";      

       ptr +="var chart3 = new google.visualization.Gauge(document.getElementById('chart_div3'));";
       ptr +="chart3.draw(data3, options3);";   
       #endif

       ptr +=" } ";



  ptr += "function chartout(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=7'\",100);}\n";

  ptr += "function chartout1(){$(document.body).hide();try { var clearResult = document.execCommand(\"ClearAuthenticationCache\"); } catch(e){} \n";
  ptr += "if (!clearResult){$.ajax({url: \"http://logout:logout@\" + window.location.host + \"/control\",type: \"POST\",timeout: 100});}setTimeout(\"self.location.href='/get?inputchart=1'\",100);}\n";

  ptr += "setInterval(loadDoc,100000);\n";
  ptr += "function loadDoc() {\n";
  ptr += "var xhttp = new XMLHttpRequest();\n";
  ptr += "xhttp.onreadystatechange = function() {\n";
  ptr += "if (this.readyState == 4 && this.status == 200) {\n";
  ptr += "document.body.innerHTML =this.responseText\n";

  ptr += "drawChart();\n";
    ptr += "lineComplete();\n";
  ptr += "}\n";  
  ptr += "};\n";
  ptr += "xhttp.open(\"GET\", \"/\", true);\n";
  ptr += "xhttp.send();\n";
  ptr += "}\n";

  ptr += "</script>\n";
 

  ptr += "</head>\n";
  ptr += "<body class='chartbd' onload=\"loadDoc()\";lineComplete()>\n";

  ptr += "<div id='header' onclick=\"top.location.href='/get?inputchart=3'\"><div id='select'>Measured <br>Air Quality</div>\n";

  ptr += "  <div id=\"tt\"><table class='ttab'><tr><td colspan='2' id='temp'></td></tr><tr><td id='temp1'></td><td id='otemp'></td></tr></table></div></div></div>\n";
  ptr += " <div id=\"outLine\"><div id=\"line\"></div></div>\n";
  ptr += "  <div id=\"webpage\">\n";
  #ifdef mit_CO2
  ptr +="<div id=\"chart_div2\"></div>"; 
  ptr +="<div id=\"chart_div3\"></div>"; 
  #endif
  ptr +="<div class=\"cend\"></div><div id=\"chart_div\"></div><div class=\"bqm\">[Bq/m&#179;]</div><div class=\"cend\"></div>"; 
  
  //ptr +="<div id='pressChart' class='chartContainer'></div>"; 

  ptr += "</div><br>\n";
  
  ptr += "<div id=\"webpage2\" style=\"width: 220px; height: 46px;\"><table align=\"center\"><tr><td class='Stil1'></td><td class='Stil3'><form action='/get?getgauge' method=get><button class=\"button\" type='submit' name='getgauge' value='0'>Change</button></form></td></tr></table></div>\n";	
  
  //ptr += "<div id='chartout' onclick=\"top.location.href='/get?inputchart=7'\"></div><div id='chartout1' onclick=\"top.location.href='/get?inputchart=1'\"></div><div id='chartout2' onclick=\"top.location.href='/get?inputchart=2'\"></div>";
  ptr += p_co2chart_hid;
  
  //ptr += p_homechart_in2;
  ptr += p_vanchart_in2;
  ptr += p_meshchart_in2;
  //ptr += "</div>";
  ptr += p_vanconf_in3;
  ptr += "\n";
  
 
  ptr += "</body>\n";
  ptr += "</html>\n";
  return ptr;
}
//-----------------------------------------------------------------------------------------------


// #ifdef mit_CO2


//-----------------------------------------------------------------------------------------------
// 5 einträge
// 4 long
// 3 live
String SendHTMLd(float val1, float val2, uint32_t rval3, uint32_t rval4, uint32_t rval5, uint16_t rval6, String rval7)
{

  String ptr = "<!doctype html>\n";
   ptr += "<html lang='de'>\n";
   ptr += "<head>\n";

   ptr += "<title>LivAir | FreshBox AlphaTracer</title>\n";
   ptr += "<link HREF='favicon.ico' REL='SHORTCUT ICON' title='LivAir | FreshBox AlphaTracer'>\n";
 
   ptr += "<meta charset='UTF-8'> \n";
   ptr += "<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> \n";
   ptr += "<title>Values</title> \n";
   ptr += "<link HREF=\"favicon.ico\" REL=\"SHORTCUT ICON\" title=\"Vars\">\n";

   ptr += "<style type=\"text/css\">\n";
   ptr += ".Stil1 {color: #FF0000;font-weight: bold;}\n";
   ptr += ".Stil3 {font-size: 18px;font-weight: bold;}\n";
   ptr += ".Stil4 {color: #FF0000; font-weight: bold; font-size: 18px; }\n";
   ptr += "</style>\n";


   ptr += "</head><body><div>\n";

    ptr += "Radon_live <id=\"var1\">:";
    ptr += rval3;
    ptr += "& bqm3<br>";
    
    ptr += "Radon_24h <id=\"var2\">:";
    ptr += rval4;
    ptr += "& bqm3<br>";
     
    ptr += "Radon_long <id=\"var3\">:";
    ptr += rval5;
    ptr += "& bqm3<br>";   

    ptr += "Radon_Eintaege <id=\"var4\">:";
    ptr += rval6;
    ptr += "& count<br>";


   #ifdef mit_CO2
    ptr += "<p id=\"var5\">CO2:";
    ptr += val1;
    ptr += "&ppm</p>";
  
    ptr += "<p id=\"var6\">TVOC:";
    ptr += val2;
    ptr += "&ppb</p>";
   #endif

    ptr += "Seriennummer <id=\"var7\">:";
    ptr += mb_Seriennummer;     
    ptr += "& var<br>";


    ptr += "_________________________________________________________________";
    ptr += "<br>HELP:<p id=\"var5\">search the following sequence in the html-code (you can split):<br><span class=\"Stil3\"><strong>id=\"var</strong><span class=\"Stil1\">X</span></span><span class=\"Stil3\">\"</span><br>and within <strong><span class=\"Stil4\">: & </span> </strong> you will find the unsigned value.";


    ptr += "</div></body>\n";
    ptr += "</html>\n";
    return ptr;
}





//-----------------------------------------------------------------------------------------------
// 5 einträge
// 4 long
// 3 live
String SendHTMLh(uint32_t rval3, uint32_t rval4, uint32_t rval5, uint16_t rval6)
{

  String ptr = "";

   //ptr += "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n";

   //ptr += "<?xml-stylesheet href=\"#style\" type=\"text/css\"?>\n";
   //ptr += "<?xml-stylesheet type=\"text/css\">\n";
   //ptr += "tracer:before {display: block;width: 8em;font-weight: bold;font-size: 200%;content: 'sensor';margin: -.75em 0px .25em -.25em;padding: .1em .25em;background-color: #cdf;}\n";
   //ptr += "tracer{display: block;margin: 2em 1em;border: 4px solid #cdf;padding: 0px 1em;background-color: white;}\n";
   //ptr += ".sensor {display: block;margin-bottom: 1em;}\n";
   //ptr += "</style>\n";


    ptr += "<tracer>\n";
    ptr += "<sensor id=\"";
    ptr += p_cloud_ID_resault;
    ptr += "\">\n";

    ptr += "<title>Radon Werte</title>\n";

    ptr += "<Radon_live>";
    ptr += rval3;
    ptr += "</Radon_live>\n";

    ptr += "<Radon_24h>";
    ptr += rval4;
    ptr += "</Radon_24h>\n";

    ptr += "<Radon_long>";
    ptr += rval5;
    ptr += "</Radon_long>\n";

    ptr += "<Radon_eintr>";
    ptr += rval6;
    ptr += "</Radon_eintr>\n";

    ptr += "<Radon_sern>";
    ptr += mb_Seriennummer;
    ptr += "</Radon_sern>\n";


    ptr += "</sensor>\n";
    ptr += "</tracer>";


    return ptr;
}




const char plattern_ip[] PROGMEM = R"rawliteral(pattern='^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$')rawliteral";




String file_var1 = "";   //------------ IP Setting ----------
String file_var2 = "";   //------------ TCP Setting ----------
String file_var3 = "";   //------------ Cloud Setting ----------
String file_var4 = "";   //------------ MQTT Setting ----------
String file_var5 = "";   //------------ Freshbox Setting ----------
String file_var6 = "";   //------------ LED Setting ----------
String file_var7 = "";   //------------ Text Setting ----------
String file_var8 = "";   //------------ Switch Setting ----------
String file_var9 = "";   //------------ MQTT Mesh Values ----------
String file_var10 = "";   //------------ AO1  Values ----------
String file_var9_mesh;
//********************************************
//Include the HTML, STYLE and Script "Pages"

String p_view_tr_02 = "                           ";
String p_view_tr_03 = "                           ";
String p_view_tr_04 = "                           ";
String p_view_tr_05 = "                           ";
String p_view_tr_06 = "                           ";
String p_view_tr_07 = "                           ";
String p_view_tr_08 = "                           ";
String p_view_tr_09 = "                           ";
String p_view_tr_10 = "                           ";
String p_view_tr_1a = "                           ";
String p_view_tr_1b = "                           ";
String p_view_tr_1c = "                           ";
String p_view_tr_1d = "                           ";

String p_mq_tr_01 = "                           ";
String p_mq_tr_02 = "                           ";
String p_mq_tr_03 = "                           ";
String p_mq_tr_04 = "                           ";
String p_mq_tr_05 = "                           ";

String availableKeys = "['radon1','radon2','radon3','radon4','radon5','radon6','radon7','radon8','radon9','radon10']";

String mesh_bla ="Stil3l";
String mesh_rot ="Stil3rl";
String meshrad01 ="Stil1";

String meshSti1 = mesh_bla;
String meshSti2 = mesh_bla;
String meshSti3 = mesh_bla;
String meshSti4 = mesh_bla;
String meshSti5 = mesh_bla;
String meshSti6 = mesh_bla;
String meshSti7 = mesh_bla;
String meshSti8 = mesh_bla;
String meshSti9 = mesh_bla;
String meshSti10 = mesh_bla;

#include "a1_page.h"   //LOGIN ALL
#include "a1_page0.h"  //LOG OFF
#include "a1_page01.h" //LOGIN + CLOUD ON    MQTT OFF  Freshbox OFF
#include "a1_page02.h" //LOGIN + CLOUD OFF   MQTT OFF  Freshbox ON
#include "a1_page03.h" //LOGIN + CLOUD OFF   MQTT ON   Freshbox OFF

#include "a1_page2.h"
#include "a1_page3.h"
#include "a1_page4.h"

//<meta http-equiv="refresh" content="300;url=index.html">
//********************************************

// "var s_inputstaticip = \"<form action='/get'><input name='inputstaticip' type='text' maxlength='15' " + String(plattern_ip) + " value='" + p_inputstaticip + "'><input type='submit' value='Submit'></form>\";" +

// Replaces placeholder with button section in your web page
String processor(const String& var){
  #ifdef WEB_DEBUG
  Serial.println("processor chart_page: " + String(chart_page));
  #endif
    if(chart_page == 7){  
          
      if(var == "JAVAPLACEHOLDER"){
        
         String settings = String ("<script type='text/javascript'>") +                                                                                                         
           

            //------------ IP Setting ----------
            //"var s_inputstaticip = \"<input name='inputstaticip' type='text' title='IP Adresse' maxlength='15' " + String(plattern_ip) + " value='" + p_inputstaticip + "'>\";" +
            //"var s_inputsubnetmask = \"<input name='inputsubnetmask' type='text' title='Subnetmask' maxlength='15' " + String(plattern_ip) + " value='" + p_inputsubnetmask + "'>\";" +
            //"var s_inputgateway = \"<input name='inputgateway' type='text' title='Gateway' maxlength='15' " + String(plattern_ip) + " value='" + p_inputgateway + "'>\";" +
            //"var s_inputdnss = \"<input name='inputdnss' type='text' title='NTP Server f&uuml;r die Uhrzeit' maxlength='20' value='" + p_inputntp + "'></form>\";" +
            //"var s_inputname = \"<input name='inputname' type='text' title='DNS Name from Tracer' maxlength='10' pattern='^[a-z]{1}[0-9a-z]{2,10}' value='" + p_inputname + "'>\";" +
            //"var s_inputname2 = \"[ http://" + p_inputname + ".local/index.html ]\";" +
            file_var1 +


            //------------ TCP Setting ----------
            //"var s_inputtcpport = \"<input name='inputtcpport' type='number' title='Port für Modbus Standard[502]' maxlength='4' pattern='[0-9]{4}' value='" + p_inputtcpport + "'>\";" +
            //"var s_inputwebport = \"<input name='inputwebport' type='number' title='Port für Web Standard[80 or 8080]' maxlength='4' pattern='[0-9]{4}' value='" + p_inputwebport + "'>\";" +
            file_var2 +
            ////"var s_inputbaudrate = \"<input name='inputbaudrate' type='number' title='Modbus Baudrate [standard 9600]' maxlength='5' min='2400' max='38400' pattern='[0-9]{5}' value='" + p_inputbaudrate + "'>\";" +
            ////"var s_inputdatabits = \"<input name='inputdatabits' type='number' title='Modbus Databits' maxlength='1' min='7' max='8' pattern='[7-8]{1}' value='" + p_inputdatabits + "'>\";" +
            ////"var s_inputparity = \"<input name='inputparity' type='text' title='Modbus Parity' maxlength='4' pattern='none|even|odd|mark' value='" + p_inputparity + "'>\";" +
            ////"var s_inputstopbit = \"<input name='inputstopbit' type='number' title='Modbus Stopbits' maxlength='1' min='1' max='2' pattern='[1-2]{1}' value='" + p_inputstopbit + "'>\";" +
            ////"var s_inputrestimeout = \"<input name='inputrestimeout' type='number'  title='Set Modbus Timeout' min='500' max='2000' minlength='3' maxlength='4' value='" + p_inputrestimeout + "'>\";" +
           


            "var s_inputpasswort = \"<form action='/get'><input name='inputpasswort' maxlength='15' type='password'  title='Passwort for Login' value='" + p_inputpasswort + "'><button class='button' type='submit'>Login</button></form>\";" +      
            "var s_inputpwchange = \"<form action='/get'><input name='inputpwchange' minlength='8' maxlength='15' type='password'  title='Change your Password' value='" + p_inputpwchange + "'><button class='button' type='submit'>Change</button></form>\";" +     
               

        
            "var s_Status_1 = \"" + divstatus1 + "\";" +
            "var s_Status_2 = \"" + divstatus2 + "\";" +

            "var s_Status_4 = \"" + divstatus4 + "\";" + 
            "var s_Status_5 = \"" + divstatus5 + "\";" +  
            "var s_Status_6 = \"" + divstatus6 + "\";" +  

    
            "var s_Status_9 = \"" + divstatus9 + "\";" + 
            "var s_Status_10 = \"" + divstatus10 + "\";" + 

            
            "var s_tr_h_1 = \"" + tr_h_1 + "\";" +  
            "var s_tr_h_2 = \"" + tr_h_2 + "\";" + 
            "var s_tr_h_6 = \"" + tr_h_6 + "\";" + 
            "var s_tr_h_7 = \"" + tr_h_7 + "\";" + 


            "var s_tr_h_1a = \"" + tr_h_1a + "\";" +  
            "var s_tr_h_2a = \"" + tr_h_2a + "\";" + 
            "var s_tr_h_6a = \"" + tr_h_6a + "\";" + 

            "var s_tr_h_7a = \"" + tr_h_7a + "\";" + 


            "var s_MB_scan_resault = \"" + p_MB_scan_resaults + "\";" +
            "var s_ethernet_sockets = \"" + String(m_max_clients) + "\";" +
            "var s_mac_adresse = \"" + WiFi.macAddress() + "\";" +
            "var s_ip_adresse_val = \"" + p_inputstaticip + "\";" +
            "var s_uhrzeit = \"" + p_uhrzeit + "\";" +
            "var s_uptime = \"" + p_uptime + "\";" +
            "var s_rs485_data = \"" + p_rs485_data + "\";" +

            "var s_fresh_ID_resault = \"" + p_inputfreshid + "\";" +
            "var s_mqtt_ID_resault = \"" + device_id_s + "\";" +

            "var s_tracer_id = \"" + device_id_s + "\";" +



            
            "var s_cloudaktiv = \"<td " + cloud_aktiv + ">\";" +

            //------------ Cloud ----------
            //// "var s_cloud_onoff = \"<input name='inputcloudonoff' type='text' maxlength='3' pattern='on|off' value='" + p_cloudonoff + "'>\";" +
            ////"var s_cloud_device = \"<input name='inputclouddevice' type='text' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputclouddevice + "'>\";" +
            ////"var s_cloud_user = \"<input name='inputclouduser' type='text' maxlength='20' value='" + p_inputclouduser + "'>\";" +
            ////"var s_cloud_key = \"<input name='inputcloudkey' type='text' maxlength='40' value='" + p_inputcloudkey + "'>\";" +
            //// "var s_cloudlink = \"" + cloud_link + "\";" +
            //"var s_cloud_server = \"<input name='inputcloudserver' type='text' title='Server Name' maxlength='40' value='" + p_inputcloudserver + "'>\";" +
            //"var s_cloud_inter = \"<input name='inputcloudinter' title='Sendeintervall in Minuten' type='text' pattern='[0-9]{1,2}' value='" + p_inputcloudinter + "'>\";" +
            //"var s_cloud_page = \"<input name='inputcloudpage' type='text' title='Pfad zum Server' maxlength='60' value='" + p_inputcloudpage + "'>\";" +    
             file_var3 +

           

            "var s_ledaktual = \"" + led_werteaktual + "\";" +
            "var s_ledaktiv = \"<td " + lEd_aktiv + ">\";" +
            
            "var s_ao1aktual = \"" + ao1_werteaktual + "\";" +
            "var s_ao1aktiv = \"<td " + ao1_aktiv + ">\";" +
            
            
            
            //------------ LED ----------
            ////"var s_led_funk = \"<input name='inputledfunk' type='text' maxlength='5' pattern='radon|co2' value='" + p_inputledfunk + "'>\";" +
            //"var s_led_red = \"<input name='inputledred' type='text' title='Radonschwelle f&uuml;r Rot' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputledred + "'>\";" +
            //"var s_led_orange = \"<input name='inputledorange' type='text' title='Radonschwelle f&uuml;r Orange' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputledorange + "'>\";" +
            //"var s_led_green = \"<input name='inputledgreen' type='text' title='Radonschwelle f&uuml;r Gr&uuml;n' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputledgreen + "'>\";" +
            //"var s_led_gamma = \"<input name='inputledgamma' type='text' title='Helligkeit der LED ab Schwelle Gr&uuml;n aktiv' maxlength='3' value='" + p_inputledgamma + "'>\";" +   
            //"var s_led_onoff = \"<input name='inputledonoff' type='text' title='LED Option ON or OFF' maxlength='3' pattern='on|off' value='" + p_ledonoff + "'>\";" + 
            file_var6 +




            "var s_mqttaktiv = \"<td " + mQtt_aktiv + ">\";" +

            


            //------------ MQTT ----------
            //"var s_mq_options = \"<input name='inputmqoptions' type='text' title='MQTT Option 0=Standard | 1=Thingsboard' minlength='1' maxlength='1' value='" + p_inputmqoptions + "'>\";" +
            //"var s_mq_server = \"<input name='inputmqserver' type='text' title='MQTT Server Adresse' minlength='1' maxlength='40' value='" + p_inputmqserver + "'>\";" +
            //"var s_mq_port = \"<input name='inputmqport' type='number' title='MQTT Port Standard [1883]' minlength='1' maxlength='4' value='" + p_inputmqport + "'>\";" +
            //"var s_mq_user = \"<input name='inputmquser' type='text' title='MQTT Username or Token' minlength='1' maxlength='40' value='" + p_inputmquser + "'>\";" +
            //"var s_mq_pass = \"<input name='inputmqpass' type='text' title='MQTT Passwort oder Key' minlength='1' maxlength='40' value='" + p_inputmqpass + "'>\";" +
            //"var s_mq_client = \"<input name='inputmqclient' type='text' title='MQTT Client ID or Device' minlength='1' maxlength='48' value='" + p_inputmqclient + "'>\";" +
            //"var s_mq_topic = \"<input name='inputmqtopic' type='text' title='MQTT Topic for Radon' maxlength='50' value='" + p_inputmqtopic + "'>\";" +
            //"var s_mq_topic1 = \"<input name='inputmqtopic1' type='text' title='MQTT Topic for Radon Eintr&auml;ge' maxlength='50' value='" + p_inputmqtopic1 + "'>\";" +
            //"var s_mq_topic2 = \"<input name='inputmqtopic2' type='text' title='MQTT Topic for Seriennummer' maxlength='50' value='" + p_inputmqtopic2 + "'>\";" +
            //"var s_mq_onoff = \"<input name='inputmqonoff' type='text' title='MQTT Switch ON/OFF' maxlength='3' pattern='on|off' value='" + p_mqonoff + "'>\";" +
            //"var s_mqttaktual = \"" + mq_werteaktual + "\";" +
            file_var4 +
            
            




            "var s_werteaktual = \"" + mb_werteaktual + "\";" +
            "var s_radon_live = \"" + mb_radon_live_32bitK_s + "\";" +
            "var s_radon_24h = \"" + String(mb_radon_24h_32bit) + "\";" +
            "var s_radon_long = \"" + String(mb_radon_long_32bit) + "\";" +
            "var s_radon_eintaege = \"" + String(mb_radon_F3_eintrarge) + "\";" +



           
            //"var s_radon_serienn = \"" + mb_Seriennummer + "\";" +
            //"var s_view_serienn = \"<tr><td colspan='2' class='Stil1'><div class='box2'></div> </td></tr><tr><td class='Stil1'>Seriennummer: </td><td height='30' class='Stil3'>" + mb_Seriennummer + "</td></tr>\";" + 
            //"var s_view_serienn = \"\";" + 
            file_var9 + 
  		         
            file_var10 + 

            //------------ Freshbox ----------
            //"var s_inputfreshid = \"<input name='inputfreshid' type='text' title='ID Nummer der Freshbox' minlength='16' maxlength='16' value='" + String(current_id) + "'></form>\";" +
            //"var s_inputfreshpwd = \"<input name='inputfreshpwd' type='password' title='Passwort der Freshbox' minlength='4' maxlength='4' pattern='[1-9]{4}' value='" + String((char)send_pwd[0]) + String((char)send_pwd[1]) + String((char)send_pwd[2]) + String((char)send_pwd[3]) + "'></form>\";" +

            //"var s_freshaktiv = \"<td " + fresh_aktiv + ">\";" +
            //"var s_fresh_onoff = \"<input name='inputfreshonoff' type='text' title='Freshbox switch ON or OFF' maxlength='3' pattern='on|off' value='" + p_freshonoff + "'>\";" +
            //"var s_freshaktual = \"" + fresh_werteaktual + "\";" +
            
            //"var s_inputstufe6 = \"<input name='inputstufe6' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe W&auml;chter' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe6 + "'>\";" +
            //"var s_inputstufe5 = \"<input name='inputstufe5' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 5' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe5 + "'>\";" +
            //"var s_inputstufe4 = \"<input name='inputstufe4' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 4' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe4 + "'>\";" +
            //"var s_inputstufe3 = \"<input name='inputstufe3' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 3' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe3 + "'>\";" +
            //"var s_inputstufe2 = \"<input name='inputstufe2' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 2' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe2 + "'>\";" +
            //"var s_inputstufe1 = \"<input name='inputstufe1' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 1' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe1 + "'>\";" +
            //"var s_inputfunktion = \"<input name='inputfunktion' type='text' title='Funktion [on] schaltet L&uuml;fter selbstst&auml;ndig EIN oder AUS' maxlength='3' pattern='on|off' value='" + p_inputfunktion + "'>\";" +
            //"var s_fresh_st1 = \"" + State_Power_s + "\";" +
            //"var s_fresh_st2 = \"" + String(State_Speed_mode) + "\";" +
            //"var s_fresh_st3 = \"" + State_Timer_s + "\";" +
            //"var s_fresh_st4 = \"" + String(State_Timer_Speed_mode) + "\";" +
            //"var s_fresh_st5 = \"" + State_Calender_s + "\";" +
            //"var s_fresh_st6 = \"" + String(State_Calender_Speed_mode) + "\";" +
            file_var5 +




            "var s_werteaktual_f = \"" + werteaktual_f + "\";" +
            "var s_cloud_ID_resault = \"" + p_cloud_ID_resault + "\";" +
            "var s_mez_resault = \"" + p_mez_resault + "\";" +

            "var s_xml_html = \"" + p_xml_html + "\";" +
            "var s_xml_html2 = \"" + p_xml_html2 + "\";" +
            
            //String p_xml_html "";
            //String p_xml_html_1 "<a href=\"http://modbus.local/radon.xml\">XML</a>";         //<a href="http://modbus.local/radon.xml">XML</a>
            //String p_xml_html_2 "<a href=\"http://modbus.local/radon.html\">HTML</a>";        //<a href="http://modbus.local/radon.html">HTML</a>


            #ifndef MB_Gateway
            "var s_titel = \"" + "Gateway" + "\";" +
            #else
            "var s_titel = \"" + "Server" + "\";" +
            #endif
           
             
            

            "var s_adm_v0 = \"" + p_tr_ad_hidden2 + "\";" +
            "var s_adm_v1 = \"" + p_tr_ad_hidden2 + "\";" +
        


            "var s_div_c01 = \"" + div_c01 + "\";" +
            "var s_div_c02 = \"" + div_c02 + "\";" +
            "var s_div_c03 = \"" + div_c03 + "\";" +
            "var s_div_c04 = \"" + div_c04 + "\";" +
            "var s_div_c05 = \"" + div_c05 + "\";" +
            "var s_div_c07 = \"" + div_c07 + "\";" +
            "var s_div_c08 = \"" + div_c08 + "\";" +
            "var s_div_c09 = \"" + div_c09 + "\";" +
            
            "var s_div_c12 = \"" + div_c12 + "\";" +
            #ifdef old_option
            "var s_div_c13 = \"" + div_c13 + "\";" +
            #endif 
            "var s_div_c14 = \"" + div_c14 + "\";" +
            "var s_div_c19 = \"" + div_c19 + "\";" +
 
            //file_var7 +




            "var s_sett01_s = \"" + p_sett01_s + "\";" +   // Status Setting
            "var s_sett02_s = \"" + p_sett02_s + "\";" +   // IP Setting
            "var s_sett03_s = \"" + p_sett03_s + "\";" +   // TCP Setting
                                                           // RS485 Setting
 
            "var s_sett05_s = \"" + p_sett05_s + "\";" +   // Sensor Setting
                                                           // Mesh Setting
            "var s_sett07_s = \"" + p_sett07_s + "\";" +   // MQTT Setting
            "var s_sett08_s = \"" + p_sett08_s + "\";" +   // Cloud Setting
            "var s_sett09_s = \"" + p_sett09_s + "\";" +   // LED Setting
                                                           //10 Push Setting
                                                           //11 FAN Setting

                                                           //13 LOG Setting
            "var s_sett14_s = \"" + p_sett14_s + "\";" +   // Freshbox Setting


            "var s_sett15_s = \"" + p_sett15_s + "\";" +   //Freshbox on/off Setting
            "var s_sett16_s = \"" + p_sett16_s + "\";" +   //MQTT on/off Setting   
            "var s_sett17_s = \"" + p_sett17_s + "\";" +   //LED on/off 
            "var s_sett18_s = \"" + p_sett18_s + "\";" +   //Cloud on/off Setting   

            "var s_sett19_s = \"" + p_sett19_s + "\";" +   //AO  Setting  
            "var s_sett29_s = \"" + p_sett29_s + "\";" +   //AO  on/off    

            //file_var8 +





            
            "var s_divpw = \"" + divpw + "\";" +
            "var s_divsetting = \"" + divsetting + "\";" +

            "var s_divsetting_g = \"" + divGateway_hid1 + "\";" +
            "var s_divsetting_g_2 = \"" + divGateway_hid1_2 + "\";" +
            "var s_divsetting_g_3 = \"" + divGateway_hid1_3 + "\";" +
            "var s_divsetting_g_4 = \"" + divGateway_hid1_4 + "\";" +
            "var s_divsetting_g_5 = \"" + divGateway_hid1_5 + "\";" +


     
            "var s_butt_Fan_s = \"" + p_sett20_s + "\";" +
            "var s_butt_led_s = \"" + p_sett21_s + "\";" +

            "var s_butt_cloud_s = \"" + p_sett22_s + "\";" +


            "var s_inputsavebit = \"<div id='"+ p_inputsavebit + "'><div align='center' class='savebitpost'>" + p_inputsavebit_txt + "</div></div>\";" +
            "var s_logout_or_in =  \"<div id='"+ p_logout_or_in + "</div>\";" +
            "var s_chart_or_in =  \"<div id='"+ p_chart_or_in + "</div>\";" + 
            "var s_home_in =  \"<div id='"+ p_home_in + "</div>\";" +  


                                    

            "var number = 123;" +
            "var s_zonelog = \" " + zone_view + " \";" +

            "function docWrite(variable) {document.write(variable);}</script>" +


           //"<style type=\"text/css\">" + String(file_css) + "</style>";


            " ";    
        return settings;



      }


      /*
      if (freshdAktiveConfig == true) {   // Freshbox Eingeschaltet     
        if(var == "TITELPACEHOLDER"){
          String settings = String ("<title>LivAir | FreshBox AlphaTracer</title>") +                                                                                                         
              "<link HREF='favicon.ico' REL='SHORTCUT ICON' title='LivAir | FreshBox AlphaTracer'>";
          return settings;
        }
      }else{
        if(var == "TITELPACEHOLDER"){
          String settings = String ("<title>LivAir | Modbus TCP-IP WiFi Gateway-Server</title>") +                                                                                                         
              "<link HREF='favicon.ico' REL='SHORTCUT ICON' title='LivAir | Modbus TCP-IP WiFi Gateway-Server'>";
          return settings;
        } 
      }
      */


    } //(chart_page == 0)
   //----------------------------------------------------------------------------




    if(chart_page == 1 || chart_page == 2 ||chart_page == 6){  

      //String string_temp0 = "                                                                                                                                         ";
      //if( p_inputpasswort == p_inputpasswort_admin){ 
         //string_temp0 = "var s_co2_in =  \"<div id='"+ p_co2_in + "</div>\";";   //#ifndef Freshbox
      //}else{
          //string_temp0 = "";    //#ifdef Freshbox   //in Chart Seite Live zeile ausblenden
      //}
      
     if(var == "JAVAPLACEHOLDER"){
         String settings = String ("<script type='text/javascript'>") +                                                                                                         
            "var s_uhrzeit = \"" + p_uhrzeit + "\";" +
            "var s_radon_live = \"" + mb_radon_live_32bitK_s + "\";" +
            "var s_chart_or_in =  \"<div id='"+ p_chart_or_in + "</div>\";" +
        
            "var s_config_in =  \"<div id='"+ p_chart2out + "</div>\";" +
            "var s_radon_in =  \"<div id='"+ p_chartin + "</div>\";" +
            "var s_chartco2_in =  \"<div id='"+ p_chartco2 + "</div>\";" +
            "var s_chart2_or_in =  \"<div id='"+ p_chart2_or_in + "</div>\";" +
            //string_temp0 +
            "var s_mesh_in =  \"<div id='"+ p_mesh_in + "</div>\";" +  
            "var s_home_in =  \"<div id='"+ p_home_in + "</div>\";" +  
            "var s_van_in =  \"<div id='"+ p_van_in + "</div>\";" +  
            #ifdef vent_option
            "var s_vanchart_in =  \"<div id='"+ p_vanchart_in + "</div>\";" +  
            #endif




            #ifndef MB_Gateway
            "var s_titel = \"" + "Gateway" + "\";" +
            #else
            "var s_titel = \"" + "Server" + "\";" +
            #endif
            "function docWrite(variable) {document.write(variable);}</script>";    
        return settings;
      }
               /*
                if (freshdAktiveConfig == true) {   // Freshbox Eingeschaltet     
                  if(var == "TITELPACEHOLDER"){
                    String settings = String ("<title>LivAir | FreshBox AlphaTracer</title>") +                                                                                                         
                        "<link HREF='favicon.ico' REL='SHORTCUT ICON' title='LivAir | FreshBox AlphaTracer'>";
                    return settings;
                  }
                }else{
                  if(var == "TITELPACEHOLDER"){
                    String settings = String ("<title>LivAir | Modbus TCP-IP WiFi Gateway-Server</title>") +                                                                                                         
                        "<link HREF='favicon.ico' REL='SHORTCUT ICON' title='LivAir | Modbus TCP-IP WiFi Gateway-Server'>";
                    return settings;
                  } 
                }
                */

    }
 
  
  return String();
}



#ifdef old_option
String outputState(int output){
  if(digitalRead(output)){
    return "checked";
  }
  else {
    return "";
  }
}
#endif
//*********************************************************************************************





//******************************************************************************
//                       Setup Modbus server                                   *
//******************************************************************************
// Create server
#ifndef MB_Gateway

  ModbusServerTCPasync MBserver;

  uint16_t memo[4];                     // Test server memory: 32 words

  // Server function to handle FC 0x03 and 0x04
  ModbusMessage FC03(ModbusMessage request) {
    ModbusMessage response;      // The Modbus message we are going to give back
    uint16_t addr = 0;           // Start address
    uint16_t words = 0;          // # of words requested
    request.get(2, addr);        // read address from request
    request.get(4, words);       // read # of words from request
    
    dataRequest = addr + words;
    received_count = received_count + dataRequest;
    //#ifdef MBDebug
    //Serial.println("dataRequest " + String(received_count));
    //#endif
    

    // Address overflow?
    if ((addr + words) > 11) {
      // Yes - send respective error response
      response.setError(request.getServerID(), request.getFunctionCode(), ILLEGAL_DATA_ADDRESS);
    }
    // Set up response
    response.add(request.getServerID(), request.getFunctionCode(), (uint8_t)(words * 2));
    // Request for FC 0x03?
    if (request.getFunctionCode() != READ_INPUT_REGISTER) {
      // Yes. Complete response
      //for (uint8_t i = 0; i < words; ++i) {
        // send increasing data values
       // response.add((uint16_t)(addr + i));
       // Serial.println("response " + i);
      //}
      response.setError(request.getServerID(), request.getFunctionCode(), ILLEGAL_FUNCTION );

    } else {
      // No, this is for FC 0x04. Response is random
      //response.clear();
      for (uint8_t i = 0; i < words; ++i) {
        // send increasing data values
        switch (i) {
          case 0:
            //response.add(mb_radon_ist_word_long1);
            response.add((uint16_t)mb_radon_ist_word_long0);
            break; 
          case 1:
            //response.add(mb_radon_ist_word_long0);
            response.add((uint16_t)mb_radon_ist_word_long1);
            break; 
          case 2:
            //response.add(mb_radon_ist_word);
            response.add((uint16_t)mb_radon_ist_word);
            break; 
          case 3:
            //response.add(mb_radon_word_long1);
            response.add((uint16_t)mb_radon_word_long0);
            break; 
          case 4:
           // response.add(mb_radon_word_long0);
            response.add((uint16_t)mb_radon_word_long1);
            break; 
          case 5:
           // response.add(mb_radon_eintrarge);
            response.add((uint16_t)mb_radon_eintrarge);
            break; 
          case 6:
            #ifdef CO2_on
            response.add((uint16_t)eco2val1);  //  CO2: 
            #else
            response.add((uint16_t)0); 
            #endif
            break;
          case 7:
            #ifdef CO2_on
            response.add((uint16_t)etvocval2);  //ppm, TVOC: 
            #else
            response.add((uint16_t)0); 
            #endif
          break; 
          case 8:
            response.add((uint16_t)f_pwm);  //Lüfter Drehzahl: 
          break; 
          case 9:
            response.add((uint16_t)measurement_lage);  //Lage: 
          break;           
          default:
            response.add((uint16_t)measurement_temp);  //Temperatur: 
          break;  
        } 

        // MODBUS SERVER


      }

    }
    // Send response back
    return response;
  }
#endif

//****************************************************************************



//******************************************************************************
//                                Setup MQTT                                   *
//******************************************************************************


//---------------------------------------------------------------
  void client_state_resault() 
  {

      b_clint_status = client.state(); 
        switch (b_clint_status) {
          case -4:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECTION_TIMEOUT - the server didn't respond within the keepalive time");
            #endif

            break;
          case -3:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECTION_LOST - the network connection was broken");
            #endif

            break;
          case -2:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECT_FAILED - the network connection failed");
            #endif

            break;
          case -1:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_DISCONNECTED - the client is disconnected cleanly");
            #endif

            break;
          case 0:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECTED - the client is connected");
            #endif

            break;
          case 1:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECT_BAD_PROTOCOL - the server doesn't support the requested version of MQTT");
            #endif

            break;
          case 2:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECT_BAD_CLIENT_ID - the server rejected the client identifier");
            #endif

            break;
          case 3:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECT_UNAVAILABLE - the server was unable to accept the connection");
            #endif

            break;
          case 4:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECT_BAD_CREDENTIALS - the username/password were rejected");
            #endif

            break;
          case 5:
            #ifdef MQTT_DEBUG
               Serial.println(String(p_time) + " |> MQTT_CONNECT_UNAUTHORIZED - the client was not authorized to connect");
            #endif
            break;

          default:
            // statements
            break;
        }

  }
//---------------------------------------------------------------

 



 
//*********************************************************************************************

 
 





  //******************************************************************************
  //                            Setup NTP Time                                   *
  //******************************************************************************

 // Define NTP Client to get time
  WiFiUDP ntpUDP;
  // #define NTP_SERVER "de.pool.ntp.org"
  //NTPClient timeClient(ntpUDP, "de.pool.ntp.org");
   
  //Serial.println("-->  " + p_time + " p_inputntpc: " + String(p_inputntpc));
  NTPClient timeClient(ntpUDP, p_inputntpc);



  //NTPClient timeClient(ntpUDP, "192.168.178.1");
   // p_inputntp


  //NTPClient timeClient(ntpUDP);
  // Variables to save date and time
  static String formattedDate;
  static String dayStamp;
  static String timeStamp;
  //static int oldUTC;
  static int ntpCallCount;
  int     gTimezone = 2; 
  int     gUTC = 1;
  int     gYear;
  int     gMonth;
  int     gDay;
  int     gHour;
  int     gMinute = 1;
  int     gSecond;
  String  gDateTimeStr;
  char DateAndTimeString[21]; //19 digits plus the 2 null char
  int Jahre2 = 0;         // Hilfsvariable, weil Variable "Jahr" global verwendet wird  



  void NTP_setup() {
  // Initialize a NTPClient to get time
    //Serial.println("NTP_setup");
    timeClient.begin();
    // Set offset time in seconds to adjust for your timezone, for example:
    // GMT +1 = 3600
    // GMT +8 = 28800
    // GMT -1 = -3600
    // GMT 0 = 0

    //#ifdef NTPDebug
      //Serial.println("--> gUTC: " + String(gUTC));
   // #endif

  }

  void NTP_setup_clac() {
   
   //Serial.println("NTP_setup_clac");
   
    gUTC = 1; // 1=zeitzone
    
    
    //Serial.println("-->  " + p_uhrzeit + " millissave: " + String(millissave));
    timeClient.setEpochTime(millissave);
    
    //timeClient.setTimeOffset(gUTC * 3600);

    
        //---------------------------------------------------------------- 
            //timeClient.setTimeOffset(gUTC * 3600); // timeClient.setTimeOffset(gUTC * 3600);
            
            //timeClient.setTimeOffset(millissave);
            //setEpochTime(millissave);
          
            // The formattedDate comes with the following format:
            formattedDate = timeClient.getFormattedDate(); //2019-05-24T01:21:09Z
            #ifdef NTPTimeDebug
              Serial.println("formattedDate " + formattedDate);
              Serial.println("millissave " + String(millissave));
            #endif


            // Extract date
            int splitT = formattedDate.indexOf("T");
            dayStamp = formattedDate.substring(0, splitT); //2019-05-24
            // Extract time
            timeStamp = formattedDate.substring(splitT+1, formattedDate.length()-1); //01:21:09
          //Serial.print("DATE: ");
          //Serial.println(dayStamp);
            splitT = dayStamp.indexOf("-"); gYear = dayStamp.substring(0,splitT).toInt(); //Year : 2019 
            dayStamp = dayStamp.substring(splitT+1, dayStamp.length()); //05-24
            splitT = dayStamp.indexOf("-"); gMonth = dayStamp.substring(0,splitT).toInt(); //Month : 05
            gDay = dayStamp.substring(splitT+1, dayStamp.length()).toInt(); //24
            gDateTimeStr = String(gDay) + "/" + String(gMonth); // Date : 24/05
          //Serial.print("HOUR: ");
          // Serial.println(timeStamp);
            #ifdef NTPTimeDebug
              Serial.println(timeStamp); 
            #endif
            splitT = timeStamp.indexOf(":"); gHour = timeStamp.substring(0,splitT).toInt(); //Hour : 01
            timeStamp = timeStamp.substring(splitT+1, timeStamp.length()); //21:09
            splitT = timeStamp.indexOf(":"); gMinute = timeStamp.substring(0,splitT).toInt(); //Minute : 21
            gSecond = timeStamp.substring(splitT+1, timeStamp.length()).toInt(); //09
            gDateTimeStr = gDateTimeStr + " " + String(gHour) + ":" + String(gMinute) + ":" + String(gSecond); //01:21
          
            Jahre2 = gYear %100;      // modulo, die Jahreszahl auf 2 Stellen beschränken

            // Serial.println("-------gYear " + String(gYear));
           
           if(gYear <= 2022){
            fail2Timeinfo = true;
           }else{
            fail2Timeinfo = false; //false = time ok,  jahr ist größer 2022
           }
            //p_uhrzeit = String(gDay) + "." + String(gMonth) + "." + String(gYear)  + "  " + String(gHour) + ":" + String(gMinute);

          sprintf_P(DateAndTimeString, PSTR("%02d.%02d.%4d  %02d:%02d:%02d"), gDay, gMonth, gYear, gHour, gMinute, gSecond);
          p_uhrzeit = DateAndTimeString;

          sprintf_P(DateAndTimeString, PSTR("%02d:%02d:%02d"),  gHour, gMinute, gSecond);  
          p_time = DateAndTimeString;

          sprintf_P(DateAndTimeString, PSTR("%02d.%02d.%02d  %02d:%02d"), gDay, gMonth, Jahre2, gHour, gMinute);
          p_uhrzeit2 = DateAndTimeString; 

          gUhrzeitAktuellFlag = true;   
          #ifdef NTPTimeDebug
            Serial.println("-->  " + p_time + " Time Update."); 
          #endif
          //Serial.println(p_uhrzeit);  

            #ifdef old_option
            runMillis= millis();
            allSeconds=millis()/1000;
            runHours= allSeconds/3600;
            secsRemaining=allSeconds%3600;
            runMinutes=secsRemaining/60;
            runSeconds=secsRemaining%60;
            sprintf(tbuf,"%02d:%02d:%02d",runHours,runMinutes,runSeconds);
            #endif


            t_hour = gHour;
            t_mday = gDay;
            t_mon = gMonth + 0;
            t_year = gYear;
            t_tzHours = 0;





            #ifdef NTPTimeDebug
              Serial.println(p_uhrzeit); 
            #endif
        //---------------------------------------------------------------- 

    //Serial.println("-->  " + p_uhrzeit + " millissave: " + String(millissave));





    #ifdef NTPDebug

      Serial.println("-->  " + p_time + " gUTC: " + String(gUTC));  //zeitzone
      Serial.println(" p_inputntpc: " + String(p_inputntpc));
    #endif




    //oldUTC = gUTC;
    ntpCallCount = 0;

            #ifdef NTPDebug
              Serial.println("-->  " + p_time + " NTP Setup");
            #endif

      
      if(WiFi_status == WL_CONNECTED){ 
        if(timeClient.update()){
          //Serial.println("# Time in sync with NTP server");
          divstatus6 = divgreen;  // Status
          g_NTP_update = true;
          g_ntp_update_ok = true;
          failTimeinfo = false;
            #ifdef NTPDebug
              Serial.println("-->  " + p_time + " timeClient.update() ok");
            #endif
        } else {
          //Serial.println("# TIME NOT IN SYNC WITH NTP SERVER !");
          divstatus6 = divred;  // Status
          g_NTP_update = false; 
          g_ntp_update_ok = false;
          failTimeinfo = true;    
            #ifdef NTPDebug
              Serial.println("-->  " + p_time + " forceUpdate() !fail");
            #endif
             
             
              if(!timeClient.forceUpdate()){
                  Serial.println("-->  " + p_time + " forceUpdate !fail");
                  divstatus6 = divred;  // Status
                  g_NTP_update = false; 
                  g_ntp_update_ok = false;
                  if(millissave > 1577833200){
                     failTimeinfo = false; //ok
                  }else{
                    failTimeinfo = true;
                  }
              }else{
                  Serial.println("-->  " + p_time + " forceUpdate ok");
                  divstatus6 = divgreen;  // Status
                  g_NTP_update = true;
                  g_ntp_update_ok = true;
                  failTimeinfo = false;
              }

        } 
      }




  }


   //----------------------------------------------------
    void force_Time_update(){

         #ifdef NTPDebug
              Serial.println("-->  " + p_time + " NTP Setup");
            #endif

        if(timeClient.update()){
          //Serial.println("# Time in sync with NTP server");
          divstatus6 = divgreen;  // Status
          g_NTP_update = true;
          g_ntp_update_ok = true;
          failTimeinfo = false;
            #ifdef NTPDebug
              Serial.println("-->  " + p_time + " timeClient.update() ok");
            #endif
        } else {
          //Serial.println("# TIME NOT IN SYNC WITH NTP SERVER !");
          divstatus6 = divred;  // Status
          g_NTP_update = false; 
          g_ntp_update_ok = false;
          failTimeinfo = true;    
            #ifdef NTPDebug
              Serial.println("-->  " + p_time + " forceUpdate() !fail");
            #endif
             
             

              if(!timeClient.forceUpdate()){
                  Serial.println("-->  " + p_time + " forceUpdate !fail");
                  divstatus6 = divred;  // Status
                  g_NTP_update = false; 
                  g_ntp_update_ok = false;
                  if(millissave > 1577833200){
                     failTimeinfo = false; //ok
                  }else{
                    failTimeinfo = true;
                  }
              }else{
                  Serial.println("-->  " + p_time + " forceUpdate ok");
                  divstatus6 = divgreen;  // Status
                  g_NTP_update = true;
                  g_ntp_update_ok = true;
                  failTimeinfo = false;
              }
   
       
       

        } 


    }




   //----------------------------------------------------
    void printLocalTime(){
     
     //Serial.println("printLocalTime()");
          /*
        %a Abbreviated weekday name 
        %A Full weekday name 
        %b Abbreviated month name 
        %B Full month name 
        %c Date and time representation for your locale 
        %d Day of month as a decimal number (01-31) 
        %H Hour in 24-hour format (00-23) 
        %I Hour in 12-hour format (01-12) 
        %j Day of year as decimal number (001-366) 
        %m Month as decimal number (01-12) 
        %M Minute as decimal number (00-59) 
        %p Current locale’s A.M./P.M. indicator for 12-hour clock 
        %S Second as decimal number (00-59) 
        %U Week of year as decimal number,  Sunday as first day of week (00-51) 
        %w Weekday as decimal number (0-6; Sunday is 0) 
        %W Week of year as decimal number, Monday as first day of week (00-51) 
        %x Date representation for current locale 
        %X Time representation for current locale 
        %y Year without century, as decimal number (00-99) 
        %Y Year with century, as decimal number 
        %z %Z Time-zone name or abbreviation, (no characters if time zone is unknown) 
        %% Percent sign 
        You can include text literals (such as spaces and colons) to make a neater display or for padding between adjoining columns. 
        You can suppress the display of leading zeroes  by using the "#" character  (%#d, %#H, %#I, %#j, %#m, %#M, %#S, %#U, %#w, %#W, %#y, %#Y) 
      */ 
     

      
      struct tm timeinfo;
     
      if(getLocalTime(&timeinfo)){ 
        //Serial.println(&timeinfo, "%A, %B %d %Y %H:%M:%S");
        //g_ntp_update_ok = true;
        //divstatus6 = divgreen;  // Status
        #ifdef NTPTimeDebug
        Serial.println("Zeit ok");
        #endif
       // failTimeinfo = false;
      }else{
        //Serial.println("Failed to obtain time");
        //g_ntp_update_ok = false;
        //divstatus6 = divred;  // Status
        #ifdef NTPTimeDebug
        Serial.println("Zeit nicht ok");
        #endif
        //failTimeinfo = true;
        //return;
      }
       


     
      //uint16_t th_h; 
      //th_h=timeinfo.tm_year;
      #ifdef NTPTimeDebug
        Serial.println(timeinfo.tm_sec); 
        Serial.println(timeinfo.tm_min); 
        Serial.println(timeinfo.tm_hour); 
        Serial.println(timeinfo.tm_mday); 
        Serial.println(timeinfo.tm_mon); 
        Serial.println(timeinfo.tm_year); //+1900
        Serial.println(timeinfo.tm_yday); 
        Serial.println(timeinfo.tm_wday);  //0-7
        Serial.println(timeinfo.tm_isdst); 
      #endif

      
      // (int year, byte month, byte day, byte hour, byte tzHours)
      t_hour = timeinfo.tm_hour;
      t_mday = timeinfo.tm_mday;
      t_mon = timeinfo.tm_mon + 1;
      t_year = timeinfo.tm_year +1900;
      t_tzHours = 0;

        gMonth = t_mon;
        gDay = t_mday;
        gHour = t_hour;


      
      #ifdef NTPTimeDebug
        Serial.print("Day of week: ");
        Serial.println(&timeinfo, "%A");

        Serial.print("Day of week: ");
        Serial.println(&timeinfo, "%w");   //7 = Sonntag

        Serial.print("Week of Year: ");
        Serial.println(&timeinfo, "%W");     
        Serial.print("Week of Year: ");
        Serial.println(&timeinfo, "%U");  

        Serial.print("Month: ");
        Serial.println(&timeinfo, "%B");
        Serial.print("Day of Month: ");
        Serial.println(&timeinfo, "%d");
        Serial.print("Year: ");
        Serial.println(&timeinfo, "%Y");
        Serial.print("Hour: ");
        Serial.println(&timeinfo, "%H");
        Serial.print("Hour (12 hour format): ");
        Serial.println(&timeinfo, "%I");
        Serial.print("Minute: ");
        Serial.println(&timeinfo, "%M");
        Serial.print("Second: ");
        Serial.println(&timeinfo, "%S");


        Serial.println("Time variables: Hour: ");
        char timeHour[3];
        strftime(timeHour,3, "%H", &timeinfo);
        Serial.println(timeHour);
        char timeWeekDay[10];
        strftime(timeWeekDay,10, "%A", &timeinfo);
        Serial.println(timeWeekDay);
        Serial.println();
      #endif
    }
       //----------------------------------------------------



   //----------------------------------------------------
        #ifdef old_option
        boolean summertime_EU(int year, byte month, byte day, byte hour, byte tzHours)
        // European Daylight Savings Time calculation by "jurs" for German Arduino Forum
        // input parameters: "normal time" for year, month, day, hour and tzHours (0=UTC, 1=MEZ)
        // return value: returns true during Daylight Saving Time, false otherwise
        {
          if (month < 3 || month > 10) return false; // keine Sommerzeit in Jan, Feb, Nov, Dez
          if (month > 3 && month < 10) return true; // Sommerzeit in Apr, Mai, Jun, Jul, Aug, Sep
          if (month == 3 && (hour + 24 * day) >= (1 + tzHours + 24 * (31 - (5 * year / 4 + 4) % 7)) || month == 10 && (hour + 24 * day) < (1 + tzHours + 24 * (31 - (5 * year / 4 + 1) % 7)))
            return true;
          else
            return false;
        }
        #endif


          boolean Sommerzeit_aktiv (int year, int month, int day, int hour)
          // ausgehend das die RTC in der Zeitzone UTC+1, also "Winterzeit Berlin" dauerhaft läuft
          // European Daylight Savings Time calculation by "jurs" for German Arduino Forum
          // input parameters: "normal time" for year, month, day, hour
          // return value: returns true during Daylight Saving Time, false otherwise
          { 
            static int x1,x2, lastYear; // Zur Beschleunigung des Codes ein Cache für einige statische Variablen
            int x3;
            if (month<3 || month>10) return false; // keine Sommerzeit in Jan, Feb, Nov, Dez
            if (month>3 && month<10) return true;  // Sommerzeit in Apr, Mai, Jun, Jul, Aug, Sep
            // der nachfolgende Code wird nur für Monat 3 und 10 ausgeführt
            // Umstellung erfolgt auf Stunde utc_hour=1, in der Zeitzone Berlin entsprechend 2 Uhr MEZ
            // Es wird ein Cache-Speicher für die Variablen x1 und x2 verwendet, 
            // dies beschleunigt die Berechnung, wenn sich das Jahr bei Folgeaufrufen nicht ändert
            // x1 und x2 werden nur neu Berechnet, wenn sich das Jahr bei nachfolgenden Aufrufen ändert
            if (year!= lastYear) 
              { // Umstellungsbeginn und -ende
              x1= 1 + 1 + 24*(31 - (5 * year /4 + 4) % 7);  
              x2= 1 + 1 + 24*(31 - (5 * year /4 + 1) % 7);
              lastYear=year;
            }  
            x3= hour + 24 * day;
            if (month==3 && x3>=x1 || month==10 && x3<x2) return true; else return false;
          }    
   //----------------------------------------------------



   //----------------------------------------------------
    void calcLocalTime(){

    
      //---------------------------------------------------------------- 
            timeClient.setTimeOffset(gUTC * 3600); // timeClient.setTimeOffset(gUTC * 3600);  //zeitzone
            
            //timeClient.setTimeOffset(millissave);
            //setEpochTime(millissave);
          
            // The formattedDate comes with the following format:
            formattedDate = timeClient.getFormattedDate(); //2019-05-24T01:21:09Z
            #ifdef NTPTimeDebug
              Serial.println("formattedDate " + formattedDate);
              Serial.println("millissave " + String(millissave));
            #endif


            // Extract date
            int splitT = formattedDate.indexOf("T");
            dayStamp = formattedDate.substring(0, splitT); //2019-05-24
            // Extract time
            timeStamp = formattedDate.substring(splitT+1, formattedDate.length()-1); //01:21:09
          //Serial.print("DATE: ");
          //Serial.println(dayStamp);
            splitT = dayStamp.indexOf("-"); gYear = dayStamp.substring(0,splitT).toInt(); //Year : 2019 
            dayStamp = dayStamp.substring(splitT+1, dayStamp.length()); //05-24
            splitT = dayStamp.indexOf("-"); gMonth = dayStamp.substring(0,splitT).toInt(); //Month : 05
            gDay = dayStamp.substring(splitT+1, dayStamp.length()).toInt(); //24
            gDateTimeStr = String(gDay) + "/" + String(gMonth); // Date : 24/05
          //Serial.print("HOUR: ");
          // Serial.println(timeStamp);
            #ifdef NTPTimeDebug
              Serial.println(timeStamp); 
            #endif
            splitT = timeStamp.indexOf(":"); gHour = timeStamp.substring(0,splitT).toInt(); //Hour : 01
            timeStamp = timeStamp.substring(splitT+1, timeStamp.length()); //21:09
            splitT = timeStamp.indexOf(":"); gMinute = timeStamp.substring(0,splitT).toInt(); //Minute : 21
            gSecond = timeStamp.substring(splitT+1, timeStamp.length()).toInt(); //09
            gDateTimeStr = gDateTimeStr + " " + String(gHour) + ":" + String(gMinute) + ":" + String(gSecond); //01:21
          
            Jahre2 = gYear %100;      // modulo, die Jahreszahl auf 2 Stellen beschränken

            // Serial.println("-------gYear " + String(gYear));
           
           if(gYear <= 2022){
            fail2Timeinfo = true;
           }else{
            fail2Timeinfo = false; //false = time ok,  jahr ist größer 2022
           }
            //p_uhrzeit = String(gDay) + "." + String(gMonth) + "." + String(gYear)  + "  " + String(gHour) + ":" + String(gMinute);

          sprintf_P(DateAndTimeString, PSTR("%02d.%02d.%4d  %02d:%02d:%02d"), gDay, gMonth, gYear, gHour, gMinute, gSecond);
          p_uhrzeit = DateAndTimeString;

          sprintf_P(DateAndTimeString, PSTR("%02d:%02d:%02d"),  gHour, gMinute, gSecond);  
          p_time = DateAndTimeString;

          sprintf_P(DateAndTimeString, PSTR("%02d.%02d.%02d  %02d:%02d"), gDay, gMonth, Jahre2, gHour, gMinute);
          p_uhrzeit2 = DateAndTimeString; 

          gUhrzeitAktuellFlag = true;   
          #ifdef NTPTimeDebug
            //Serial.println("-->  " + p_time + " Time Update."); 
          #endif
          //Serial.println(p_uhrzeit);  

            #ifdef old_option
            runMillis= millis();
            allSeconds=millis()/1000;
            runHours= allSeconds/3600;
            secsRemaining=allSeconds%3600;
            runMinutes=secsRemaining/60;
            runSeconds=secsRemaining%60;
            sprintf(tbuf,"%02d:%02d:%02d",runHours,runMinutes,runSeconds);
            #endif


            t_hour = gHour;
            t_mday = gDay;
            t_mon = gMonth + 0;
            t_year = gYear;
            t_tzHours = 0;


            #ifdef NTPTimeDebug
              Serial.println(p_uhrzeit); 
            #endif
        //---------------------------------------------------------------- 



   }
   //----------------------------------------------------



    // g_ntp_update_start = true;
    //  g_ntp_update_ok = true;
   //----------------------------------------------------
    void NTPCallback2() {

      //Serial.println("--> NTP Callback");

     gUhrzeitAktuellFlag = false; 

     //Serial.println("1 NTPCallback2");
     //if(WiFi.status() != WL_CONNECTED) return;  /*{CD}*/ 
     //Serial.println("2 NTPCallback2"); 

      //Serial.println("4p_inputntpc: " + String(p_inputntpc));
      //if( g_ntp_update_ok == true){
        configTime(gmtOffset_sec, daylightOffset_sec, p_inputntpc);   // configTime(gmtOffset_sec, daylightOffset_sec, p_inputntpc);   
      //}

     esp_task_wdt_reset(); 
      
      //printLocalTime();
      calcLocalTime();
      if(failTimeinfo == true){
       // failTimeinfo = false;
        //return;
      }else{

        failTimeinfo = false;
        //-----------------------------------------------------------------
         //Serial.println("gYear " + String(gYear)); 
         //Serial.println("gMonth " + String(gMonth)); 
         //Serial.println("gDay " + String(gDay)); 
         //Serial.println("gHour " + String(gHour)); 
     
     
        if(Sommerzeit_aktiv(gYear+1900, gMonth, gDay, gHour)){
            #ifdef NTPTimeDebugmez
              Serial.println("-->  Es ist Sommer");
            #endif
            Set_mesz = true;
            daylightOffset_sec = 3600;
            gUTC = 2; //zeitzone
            p_mez_resault ="MESZ";
            //b_mesz_set_ok = true;
        }else{
            #ifdef NTPTimeDebugmez
              Serial.println("-->  Es ist Winter");
            #endif
            Set_mesz = false;
            daylightOffset_sec = 0;
            gUTC = 1;
            p_mez_resault ="MEZ";
            //b_mesz_set_ok = true;
        }
        
        
        
        
        t_tzHours = 0;

        /*
        if(summertime_EU(gYear+1900, gMonth, gDay, gHour, t_tzHours)){
            #ifdef NTPTimeDebugmez
              Serial.println("a-->  Es ist Sommer");
            #endif
            Set_mesz = true;
            daylightOffset_sec = 3600;
            gUTC = 2;
            p_mez_resault ="MESZ";
            //b_mesz_set_ok = true;
        }else{
            #ifdef NTPTimeDebugmez
              Serial.println("a-->  Es ist Winter");
            #endif
            Set_mesz = false;
            daylightOffset_sec = 0;
            gUTC = 1;
            p_mez_resault ="MEZ";
            //b_mesz_set_ok = true;
        }
        */

          //Serial.println("5p_inputntpc: " + String(p_inputntpc));
         
          //if( g_ntp_update_ok == true){
            configTime(gmtOffset_sec, daylightOffset_sec, p_inputntpc);   // configTime(gmtOffset_sec, daylightOffset_sec, p_inputntpc);   
          //}
          //printLocalTime();
          calcLocalTime();


             esp_task_wdt_reset(); 
          // Serial.println("--------ENDE------ ");


      }



     // erste auswertung
     calcLocalTime();

  

    gUhrzeitAktuellFlag = true; 

 }
 //---------------------------------------------------------------- 





  void Timeupdate() {  
     
   //if(WiFi.status() != WL_CONNECTED) return;  /*{CD}*/ 
      

      if(WiFi_status == WL_CONNECTED){ 
       
        if(!timeClient.update()) 
        {
           gUhrzeitAktuellFlag = false; 
           divstatus6 = divred;  // Status
        }else{
           gUhrzeitAktuellFlag = true; 
           divstatus6 = divgreen;  // Status
          #ifdef NTPTimeDebug
            Serial.println(p_time + " | Time Update"); 
          #endif
        }
        
      }

        gNTPupdateFlag = true;



          calcLocalTime();


  }

  //****************************************************************************************




 //******************************************************************************
 //                        Grafik UDATE nach Zeit                               *
 //****************************************************************************** 
  void UpdateChartValue()
  {

    
    

      #ifdef DataDebug
      Serial.println("Liniendiagramm gefüllt: " + String(chartumlauf));  
      Serial.println("Welcher Eintag in linie: " + String(charcount));  
      #endif 
   

       if(gUhrzeitAktuellFlag == false) return;  /*{CD}*/ 


         //wenn Grafik voll gezeichnet ist hinten anhängen
        charInts[42] = mb_radon_ist_word;
        #ifdef old_option
          charInts5[42] = f_pwm; 
          charInts7[42] = fval1;
        #endif
        chartime14 = String(p_uhrzeit2);
        #ifdef CO2_on
        
        #ifdef old_option
          charInts3[42] = eco2val1;
          charInts4[42] = etvocval2;
        #endif
        #else
        
        #ifdef old_option
          charInts3[42] = random(0, 50);
          charInts4[42] = random(5, 60);
        #endif 
        #endif

  
       // }



      // gGRAPHUpdateFlag = true; 
      stringtime = "labels : ['" + chartime00 + "','','','" + chartime01 + "','','','" + chartime02 + "','','','" + chartime03 + "','','','" + chartime04 + "','','','" + chartime05 + "','','','" + chartime06 + "','','','" + chartime07 + "','','','" + chartime08 + "','','','" + chartime09 + "','','','" + chartime10 + "','','','" + chartime11 + "','','','" + chartime12 + "','','','" + chartime13 + "','','','" + chartime14 + "',],";
      // wird im Server.on gemacht

      
      charcount ++;
      if(charcount >= 43){
        charcount = 0;
        //chartumlauf = 1; //ab jetzt die variablen nach vorne schieben.
      }

      //Serial.println("Wieviel Eintäge: " + String(charcount));  
      //Serial.println("chartumlauf: " + String(chartumlauf));  

     if (chartumlauf >= 1){
         // variablen nach vorne schieben.
        chartime00 = chartime00a;
        chartime00a = chartime00b;
        chartime00b = chartime01;

        chartime01 = chartime01a;
        chartime01a = chartime01b;
        chartime01b = chartime02;

        chartime02 = chartime02a;
        chartime02a = chartime02b;
        chartime02b = chartime03;

        chartime03 = chartime03a;
        chartime03a = chartime03b;
        chartime03b = chartime04;

        chartime04 = chartime04a;
        chartime04a = chartime04b;
        chartime04b = chartime05;

        chartime05 = chartime05a;
        chartime05a = chartime05b;
        chartime05b = chartime06;

        chartime06 = chartime06a;
        chartime06a = chartime06b;
        chartime06b = chartime07;

        chartime07 = chartime07a;
        chartime07a = chartime07b;
        chartime07b = chartime08;

        chartime08 = chartime08a;
        chartime08a = chartime08b;
        chartime08b = chartime09;

        chartime09 = chartime09a;
        chartime09a = chartime09b;
        chartime09b = chartime10;

        chartime10 = chartime10a;
        chartime10a = chartime10b;
        chartime10b = chartime11;

        chartime11 = chartime11a;
        chartime11a = chartime11b;
        chartime11b = chartime12;

        chartime12 = chartime12a;
        chartime12a = chartime12b;
        chartime12b = chartime13;

        chartime13 = chartime13a;
        chartime13a = chartime13b;
        chartime13b = chartime14;


        

        charInts[0] = charInts[1];
        charInts[1] = charInts[2];
        charInts[2] = charInts[3];
        charInts[3] = charInts[4];
        charInts[4] = charInts[5];
        charInts[5] = charInts[6];
        charInts[6] = charInts[7];
        charInts[7] = charInts[8];
        charInts[8] = charInts[9];
        charInts[9] = charInts[10];
        charInts[10] = charInts[11];
        charInts[11] = charInts[12];
        charInts[12] = charInts[13];
        charInts[13] = charInts[14];
        charInts[14] = charInts[15];
        charInts[15] = charInts[16];
        charInts[16] = charInts[17];
        charInts[17] = charInts[18];
        charInts[18] = charInts[19];
        charInts[19] = charInts[20];
        charInts[20] = charInts[21];
        charInts[21] = charInts[22];
        charInts[22] = charInts[23];
        charInts[23] = charInts[24];
        charInts[24] = charInts[25];
        charInts[25] = charInts[26];
        charInts[26] = charInts[27];
        charInts[27] = charInts[28];
        charInts[28] = charInts[29];
        charInts[29] = charInts[30];
        charInts[30] = charInts[31];
        charInts[31] = charInts[32];
        charInts[32] = charInts[33];
        charInts[33] = charInts[34];
        charInts[34] = charInts[35];
        charInts[35] = charInts[36];
        charInts[36] = charInts[37];
        charInts[37] = charInts[38];
        charInts[38] = charInts[39];
        charInts[39] = charInts[40];
        charInts[40] = charInts[41];
        charInts[41] = charInts[42];
       // charInts[42] = charInts[43];


        /*
        charInts3[0] = charInts3[1];   //CO2
        charInts3[1] = charInts3[2];
        charInts3[2] = charInts3[3];
        charInts3[3] = charInts3[4];
        charInts3[4] = charInts3[5];
        charInts3[5] = charInts3[6];
        charInts3[6] = charInts3[7];
        charInts3[7] = charInts3[8];
        charInts3[8] = charInts3[9];
        charInts3[9] = charInts3[10];
        charInts3[10] = charInts3[11];
        charInts3[11] = charInts3[12];
        charInts3[12] = charInts3[13];
        charInts3[13] = charInts3[14];
        charInts3[14] = charInts3[15];
        charInts3[15] = charInts3[16];
        charInts3[16] = charInts3[17];
        charInts3[17] = charInts3[18];
        charInts3[18] = charInts3[19];
        charInts3[19] = charInts3[20];
        charInts3[20] = charInts3[21];
        charInts3[21] = charInts3[22];
        charInts3[22] = charInts3[23];
        charInts3[23] = charInts3[24];
        charInts3[24] = charInts3[25];
        charInts3[25] = charInts3[26];
        charInts3[26] = charInts3[27];
        charInts3[27] = charInts3[28];
        charInts3[28] = charInts3[29];
        charInts3[29] = charInts3[30];
        charInts3[30] = charInts3[31];
        charInts3[31] = charInts3[32];
        charInts3[32] = charInts3[33];
        charInts3[33] = charInts3[34];
        charInts3[34] = charInts3[35];
        charInts3[35] = charInts3[36];
        charInts3[36] = charInts3[37];
        charInts3[37] = charInts3[38];
        charInts3[38] = charInts3[39];
        charInts3[39] = charInts3[40];
        charInts3[40] = charInts3[41];
        charInts3[41] = charInts3[42];

        charInts4[0] = charInts4[1];  //TVOC
        charInts4[1] = charInts4[2];
        charInts4[2] = charInts4[3];
        charInts4[3] = charInts4[4];
        charInts4[4] = charInts4[5];
        charInts4[5] = charInts4[6];
        charInts4[6] = charInts4[7];
        charInts4[7] = charInts4[8];
        charInts4[8] = charInts4[9];
        charInts4[9] = charInts4[10];
        charInts4[10] = charInts4[11];
        charInts4[11] = charInts4[12];
        charInts4[12] = charInts4[13];
        charInts4[13] = charInts4[14];
        charInts4[14] = charInts4[15];
        charInts4[15] = charInts4[16];
        charInts4[16] = charInts4[17];
        charInts4[17] = charInts4[18];
        charInts4[18] = charInts4[19];
        charInts4[19] = charInts4[20];
        charInts4[20] = charInts4[21];
        charInts4[21] = charInts4[22];
        charInts4[22] = charInts4[23];
        charInts4[23] = charInts4[24];
        charInts4[24] = charInts4[25];
        charInts4[25] = charInts4[26];
        charInts4[26] = charInts4[27];
        charInts4[27] = charInts4[28];
        charInts4[28] = charInts4[29];
        charInts4[29] = charInts4[30];
        charInts4[30] = charInts4[31];
        charInts4[31] = charInts4[32];
        charInts4[32] = charInts4[33];
        charInts4[33] = charInts4[34];
        charInts4[34] = charInts4[35];
        charInts4[35] = charInts4[36];
        charInts4[36] = charInts4[37];
        charInts4[37] = charInts4[38];
        charInts4[38] = charInts4[39];
        charInts4[39] = charInts4[40];
        charInts4[40] = charInts4[41];
        charInts4[41] = charInts4[42];        
        */


        /* 
        charInts5[0] = charInts5[1];   //hz
        charInts5[1] = charInts5[2];
        charInts5[2] = charInts5[3];
        charInts5[3] = charInts5[4];
        charInts5[4] = charInts5[5];
        charInts5[5] = charInts5[6];
        charInts5[6] = charInts5[7];
        charInts5[7] = charInts5[8];
        charInts5[8] = charInts5[9];
        charInts5[9] = charInts5[10];
        charInts5[10] = charInts5[11];
        charInts5[11] = charInts5[12];
        charInts5[12] = charInts5[13];
        charInts5[13] = charInts5[14];
        charInts5[14] = charInts5[15];
        charInts5[15] = charInts5[16];
        charInts5[16] = charInts5[17];
        charInts5[17] = charInts5[18];
        charInts5[18] = charInts5[19];
        charInts5[19] = charInts5[20];
        charInts5[20] = charInts5[21];
        charInts5[21] = charInts5[22];
        charInts5[22] = charInts5[23];
        charInts5[23] = charInts5[24];
        charInts5[24] = charInts5[25];
        charInts5[25] = charInts5[26];
        charInts5[26] = charInts5[27];
        charInts5[27] = charInts5[28];
        charInts5[28] = charInts5[29];
        charInts5[29] = charInts5[30];
        charInts5[30] = charInts5[31];
        charInts5[31] = charInts5[32];
        charInts5[32] = charInts5[33];
        charInts5[33] = charInts5[34];
        charInts5[34] = charInts5[35];
        charInts5[35] = charInts5[36];
        charInts5[36] = charInts5[37];
        charInts5[37] = charInts5[38];
        charInts5[38] = charInts5[39];
        charInts5[39] = charInts5[40];
        charInts5[40] = charInts5[41];
        charInts5[41] = charInts5[42];
        */

     /*
        charInts7[0] = charInts7[1];  //Radon Fan Bq/m3
        charInts7[1] = charInts7[2];
        charInts7[2] = charInts7[3];
        charInts7[3] = charInts7[4];
        charInts7[4] = charInts7[5];
        charInts7[5] = charInts7[6];
        charInts7[6] = charInts7[7];
        charInts7[7] = charInts7[8];
        charInts7[8] = charInts7[9];
        charInts7[9] = charInts7[10];
        charInts7[10] = charInts7[11];
        charInts7[11] = charInts7[12];
        charInts7[12] = charInts7[13];
        charInts7[13] = charInts7[14];
        charInts7[14] = charInts7[15];
        charInts7[15] = charInts7[16];
        charInts7[16] = charInts7[17];
        charInts7[17] = charInts7[18];
        charInts7[18] = charInts7[19];
        charInts7[19] = charInts7[20];
        charInts7[20] = charInts7[21];
        charInts7[21] = charInts7[22];
        charInts7[22] = charInts7[23];
        charInts7[23] = charInts7[24];
        charInts7[24] = charInts7[25];
        charInts7[25] = charInts7[26];
        charInts7[26] = charInts7[27];
        charInts7[27] = charInts7[28];
        charInts7[28] = charInts7[29];
        charInts7[29] = charInts7[30];
        charInts7[30] = charInts7[31];
        charInts7[31] = charInts7[32];
        charInts7[32] = charInts7[33];
        charInts7[33] = charInts7[34];
        charInts7[34] = charInts7[35];
        charInts7[35] = charInts7[36];
        charInts7[36] = charInts7[37];
        charInts7[37] = charInts7[38];
        charInts7[38] = charInts7[39];
        charInts7[39] = charInts7[40];
        charInts7[40] = charInts7[41];
        charInts7[41] = charInts7[42];
        */

     }
     chartumlauf = 1; //ab jetzt die variablen nach vorne schieben.
      //*******************************************************************************************************


          
          if(radonTagEintrCount >= 14){
             radonTagEintrCount = 0;
             radonMore14Day = 1;  // jetzt umladen der Einträge
          }

      radon_tag = radon_tag + mb_radon_ist_word;
      //radonTagCount ++ ;
      radonTagCount = radonTagCount +1 ;
      radon_temp = radon_tag / radonTagCount;

      #ifdef DataDebug
      Serial.println("Radon Summe: " + String(radon_tag));  
      Serial.println("Counts für AVG Radon Tag: " + String(radonTagCount));  // radonTagCountvorgabe
      Serial.println("Radon Tag: " + String(radon_temp));  
      Serial.println("Tageszählung aktuell: " + String(radonTagEintrCount)); 
      Serial.println("Mehr als 14 Tage: " + String(radonMore14Day)); 
      



      #endif 

      if (radonMore14Day == 1){
        radon_tag14 = radon_temp;
        rgbchart14 = rgbchartvorgabeSel;
        stringtime2 = "labels : ['1','2','3','4','5','6','7','8','9','10','11','12','13','Now',],";
      } 

      #ifdef DataDebug
      Serial.println(" ");  
      Serial.println("radon_tag01: " + String(radon_tag01));  
      Serial.println("radon_tag02: " + String(radon_tag02));  
      Serial.println("radon_tag03: " + String(radon_tag03));  
      Serial.println("radon_tag04: " + String(radon_tag04));  
      Serial.println("radon_tag05: " + String(radon_tag05));  
      Serial.println("radon_tag09: " + String(radon_tag06));  
      Serial.println("radon_tag07: " + String(radon_tag07));  
      Serial.println("radon_tag08: " + String(radon_tag08));  
      Serial.println("radon_tag09: " + String(radon_tag09));  
      Serial.println("radon_tag10: " + String(radon_tag10));  
      Serial.println("radon_tag11: " + String(radon_tag11));  
      Serial.println("radon_tag12: " + String(radon_tag12));  
      Serial.println("radon_tag13: " + String(radon_tag13));  
      Serial.println("radon_tag14: " + String(radon_tag14));  
      Serial.println(" "); 
      #endif 

      if (radonMore14Day == 0){  // befüllung bis zm 14ten Tag mit livewerten, dann nicht mehr
      
            rgbchart01 = "rgb(62,149,205)";
            rgbchart02 = "rgb(62,149,205)";
            rgbchart03 = "rgb(62,149,205)";
            rgbchart04 = "rgb(62,149,205)";
            rgbchart05 = "rgb(62,149,205)";
            rgbchart06 = "rgb(62,149,205)";
            rgbchart07 = "rgb(62,149,205)";
            rgbchart08 = "rgb(62,149,205)";
            rgbchart09 = "rgb(62,149,205)";
            rgbchart10 = "rgb(62,149,205)";
            rgbchart11 = "rgb(62,149,205)";
            rgbchart12 = "rgb(62,149,205)";
            rgbchart13 = "rgb(62,149,205)";
            rgbchart14 = "rgb(62,149,205)";
      
           switch (radonTagEintrCount) {
              case 0:
                radon_tag01 = radon_temp;
                rgbchart01 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['Now','2','3','4','5','6','7','8','9','10','11','12','13','14',],";
                break; 
              case 1:
                radon_tag02 = radon_temp;
                rgbchart02 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','Now','3','4','5','6','7','8','9','10','11','12','13','14',],";
                break;          
              case 2:
                radon_tag03 = radon_temp;
                rgbchart03 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','Now','4','5','6','7','8','9','10','11','12','13','14',],";
                break;             
              case 3:
                radon_tag04 = radon_temp;
                rgbchart04 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','Now','5','6','7','8','9','10','11','12','13','14',],";
                break;        
              case 4:
                radon_tag05 = radon_temp;
                rgbchart05 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','Now','6','7','8','9','10','11','12','13','14',],";
                break; 
              case 5:
                radon_tag06 = radon_temp;
                rgbchart06 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','Now','7','8','9','10','11','12','13','14',],";
                break; 
              case 6:
                radon_tag07 = radon_temp;
                rgbchart07 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','6','Now','8','9','10','11','12','13','14',],";
                break; 
              case 7:
                radon_tag08 = radon_temp;
                rgbchart08 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','6','7','Now','9','10','11','12','13','14',],";
                break; 
              case 8:
                radon_tag09 = radon_temp;
                rgbchart09 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','6','7','8','Now','10','11','12','13','14',],";
                break; 
              case 9:
                radon_tag10 = radon_temp;
                rgbchart10 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','6','7','8','9','Now','11','12','13','14',],";
                break; 
              case 10:
                radon_tag11 = radon_temp;
                rgbchart11 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','6','7','8','9','10','Now','12','13','14',],";
                break; 
              case 11:
                radon_tag12 = radon_temp;
                rgbchart12 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','6','7','8','9','10','11','Now','13','14',],";
                break; 
              case 12:
                radon_tag13 = radon_temp;
                rgbchart13 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','6','7','8','9','10','11','12','Now','14',],";
                break; 
              case 13:
                radon_tag14 = radon_temp;
                rgbchart14 = rgbchartvorgabeSel;
                stringtime2 = "labels : ['1','2','3','4','5','6','7','8','9','10','11','12','13','Now',],";
                break; 
              default:
                break; 
            }

      }  // befüllung bis zm 14ten Tag mit livewerten, dann nicht mehr


      //--
      //Serial.println("radonTagCount: " + String(radonTagCount));  // radonTagCountvorgabe
      //Serial.println("radonMore14Day: " + String(radonMore14Day));  // radonTagCountvorgabe

    if(radonTagCount >= radonTagCountvorgabe){   // nach 96 einträgen   radonTagCountvorgabe
      
       
       radonTagCount = 0;   //löschen Counter für den Tag
       radon_tag = 0;    //Tageswert löschen für neuen Tag
       //Serial.println("radonTagCount: " + String(radonTagCount));  // radonTagCountvorgabe

      if(radonMore14Day == 0){

        radonTagEintrCount ++;  //welcher Tag
        if (radonTagEintrCount >= 15) {radonTagEintrCount = 1;}

            //-- case tage  
            switch (radonTagEintrCount) {
              case 1:
                radon_tag01 = radon_temp;
                rgbchart01 = rgbchartvorgabeSel;
                break; 
              case 2:
                radon_tag02 = radon_temp;
                rgbchart02 = rgbchartvorgabeSel;
                break;          
              case 3:
                radon_tag03 = radon_temp;
                rgbchart03 = rgbchartvorgabeSel;
                break;             
              case 4:
                radon_tag04 = radon_temp;
                rgbchart04 = rgbchartvorgabeSel;
                break;        
              case 5:
                radon_tag05 = radon_temp;
                rgbchart05 = rgbchartvorgabeSel;
                break; 
              case 6:
                radon_tag06 = radon_temp;
                rgbchart06 = rgbchartvorgabeSel;
                break; 
              case 7:
                radon_tag07 = radon_temp;
                rgbchart07 = rgbchartvorgabeSel;
                break; 
              case 8:
                radon_tag08 = radon_temp;
                rgbchart08 = rgbchartvorgabeSel;
                break; 
              case 9:
                radon_tag09 = radon_temp;
                rgbchart09 = rgbchartvorgabeSel;
                break; 
              case 10:
                radon_tag10 = radon_temp;
                rgbchart10 = rgbchartvorgabeSel;
                break; 
              case 11:
                radon_tag11 = radon_temp;
                rgbchart11 = rgbchartvorgabeSel;
                break; 
              case 12:
                radon_tag12 = radon_temp;
                rgbchart12 = rgbchartvorgabeSel;
                break; 
              case 13:
                radon_tag13 = radon_temp;
                rgbchart13 = rgbchartvorgabeSel;
                break; 
              case 14:
                radon_tag14 = radon_temp;
                break; 
              default:
                radon_temp = 0;
                break; 
            } //--- case --
           


      }else{

              radon_tag01 = radon_tag02;
              radon_tag02 = radon_tag03;
              radon_tag03 = radon_tag04;
              radon_tag04 = radon_tag05;
              radon_tag05 = radon_tag06;
              radon_tag06 = radon_tag07;
              radon_tag07 = radon_tag08;
              radon_tag08 = radon_tag09;
              radon_tag09 = radon_tag10;
              radon_tag10 = radon_tag11;
              radon_tag11 = radon_tag12;
              radon_tag12 = radon_tag13;
              radon_tag13 = radon_tag14;
              radon_tag14 = radon_temp;
              rgbchart14 = rgbchartvorgabeSel;

      }  //-- radonMore14Day
          
       
    }  // nach 96 einträgen
 //------

      #ifdef DataDebug
      Serial.println("radon_tag01: " + String(radon_tag01));  
      Serial.println("radon_tag02: " + String(radon_tag02));  
      Serial.println("radon_tag03: " + String(radon_tag03));  
      Serial.println("radon_tag04: " + String(radon_tag04));  
      Serial.println("radon_tag05: " + String(radon_tag05));  
      Serial.println("radon_tag09: " + String(radon_tag06));  
      Serial.println("radon_tag07: " + String(radon_tag07));  
      Serial.println("radon_tag08: " + String(radon_tag08));  
      Serial.println("radon_tag09: " + String(radon_tag09));  
      Serial.println("radon_tag10: " + String(radon_tag10));  
      Serial.println("radon_tag11: " + String(radon_tag11));  
      Serial.println("radon_tag12: " + String(radon_tag12));  
      Serial.println("radon_tag13: " + String(radon_tag13));  
      Serial.println("radon_tag14: " + String(radon_tag14)); 

      Serial.println("---------");  
       
      Serial.println("00: " + chartime00); 
      Serial.println("00: " + chartime01);  
      Serial.println("00: " + chartime02);  
      Serial.println("00: " + chartime03);  
      Serial.println("00: " + chartime04);  
      Serial.println("00: " + chartime05);  
      Serial.println("00: " + chartime06);  
      Serial.println("00: " + chartime07);  
      Serial.println("00: " + chartime08);  
      Serial.println("00: " + chartime09);  
      Serial.println("00: " + chartime10);   
      Serial.println("00: " + chartime11); 
      Serial.println("00: " + chartime12); 
      Serial.println("00: " + chartime13); 
      Serial.println("00: " + chartime14); 
      #endif 


        stringdata2 = "data : [" + String(radon_tag01) + "," + String(radon_tag02) + "," + String(radon_tag03) + "," + String(radon_tag04) + "," + String(radon_tag05) + "," + String(radon_tag06) + "," + String(radon_tag07) + "," + String(radon_tag08) + "," + String(radon_tag09) + "," + String(radon_tag10) + "," + String(radon_tag11) + "," + String(radon_tag12) + "," + String(radon_tag13) + "," + String(radon_tag14) + ",],";

        

  }

  //****************************************************************************************


 //******************************************************************************
 //                        LED UDATE nach Auslesen                              *
 //****************************************************************************** 
  void UpdateLEDValue()
  {

    // ledRedVal    300           150
    // ledOrangeVal   150         90
    // ledGreenVal   50         30
    //led einstellung
    if(ledRedVal > ledOrangeVal && ledRedVal > ledGreenVal && ledOrangeVal > ledGreenVal){
      // ok
      val3max_vorgabe = ledRedVal+50;
      val3max_vorgabe2 = ledRedVal;  
      vredFrom_vorgabe = ledOrangeVal;
      vyellowFrom_vorgabe = ledGreenVal;
      if(vyellowFrom_vorgabe>50)
      {
        vgreenFrom_vorgabe = vyellowFrom_vorgabe - 50;
      }else{
        vgreenFrom_vorgabe = 0;
      }
      val3_vorgabe = val3max_vorgabe + 200;           //50
     

    }else{
     
      // nicht ok
      val3max_vorgabe = 300;                          //300  rot
      vredFrom_vorgabe = val3max_vorgabe-100;         //200  orange
      vyellowFrom_vorgabe = val3max_vorgabe-200;      //100  grün
      vgreenFrom_vorgabe = vyellowFrom_vorgabe - 50;  //50
      val3_vorgabe = val3max_vorgabe + 200;           //50


    }





         if(val3 <= vyellowFrom_vorgabe){     //   0-100  grün      30

            val3max = val3max_vorgabe;    //Max Wert 300 unterer bereich
            vredTo = val3max;
            vredFrom = vredFrom_vorgabe;
            vyellowTo = vredFrom_vorgabe;
            vyellowFrom = vyellowFrom_vorgabe;
            vgreenTo = vyellowFrom_vorgabe;
            vgreenFrom = vgreenFrom_vorgabe;
            //val3_color = "0, 250, 0, 0.3";  //grün
            //bgcolor_vorgabe = bgcolor_g;

          }else if(val3 <= vredFrom_vorgabe){ // 100-200  orange

            val3max = val3max_vorgabe;    //Max Wert 300 unterer bereich
            vredTo = val3max;
            vredFrom = vredFrom_vorgabe;
            vyellowTo = vredFrom_vorgabe;
            vyellowFrom = vyellowFrom_vorgabe;
            vgreenTo = vyellowFrom_vorgabe;
            vgreenFrom = vgreenFrom_vorgabe;
            //val3_color = "250, 200, 0, 0.3"; //orange
            //bgcolor_vorgabe = bgcolor_o;

          }else if(val3 <= val3max_vorgabe2){  //200-300  rot

            val3max = val3max_vorgabe;    //Max Wert 300 unterer bereich
            vredTo = val3max;
            vredFrom = vredFrom_vorgabe;
            vyellowTo = vredFrom_vorgabe;
            vyellowFrom = vyellowFrom_vorgabe;
            vgreenTo = vyellowFrom_vorgabe;
            vgreenFrom = vgreenFrom_vorgabe;
            //val3_color = "250, 0, 0, 0.3"; //rot
            //bgcolor_vorgabe = bgcolor_r;

          }else if(val3 <= val3_vorgabe){  //300-500  rot

            val3max = val3_vorgabe;
            vredTo = val3max;
            vredFrom = vredFrom_vorgabe;
            vyellowTo = vredFrom_vorgabe;
            vyellowFrom = vyellowFrom_vorgabe;
            vgreenTo = vyellowFrom_vorgabe;
            vgreenFrom = vgreenFrom_vorgabe;
            //val3_color = "250, 0, 0, 0.3"; //rot
            //bgcolor_vorgabe = bgcolor_r;

          }else if(val3 <= val3_vorgabe){

            val3max = val3max_vorgabe+vredFrom_vorgabe;
            vredTo = val3max;
            vredFrom = vredFrom_vorgabe;
            vyellowTo = vredFrom_vorgabe;
            vyellowFrom = vyellowFrom_vorgabe;
            vgreenTo = vyellowFrom_vorgabe;
            vgreenFrom = vgreenFrom_vorgabe;
            //val3_color = "250, 0, 0, 0.3";
            //bgcolor_vorgabe = bgcolor_r;
        
          }else{

            val3max = val3 + vyellowFrom_vorgabe;
            vredTo = val3max;
            vredFrom = vredFrom_vorgabe;
            vyellowTo = vredFrom_vorgabe;
            vyellowFrom = vyellowFrom_vorgabe;
            vgreenTo = vyellowFrom_vorgabe;
            vgreenFrom = vgreenFrom_vorgabe;
            //val3_color = "250, 0, 0, 0.3";
            // = bgcolor_r;

          }





  }

  //****************************************************************************************





 //******************************************************************************
 //                        Lesen aus  EEPROM                                    *
 //****************************************************************************** 
  void ReadChartValue()
  {

       Preferences preferences;
       preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden  



       //******************************************************************************************************  
          radon_tag =   preferences.getUInt("ee_radont", 0);             //"Datei"  auslesen
          radon_tag01 = preferences.getUInt("ee_rad01", 0);              //"Datei"  auslesen
          radon_tag02 = preferences.getUInt("ee_rad02", 0);              //"Datei"  auslesen
          radon_tag03 = preferences.getUInt("ee_rad03", 0);              //"Datei"  auslesen
          radon_tag04 = preferences.getUInt("ee_rad04", 0);              //"Datei"  auslesen
          radon_tag05 = preferences.getUInt("ee_rad05", 0);              //"Datei"  auslesen
          radon_tag06 = preferences.getUInt("ee_rad06", 0);              //"Datei"  auslesen
          radon_tag07 = preferences.getUInt("ee_rad07", 0);              //"Datei"  auslesen
          radon_tag08 = preferences.getUInt("ee_rad08", 0);              //"Datei"  auslesen
          radon_tag09 = preferences.getUInt("ee_rad09", 0);              //"Datei"  auslesen
          radon_tag10 = preferences.getUInt("ee_rad10", 0);              //"Datei"  auslesen
          radon_tag11 = preferences.getUInt("ee_rad11", 0);              //"Datei"  auslesen
          radon_tag12 = preferences.getUInt("ee_rad12", 0);              //"Datei"  auslesen
          radon_tag13 = preferences.getUInt("ee_rad13", 0);              //"Datei"  auslesen
          radon_tag14 = preferences.getUInt("ee_rad14", 0);              //"Datei"  auslesen
          radonTagCount = preferences.getUInt("ee_radc1", 0);              //"Datei"  auslesen
          radonTagEintrCount = preferences.getUInt("ee_radc2", 0);              //"Datei"  auslesen
          radonMore14Day = preferences.getUInt("ee_rad24d", 0);              //"Datei"  auslesen
      //******************************************************************************************************     




       chartumlauf = preferences.getUInt("chartuml", 0);             //"Datei"  auslesen  
       charcount = preferences.getUInt("charcount", 0);             //"Datei"  auslesen  

       chartime00 = preferences.getString("chartime00", " ");             //"Datei"  auslesen 
       chartime00a= preferences.getString("chartime00a", " ");             //"Datei"  auslesen 
       chartime00b = preferences.getString("chartime00b", " ");             //"Datei"  auslesen 
       chartime01 = preferences.getString("chartime01", " ");             //"Datei"  auslesen 
       chartime01a= preferences.getString("chartime01a", " ");             //"Datei"  auslesen 
       chartime01b = preferences.getString("chartime01b", " ");             //"Datei"  auslesen  
       chartime02 = preferences.getString("chartime02", " ");             //"Datei"  auslesen  
       chartime02a= preferences.getString("chartime02a", " ");             //"Datei"  auslesen 
       chartime02b = preferences.getString("chartime02b", " ");             //"Datei"  auslesen 
       chartime03 = preferences.getString("chartime03", " ");             //"Datei"  auslesen
       chartime03a= preferences.getString("chartime03a", " ");             //"Datei"  auslesen 
       chartime03b = preferences.getString("chartime03b", " ");             //"Datei"  auslesen   
       chartime04 = preferences.getString("chartime04", " ");             //"Datei"  auslesen  
       chartime04a= preferences.getString("chartime04a", " ");             //"Datei"  auslesen 
       chartime04b = preferences.getString("chartime04b", " ");             //"Datei"  auslesen 
       chartime05 = preferences.getString("chartime05", " ");             //"Datei"  auslesen  
       chartime05a= preferences.getString("chartime05a", " ");             //"Datei"  auslesen 
       chartime05b = preferences.getString("chartime05b", " ");             //"Datei"  auslesen 
       chartime06 = preferences.getString("chartime06", " ");             //"Datei"  auslesen  
       chartime06a= preferences.getString("chartime06a", " ");             //"Datei"  auslesen 
       chartime06b = preferences.getString("chartime06b", " ");             //"Datei"  auslesen 
       chartime07 = preferences.getString("chartime07", " ");             //"Datei"  auslesen  
       chartime07a= preferences.getString("chartime07a", " ");             //"Datei"  auslesen 
       chartime07b = preferences.getString("chartime07b", " ");             //"Datei"  auslesen 
       chartime08 = preferences.getString("chartime08", " ");             //"Datei"  auslesen  
       chartime08a= preferences.getString("chartime08a", " ");             //"Datei"  auslesen 
       chartime08b = preferences.getString("chartime08b", " ");             //"Datei"  auslesen 
       chartime09 = preferences.getString("chartime09", " ");             //"Datei"  auslesen  
       chartime09a= preferences.getString("chartime09a", " ");             //"Datei"  auslesen 
       chartime09b = preferences.getString("chartime09b", " ");             //"Datei"  auslesen 
       chartime10 = preferences.getString("chartime10", " ");             //"Datei"  auslesen  
       chartime10a= preferences.getString("chartime10a", " ");             //"Datei"  auslesen 
       chartime10b = preferences.getString("chartime10b", " ");             //"Datei"  auslesen 
       chartime11 = preferences.getString("chartime11", " ");             //"Datei"  auslesen  
       chartime11a= preferences.getString("chartime11a", " ");             //"Datei"  auslesen 
       chartime11b = preferences.getString("chartime11b", " ");             //"Datei"  auslesen 
       chartime12 = preferences.getString("chartime12", " ");             //"Datei"  auslesen  
       chartime12a= preferences.getString("chartime12a", " ");             //"Datei"  auslesen 
       chartime12b = preferences.getString("chartime12b", " ");             //"Datei"  auslesen 
       chartime13 = preferences.getString("chartime13", " ");             //"Datei"  auslesen  
       chartime13a= preferences.getString("chartime13a", " ");             //"Datei"  auslesen 
       chartime13b = preferences.getString("chartime13b", " ");             //"Datei"  auslesen 
       chartime14 = preferences.getString("chartime14", " ");             //"Datei"  auslesen  
      // chartime14a= preferences.getString("chartime14a", " ");             //"Datei"  auslesen 
      // chartime14b = preferences.getString("chartime14b", " ");             //"Datei"  auslesen 
     //******************************************************************************************************  

        

     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ ReadChartValue __");
     #endif

  }
  //*******************************************************************************


 //******************************************************************************
 //                        Schreiben in EEPROM                                  *
 //****************************************************************************** 
       
  void WritedChartValue()
  {

       Preferences preferences;
       preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden  



        //-------------------
        preferences.putUInt("ee_radont", radon_tag);                   //Variable  speichern  
        preferences.putUInt("ee_rad01", radon_tag01);                  //Variable  speichern  
        preferences.putUInt("ee_rad02", radon_tag02);                  //Variable  speichern  
        preferences.putUInt("ee_rad03", radon_tag03);                  //Variable  speichern  
        preferences.putUInt("ee_rad04", radon_tag04);                  //Variable  speichern  
        preferences.putUInt("ee_rad05", radon_tag05);                  //Variable  speichern  
        preferences.putUInt("ee_rad06", radon_tag06);                  //Variable  speichern  
        preferences.putUInt("ee_rad07", radon_tag07);                  //Variable  speichern  
        preferences.putUInt("ee_rad08", radon_tag08);                  //Variable  speichern  
        preferences.putUInt("ee_rad09", radon_tag09);                  //Variable  speichern  
        preferences.putUInt("ee_rad10", radon_tag10);                  //Variable  speichern  
        preferences.putUInt("ee_rad11", radon_tag11);                  //Variable  speichern  
        preferences.putUInt("ee_rad12", radon_tag12);                  //Variable  speichern  
        preferences.putUInt("ee_rad13", radon_tag13);                  //Variable  speichern  
        preferences.putUInt("ee_rad14", radon_tag14);                  //Variable  speichern  
        preferences.putUInt("ee_radc1", radonTagCount);                //Variable  speichern  
        preferences.putUInt("ee_radc2", radonTagEintrCount);           //Variable  speichern  
        preferences.putUInt("ee_rad24d", radonMore14Day);              //Variable  speichern  
        //-------------------





       preferences.putUInt("charcount", charcount);                   //Variable  speichern  
       preferences.putUInt("chartuml", chartumlauf);                   //Variable  speichern 
       
 
       preferences.putString("chartime00", chartime00);                   //Variable  speichern 
       preferences.putString("chartime00a", chartime00a);                   //Variable  speichern 
       preferences.putString("chartime00b", chartime00b);                   //Variable  speichern 
       preferences.putString("chartime01", chartime01);                   //Variable  speichern 
       preferences.putString("chartime01a", chartime01a);                   //Variable  speichern 
       preferences.putString("chartime01b", chartime01b);                   //Variable  speichern 
       preferences.putString("chartime02", chartime02);                   //Variable  speichern
       preferences.putString("chartime02a", chartime02a);                   //Variable  speichern 
       preferences.putString("chartime02b", chartime02b);                   //Variable  speichern  
       preferences.putString("chartime03", chartime03);                   //Variable  speichern
       preferences.putString("chartime03a", chartime03a);                   //Variable  speichern 
       preferences.putString("chartime03b", chartime03b);                   //Variable  speichern  
       preferences.putString("chartime04", chartime04);                   //Variable  speichern
       preferences.putString("chartime04a", chartime04a);                   //Variable  speichern 
       preferences.putString("chartime04b", chartime04b);                   //Variable  speichern  
       preferences.putString("chartime05", chartime05);                   //Variable  speichern
       preferences.putString("chartime05a", chartime05a);                   //Variable  speichern 
       preferences.putString("chartime05b", chartime05b);                   //Variable  speichern  
       preferences.putString("chartime06", chartime06);                   //Variable  speichern 
       preferences.putString("chartime06a", chartime06a);                   //Variable  speichern 
       preferences.putString("chartime06b", chartime06b);                   //Variable  speichern  
       preferences.putString("chartime07", chartime07);                   //Variable  speichern 
       preferences.putString("chartime07a", chartime07a);                   //Variable  speichern 
       preferences.putString("chartime07b", chartime07b);                   //Variable  speichern  
       preferences.putString("chartime08", chartime08);                   //Variable  speichern 
       preferences.putString("chartime08a", chartime08a);                   //Variable  speichern 
       preferences.putString("chartime08b", chartime08b);                   //Variable  speichern  
       preferences.putString("chartime09", chartime09);                   //Variable  speichern 
       preferences.putString("chartime09a", chartime09a);                   //Variable  speichern 
       preferences.putString("chartime09b", chartime09b);                   //Variable  speichern  
       preferences.putString("chartime10", chartime10);                   //Variable  speichern 
       preferences.putString("chartime10a", chartime10a);                   //Variable  speichern 
       preferences.putString("chartime10b", chartime10b);                   //Variable  speichern  
       preferences.putString("chartime11", chartime11);                   //Variable  speichern 
       preferences.putString("chartime11a", chartime11a);                   //Variable  speichern 
       preferences.putString("chartime11b", chartime11b);                   //Variable  speichern  
       preferences.putString("chartime12", chartime12);                   //Variable  speichern 
       preferences.putString("chartime12a", chartime12a);                   //Variable  speichern 
       preferences.putString("chartime12b", chartime12b);                   //Variable  speichern  
       preferences.putString("chartime13", chartime13);                   //Variable  speichern 
       preferences.putString("chartime13a", chartime13a);                   //Variable  speichern 
       preferences.putString("chartime13b", chartime13b);                   //Variable  speichern  
       preferences.putString("chartime14", chartime14);                   //Variable  speichern 
      // preferences.putString("chartime14a", chartime14a);                   //Variable  speichern 
      // preferences.putString("chartime14b", chartime14b);                   //Variable  speichern  

      
  
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Writed Chart Value __");
     #endif

  }
  //*******************************************************************************









  //******************************************************************************
  //                   Grafikdaten lesen aus File System                         *
  //******************************************************************************
 
 /*
  void datei_schreiben()  // tvoc Daten  charInts4[42]   dateiGr01
  {
    File file = SPIFFS.open(dateiGr01, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_DEBUGdetail
          Serial.println("Die Datei " + String(dateiGr01) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr01, "w");
        #ifdef NVS_DEBUGdetail
          Serial.println("Datei " + String(dateiGr01) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          #ifdef NVS_DEBUGdetail
            Serial.println("In die Datei " + String(dateiGr01) + " schreiben!");
            for (int i=0; i <= 43; i++){
              Serial.print("Zeile ");
              Serial.print(i);
              Serial.print(": ");
              Serial.println(charInts4[i]);           // ... erst ausgegeben
            } 
         #endif
          // Wiederhole 43 Mal:   Inhalt schreiben
          for (int i=0; i <= 43; i++){
            file.print(String(charInts4[i]) + "\n");  
          } 
          file.close();       
      }
  }


  void datei_lesen_line()  //tvoc  charInts4[42]   dateiGr01
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr01, "r");
      
      #ifdef NVS_DEBUGdetail
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_DEBUGdetail
          Serial.print("Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        charInts4[i] = data.toInt();      
        i++;
        zeilenZaehler++;
      } 

      file.close();
      #ifdef NVS_DEBUGdetail
        Serial.println(" ");
      #endif

  }
*/







  //*******************************************************************************
/*
  void datei_schreiben2()  // co2 Daten   charInts3[42]   dateiGr02
  {
    File file = SPIFFS.open(dateiGr02, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_DEBUGdetail
          Serial.println("Die Datei " + String(dateiGr02) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr02, "w");
        #ifdef NVS_DEBUGdetail
          Serial.println("Datei " + String(dateiGr02) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          #ifdef NVS_DEBUGdetail
            Serial.println("In die Datei " + String(dateiGr02) + " schreiben!");
            for (int i=0; i <= 43; i++){
              Serial.print("Zeile ");
              Serial.print(i);
              Serial.print(": ");
              Serial.println(charInts3[i]);           // ... erst ausgegeben
            } 
         #endif
          // Wiederhole 43 Mal:   Inhalt schreiben
          for (int i=0; i <= 43; i++){
            file.print(String(charInts3[i]) + "\n");  
          } 
          file.close();       
      }
  }


  void datei_lesen_line2()    //co2  charInts3[42]   dateiGr02
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr02, "r");
      
      #ifdef NVS_DEBUGdetail
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_DEBUGdetail
          Serial.print("Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        charInts3[i] = data.toInt();      
        i++;
        zeilenZaehler++;
      } 

      file.close();
      #ifdef NVS_DEBUGdetail
        Serial.println(" ");
      #endif

  }

*/
 //********************************************************************************





 //*******************************************************************************
  void datei_schreiben3()  // radon Daten     charInts[42]      dateiGr03
  {
    File file = SPIFFS.open(dateiGr03, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_DEBUGdetail
          Serial.println("Die Datei " + String(dateiGr03) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr03, "w");
        #ifdef NVS_DEBUGdetail
          Serial.println("Datei " + String(dateiGr03) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          #ifdef NVS_DEBUGdetail
            Serial.println("In die Datei " + String(dateiGr03) + " schreiben!");
            for (int i=0; i <= 43; i++){
              Serial.print("Zeile ");
              Serial.print(i);
              Serial.print(": ");
              Serial.println(charInts[i]);           // ... erst ausgegeben
            } 
         #endif
          // Wiederhole 43 Mal:   Inhalt schreiben
          for (int i=0; i <= 43; i++){
            file.print(String(charInts[i]) + "\n");  
          } 
          file.close();       
      }
  }


  void datei_lesen_line3()  //Radon   charInts[42]  dateiGr03
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr03, "r");
      
      #ifdef NVS_DEBUGdetail
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_DEBUGdetail
          Serial.print("Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        charInts[i] = data.toInt();      
        i++;
        zeilenZaehler++;
      } 

      file.close();
      #ifdef NVS_DEBUGdetail
        Serial.println(" ");
      #endif

  }
  //********************************************************************************


 //*******************************************************************************
/* 
  void datei_schreiben5()
  {
    File file = SPIFFS.open(dateiGr05, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_DEBUGdetail
          Serial.println("Die Datei " + String(dateiGr05) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr05, "w");
        #ifdef NVS_DEBUGdetail
          Serial.println("Datei " + String(dateiGr05) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          #ifdef NVS_DEBUGdetail
            Serial.println("In die Datei " + String(dateiGr05) + " schreiben!");
            for (int i=0; i <= 43; i++){
              Serial.print("Zeile ");
              Serial.print(i);
              Serial.print(": ");
              Serial.println(charInts5[i]);           // ... erst ausgegeben
            } 
         #endif
          // Wiederhole 43 Mal:   Inhalt schreiben
          for (int i=0; i <= 43; i++){
            file.print(String(charInts5[i]) + "\n");  
          } 
          file.close();       
      }
  }


  void datei_lesen_line5()
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr05, "r");
      
      #ifdef NVS_DEBUGdetail
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_DEBUGdetail
          Serial.print("Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        charInts5[i] = data.toInt();      
        i++;
        zeilenZaehler++;
      } 

      file.close();
      #ifdef NVS_DEBUGdetail
        Serial.println(" ");
      #endif

  }
*/
  //********************************************************************************





 //*******************************************************************************
 /*
  void datei_schreiben6()
  {
    File file = SPIFFS.open(dateiGr06, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_log_DEBUG
          Serial.println("Die Datei " + String(dateiGr06) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr06, "w");
        #ifdef NVS_log_DEBUG
          Serial.println("Datei " + String(dateiGr06) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          #ifdef NVS_log_DEBUG
            Serial.println("In die Datei " + String(dateiGr06) + " schreiben!");
            for (int i=0; i <= LOG_LEN; i++){
              Serial.print("Zeile ");
              Serial.print(i);
              Serial.print(": ");
              Serial.println(log_list[i]);           // ... erst ausgegeben
            } 
         #endif
          // Wiederhole x Mal:   Inhalt schreiben
         
          // 7-21
          // 1-7
          
          file.print(String(log_list_count) + "\n");  
          for (int i=1; i <= LOG_LEN; i++){
            //file.print(String(log_list[i]) + "\n");  
          } 
   

          file.close();       
      }
  }


  void datei_lesen_line6()
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr06, "r");
      
      #ifdef NVS_log_DEBUG
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_log_DEBUG
          Serial.print("Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
       //log_list[i] = data;      
        i++;
        zeilenZaehler++;
      } 
      
      //log_list_count = log_list[0].toInt();

      file.close();
      #ifdef NVS_log_DEBUG
        Serial.println(" ");
      #endif

  }
*/

  //********************************************************************************





 //*******************************************************************************
 /*
  void datei_schreiben7()
  {
    File file = SPIFFS.open(dateiGr07, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_DEBUGdetail
          Serial.println("Die Datei " + String(dateiGr07) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr07, "w");
        #ifdef NVS_DEBUGdetail
          Serial.println("Datei " + String(dateiGr07) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          #ifdef NVS_DEBUGdetail
            Serial.println("In die Datei " + String(dateiGr07) + " schreiben!");
            for (int i=0; i <= 43; i++){
              Serial.print("Zeile ");
              Serial.print(i);
              Serial.print(": ");
              Serial.println(charInts7[i]);           // ... erst ausgegeben
            } 
         #endif
          // Wiederhole 43 Mal:   Inhalt schreiben
          for (int i=0; i <= 43; i++){
            file.print(String(charInts7[i]) + "\n");  
          } 
          file.close();       
      }
  }


  void datei_lesen_line7()
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr07, "r");
      
      #ifdef NVS_DEBUGdetail
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_DEBUGdetail
          Serial.print("Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        charInts7[i] = data.toInt();      
        i++;
        zeilenZaehler++;
      } 

      file.close();
      #ifdef NVS_DEBUGdetail
        Serial.println(" ");
      #endif

  }
*/
  //********************************************************************************







 //*******************************************************************************
 /*
  void datei_schreiben8()
  {
    File file = SPIFFS.open(dateiGr08, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_DEBUGdetail_
          Serial.println("Die Datei " + String(dateiGr08) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr08, "w");
        #ifdef NVS_DEBUGdetail_
          Serial.println("Datei " + String(dateiGr08) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          
          if(gcharcount8Del == false){
                      
            #ifdef MQTT_DEBUG_last
              Serial.println("In die Datei " + String(dateiGr08) + " schreiben!");            

              for (int i=0; i <= charcount8; i++){ //charcount8
                Serial.print("Zeile ");
                Serial.print(i);
                Serial.print(": ");
                //Serial.println(charInts8[i]);           // ... erst ausgegeben
                Serial.println(charInts8_s[i]);           // ... erst ausgegeben
                
              } 
            #endif

              // Wiederhole 43 Mal:   Inhalt schreiben
              for (int i=0; i <= charcount8; i++){   //charcount8
                //file.print(String(charInts8[i]) + "\n"); 

              file.print(String(charInts8_s[i]) + "\n"); 

              } 

              charcount8++;   // Zeilen inhalt der MQTT nicht übertragenen Dateien
              if(charcount8>=63){
                charcount8 = 63;
              } 

          }else{

              gcharcount8Del = false;
              file.print(""); 
              charcount8 = 0;   // Zeilen inhalt der MQTT nicht übertragenen Dateien

          }


          file.close();       
      }
  }


  void datei_lesen_line8()
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr08, "r");
      
      #ifdef MQTT_DEBUG_last
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef MQTT_DEBUG_last
          Serial.print("Zeile ");
          //Serial.print(zeilenZaehler);
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          //Serial.println(data);           // ... und wieder ausgegeben
        #endif
        //charInts8[i] = data.toInt();  
        charInts8_s[zeilenZaehler] = data;  
        #ifdef MQTT_DEBUG_last
           Serial.println(charInts8_s[zeilenZaehler]);           // ... und wieder ausgegeben
        #endif  
        i++;
        zeilenZaehler++;
      } 
      charcount8 = zeilenZaehler;  // Zeilen inhalt der MQTT nicht übertragenen Dateien

      file.close();
      #ifdef MQTT_DEBUG_last
        //Serial.println(" ");
        Serial.println("charcount8: " + String(charcount8));      // Zeilen inhalt der MQTT nicht übertragenen Dateien
      #endif

  }
  */
  //********************************************************************************







 //*******************************************************************************
  void datei_schreiben9()
  {
    File file = SPIFFS.open(dateiGr09, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_DEBUGdetail_
          Serial.println("Die Datei " + String(dateiGr09) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr09, "w");
        #ifdef NVS_DEBUGdetail_
          Serial.println("Datei " + String(dateiGr09) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          
          if(gcharcount9Del == false){
                      
            #ifdef MQTT_DEBUG_last
              Serial.println("In die Datei " + String(dateiGr09) + " schreiben!");            

              for (int i=0; i <= charcount9; i++){ //charcount9
                Serial.print("Zeile ");
                Serial.print(i);
                Serial.print(": ");
                Serial.println(charInts9[i]);           // ... erst ausgegeben
                
              } 
            #endif

              // Wiederhole 43 Mal:   Inhalt schreiben
              for (int i=0; i <= charcount9; i++){   //charcount9
              file.print(String(charInts9[i]) + "\n"); 


              } 

              charcount9++;   // Zeilen inhalt der MQTT nicht übertragenen Dateien
              if(charcount9>=63){
                charcount9 = 63;
              } 

          }else{

              gcharcount9Del = false;
              file.print(""); 
              charcount9 = 0;   // Zeilen inhalt der MQTT nicht übertragenen Dateien

          }


          file.close();       
      }
  }


  void datei_lesen_line9()
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr09, "r");
      
      #ifdef MQTT_DEBUG_last
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef MQTT_DEBUG_last
          Serial.print("Zeile ");
          //Serial.print(zeilenZaehler);
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          //Serial.println(data);           // ... und wieder ausgegeben
        #endif
        charInts9[i] = data.toInt();  

        #ifdef MQTT_DEBUG_last
           Serial.println(String(charInts9[zeilenZaehler]));           // ... und wieder ausgegeben
        #endif  
        i++;
        zeilenZaehler++;
      } 
      charcount9 = zeilenZaehler;  // Zeilen inhalt der MQTT nicht übertragenen Dateien

      file.close();
      #ifdef MQTT_DEBUG_last
        //Serial.println(" ");
        Serial.println("charcount9: " + String(charcount9));      // Zeilen inhalt der MQTT nicht übertragenen Dateien
      #endif

  }
  //********************************************************************************






 //*******************************************************************************
  void datei_schreiben10()
  {
    File file = SPIFFS.open(dateiGr10, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_DEBUGdetail_
          Serial.println("Die Datei " + String(dateiGr10) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr10, "w");
        #ifdef NVS_DEBUGdetail_
          Serial.println("Datei " + String(dateiGr10) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("0");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
          
          if(gcharcount10Del == false){
                      
            #ifdef MQTT_DEBUG_last
              Serial.println("In die Datei " + String(dateiGr10) + " schreiben!");            

              for (int i=0; i <= charcount10; i++){ //charcount10
                Serial.print("Zeile ");
                Serial.print(i);
                Serial.print(": ");
                Serial.println(charInts10[i]);           // ... erst ausgegeben
                
              } 
            #endif

              // Wiederhole 43 Mal:   Inhalt schreiben
              for (int i=0; i <= charcount10; i++){   //charcount10
              file.print(String(charInts10[i]) + "\n"); 


              } 

              charcount10++;   // Zeilen inhalt der MQTT nicht übertragenen Dateien
              if(charcount10>=63){
                charcount10 = 63;
              } 

          }else{

              gcharcount10Del = false;
              file.print(""); 
              charcount10 = 0;   // Zeilen inhalt der MQTT nicht übertragenen Dateien

          }


          file.close();       
      }
  }


  void datei_lesen_line10()
  {
      String data;
      unsigned int zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr10, "r");
      
      #ifdef MQTT_DEBUG_last
        Serial.println("Inhalt der geöffneten Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef MQTT_DEBUG_last
          Serial.print("Zeile ");
          //Serial.print(zeilenZaehler);
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          //Serial.println(data);           // ... und wieder ausgegeben
        #endif
        charInts10[i] = data.toInt();  

        #ifdef MQTT_DEBUG_last
           Serial.println(String(charInts10[zeilenZaehler]));           // ... und wieder ausgegeben
        #endif  
        i++;
        zeilenZaehler++;
      } 
      charcount10 = zeilenZaehler;  // Zeilen inhalt der MQTT nicht übertragenen Dateien

      file.close();
      #ifdef MQTT_DEBUG_last
        //Serial.println(" ");
        Serial.println("charcount10: " + String(charcount10));      // Zeilen inhalt der MQTT nicht übertragenen Dateien
      #endif

  }
  //********************************************************************************






 //*******************************************************************************
  void datei_schreiben11()
  {
    File file = SPIFFS.open(dateiGr11, "w");
    //File file = SPIFFS.open(dateiGr01, FILE_APPEND);
     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_cloud_DEBUG
          Serial.println("Die Datei " + String(dateiGr11) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr11, "w");
        #ifdef NVS_cloud_DEBUG
          Serial.println("Datei " + String(dateiGr11) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden
        


        charcount11_w = charcount11 + 1;

        if(gcharcount11Del == true){
          charcount11_w =  0;
          gcharcount11Del = false;
          #ifdef NVS_cloud_DEBUG
            Serial.println("Datei " + String(dateiGr11) + " löschen!");
          #endif
        }else{
          #ifdef NVS_cloud_DEBUG
            Serial.println("In die Datei " + String(dateiGr11) + " schreiben! -> Zeilen: "+ String(charcount11_w));
          #endif
        }


        if(gdata11Resave == false){
              for (int i=0; i < charcount11_w; i++){        // charcount11    CLOUD_LEN
            
               
                  //if(cloud_list[i] != ""){
                     // file.print(cloud_list[i] + "\n"); 
                      #ifdef NVS_cloud_DEBUG
                        //Serial.println("Zeile " + String(i) + ": " + cloud_list[i]);           // ... und ausgegeben 
                      #endif
                 // }
 
              } 
        }else{

                // 5                 6
                i_write_line_t = i_write_line -1;
               //          17
               //   must_transfer;  //nur teile von daten wieder speichern wegen cloud fehler
               Serial.println("i_write_line_t: " + String(i_write_line_t) + " | must_transfer: " + String(must_transfer) + " | charcount11_w: " + String(charcount11_w));           // ... und ausgegeben 


            //                                          
            for (int i_re=i_write_line_t; i_re < charcount11_w; i_re++){        // charcount11    CLOUD_LEN
            
                //if(cloud_list[i_re] != ""){
                    //file.print(cloud_list[i_re] + "\n"); 
                    #ifdef NVS_cloud_DEBUG
                      //Serial.println("Zeile " + String(i) + ": " + cloud_list[i_re]);           // ... und ausgegeben 
                    #endif
                //}  

            }

        }




          file.close();       
      }
  }


  void datei_lesen_line11()
  {
      String data;
      uint16_t zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr11, "r");
      

      if(!file){

          // Die Datei ist nicht vorhanden
          #ifdef NVS_cloud_DEBUG
            Serial.println("Die Datei " + String(dateiGr11) + " existiert nicht!");
          #endif 
          // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
          File file = SPIFFS.open(dateiGr11, "w");
          #ifdef NVS_cloud_DEBUG
            Serial.println("Datei " + String(dateiGr11) + " wurde erstellt!");
          #endif
          // Daten in die Datei schreiben
          file.print("0");
          // Schließen der Datei
          file.close();

          // erneut öffnen für lesen 
          file = SPIFFS.open(dateiGr11, "r");
        
      }



      #ifdef NVS_cloud_DEBUG
        Serial.println("Lese Daten aus Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_cloud_DEBUG
          Serial.print("Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        //cloud_list[i] = data;      
        i++;
        zeilenZaehler++;
      } 

      int str_len1 = data.length(); 
      if(str_len1 < 2){
        if(zeilenZaehler>0){zeilenZaehler--;}
      }
          charcount11 = zeilenZaehler;

          if(charcount11> CLOUD_LEN){
                charcount11 = CLOUD_LEN;
                zeilenZaehler = CLOUD_LEN;
          }
       
          charcount11_t = charcount11;

      //cloud_list_count = cloud_list[0].toInt();
      
      #ifdef NVS_cloud_DEBUG
      Serial.print("Aktueller Zeilen Zähler: ");
      Serial.println(charcount11);
      //Serial.print("Count: ");
      //Serial.println(cloud_list_count);
      #endif

      file.close();
      #ifdef NVS_cloud_DEBUG
        //Serial.println(" ");
      #endif

  }

  
  //********************************************************************************





 //*******************************************************************************
  void datei_lesen_line12()
  {
      String data;
      uint16_t zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr12, "r");
      

      if(!file){

          // Die Datei ist nicht vorhanden
          #ifdef NVS_cloud_DEBUG
            Serial.println("Die Datei " + String(dateiGr12) + " existiert nicht!");
          #endif 
          // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
          File file = SPIFFS.open(dateiGr12, "w");
          #ifdef NVS_cloud_DEBUG
            Serial.println("Datei " + String(dateiGr12) + " wurde erstellt!");
          #endif
          // Daten in die Datei schreiben
          file.print("0");
          // Schließen der Datei
          file.close();

          // erneut öffnen für lesen 
          file = SPIFFS.open(dateiGr12, "r");
        
      }



      #ifdef NVS_cloud_DEBUG
        Serial.println("Lese Daten aus Cloud Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_cloud_DEBUG
          Serial.print("r Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        //cloud_list[i] = data;      
        i++;
        zeilenZaehler++;
      } 

          charcount12 = zeilenZaehler;
          charcount12_t = charcount12;

      //cloud_list_count = cloud_list[0].toInt();
      
      #ifdef NVS_cloud_DEBUG
      Serial.println("-->  " + p_time + " | Aktueller Cloud read Zeilen Zähler: " + String(charcount12)); 
      #endif

      file.close();
      #ifdef NVS_cloud_DEBUG
        //Serial.println(" ");
      #endif

  }




  void datei_schreiben12()   // FILE_APPEND
  {
    File file = SPIFFS.open(dateiGr12, FILE_APPEND);

     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_cloud_DEBUG
          Serial.println("Die Datei " + String(dateiGr12) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr12, FILE_APPEND);
        #ifdef NVS_cloud_DEBUG
          Serial.println("Datei " + String(dateiGr12) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden

           file.print(sendValueStr2 + "\n"); 
             #ifdef NVS_cloud_DEBUG
                //Serial.println("Cloud w Zeile  : " + cloud_list_t);           // ... und ausgegeben 
             #endif


          file.close();       
      }
  }





 //*******************************************************************************
  void datei_lesen_line13()
  {
      String data;
      uint16_t zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr13, "r");
      

      if(!file){

          // Die Datei ist nicht vorhanden
          #ifdef NVS_MQTT_DEBUG
            Serial.println("Die Datei " + String(dateiGr13) + " existiert nicht!");
          #endif 
          // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
          File file = SPIFFS.open(dateiGr13, "w");
          #ifdef NVS_MQTT_DEBUG
            Serial.println("Datei " + String(dateiGr13) + " wurde erstellt!");
          #endif
          // Daten in die Datei schreiben
          file.print("0");
          // Schließen der Datei
          file.close();

          // erneut öffnen für lesen 
          file = SPIFFS.open(dateiGr13, "r");
        
      }



      #ifdef NVS_MQTT_DEBUG
        Serial.println("Lese Daten aus MQTT Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_MQTT_DEBUG
          Serial.print("r Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        //cloud_list[i] = data;      
        i++;
        zeilenZaehler++;
      } 

          charcount13 = zeilenZaehler;
          charcount13_t = charcount13;

      //cloud_list_count = cloud_list[0].toInt();
      
      #ifdef NVS_MQTT_DEBUG
      Serial.println("-->  " + p_time + " | Aktueller MQTT read Zeilen Zähler: " + String(charcount13)); 
      #endif

      file.close();
      #ifdef NVS_cloud_DEBUG
        //Serial.println(" ");
      #endif

  }




  void datei_schreiben13()   // FILE_APPEND
  {
    File file = SPIFFS.open(dateiGr13, FILE_APPEND);

     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_MQTT_DEBUG
          Serial.println("Die Datei " + String(dateiGr13) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr13, FILE_APPEND);
        #ifdef NVS_MQTT_DEBUG
          Serial.println("Datei " + String(dateiGr13) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden

           file.print(things_list_t + "\n"); 
             #ifdef NVS_MQTT_DEBUG
                //Serial.println("MQTT w Zeile  : " + things_list_t);           // ... und ausgegeben 
             #endif


          file.close();       
      }
  }




 //*******************************************************************************
  void datei_lesen_line14()
  {
      String data;
      uint16_t zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr14, "r");
      

      if(!file){

          // Die Datei ist nicht vorhanden
          #ifdef NVS_MQTT_DEBUG
            Serial.println("Die Datei " + String(dateiGr14) + " existiert nicht!");
          #endif 
          // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
          File file = SPIFFS.open(dateiGr14, "w");
          #ifdef NVS_MQTT_DEBUG
            Serial.println("Datei " + String(dateiGr14) + " wurde erstellt!");
          #endif
          // Daten in die Datei schreiben
          file.print("");
          // Schließen der Datei
          file.close();

          // erneut öffnen für lesen 
          file = SPIFFS.open(dateiGr14, "r");
        
      }



      #ifdef NVS_MQTT_DEBUG
        Serial.println("Lese Daten aus MQTT Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_MQTT_DEBUG
          Serial.print("read Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        //cloud_list[i] = data;      
        i++;
        zeilenZaehler++;
      } 

          charcount14 = zeilenZaehler;
          charcount14_t = charcount14;

      //cloud_list_count = cloud_list[0].toInt();
      
      #ifdef NVS_MQTT_DEBUG
      Serial.println("-->  " + p_time + " | Aktueller MQTT read Zeilen Zähler: " + String(charcount14)); 
      #endif

      file.close();
      #ifdef NVS_MQTT_DEBUG
        //Serial.println(" ");
      #endif

  }




  void datei_schreiben14()   // FILE_APPEND
  {
    File file = SPIFFS.open(dateiGr14, FILE_APPEND);

     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_MQTT_DEBUG
          Serial.println("Die Datei " + String(dateiGr14) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr14, FILE_APPEND);
        #ifdef NVS_MQTT_DEBUG
          Serial.println("Datei " + String(dateiGr14) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden


           file.print(String(mb_radon_ist_word) + "\n"); 
             #ifdef NVS_MQTT_DEBUG
                Serial.println("MQTT 1w Zeile " );           // ... und ausgegeben 
             #endif


          file.close();       
      }
  }





 //*******************************************************************************
  void datei_lesen_line15()
  {
      String data;
      uint16_t zeilenZaehler = 0;
      int i = 0;
      File file = SPIFFS.open(dateiGr15, "r");
      

      if(!file){

          // Die Datei ist nicht vorhanden
          #ifdef NVS_MQTT_DEBUG
            Serial.println("Die Datei " + String(dateiGr15) + " existiert nicht!");
          #endif 
          // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
          File file = SPIFFS.open(dateiGr15, "w");
          #ifdef NVS_MQTT_DEBUG
            Serial.println("Datei " + String(dateiGr15) + " wurde erstellt!");
          #endif
          // Daten in die Datei schreiben
          file.print("");
          // Schließen der Datei
          file.close();

          // erneut öffnen für lesen 
          file = SPIFFS.open(dateiGr15, "r");
        
      }



      #ifdef NVS_MQTT_DEBUG
        Serial.println("Lese Daten aus MQTT Datei:");
      #endif

      while(file.available()) {
        data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
        #ifdef NVS_MQTT_DEBUG
          Serial.print("r Zeile ");
          Serial.print(zeilenZaehler);
          Serial.print(": ");
          Serial.println(data);           // ... und wieder ausgegeben
        #endif
        //cloud_list[i] = data;      
        i++;
        zeilenZaehler++;
      } 

          charcount15 = zeilenZaehler;
          charcount15_t = charcount15;

      //cloud_list_count = cloud_list[0].toInt();
      
      #ifdef NVS_MQTT_DEBUG
      Serial.println("-->  " + p_time + " | Aktueller MQTT read Zeilen Zähler: " + String(charcount15)); 
      #endif

      file.close();
      #ifdef NVS_MQTT_DEBUG
        //Serial.println(" ");
      #endif

  }




  void datei_schreiben15()   // FILE_APPEND
  {
    File file = SPIFFS.open(dateiGr15, FILE_APPEND);

     
    if(!file){
        // Die Datei ist nicht vorhanden
        #ifdef NVS_MQTT_DEBUG
          Serial.println("Die Datei " + String(dateiGr15) + " existiert nicht!");
        #endif 
        // Datei mit Schreibrechten öffnen, wird erstellt wenn nicht vorhanden
        File file = SPIFFS.open(dateiGr15, FILE_APPEND);
        #ifdef NVS_MQTT_DEBUG
          Serial.println("Datei " + String(dateiGr15) + " wurde erstellt!");
        #endif
        // Daten in die Datei schreiben
        file.print("");
        // Schließen der Datei
        file.close();
      }else{
          // Die Datei ist vorhanden


           file.print(String(mb_radon_eintrarge) + "\n"); 
             #ifdef NVS_MQTT_DEBUG
                Serial.println("MQTT 2w Zeile " );           // ... und ausgegeben 
             #endif


          file.close();       
      }
  }










 //********************************************************************************
    #ifdef BLE_Serialparing

      void BTConfirmRequestCallback(uint32_t numVal)
      {
        confirmRequestPending = true;
        Serial.println(numVal);
      }

      void BTAuthCompleteCallback(boolean success)
      {
        confirmRequestPending = false;
        if (success)
        {
          Serial.println("Pairing success!!");
        }
        else
        {
          Serial.println("Pairing failed, rejected by user!!");
        }
      }

    #endif
 //********************************************************************************






  //******************************************************************************
  //                        ModbusMessage für FC4                                *
  //******************************************************************************
  // Error errd = MB.addRequest(1, client_id, READ_INPUT_REGISTER, 0, 6);
  // Error errd2 = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 7);

  void handleData(ModbusMessage response, uint32_t token) 
  {
    //Serial.println("-------------------------------------");

    esp_task_wdt_reset(); 
    
    #ifdef MBDebug
      //Serial.println(" ");
      Serial.println("-------------------");
      Serial.printf("Response: serverID=%d, FC=%d, Token=%08X, length=%d:\n", response.getServerID(), response.getFunctionCode(), token, response.size());
    #endif
    //Serial.println(response.getServerID());
    //Serial.println(response.getFunctionCode());
    //Serial.println(response.size());
    
    i_loop = 0;
    mb_byte_size = response.size();

    for (auto& byte : response) {
      mb_arry_byte[i_loop] = byte;
      //Serial.printf("%02X ", byte);
      //Serial.println(mb_arry_byte[i_loop]);
      i_loop ++;
    }

    //#ifdef MBDebug
      //Serial.println("response.size() " + response.size());
    //#endif
    
    response_size = response_size + response.size();

    response_ServerID =  response.getServerID();

    //Serial.println("------------");
    // alle bytes im Array
   // for (byte i = 0; i < mb_byte_size; i = i + 1) {
     // Serial.println(mb_arry_byte[i]);
     // Serial.printf(" ", mb_arry_byte[i]);
    //} 
  
    
    //Serial.println("------------");
    // nur daten
    mb_byte_resault = mb_byte_size - mb_byte_header;
    mb_byte_header_t = mb_byte_header - 1;
    //for (byte i = mb_byte_header_t; i < mb_byte_size; i = i + 1) {
    // Serial.println(mb_arry_byte[i]);
      //Serial.printf("%02X ", mb_arry_byte[i]);
    // } 
    //Serial.println("");
    
    responsegetFunctionCode = response.getFunctionCode();
    
    #ifdef MBDebug
       Serial.println("responsegetFunctionCode: " + String(responsegetFunctionCode));
       Serial.println("response.size " + String(mb_byte_size));
       Serial.println("response.ServerID " + String(response_ServerID));
       Serial.println("-------------------");
       Serial.println(" ");
    #endif

    //if (response.getFunctionCode() == 4 || response.getServerID() == 2 || response.size() == 15){
    if (response.getFunctionCode() == 4 && mb_byte_size == 13){  
      //if (response.getFunctionCode() == 4 ){  

      // 0 = 3,4
      // 1 = 5,6     

      // 2 = 7,8

      // 3 = 9,10
      // 4 = 11,12

      // 5 = 13,14

      // 6 = 15,16
      // 7 = 17,18
      // 8 = 19,20
      // 9 = 21,22
      // 10 = 23,24
      // 11 = 25,26


           mb_Seriennummer_char[0] = (char)mb_arry_byte[3];
           mb_Seriennummer_char[1] = (char)mb_arry_byte[4];
           mb_Seriennummer_char[2] = (char)mb_arry_byte[5];
           mb_Seriennummer_char[3] = (char)mb_arry_byte[6];
           mb_Seriennummer_char[4] = (char)mb_arry_byte[7];
           mb_Seriennummer_char[5] = (char)mb_arry_byte[8];
           mb_Seriennummer_char[6] = (char)mb_arry_byte[9];
           mb_Seriennummer_char[7] = (char)mb_arry_byte[10];
           mb_Seriennummer_char[8] = (char)mb_arry_byte[11];
           mb_Seriennummer_char[9] = (char)mb_arry_byte[12];


           mb_Seriennummer = String(mb_Seriennummer_char);
        #ifdef MBDebug
           Serial.println("Seriennummer " + mb_Seriennummer);  
        #endif

           rval7 = mb_Seriennummer;

 
              #ifdef DataDebug
              Serial.println("-->  Sensor Seriennummer Daten aktualisiert");  
              #endif 


    }   //(response.getFunctionCode() == 4 || response.getServerID() == 2 || response.size() == 15){
    //--------------------------------------------------------------------------------------------------


    //--------------------------------------------------------------------------------------------------
    //------------------ M E S H -----------------------
    //--------------------------------------------------------------------------------------------------
    if(g_mb_mesh == true){ 

        if (response.getFunctionCode() == 3 && mb_byte_size == 17){  
            //#ifdef MBDebug_master
              //Serial.println("--> Funktion Mesh");
            //#endif

            //------------------------------
            if(response_ServerID == 1){          
                
                mb_radon_live_word_0 = word(mb_arry_byte[3], mb_arry_byte[4]);
                mb_radon_live_word_1 = word(mb_arry_byte[5], mb_arry_byte[6]);
                mb_radon_live_32bit = mb_radon_live_word_0 + mb_radon_live_word_1;
                
                //mb_radon_live_32bit = 1576;
                mb_radon_live_32bitK_s = String(mb_radon_live_32bit) + " ";
                if(mb_radon_live_32bit>1000){
                  mb_radon_live_32bitK = mb_radon_live_32bit / 1000;
                  mb_radon_live_32bitK_s = String(mb_radon_live_32bitK) + "k ";
                }
              
                mb_radon_live_word_0_m[response_ServerID] = word(mb_arry_byte[3], mb_arry_byte[4]);
                mb_radon_live_word_1_m[response_ServerID] = word(mb_arry_byte[5], mb_arry_byte[6]);
                mb_radon_live_32bit_m[response_ServerID] = mb_radon_live_word_0_m[response_ServerID] + mb_radon_live_word_1_m[response_ServerID];

                rval3 = mb_radon_live_32bit;
                r0_val3 = String(mb_radon_live_32bit);
                mb_radon_ist_long = mb_radon_live_32bit;

                if(mb_radon_live_32bit > 65535){
                  val3 = 65535; 
                  mb_radon_ist_word = 65535;
                }else{
                  val3 = mb_radon_live_word_1;
                  mb_radon_ist_word = mb_radon_live_word_1;
                }

                if(p_sett20 == 1){
                  fval1 = mb_radon_ist_word;
                }

                g_mb_tracer_radon[response_ServerID] = 1;     // ok  
                #ifdef MBDebug_master
                Serial.println("-->  Radon Iive [32bit]: " + String(mb_radon_live_32bit));
                Serial.println("-->  Sensor Adresse: " + String(response_ServerID)+ " Daten aktualisiert"); 
                Serial.println(" "); 
                #endif
              //***********************************



                mb_radon_live_word_0 = word(mb_arry_byte[7], mb_arry_byte[8]);
                mb_radon_live_word_1 = word(mb_arry_byte[9], mb_arry_byte[10]);
                mb_radon_24h_32bit = mb_radon_live_word_0 + mb_radon_live_word_1;
                
                val8 = mb_radon_live_word_1;
                
                
                

                rval4 = mb_radon_24h_32bit;
                //Serial.println("Radon Ist Long: " + String(mb_radon_live_word_0) + " " + String(mb_radon_live_word_1));
                //Serial.println("Radon Ist Long: " + String(mb_arry_byte[3]) + " " + String(mb_arry_byte[4]) + " " + String(mb_arry_byte[5]) + " " + String(mb_arry_byte[6]) + "  : "  + String(mb_radon_live_32bit));
                #ifdef MBDebug_master
                //Serial.println("--> Radon 24h [32bit]: " + String(mb_radon_24h_32bit));
                #endif

                mb_radon_live_word_0 = word(mb_arry_byte[11], mb_arry_byte[12]);
                mb_radon_live_word_1 = word(mb_arry_byte[13], mb_arry_byte[14]);
                mb_radon_long_32bit = mb_radon_live_word_0 + mb_radon_live_word_1;


                rval5 = mb_radon_long_32bit;
                mb_radon_long = mb_radon_long_32bit;
                if(mb_radon_long_32bit > 65535){
                  mb_radon_int = 65535; 
                  val9 = 65535;
                }else{
                  mb_radon_int = mb_radon_live_word_1;
                  val9 = mb_radon_live_word_1;
                }

                //Serial.println("Radon Ist Long: " + String(mb_radon_live_word_0) + " " + String(mb_radon_live_word_1));
                //Serial.println("Radon Ist Long: " + String(mb_arry_byte[3]) + " " + String(mb_arry_byte[4]) + " " + String(mb_arry_byte[5]) + " " + String(mb_arry_byte[6]) + "  : "  + String(mb_radon_live_32bit));
                #ifdef MBDebug_master
                  //Serial.println("--> Radon long [32bit]: " + String(mb_radon_long_32bit));
                #endif


                mb_radon_F3_eintrarge = word(mb_arry_byte[15], mb_arry_byte[16]);
              
                rval6 = mb_radon_F3_eintrarge;
                mb_radon_eintrarge = mb_radon_F3_eintrarge;

                val10 = mb_radon_eintrarge;

                    //Serial.println("Einträge: " + String(mb_arry_byte[13]) + " " + String(mb_arry_byte[14]) + "  : "  + String(mb_radon_F3_eintrarge));
                #ifdef MBDebug_master
                  //Serial.println("--> Einträge: " + String(mb_radon_F3_eintrarge));
                #endif


                p_uhrzeit_last = p_time;
            }
            //------ 1 ------------------------
              mb_tracer_number ++;
              #ifdef MBDebug_master
                //Serial.println("--> next tracer counter abfrage number: " + String(mb_tracer_number));
              #endif 
        } // (response.getFunctionCode() == 3 && mb_byte_size == 17)


        if (response.getFunctionCode() == 3 && mb_byte_size == 7){  
            //#ifdef MBDebug_master
            //Serial.println("--> Funktion Mesh");
            //#endif

            //----- 2-10 -------------------------
            if(response_ServerID > 1 && response_ServerID <= 10){       
              mb_radon_live_word_0_m[response_ServerID] = word(mb_arry_byte[3], mb_arry_byte[4]);
              mb_radon_live_word_1_m[response_ServerID]  = word(mb_arry_byte[5], mb_arry_byte[6]);
              mb_radon_live_32bit_m[response_ServerID] = mb_radon_live_word_0_m[response_ServerID] + mb_radon_live_word_1_m[response_ServerID] ;
              g_mb_tracer_radon[response_ServerID] = 1;     // ok   
              #ifdef MBDebug_master
                Serial.println("-->  Radon Iive [32bit]: " + String(mb_radon_live_32bit_m[response_ServerID]));
                Serial.println("-->  Sensor Adresse: " + String(response_ServerID)+ " Daten aktualisiert"); 
                Serial.println(" ");  
              #endif 
              
            }
            //------------------------------
              mb_tracer_number ++;
              #ifdef MBDebug_master
                //Serial.println("--> next tracer counter abfrage number: " + String(mb_tracer_number));
              #endif 


        }

        valm1 = mb_radon_live_32bit_m[1]; 
        valm2 = mb_radon_live_32bit_m[2]; 
        valm3 = mb_radon_live_32bit_m[3]; 
        valm4 = mb_radon_live_32bit_m[4]; 
        valm5 = mb_radon_live_32bit_m[5]; 
        valm6 = mb_radon_live_32bit_m[6]; 
        valm7 = mb_radon_live_32bit_m[7]; 
        valm8 = mb_radon_live_32bit_m[8]; 
        valm9 = mb_radon_live_32bit_m[9]; 
        valm10 = mb_radon_live_32bit_m[10];
    
    } //g_mb_mesh == true
    //--------------------------------------------------------------------------------------------------
    //------------------ M E S H -----------------------
    //--------------------------------------------------------------------------------------------------




    //--------------------------------------------------------------------------------------------------
    if(g_mb_mesh == false){ 
      if (response.getFunctionCode() == 3 && mb_byte_size == 17){  


        #ifdef MBDebug
        Serial.println("Funkton 3 ");
        #endif

        mb_radon_live_word_0 = word(mb_arry_byte[3], mb_arry_byte[4]);
        mb_radon_live_word_1 = word(mb_arry_byte[5], mb_arry_byte[6]);
        mb_radon_live_32bit = mb_radon_live_word_0 + mb_radon_live_word_1;

        //mb_radon_live_32bit = 1576;
        mb_radon_live_32bitK_s = String(mb_radon_live_32bit) + " ";
        if(mb_radon_live_32bit>1000){
          mb_radon_live_32bitK = mb_radon_live_32bit / 1000;
          mb_radon_live_32bitK_s = String(mb_radon_live_32bitK) + "k ";
        }


        rval3 = mb_radon_live_32bit;
        r0_val3 = String(mb_radon_live_32bit);
        mb_radon_ist_long = mb_radon_live_32bit;

        if(mb_radon_live_32bit > 65535){
          val3 = 65535; 
          mb_radon_ist_word = 65535;
        }else{
          val3 = mb_radon_live_word_1;
          mb_radon_ist_word = mb_radon_live_word_1;
        }

        if(p_sett20 == 1){
          fval1 = mb_radon_ist_word;
        }


        //Serial.println("Radon Ist Long: " + String(mb_radon_live_word_0) + " " + String(mb_radon_live_word_1));
        //Serial.println("Radon Ist Long: " + String(mb_arry_byte[3]) + " " + String(mb_arry_byte[4]) + " " + String(mb_arry_byte[5]) + " " + String(mb_arry_byte[6]) + "  : "  + String(mb_radon_live_32bit));
        #ifdef MBDebug
        Serial.println("Radon Iive [32bit]: " + String(mb_radon_live_32bit));
        #endif

        mb_radon_live_word_0 = word(mb_arry_byte[7], mb_arry_byte[8]);
        mb_radon_live_word_1 = word(mb_arry_byte[9], mb_arry_byte[10]);
        mb_radon_24h_32bit = mb_radon_live_word_0 + mb_radon_live_word_1;
        
        val8 = mb_radon_live_word_1;
        
        
        

        rval4 = mb_radon_24h_32bit;
        //Serial.println("Radon Ist Long: " + String(mb_radon_live_word_0) + " " + String(mb_radon_live_word_1));
        //Serial.println("Radon Ist Long: " + String(mb_arry_byte[3]) + " " + String(mb_arry_byte[4]) + " " + String(mb_arry_byte[5]) + " " + String(mb_arry_byte[6]) + "  : "  + String(mb_radon_live_32bit));
        #ifdef MBDebug
        Serial.println("Radon 24h [32bit]: " + String(mb_radon_24h_32bit));
        #endif

        mb_radon_live_word_0 = word(mb_arry_byte[11], mb_arry_byte[12]);
        mb_radon_live_word_1 = word(mb_arry_byte[13], mb_arry_byte[14]);
        mb_radon_long_32bit = mb_radon_live_word_0 + mb_radon_live_word_1;


        rval5 = mb_radon_long_32bit;
        mb_radon_long = mb_radon_long_32bit;
        if(mb_radon_long_32bit > 65535){
          mb_radon_int = 65535; 
          val9 = 65535;
        }else{
          mb_radon_int = mb_radon_live_word_1;
          val9 = mb_radon_live_word_1;
        }

        //Serial.println("Radon Ist Long: " + String(mb_radon_live_word_0) + " " + String(mb_radon_live_word_1));
        //Serial.println("Radon Ist Long: " + String(mb_arry_byte[3]) + " " + String(mb_arry_byte[4]) + " " + String(mb_arry_byte[5]) + " " + String(mb_arry_byte[6]) + "  : "  + String(mb_radon_live_32bit));
        #ifdef MBDebug
          Serial.println("Radon long [32bit]: " + String(mb_radon_long_32bit));
        #endif


        mb_radon_F3_eintrarge = word(mb_arry_byte[15], mb_arry_byte[16]);
      
        rval6 = mb_radon_F3_eintrarge;
        mb_radon_eintrarge = mb_radon_F3_eintrarge;

        val10 = mb_radon_eintrarge;

            //Serial.println("Einträge: " + String(mb_arry_byte[13]) + " " + String(mb_arry_byte[14]) + "  : "  + String(mb_radon_F3_eintrarge));
        #ifdef MBDebug
          Serial.println("Einträge: " + String(mb_radon_F3_eintrarge));
        #endif


          //***********************************
            gLEDColorUpdateFlag = true;  
            gledUpdateFlag = true;

            gSensordRadonFlag = true;  // Haupt bit für 15min abfrage
            //Serial.println("a gSensordRadonFlag: " + String(gSensordRadonFlag));
          //***********************************    


      
          #ifndef mit_Mesh
            gWerte3UpdateFlag = 3;
          #endif

          #ifndef mit_CO2
            gWerte2UpdateFlag = 3;
          #endif
          
          //        radon                     co2                      mesh      
            if (gWerte1UpdateFlag == 3 && gWerte2UpdateFlag == 3 && gWerte3UpdateFlag == 3){
              

              if (minUpdateFlag == true){
              
                minUpdateFlag = false;
                //MQTTFailUpdateFlag = true;
                gcloudUpdateFlag = true; 
                gGRAPHUpdateFlag = true; 
                gSensorLogFlag = true;


                gMQTTUpdateFlag = true;


                  

              }


            }

            gGRAPHReadFlag = true;

            val_sensor_aktual = 11;


            #ifdef MBDebug
            Serial.println("-->  Sensor Daten aktualisiert");  
            #endif 
            mb_werteaktual = "<span class='Stil5'>Sensor Daten aktuell</div>";
            p_uhrzeit_last = p_time;


      }
    }


  }
 //***********************************************************************************



  //******************************************************************************
  //                         Modbus  handleError                                 *
  //******************************************************************************
  // Define an onError handler function to receive error responses
  // Arguments are the error code returned and a user-supplied token to identify the causing request
  #ifndef MB_Gateway
   
    void handleError(Error error, uint32_t token) 
    {
      // ModbusError wraps the error code and provides a readable error message for it
      ModbusError me(error);
      LOG_E("Error response: %02X - %s\n", (int)me, (const char *)me);
    }
    
  #endif  
  //*************************************************************************************



#ifdef __cplusplus
extern "C" {
#endif
uint8_t temprature_sens_read();
#ifdef __cplusplus
}
#endif
uint8_t temprature_sens_read();






//callback notifying us of the need to save config
void saveConfigCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager saveConfigCallback");
  #endif
  shouldSaveConfig = true;
}

void setConfigResetCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager setConfigResetCallback");
  #endif


  shouldSaveConfig = true;
}



void setAPCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager setAPCallback");
  #endif

}


void setSaveParamsCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager setSaveParamsCallback");
  #endif

}


void setWebServerCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager setWebServerCallback");
  #endif

}


void setSaveConfigCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager setSaveConfigCallback");
  #endif

}


void WebServerCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager WebServerCallback");
  // wenn im Handy eingeloggt wurde
  #endif

 //  WIFImanager WebServerCallback          ee_wifires
            Preferences preferences;
            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

            ee_wifires = 0;
            preferences.putUInt("ee_wifires", ee_wifires);                  //Variable counter unter "Datei"  speichern

            preferences.end();                                      //Preferences beenden
      
        #ifdef NVS_DEBUG
        Serial.printf("Save Boot Anzahl für Reset WLAN: %u\n", ee_wifires);          //Variable counter Seriell ausgeben
        #endif


     
      if(gCONNECTEDflag == 0){

          long Farbe;
          // #ifndef WIFI_nur_LED
            //Farbe = strip1.Color(255, 102, 0); //orange
            //Farbe = strip1.Color(255, 255, 255);
          //#else
          // Farbe = strip1.Color(255, 255, 255); //weiss
          //#endif
    
          if (zustandVersion == 1){     //1 = Normal Version    
            //Farbe = strip1.Color(255, 102, 0); //orange
            Farbe = strip1.Color(255, 255, 255);           
          } else{          
              Farbe = strip1.Color(255, 255, 255); //weiss
          }

          strip1.fill(Farbe, 0, 80);  //helligkeit
          strip1.show(); 

      }


        if (zustandVersion == 1){     //1 = Normal Version 
          Serial.println("    Init --> Start AP Mode");
        //} else{
          //Serial.println("    Init --> Start LED");    //     INIT--> 
          abbruch_portal = true;
        }

        currentMillis = millis();


}



void ConfigResetCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager ConfigResetCallback");
  #endif

            Preferences preferences;
            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

            
            //#ifndef WIFI_nur_LED
            //   ee_portalTimeout = 310; 
            //#else
           //   ee_portalTimeout = 60; 
            //#endif
            if (zustandVersion == 1){     //1 = Normal Version 
                            
              ee_portalTimeout = 620; 
                            
            } else{
                            
              ee_portalTimeout = 1; //60

            }
                                                  
            #ifdef WIFI_DEBUG
            Serial.printf("Portal Timeout: %u\n", ee_portalTimeout);          //Variable counter Seriell ausgeben
            #endif
            preferences.putUInt("ePortalTime", ee_portalTimeout);                  //Variable counter unter "Datei" ee_portalTimeout speichern 
            
            preferences.putString("p_ipchange", "0");                     //Variable speichern

            ee_ip_search = 1;
            preferences.putUInt("ee_ipsearch", ee_ip_search);                  //Variable unter "Datei" ee_ipsearch speichern 

            gCONNECTEDflag = 0;
            preferences.putUInt("gCONNflag", gCONNECTEDflag);                  //Variable  speichern 

            preferences.putString("p_staticip", "");                    //Variable speichern
            preferences.putString("p_subnetmask", "");                  //Variable speichern
            preferences.putString("p_gateway", "");                     //Variable speichern
            preferences.putString("p_wifidns", "");                     //Variable speichern
            preferences.putString("p_ipchange", "0");                     //Variable speichern

            preferences.end();                                      //Preferences beenden
            #ifdef BLE_WIFI_disable
              Serial.println("WIFI resetSettings");
              WiFiManager wifiManager;
              //wifiManager.WiFi_eraseConfig();
                IPAddress _ip,_gw,_sn,_dns1,_dns2;
                _ip.fromString("");
                _gw.fromString("");
                _sn.fromString("");
                _dns1.fromString("");
                _dns2.fromString("");
                wifiManager.setSTAStaticIPConfig(_ip, _gw, _sn , _dns1);
                //wifiManager.setSTAStaticIPConfig(IPAddress(), IPAddress(), IPAddress(), IPAddress());
              wifiManager.erase(true);
              //delay(200);
              //wifiManager.resetSettings();

            #endif
          #ifdef WIFI_DEBUG
            Serial.println("---->>> WIFImanager setConfigResetCallback reboot");
          #endif
            delay(500);
            ESP.restart(); 


}

void SaveParamsCallback () {
  #ifdef WIFI_DEBUG
  Serial.println("---->>> WIFImanager SaveParamsCallback");
  #endif
  // WLAN gespeichert
  //WriteipValuechange();
}



void PreSaveConfigCallback () {
  Serial.println("---->>> WIFImanager PreSaveConfigCallback");
}



#ifdef BLE_WIFI_disable
void configModeCallback (WiFiManager *myWiFiManager) {
  #ifdef WIFI_DEBUG
  Serial.println("--------->>> WIFImanager Entered config mode");

  //if you used auto generated SSID, print it
  // wenn im AP Modus 
  //Serial.println(myWiFiManager->getConfigPortalSSID());
  #endif


    if(gCONNECTEDflag == 0){
      //aus
      long Farbe;
      Farbe = strip1.Color(0, 0, 0);
      strip1.fill(Farbe, 0, 255);
      strip1.show(); 
      delay(500);
    }

}
#endif


  //******************************************************************************
  //                        Schreiben ins  EEPROM                                *
  //****************************************************************************** 
    void WritePW()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

   
      //int length = p_inputpwchange.length();
      //Serial.println(length);

        if(p_inputpwchange.length() <=15 ){
          if (p_inputpwchange != "          "){
            if (p_inputpwchange != ""){
              p_inputpasswort_vorgabe = p_inputpwchange; //PW temporär lesen
              p_inputpasswort_vorgabe.toCharArray(p_inputpasswort_vorgabec, PW_VORG_LEN);

              preferences.putString("p_inputpwchange", p_inputpwchange);                     //aktuelles PW
            // #ifdef NVS_DEBUG
                //Serial.println("PW gesppeichert und geändert: " + p_inputpasswort_vorgabe);
                Serial.println("PW gespeichert und geändert. ");
            // #endif
            
             g_restart_pw_change = true;
             g_restart_pw_change_t = 3;

            }
          }
        }
        p_inputpwchange = ""; // leeren das im Web nichts drinsteht


    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write PW Value __");
     #endif

  }
  
  void WriteSensorValue()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

   
    preferences.putString("p_gateway", p_inputgateway);                     //Variable speichern
    preferences.putString("p_baudrate", p_inputbaudrate);                    //Variable speichern
    preferences.putString("p_databits", p_inputdatabits);                    //Variable speichern
    preferences.putString("p_parity", p_inputparity);                      //Variable speichernWebServerCallback
    preferences.putString("p_stopbit", p_inputstopbit);                     //Variable speichern
    preferences.putString("p_restimeout", p_inputrestimeout);                  //Variable speichern

    p_inputtcpport.toCharArray(p_inputtcpportc, 4); 
    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write div. Value __");
     #endif

  }

  void WriteWebValue()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
  

    preferences.putString("p_tcpport", p_inputtcpport);                     //Variable speichern
    preferences.putString("p_webport", p_inputwebport);                     //Variable speichern


    p_inputtcpport.toCharArray(p_inputtcpportc, 4); 

    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write div. Value __");
     #endif

  }


  //--------------------
  void WriteMqttValue()
  {

    client.disconnect();


    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden


    preferences.putString("p_mqclie", p_inputmqclient);                         //Variable speichern
    preferences.putString("p_mqserv", p_inputmqserver);                         //Variable speichern
    preferences.putString("p_mqoption", p_inputmqoptions);        //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
    
    if(p_inputmqoptions == "0"){
      p_inputmqmesh = "0";
    }
    if(p_inputmqmesh == "1" || p_inputmqmesh == ""){
      p_inputmqmesh = "0";
    }


    preferences.putString("p_mqmesh", p_inputmqmesh);        //0 = aus    1-10 = Anzahl
  
    preferences.putString("p_mqport", p_inputmqport);                         //Variable speichern
    preferences.putString("p_mquser", p_inputmquser);                         //Variable speichern
    preferences.putString("p_mqpass", p_inputmqpass);                         //Variable speichern
    preferences.putString("p_mqtopic", p_inputmqtopic);                         //Variable speichern
    preferences.putString("p_mqtopic1", p_inputmqtopic1);                         //Variable speichern
    preferences.putString("p_mqtopic2", p_inputmqtopic2);                         //Variable speichern
   
    divstatus2 = divgrau;   // Status
    p_inputmqmeshi = atoi(p_inputmqmesh.c_str()); 


        if(p_inputmqmeshi == 0){
           g_mb_mesh = false; 
        }else{
           g_mb_mesh = true; 
        }


    p_sett16 = p_sett16t;   
    if(p_sett16 == 1){  //ON OFF   MQTT on/off Setting   
      p_mqonoff = "on";
    }else{
      p_mqonoff = "off";
    }
    //Serial.println("p_mqonoff " + p_mqonoff);
    //Serial.println("p_sett16 " + String(p_sett16));
    preferences.putString("p_mqon", p_mqonoff);                         //Variable speichern
    preferences.putUInt("p_sett16", p_sett16);                         //Variable speichern   MQTT on/off Setting   

                    if (p_mqonoff == "on") mqttdAktiveConfig = true;
                    if (p_mqonoff == "off") mqttdAktiveConfig = false;
                    if(mqttdAktiveConfig == true) {
                      mQtt_aktiv = " class='Stil1a' ";
                      mq_werteaktual = "<span class='Stil5'>MQTT aktiviert</div>";
                      mQtt_aktiv = " class='Stil1c' ";//grau
                    }
                    if(mqttdAktiveConfig == false) {
                      mQtt_aktiv = " class='Stil1b' ";
                      mq_werteaktual = "MQTT deaktiviert";
                      mQtt_aktiv = " class='Stil1c' ";//grau
                    }



    gMQTTUpdateFlag = true;

    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write Mqtt. Value __");
     #endif
    


  }
  //--------------------





  //--------------------
  void WriteMqttToken()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

    gACCESS_TOKENFlag = 1;  // provision fertig

    preferences.putString("p_mquser", p_inputmquser);                         //Variable speichern
    preferences.putUInt("p_token", gACCESS_TOKENFlag);                         //provision Variable speichern
    preferences.putString("p_device_id", device_id_s);                         //provision Variable speichern



    //preferences.end();                                      //Preferences beenden
     //#ifdef NVS_DEBUG
     //Serial.println(" ");
     //Serial.println("__ Write WriteMqttToken. Value __");
        #ifdef MQTT_DEBUG_min
           Serial.println(p_time + " | Token Saved | " + p_inputmquser);
        #endif
    
     //#endif

  }
  //--------------------




  //--------------------
  void WriteMqttReset()
  {

    client.disconnect();

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden


    preferences.putString("p_mquser", p_inputmquser);                         //Variable speichern
    gACCESS_TOKENFlag = 0;// provision fertig
    preferences.putUInt("p_token", gACCESS_TOKENFlag);                         //provision Variable speichern
    preferences.putString("p_device_id", device_id_s);                         //provision Variable speichern

    preferences.putString("p_mquser", p_inputmquser);                         //Variable speichern



    preferences.putString("p_mqon", p_mqonoff);                         //Variable speichern
    preferences.putString("p_mqclie", p_inputmqclient);                         //Variable speichern
    preferences.putString("p_mqserv", p_inputmqserver);                         //Variable speichern
    preferences.putString("p_mqoption", p_inputmqoptions);              //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
    p_inputmqmesh = "0";
    preferences.putString("p_mqmesh", p_inputmqmesh);        //0 = aus    1-10 = Anzahl
    p_inputmqmeshi = atoi(p_inputmqmesh.c_str()); 

        if(p_inputmqmeshi == 0){
           g_mb_mesh = false; 
        }else{
           g_mb_mesh = true; 
        }

    preferences.putString("p_mqport", p_inputmqport);                         //Variable speichern
    preferences.putString("p_mquser", p_inputmquser);                         //Variable speichern
    preferences.putString("p_mqpass", p_inputmqpass);                         //Variable speichern
    preferences.putString("p_mqtopic", p_inputmqtopic);                         //Variable speichern
    preferences.putString("p_mqtopic1", p_inputmqtopic1);                         //Variable speichern
    preferences.putString("p_mqtopic2", p_inputmqtopic2);                         //Variable speichern

    preferences.putUInt("p_sett16", p_sett16);                         //Variable speichern    MQTT on/off Setting   




    //preferences.end();                                      //Preferences beenden
     //#ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write Mqtt. Value __");
    // #endif

  }
  //--------------------











  //--------------------
  void WriteCloudValue()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden



    preferences.putString("p_clserv", p_inputcloudserver);                         //Variable speichern
    preferences.putString("p_cluser", p_inputclouduser);                         //Variable speichern
    preferences.putString("p_cldevice", p_inputclouddevice);                         //Variable speichern
    preferences.putString("p_clpage", p_inputcloudpage);                         //Variable speichern
    preferences.putString("p_clpre", p_inputcloudpre);                         //Variable speichern
    preferences.putString("p_clchain", p_inputcloudchain);                         //Variable speichern
    preferences.putString("p_clport", p_inputcloudport);                         //Variable speichern
    preferences.putString("p_clkey", p_inputcloudkey);                         //Variable speichern
    preferences.putString("p_clinter", p_inputcloudinter);                         //Variable speichern
    p_inputcloudinteri = p_inputcloudinter.toInt(); 
    p_inputcloudporti = p_inputcloudport.toInt(); 
   
//Serial.println(p_inputcloudserver);
//Serial.println(p_inputcloudpage);
//Serial.println(p_inputcloudinteri);
             
    p_inputcloudserver.toCharArray(p_inputcloudserverc, CLOUD_SERVER_LEN);
     p_inputcloudpage.toCharArray(p_inputcloudpagec, DB_PAGE_LEN);

     p_inputcloudpre.toCharArray(p_inputcloudprec, DB_PRE_LEN);

     p_inputcloudport.toCharArray(p_inputcloudportc, DB_PORT_LEN);
     p_inputcloudchain.toCharArray(p_inputcloudchainc, DB_CHAIN_LEN);


    p_sett22 = p_sett22t;  
    preferences.putUInt("p_sett22", p_sett22);                         //Variable speichern
    
    p_sett18 = p_sett18t;
    preferences.putUInt("p_sett18", p_sett18);                         //Variable speichern    Cloud on/off Setting   
       
    if(p_sett18 == 1){  //ON OFF   Cloud on/off Setting   
      p_cloudonoff = "on";
      cloudAktiveConfig = true;
    }else{
      p_cloudonoff = "off";
      cloudAktiveConfig = false;
    }
    preferences.putString("p_clon", p_cloudonoff);                         //Variable speichern


                    if(cloudAktiveConfig == true){
                       cloud_aktiv = " class='Stil1c' ";
                       cloud_werteaktual = "<span class='Stil5'>CLOUD aktiviert</div>";
                    }
                    if(cloudAktiveConfig == false){
                       cloud_aktiv = " class='Stil1b' ";
                       cloud_werteaktual = "CLOUD deaktiviert";
                    }


    divstatus1 = divgrau;   // Status

    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write Cloud. Value __");
     #endif

  }
  //--------------------



  //--------------------
  void WriteSettingValue() 
  {
    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

   
    p_sett01 = p_sett01t;
    p_sett02 = p_sett02t;
    p_sett03 = p_sett03t;
    p_sett04 = p_sett04t;
    p_sett05 = p_sett05t;
    p_sett06 = p_sett06t;
    p_sett07 = p_sett07t;
    p_sett08 = p_sett08t;
    p_sett09 = p_sett09t;
    p_sett10 = p_sett10t;
    p_sett11 = p_sett11t;  
    p_sett13 = p_sett13t;  
    p_sett14 = p_sett14t;  

    p_sett19 = p_sett19t; 


      
 

    preferences.putUInt("p_sett01", p_sett01);                         //Variable speichern
    preferences.putUInt("p_sett02", p_sett02);                         //Variable speichern
    preferences.putUInt("p_sett03", p_sett03);                         //Variable speichern
    preferences.putUInt("p_sett04", p_sett04);                         //Variable speichern
    preferences.putUInt("p_sett05", p_sett05);                         //Variable speichern
    preferences.putUInt("p_sett06", p_sett06);                         //Variable speichern
    preferences.putUInt("p_sett07", p_sett07);                         //Variable speichern
    preferences.putUInt("p_sett08", p_sett08);                         //Variable speichern
    preferences.putUInt("p_sett09", p_sett09);                         //Variable speichern
    preferences.putUInt("p_sett10", p_sett10);                         //Variable speichern
    preferences.putUInt("p_sett11", p_sett11);                         //Variable speichern
    preferences.putUInt("p_sett13", p_sett13);                         //Variable speichern
    preferences.putUInt("p_sett14", p_sett14);                         //Variable speichern

    preferences.putUInt("p_sett19", p_sett19);                         //Variable speichern
   


    //Serial.println("10: " + String(p_sett10));
   // Serial.println("11: " + String(p_sett11));
    //Serial.println("13: " + String(p_sett13));
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write Setting. Value __");
     #endif   

  }
 //-----------------------------------------------------



// inputchart  changeFanValue()   p_fansavebit_txt = "<span class='Stil6'>FAN offline!</div>"
//-----------------------------------------------------
  void changeFanValue(){
        
      //  p_fansavebit = "savebit";
      // p_fansavebit_txt = "<span class='Stil6'>Sensor connect failed!</div>";
        
        //Serial.println("----p_sett20: "+ String(p_sett20));
        //Serial.println("----g_CRC_ok: "+ String(g_CRC_ok));
        //Serial.println("----g_crc_counter: "+ String(g_crc_counter));



          if(p_sett20 == 1){  //not Mesh
              
                p_sett20_s = p_sett20_1;
              
                //p_fansavebit = "savebit"; 
                //p_fansavebit_txt = "<span class='Stil6'> </div>";
              
                if (sensor_mb_ok == 1){
                  f_Rsource = "Radon source this Sensor";
                  divstatus7 = divgreen;  // Status
                  p_fansavebit = "savebit_green"; 
                  p_fansavebit_txt = "<span class='Stil6'> </div>";
                }else{
                  f_Rsource = "Sensor not ready!";  
                  p_fansavebit = "savebit_red"; 
                  p_fansavebit_txt = "<span class='Stil6'> </div>";
                  divstatus7 = divred;  // Status
                }
                fval1 = mb_radon_ist_word;



              if (g_CRC_ok == false && g_crc_counter >= 15){

                  p_sett20_s = p_sett20_1;
                  if (sensor_mb_ok == 1){
                    f_Rsource = "Radon source this Sensor";
                  }else{
                    f_Rsource = "Sensor not ready!";  
                  }

                  fval1 = 0; 
                  p_fansavebit = "savebit_red"; 
                  p_fansavebit_txt = "<span class='Stil6'>FAN offline!</div>";
                  divstatus7 = divred;  // Status

              }

          }else{
           
            if (b_set_mesh_read == true){ // Mesh gelesen
              
                if (b_set_mesh_on != true){ // Mesh nicht aktiv dann wieder auf diesen Sensor schreiben
                

                      if (g_CRC_ok == false && g_crc_counter >= 15){

                          p_sett20_s = p_sett20_1;
                          if (sensor_mb_ok == 1){
                            f_Rsource = "Radon source this Sensor";
                          }else{
                            f_Rsource = "Sensor not ready!";  
                          }
                          fval1 = 0; 
                          p_fansavebit = "savebit_red"; 
                          p_fansavebit_txt = "<span class='Stil6'>FAN offline!</div>";
                          divstatus7 = divred;  // Status

                      }else{

                          p_sett20 = 1;
                          p_sett20t = 1;
                          p_sett20_s = p_sett20_1;
                          if (sensor_mb_ok == 1){
                            f_Rsource = "Radon source this Sensor";
                            p_fansavebit = "savebit_green"; 
                            p_fansavebit_txt = "<span class='Stil6'> </div>";
                          }else{
                            f_Rsource = "Sensor not ready!"; 
                            divstatus7 = divred;  // Status 
                            p_fansavebit = "savebit_red"; 
                            p_fansavebit_txt = "<span class='Stil6'> </div>";
                          }
                          fval1 = mb_radon_ist_word;
                          b_fan_Notmesh = true;
                        

                    }

                }else{

                  if (g_CRC_ok == false && g_crc_counter >= 15){

                          p_sett20_s = p_sett20_0;
                          f_Rsource = "Radon source Mesh Sensor";
                          fval1 = 0; 
                          p_fansavebit = "savebit_red"; 
                          p_fansavebit_txt = "<span class='Stil6'>FAN offline!</div>";
                          divstatus7 = divred;  // Status

                  }else{
                      
                      //----- Auswertung online offline
                      if(b_set_mesh_online == true){
                          p_sett20_s = p_sett20_0;
                          f_Rsource = "Radon source Mesh Sensor";
                          fval1 = r1_val3.toInt(); 
                          
                          p_fansavebit = "savebit_green"; 
                          //p_fansavebit_txt = "<span class='Stil6'>Mesh Sensor online</div>";
                          p_fansavebit_txt = "<span class='Stil6'> </div>";

                          p_mesh_IP_resault = "<span class='Stil9'>    " + p_inputip01 + "</div>";   //blau

                      }else{
                          p_sett20_s = p_sett20_0;
                          f_Rsource = "Radon source Mesh Sensor";
                          fval1 = 0; 
                          
                          p_fansavebit = "savebit_red"; 
                          p_fansavebit_txt = "<span class='Stil6'>Mesh Sensor offline!</div>";
                          p_mesh_IP_resault = "<span class='Stil6'>    " + p_inputip01 + "</div>";   //rot
                      }
                      //---------------------

                  }

                }
            
            }else{

              p_sett20_s = p_sett20_0;
              f_Rsource = "waiting for Mesh Sensor...";
              fval1 = 0; 

            
            }

          }



  }
//-----------------------------------------------------





  //--------------------
  void changesetValue()
  { 

  //Serial.println("changesetValue");

  



  
          if(p_sett01 == 1){
            div_c01 = divonc01;
            p_sett01_s = p_sett01_1;
            //Serial.println("1 = 1");
            //Serial.println(div_c01);
            //Serial.println(p_sett01_s);
          }else{
            div_c01 = divonc01h;
            p_sett01_s = p_sett01_0;
            //Serial.println("1 = 0");
            //Serial.println(div_c01);
            //Serial.println(p_sett01_s);
          }
          if(p_sett02 == 1){         // IP Setting
            if(web_write_ok == 1){ 
              div_c02 = divonc02;
            }else{
              div_c02 = divonc02h; 
            }
            p_sett02_s = p_sett02_1;
            //Serial.println("2 = 1");
            //Serial.println(div_c02);
            //Serial.println(p_sett02_s);
          }else{
            div_c02 = divonc02h;
            p_sett02_s = p_sett02_0;
            //Serial.println("2 = 0");
            //Serial.println(div_c02);
            //Serial.println(p_sett02_s);
          }
          if(p_sett03 == 1){          // TCP Setting
            if(web_write_ok == 1){ 
              div_c03 = divonc03;
            }else{
              div_c03 = divonc03h; 
            }
            p_sett03_s = p_sett03_1;
          }else{
            div_c03 = divonc03h;
            p_sett03_s = p_sett03_0;  
          }    
          if(p_sett04 == 1){
            if(web_write_ok == 1){ 
              div_c04 = divonc04;
            }else{
              div_c04 = divonc04h; 
            }
            p_sett04_s = p_sett04_1;
            //Serial.println("4 = 1");
            //Serial.println(div_c04);
            //Serial.println(p_sett04_s);
          }else{
            div_c04 = divonc04h;
            p_sett04_s = p_sett04_0;
            //Serial.println("4 = 0");
            //Serial.println(div_c04);
            //Serial.println(p_sett04_s);
          }
          if(p_sett05 == 1){
            div_c05 = divonc05;
            p_sett05_s = p_sett05_1;
            //Serial.println("5 = 1");
            //Serial.println(div_c05);
            //Serial.println(p_sett05_s);
          }else{
            div_c05 = divonc05h;
            p_sett05_s = p_sett05_0;
            //Serial.println("5 = 0");
            //Serial.println(div_c05);
            //Serial.println(p_sett05_s);
          }
          if(p_sett06 == 1){
            if(web_write_ok == 1){ 
              div_c06 = divonc06;
            }else{
              div_c06 = divonc06h; 
            }
            p_sett06_s = p_sett06_1;
            //Serial.println("6 = 1");
            //Serial.println(div_c06);
            //Serial.println(p_sett06_s);
          }else{
            div_c06 = divonc06h;
            p_sett06_s = p_sett06_0;
            //Serial.println("6 = 0");
            //Serial.println(div_c06);
            //Serial.println(p_sett06_s);
          }
          if(p_sett07 == 1){
            if(web_write_ok == 1){ 
              div_c07 = divonc07;
            }else{
              div_c07 = divonc07h; 
            }
            p_sett07_s = p_sett07_1;
            //Serial.println("7 = 1");
            //Serial.println(div_c07);
            //Serial.println(p_sett07_s);
          }else{
            div_c07 = divonc07h;
            p_sett07_s = p_sett07_0;
            //Serial.println("7 = 0");
            //Serial.println(div_c07);
            //Serial.println(p_sett07_s);
          }
          if(p_sett08 == 1){
            if(web_write_ok == 1){ 
              div_c08 = divonc08;
            }else{
              div_c08 = divonc08h; 
            }
            p_sett08_s = p_sett08_1;
            //Serial.println("8 = 1");
            //Serial.println(div_c08);
            //Serial.println(p_sett08_s);
          }else{
            div_c08 = divonc08h;
            p_sett08_s = p_sett08_0;
            //Serial.println("8 = 0");
            //Serial.println(div_c08);
            //Serial.println(p_sett08_s);
          }
          if(p_sett09 == 1){
            if(web_write_ok == 1){ 
              div_c09 = divonc09;
            }else{
              div_c09 = divonc09h; 
            }
            p_sett09_s = p_sett09_1;

          }else{
            div_c09 = divonc09h;
            p_sett09_s = p_sett09_0;

          }
        #ifdef old_option
          if(p_sett10 == 1){
            if(web_write_ok == 1){ 
              div_c10 = divonc10;
            }else{
              div_c10 = divonc10h; 
            }
            p_sett10_s = p_sett10_1;
            //Serial.println("10 = 1");
            //Serial.println(div_c10);
            //Serial.println(p_sett10_s);
          }else{
            div_c10 = divonc10h;
            p_sett10_s = p_sett10_0;
            //Serial.println("10 = 0");
            //Serial.println(div_c10);
            //Serial.println(p_sett10_s);
          }

          if(p_sett11 == 1){
            if(web_write_ok == 1){ 
              div_c11 = divonc11;
            }else{
              div_c11 = divonc11h; 
            }
            p_sett11_s = p_sett11_1;
          }else{
            div_c11 = divonc11h;
            p_sett11_s = p_sett11_0;
          }
        
          
          if(p_sett13 == 1){
            if(web_write_ok == 1){ 
              div_c13 = divonc13;
            }else{
              div_c13 = divonc13h; 
            }
            p_sett13_s = p_sett13_1;
          }else{
            div_c13 = divonc13h;
            p_sett13_s = p_sett13_0;
          }

          #endif

          if(p_sett14 == 1){
            if(web_write_ok == 1){ 
              div_c14 = divonc14;
            }else{
              div_c14 = divonc14h; 
            }
            p_sett14_s = p_sett14_1;

          }else{
            div_c14 = divonc14h;
            p_sett14_s = p_sett14_0;

          }

          if(p_sett19 == 1){  //Setting
            if(web_write_ok == 1){ 
              div_c19 = divonc19;
            }else{
              div_c19 = divonc19h; 
            }
            p_sett19_s = p_sett19_1;
            //Serial.println("sett19 = 1");
            ///Serial.println(div_c19);
            //Serial.println(p_sett19_s);

          }else{
            div_c19 = divonc19h;
            p_sett19_s = p_sett19_0;
            //Serial.println("sett19 = 0");
            //Serial.println(div_c19);
            //Serial.println(p_sett19_s);
          }



           
            if(web_write_ok == 1){ 
              if( p_inputpasswort == p_inputpasswort_admin){ 
                  // eingeloggt als admin
                  divGateway_hid1_5 = divGateway_hid_5;  //Portal einblenden 
              }else{
                  // eingeloggt als user
                  div_c12 = divonc12;
              }
            }else{
              // ausgeloggt
              div_c12 = divonc12h;   
              divGateway_hid1_5 = divGateway_hid0_5;  //Portal ausblenden 

            }


  }
 //--------------------------------------





//--------------------
  void Writeao1Value()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
   


    preferences.putString("p_ao1og", p_inputao1og);                         //Variable speichern
    preferences.putString("p_ao1ug", p_inputao1ug);                         //Variable speichern
    preferences.putString("p_ao1option", p_inputao1option);                         //Variable speichern
    preferences.putString("p_ao1korrektur", p_inputao1korrektur);                         //Variable speichern
    preferences.putString("p_ao1korrektur2", p_inputao1korrektur2);                         //Variable speichern
    preferences.putString("p_ao1namur", p_inputao1namur);                         //Variable speichern

    p_sett29 = p_sett29t;   
    if(p_sett29 == 1){  //ON OFF 
      p_ao1onoff = "on";
    }else{
      p_ao1onoff = "off";
    }
    //Serial.println("_Write: " + p_ao1onoff);

    preferences.putString("p_ao1on", p_ao1onoff);                         //Variable speichern
    preferences.putUInt("p_sett29", p_sett29);                         //Variable speichern

     ao1OGVal = atoi(p_inputao1og.c_str());
     ao1UGVal = atoi(p_inputao1ug.c_str());
     ao1OptionVal = atoi(p_inputao1option.c_str());
     ao1KorrekturVal = atoi(p_inputao1korrektur.c_str());
     ao1Korrektur2Val = atoi(p_inputao1korrektur2.c_str());
     ao1namurVal = atoi(p_inputao1namur.c_str());

     if(ao1OptionVal > 2){
      ao1OptionVal = 2;
     }
     if(ao1namurVal > 2){
      ao1namurVal = 2;
     }




                    if (p_ao1onoff == "on") ao1AktiveConfig = true;
                    if (p_ao1onoff == "off") ao1AktiveConfig = false;
                    if(ao1AktiveConfig == true){
                       ao1_aktiv = " class='Stil1a' ";
                       if(ao1OptionVal==0){
                         ao1_werteaktual = "<span class='Stil5'>4-20mA aktiviert</div>";
                        }
                        if(ao1OptionVal==1){
                         ao1_werteaktual = "<span class='Stil5'>3,8-20,5mA aktiviert</div>";
                       }
                        if(ao1OptionVal==2){
                         ao1_werteaktual = "<span class='Stil5'>0-20mA aktiviert</div>";
                       }
                    }
                    if(ao1AktiveConfig == false){
                       ao1_aktiv = " class='Stil1c' ";
                       ao1_werteaktual = "AO1 deaktiviert";
                    }


    

        
          int akorrval2 = 0;
          if(ao1KorrekturVal < 0){
            akorrval2 = abs(ao1KorrekturVal);

              calc_down2_f = calc_down - akorrval2;
              if(calc_down2_f < 0){calc_down2_f = 0;} //nicht unter 0
              calc_down2 = abs(calc_down2_f);
                         
          }else{
            calc_down2 = calc_down + akorrval2;
          }
         

          if(ao1Korrektur2Val < 0){
            akorrval2 = abs(ao1Korrektur2Val);

              calc_top2 = calc_top - akorrval2;
              if(calc_top2 <= calc_down2){calc_top2 = calc_down2 + 1;}

          }else{
            calc_top2 = calc_top + akorrval2;
          }

         
        #ifdef PCB_v_7  
          #ifdef v_4_20_mA_4 
            module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
            module.calibration4_20mA(/*dac_4 =*/calc_down2, /*dac_20 =*/calc_top2);
            module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
            uint16_t dac1 = module.output(/*current_mA =*/ao1_outmA); 
            Serial.print("calibration4-20mA -> DAC1 value: "); Serial.println(dac1);
          #endif
        #endif


     gao1UpdateFlag = true;




    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write ao1. Value __");
     #endif

  }
  //--------------------






  //--------------------
  void WriteTimeValue()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
    preferences.putULong64("epochTime", epochTime_start);                         //Variable speichern
    p_timeon = 1;
    preferences.putInt("p_timeon", p_timeon);                         //Variable speichern

     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write Time. Value __");
     #endif

  }

  //--------------------
  void WriteLedValue()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

    


    preferences.putString("p_ledred", p_inputledred);                         //Variable speichern
    preferences.putString("p_ledorange", p_inputledorange);                         //Variable speichern
    preferences.putString("p_ledgreen", p_inputledgreen);                         //Variable speichern
    preferences.putString("p_ledfunk", p_inputledfunk);                         //Variable speichern
    preferences.putString("p_ledtime", p_inputledgamma);                         //Variable speichern


    p_sett21 = p_sett21t;  
    preferences.putUInt("p_sett21", p_sett21);                         //Variable speichern


    p_sett17 = p_sett17t;   
    if(p_sett17 == 1){  //ON OFF 
      p_ledonoff = "on";
    }else{
      p_ledonoff = "off";
    }
    preferences.putString("p_ledon", p_ledonoff);                         //Variable speichern
    preferences.putUInt("p_sett17", p_sett17);                         //Variable speichern

   // Serial.println("__ Write LED. Value __p_ledonoff: " + p_ledonoff);
    //Serial.println("__ Write LED. Value __p_sett17: " + String(p_sett17));


                    if (p_ledonoff == "on") ledAktiveConfig = true;
                    if (p_ledonoff == "off") ledAktiveConfig = false;
                    if(ledAktiveConfig == true){
                       lEd_aktiv = " class='Stil1a' ";
                       led_werteaktual = "<span class='Stil5'>LED aktiviert</div>";

                    }
                    if(ledAktiveConfig == false){
                       lEd_aktiv = " class='Stil1c' ";
                       led_werteaktual = "LED deaktiviert";
                    }


    
     ledRedVal = atoi(p_inputledred.c_str());
     ledOrangeVal = atoi(p_inputledorange.c_str());
     ledGreenVal = atoi(p_inputledgreen.c_str());
     ledgammaVal = atoi(p_inputledgamma.c_str());
     
        if(ledgammaVal == 0){
        ledgammaVal = 1;
        p_inputledgamma = "1";
        preferences.putString("p_ledtime", p_inputledgamma);                         //Variable speichern
        }
        if(ledgammaVal > 255){
        ledgammaVal = 255;
        p_inputledgamma = "255";
        preferences.putString("p_ledtime", p_inputledgamma);                         //Variable speichern
        }     

     msLed = millis();
     gledUpdateFlag = true;

    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write LED. Value __");
     #endif

  }
  //--------------------


  //--------------------
  #ifdef vent_option
  void WritevanValue()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden


    preferences.putString("p_vanon", p_vanonoff);                         //Variable speichern
    preferences.putString("p_vanmax", p_inputvanmax);                         //Variable speichern
    preferences.putString("p_vanmin", p_inputvanmin);                         //Variable speichern

    p_sett20 = p_sett20t;  
    preferences.putUInt("p_sett20", p_sett20);                         //Variable speichern
     
     gvanUpdateFlag = true;

    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write VAN. Value __");

    // Serial.println(String(p_sett20));
     #endif

  }
  #endif
  //--------------------


  //--------------------
  // Pushover PushSafer
  void WritePushValue()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden


    preferences.putString("p_pushon", p_pushonoff);                         //Variable speichern
    preferences.putString("p_pushkey", p_pushkey);                         //Variable speichern
    preferences.putString("p_pushmessage", p_pushmessage);                         //Variable speichern
    preferences.putString("p_pushtitle", p_pushtitle);                         //Variable speichern
    preferences.putString("p_sound", p_pushsound);                         //Variable speichern
    preferences.putString("p_vibration", p_pushvibration);                         //Variable speichern
    preferences.putString("p_icon", p_pushicon);                         //Variable speichern
    preferences.putString("p_iconcolor", p_pushiconcolor);                         //Variable speichern
    preferences.putString("p_priority", p_pushpriority);                         //Variable speichern
    preferences.putString("p_pushdevice", p_pushdevice);                         //Variable speichern
    preferences.putString("p_pushvalue", p_pushvalue);                         //Variable speichern 



    //preferences.end();                                      //Preferences beenden
     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println(p_pushmessage);
     Serial.println(preferences.getString("p_pushmessage", "Push Message"));
     Serial.println("__ Write Push. Value __");
     #endif

  }
  //--------------------


  //---------------------------------------------------------------------------
  void Writeip15Value()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

    preferences.putString("p_inputip01", p_inputip01);                    //Variable speichern
    preferences.putString("p_inputip02", p_inputip02);                  //Variable speichern
    preferences.putString("p_inputip03", p_inputip03);                     //Variable speichern
    preferences.putString("p_inputip04", p_inputip04);                      //Variable speichern
    preferences.putString("p_inputip05", p_inputip05);                      //Variable speichern
    //preferences.end();                                      //Preferences beenden
   

          if (p_inputip01 != "000.000.000.000"){ 
            if (p_sett06 != 1){  //view Mesh ausgeschaltet  
                p_mesh_IP_resault = "<span class='Stil5'>    " + p_inputip01 + "</div>";   //grün
            }else{
               if(p_sett20 == 1){  //FAN   1 = dieser Sensor R_Lueferstatus
                 p_mesh_IP_resault = "<span class='Stil5'>    " + p_inputip01 + "</div>";   //grün
               }else{ 
                 p_mesh_IP_resault = "<span class='Stil9'>    " + p_inputip01 + "</div>";   //blau
               }
            }
          }else{
            p_mesh_IP_resault = "";
          }
    


     
    preferences.putString("p_room01", p_room01);                      //Variable speichern
    preferences.putString("p_room02", p_room02);                      //Variable speichern
    preferences.putString("p_room03", p_room03);                      //Variable speichern
    preferences.putString("p_room04", p_room04);                      //Variable speichern
    preferences.putString("p_room05", p_room05);                      //Variable speichern

    p_ipparson = "1";
    preferences.putString("p_ipparson", p_ipparson);                      //Variable speichern

    divstatus3 = divgrau;   // Status

     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write IP Mesh Value __");
     #endif

     ip_write_sel = 0;

  }  





 //-------------------------------------------------------------
  void WritefreshValue()
  {

      //  State_schreib_ID_bit = true;

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

    preferences.putString("p_fresh_ip", p_inputfreship);                    //Variable speichern
    preferences.putString("p_fresh_id", p_inputfreshid);                    //Variable speichern
    preferences.putString("p_fresh_pwd", p_inputfreshpwd);                    //Variable speichern

    p_sett15 = p_sett15t;   
    if(p_sett15 == 1){  //ON OFF Freshbox
      p_freshonoff = "on";
    }else{
      p_freshonoff = "off";
    }
    preferences.putString("p_freshon", p_freshonoff);                         //Variable speichern
    preferences.putUInt("p_sett15", p_sett15);                         //Variable speichern

    
                    if (p_freshonoff == "on") freshdAktiveConfig = true;
                    if (p_freshonoff == "off") freshdAktiveConfig = false;
                    if(freshdAktiveConfig == true) {
                      fresh_aktiv = " class='Stil1a' ";
                      fresh_werteaktual = "<span class='Stil5'>Freshbox aktiviert</div>";
                    }
                    if(freshdAktiveConfig == false) {
                      fresh_aktiv = " class='Stil1b' ";
                      fresh_werteaktual = "Freshbox deaktiviert";
                    }


      preferences.putString("p_freshSt1", p_inputStufe1);                         //Variable speichern
      preferences.putString("p_freshSt2", p_inputStufe2);                         //Variable speichern
      preferences.putString("p_freshSt3", p_inputStufe3);                         //Variable speichern
      preferences.putString("p_freshSt4", p_inputStufe4);                         //Variable speichern
      preferences.putString("p_freshSt5", p_inputStufe5);                         //Variable speichern
      preferences.putString("p_freshSt6", p_inputStufe6);                         //Variable speichern

      preferences.putString("p_freshfunkt", p_inputfunktion);                         //Variable speichern


      p_inputfreshid.toCharArray(current_id, 17); 
      

      b_inputStufe1 = atoi(p_inputStufe1.c_str());
      b_inputStufe2 = atoi(p_inputStufe2.c_str());
      b_inputStufe3 = atoi(p_inputStufe3.c_str());
      b_inputStufe4 = atoi(p_inputStufe4.c_str());
      b_inputStufe5 = atoi(p_inputStufe5.c_str());
      b_inputStufe6 = atoi(p_inputStufe6.c_str());


    #ifdef Freshebug 
    Serial.println("p_inputfreship " + p_inputfreship); 
    Serial.println("p_inputfreshid " + p_inputfreshid); 
    Serial.println("p_inputfreshpwd " + p_inputfreshpwd); 
    #endif



            int str_len = p_inputfreshpwd.length() + 1; 
            //Serial.println("str_len " + String(str_len)); 
            char char_array[str_len];
            p_inputfreshpwd.toCharArray(char_array, str_len);
            send_pwd[0] = char_array[0];
            send_pwd[1] = char_array[1];
            send_pwd[2] = char_array[2];
            send_pwd[3] = char_array[3];

             // Serial.println(char_array[0], HEX);
             // Serial.println(char_array[1], HEX);
             // Serial.println(char_array[2], HEX);
             // Serial.println(char_array[3], HEX);
 

          //getIpAddress(p_inputfreship); 
          //IPAddress udpAddress(IpPartAddress[0],IpPartAddress[1],IpPartAddress[2],IpPartAddress[3]);  
          //#ifdef WIFI_DEBUG
          //Serial.print("IP Address=");             
          //Serial.print(IpPartAddress[0]); Serial.print("."); Serial.print(IpPartAddress[1]); Serial.print("."); 
          //Serial.print(IpPartAddress[2]); Serial.print("."); Serial.println(IpPartAddress[3]); 
          //#endif        
          
       divstatus9 = divgrau;  //Freshbox

       gFrashupdateFlag = true;

     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write Fresh Value __");
     #endif

  } 
 //-------------------------------------------------------------


  void WriteipValue()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

    preferences.putString("p_staticip", p_inputstaticip);                    //Variable speichern
    preferences.putString("p_subnetmask", p_inputsubnetmask);                  //Variable speichern
    preferences.putString("p_gateway", p_inputgateway);                     //Variable speichern
    preferences.putString("p_ntp", p_inputntp);                     //Variable speichern
    preferences.putString("p_wifidns", p_inputwifidns);                     //Variable speichern
    
    
    preferences.putString("p_name", p_inputname);                      //Variable speichern
    //preferences.end();                                      //Preferences beenden
     
    p_inputntp.toCharArray(p_inputntpc, 30);  
    Serial.println("6p_inputntpc: " + String(p_inputntpc));
    NTPClient timeClient(ntpUDP, p_inputntpc);


     #ifdef NVS_DEBUG
     Serial.println(" ");
     Serial.println("__ Write IP Value __");
     #endif

  }  

    void WriteipValuechange()
  {

    Preferences preferences;
    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

    preferences.putString("p_staticip", p_inputstaticip);                    //Variable speichern
    preferences.putString("p_subnetmask", p_inputsubnetmask);                  //Variable speichern
    preferences.putString("p_gateway", p_inputgateway);                     //Variable speichern
    preferences.putString("p_name", p_inputname);                     //Variable speichern
    preferences.putString("p_ntp", p_inputntp);                     //Variable speichern
    preferences.putString("p_ipchange", "1");                     //Variable speichern
    preferences.putString("p_wifidns", p_inputwifidns);                     //Variable speichern

    p_inputntp.toCharArray(p_inputntpc, 30); 
    Serial.println("7p_inputntpc: " + String(p_inputntpc));
    NTPClient timeClient(ntpUDP, p_inputntpc); 

    ipchangeandreeboot = 1;

      #ifdef NVS_DEBUG
      Serial.println(" ");
      Serial.println("__ Write IP Value change __");
      #endif

  }  
  //*******************************************************************************








  //*******************************************************************************
    static int IpPartAddress[4];
    void getIpAddress(String strIP)
    {
        int Part = 0;
        int i;
        for(i=0; i<4; i++) IpPartAddress[i] = 0;
        for ( i=0; i<strIP.length(); i++ )
        {
            char c = strIP[i];
            if ( c == '.' )
            {
                Part++;
                continue;
            }
            IpPartAddress[Part] *= 10;
            IpPartAddress[Part] += c - '0';
        }
    }
  //*******************************************************************************



  //******************************************************************************
  //                             Cloud upload                                    *
  //******************************************************************************
//#define RADON_SERVER    "rec.radoncloud.com"       //p_inputcloudserverc



  //******************************************************************************
#ifdef  Radoncloud





  //**************************************************************************
 void lesen_next_cloud(){

    //String sendValueStr2;

      sendValueStr2 = p_inputcloudpre;

      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "0=";
      //Date
      sendValueStr2 += String(epochTime_mqtt);  
      //Radon value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "1=";
      sendValueStr2 += String(mb_radon_ist_long);
      
      //MAC
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "2=";
      sendValueStr2 += WiFi.BSSIDstr();

      //Tracer ID value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "3=";
      sendValueStr2 += device_id_s;

      //Radon value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "4=";
      sendValueStr2 += String(mb_radon_24h_32bit);

      //Radon value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "5=";
      sendValueStr2 += String(mb_radon_long_32bit);  

      //Radon value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "6=";
      sendValueStr2 += String(mb_radon_eintrarge);

      //cloud_list_t = sendValueStr2;




 }
  //**************************************************************************








#endif
  //******************************************************************************










//******************************************************************************************
#ifdef  Radoncloud
void RadonCloudUpload()
{
    
    
    //String sendValueStr;
    char temp[25];
    cloud_werteaktual = "CLOUD aktiviert";
    
    if(WiFi_status != WL_CONNECTED){  
        cloud_werteaktual = "<span class='Stil6'>WIFI nicht verbunden</div>";
        gcloudUpdateFlag = false;
        return;
    }   
    
    WiFiClient radonClient;
    //WiFiClient Client;
    //const int httpPort = 80;
    //IPAddress server(185,3,235,169);  // rec.auto-steuerung.de
    //Serial.println(radonClient.connect(p_inputcloudserverc, httpPort));


                                  //  " + p_uhrzeit + " " + 
    #ifdef RADONCLOUD_DEBUG
    Serial.println("-->  " + p_time + " Cloud Starting connection... "  + String(p_inputcloudserverc)); 
    #endif
    //if (!radonClient.connect("rec.auto-steuerung.de", httpPort)) {
    //if (!radonClient.connect(server, httpPort)) {
    if (!radonClient.connect(p_inputcloudserverc, p_inputcloudporti)) {  // Starte SSL Verbindung   
        #ifdef RADONCLOUD_DEBUG_min
          Serial.print(String(p_time) + " | CLOUD: " + String(p_inputcloudserverc) + " connect failed! | State:");
          //Serial.print(" CLOUD failed, reconnect= ");
          //Serial.print(radonClient.state());
          //Serial.println(" | Cloud ERROR");
    
        #endif
        //log_list[log_list_count] = String(p_time) + " | CLOUD: " + String(p_inputcloudserverc) + " connect failed!";
        divstatus1 = divred;   // Status
        //update_log(); hier nicht, erst am ende außerhalb der Funktion
        cloud_werteaktual = "<span class='Stil6'>Cloud connect failed!</div>";
        // here install an counter up to 5 for waiting reconnect wifi, then the bit gDBUpdateFlag delete
        gcloudUpdateFlag = false;
        return;
    }
    //log_list[log_list_count] = String(p_time) + " | CLOUD: " + String(p_inputcloudserverc) + " connect";
    divstatus1 = divgreen;  // Status


    //=====================================================================

    sendValueStr2 = p_inputcloudpre; // "set_data:"
    //sendValueStr2 += "&v00=";
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "0=";

    //Date
    sprintf(temp, "%d", gYear);     sendValueStr2 = sendValueStr2 +temp + "-";
    sprintf(temp, "%02d", gMonth);  sendValueStr2 = sendValueStr2 +temp + "-";
    sprintf(temp, "%02d", gDay);    sendValueStr2 += temp;
    //Time
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "1=";
    sprintf(temp, "%02d", gHour);    sendValueStr2 = sendValueStr2 + temp + "-";
    sprintf(temp, "%02d", gMinute);  sendValueStr2 = sendValueStr2 + temp + "-";
    sprintf(temp, "%02d", gSecond);  sendValueStr2 += temp;
    //Pressure value
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "2=";
    //sprintf(temp, "%d", 100);
    //sendValueStr2 += temp;
    sendValueStr2 += String(f_pwm);
    //Moisture
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "3=";
    #ifdef CO2_on
    //sprintf(temp, "%d", String(eco2val1));
    #else
    sprintf(temp, "%d", 4);
    #endif
    //sendValueStr2 += temp;
    #ifdef CO2_on
    sendValueStr2 += String(eco2val1);
    #else
    sendValueStr2 += "";
    #endif
    //Temperature
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "4=";
    #ifdef CO2_on
    //sprintf(temp, "%d", String(etvocval2));
    #else
    sprintf(temp, "%d", 5);
    #endif
    //sendValueStr2 += temp;
    #ifdef CO2_on
    sendValueStr2 += String(etvocval2);
    #else
    sendValueStr2 += "";
    #endif
   
    //Radon value
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "5=";
    if(p_sett22 == 1){
      sendValueStr2 += String(mb_radon_ist_word);
    }else{
      sendValueStr2 += r1_val3;    // r1_val3.toInt(); MESH
    }

    //Private key
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "6=";
    sendValueStr2 += p_inputcloudkey;
    //Sensor id
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "7=";
    sendValueStr2 += String(atoi(p_inputclouddevicec));
    sendValueStr2 += p_inputcloudchain;
    sendValueStr2 += "8=";
    sendValueStr2 += WiFi.BSSIDstr();

    // f_pwm  //Lüfter Drehzahl: 

    // http://rec.radoncloud.com/s_get.php?set_data:&v00=2019-01-02&v01=01-30-00&v02=10245&v03=453&v04=-123&v05=12578&v06=3as44643euW&v07=15&v08=11:22:33:44:55:AD
    String client_send_str = "GET /" + p_inputcloudpage + "?" + sendValueStr2 + " HTTP/1.1\r\n" +
                             "Host: " + p_inputcloudserver + "\r\n" +
                             "Connection: close\r\n\r\n";
    // Send the sensor data to the mysql server
    cloud_werteaktual = "<span class='Stil5'>Cloud last upload " + p_uhrzeit_last + "</div>";
    radonClient.print(client_send_str);
    #ifdef RADONCLOUD_DEBUG
      Serial.print("RadonCloud = "); Serial.println(client_send_str);
    #endif
    gcloudUpdateFlag = false;

                //#ifdef RADONCLOUD_DEBUG
                  String line_t = ""; 
                  unsigned long lasttime = millis();
                  while (!radonClient.available() && millis() - lasttime < 1000) {delay(1);}   // wait max 1s for data
                  // Read all the lines of the reply from server and print them to Serial
                  
                  #ifdef RADONCLOUD_DEBUG_min
                  Serial.println("-->  " + p_time + " Cloud send success"); 
                  #endif
                   
                    while (radonClient.available()) {
                    String line = radonClient.readStringUntil('\n');
                    #ifdef RADONCLOUD_DEBUG_return
                      Serial.println(line);
                    #endif
                  }
                //#endif




}
#endif
  //******************************************************************************




void check_individual_value() {


  if (mb_radon_ist_word <= 100) {
    radon_score = 100;
  }
  if (mb_radon_ist_word <= 150 && mb_radon_ist_word > 100) {
    radon_score = 0;  //80
  }
  if (mb_radon_ist_word <= 300 && mb_radon_ist_word > 150) {
    radon_score = -200; //60
  }
  if (mb_radon_ist_word <= 500 && mb_radon_ist_word > 300) {
    radon_score = -300;  //40
  }
  if (mb_radon_ist_word <= 900 && mb_radon_ist_word > 500) {
    radon_score = -400;  //20
  }
  if (mb_radon_ist_word > 900) {
    radon_score = -425;  //0
  }
 
}

void calculate_score() {
  check_individual_value();
  score_value = (100 + (radon_score * 1.4) + 100 + 100 + 100 + 100 + 100) / 7.4;
  if (score_value >= 100) {
    score_value = 100;
  }
  //#ifdef MQTT_DEBUG_last
    //Serial.print("score_value   = ");
    //Serial.println(score_value);
  //#endif
}





   //**************************************************************************
 void lesen_things_l(){   
    
                       calculate_score();

                        // {"ts":1677425401, "values":{"radon":44,"eintraege":1604,"sernr":0000082720,"speed":1,"power":1}
                        //       1451649600512
                         //if (gACCESS_TOKENFlag == 1){      // 1= provision  gemacht  
                              //epochTime_mqtt_minus = epochTime_mqtt - 120; //minus 2 min
                              epochTime_mqtt_minus = epochTime_mqtt;
                              
                              String payload3 = "{\"";
                                                
                              payload3 += "ts";  //topic
                              payload3 += "\":";
                              payload3 += String(epochTime_mqtt_minus);
                              
                              payload3 += "0";
                              payload3 += String(random(10, 99));
                              payload3 += ",";


                              payload3 += "\"values\":{\"";
                              payload3 += "devicenumber";  
                              payload3 += "\":";
                              payload3 += String(p_inputmqmeshi);
                              payload3 += ",";
                            
                              payload3 += "\"";
                              payload3 += p_inputmqtopic;  //topic0
                              payload3 += "\":";
                              payload3 += String(mb_radon_ist_word);
                              payload3 += ",";

                              payload3 += "\"";
                              payload3 += p_inputmqtopic1;  //topic1
                              payload3 += "\":";
                              payload3 += String(mb_radon_eintrarge);
                              payload3 += ",";

                              payload3 += "\"";
                              payload3 += p_inputmqtopic2;  //topic2
                              payload3 += "\":";
                              payload3 += mb_Seriennummer;
                              payload3 += ",";

                              payload3 += "\"";
                              payload3 += p_inputmqtopic4;  //topic3
                              payload3 += "\":";
                              payload3 += String(State_Speed_mode);
                              payload3 += ",";

                              payload3 += "\"";
                              payload3 += p_inputmqtopic5;  //topic4
                              payload3 += "\":";
                              payload3 += String(State_Power);
                              payload3 += ",";

                              payload3 += "\"";
                              payload3 += p_inputmqtopic6;  //topic5
                              payload3 += "\":";
                              payload3 += String(score_value);


                              payload3 += "}}"; 
                            
                            things_list_t = payload3;   //charcount8
                        //  } // provision  gemacht     
    
    
    
   } 
   //**************************************************************************    
    
    
    

   //**************************************************************************
 void lesen_next_things(){   
    
                       calculate_score();

                                  //epochTime_mqtt_minus = epochTime_mqtt - 60; //minus 1 min
                                  epochTime_mqtt_minus = epochTime_mqtt;
                                  
                                  String payload = "{\"";
                              
                               
                                  payload += "devicenumber"; 
                                  payload += "\":";
                                  payload += String(p_inputmqmeshi);
                                  payload += ",";

                                  payload += p_inputmqtopic;  //topic0
                                  payload += "\":";
                                  payload += String(mb_radon_ist_word);
                                  payload += ",";

                                  payload += "\"";
                                  payload += p_inputmqtopic1;  //topic1
                                  payload += "\":";
                                  payload += String(mb_radon_eintrarge);
                                  payload += ",";

                                  payload += "\"";
                                  payload += p_inputmqtopic2;  //topic2
                                  payload += "\":";
                                  payload += mb_Seriennummer;
                                  payload += ",";

                                  payload += "\"";
                                  payload += p_inputmqtopic4;  //topic3
                                  payload += "\":";
                                  payload += String(State_Speed_mode);
                                  payload += ",";

                                  payload += "\"";
                                  payload += p_inputmqtopic5;  //topic4
                                  payload += "\":";
                                  payload += String(State_Power);
                                  payload += ",";

                                  payload += "\"";
                                  payload += p_inputmqtopic6;  //topic5
                                  payload += "\":";
                                  payload += String(score_value);

                                  payload += "}"; 
                            
                            things_list_t = payload;   //charcount8
                
    
    
    
   } 
   //**************************************************************************    
    


   //**************************************************************************
 void lesen_things_l_mesh(){   
    
                  

                        // {"ts":1677425401, "values":{"radon":44,"eintraege":1604,"sernr":0000082720,"speed":1,"power":1}
                        //       1451649600512
                         //if (gACCESS_TOKENFlag == 1){      // 1= provision  gemacht  
                              //epochTime_mqtt_minus = epochTime_mqtt - 120; //minus 2 min
                              epochTime_mqtt_minus = epochTime_mqtt;
                              
                              String payload3 = "{\"";
                                                
                              payload3 += "ts";  //topic
                              payload3 += "\":";
                              payload3 += String(epochTime_mqtt_minus);
                              
                              payload3 += "0";
                              payload3 += String(random(10, 99));
                              payload3 += ",";

                           
                              payload3 += "\"values\":{\"";
                              payload3 += "devicenumber";  //topic01
                              payload3 += "\":";
                              payload3 += String(p_inputmqmeshi);

                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "Bat";  
                              payload3 += "\":";
                              payload3 += AI_VSS_mv_s;

                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "Panel";  
                              payload3 += "\":";
                              payload3 += AI_VCAPA_mv_s;

                            

                            if(g_mb_tracer_online[1] == 1 || g_mb_tracer_online_fail[1] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon01";  //topic01
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[1]);
                            }  
                            
          
                            if(g_mb_tracer_online[2] == 1 || g_mb_tracer_online_fail[2] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon02"; 
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[2]);
                            }

                   
                            if(g_mb_tracer_online[3] == 1 || g_mb_tracer_online_fail[3] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon03"; 
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[3]);
                            }
                            
                  
                            if(g_mb_tracer_online[4] == 1 || g_mb_tracer_online_fail[4] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon04"; 
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[4]);
                            }
                            
                        
                            if(g_mb_tracer_online[5] == 1 || g_mb_tracer_online_fail[5] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon05"; 
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[5]);
                            }
                            
                           
                            if(g_mb_tracer_online[6] == 1 || g_mb_tracer_online_fail[6] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon06"; 
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[6]);                           
                            }
                            
                        
                            if(g_mb_tracer_online[7] == 1 || g_mb_tracer_online_fail[7] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon07"; 
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[7]);                              
                            }
                            
                          
                            if(g_mb_tracer_online[8] == 1 || g_mb_tracer_online_fail[8] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon08"; 
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[8]);                             
                            }
                            
                          
                            if(g_mb_tracer_online[9] == 1 || g_mb_tracer_online_fail[9] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon09"; 
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[9]);                              
                            }
                            
                          
                            if(g_mb_tracer_online[10] == 1 || g_mb_tracer_online_fail[10] < 2){
                              payload3 += ",";
                              payload3 += "\"";
                              payload3 += "radon10";  
                              payload3 += "\":";
                              payload3 += String(mb_radon_live_32bit_m[10]);
                            }

                              payload3 += "}}"; 
                            
                            things_list_t = payload3;   //charcount8
                        //  } // provision  gemacht     
    
    
    
   } 
   //**************************************************************************    
   



   //**************************************************************************
 void lesen_next_things_mesh(){   
    
                             
                              
                                  //epochTime_mqtt_minus = epochTime_mqtt - 60; //minus 1 min
                                  epochTime_mqtt_minus = epochTime_mqtt;
                                  
                                  String payload = "{\"";
 
                                  
                                  payload += "devicenumber";  //topic01
                                  payload += "\":";
                                  payload += String(p_inputmqmeshi);

                                  payload += ",";
                                  payload += "\"";
                                  payload += "Bat";  
                                  payload += "\":";
                                  payload += AI_VSS_mv_s;

                                  payload += ",";
                                  payload += "\"";
                                  payload += "Panel";  
                                  payload += "\":";
                                  payload += AI_VCAPA_mv_s;


                                if(g_mb_tracer_online[1] == 1 || g_mb_tracer_online_fail[1] < 2){
                                  payload += ",";
                                  payload += "\"";
                                  payload += "radon01";  //topic01
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[1]);
                                }  

                                if(g_mb_tracer_online[2] == 1 || g_mb_tracer_online_fail[2] < 2){
                                  payload += ",";
                                  payload += "\"";
                                  payload += "radon02";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[2]);
                                }

                                if(g_mb_tracer_online[3] == 1 || g_mb_tracer_online_fail[3] < 2){
                                 payload += ",";
                                  payload += "\"";
                                  payload += "radon03";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[3]);
                                }

                                if(g_mb_tracer_online[4] == 1 || g_mb_tracer_online_fail[4] < 2){
                                 payload += ",";
                                  payload += "\"";
                                  payload += "radon04";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[4]);
                                }

                                if(g_mb_tracer_online[5] == 1 || g_mb_tracer_online_fail[5] < 2){
                                  payload += ",";
                                  payload += "\"";
                                  payload += "radon05";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[5]);
                                }

                                if(g_mb_tracer_online[6] == 1 || g_mb_tracer_online_fail[6] < 2){
                                  payload += ",";
                                  payload += "\"";
                                  payload += "radon06";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[6]);
                                }

                                if(g_mb_tracer_online[7] == 1 || g_mb_tracer_online_fail[7] < 2){
                                  payload += ",";
                                  payload += "\"";
                                  payload += "radon07";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[7]);
                                }

                                if(g_mb_tracer_online[8] == 1 || g_mb_tracer_online_fail[8] < 2){
                                  payload += ",";
                                  payload += "\"";
                                  payload += "radon08";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[8]);
                                }

                                if(g_mb_tracer_online[9] == 1 || g_mb_tracer_online_fail[9] < 2){
                                  payload += ",";
                                  payload += "\"";
                                  payload += "radon09";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[9]);

                                }

                                if(g_mb_tracer_online[10] == 1 || g_mb_tracer_online_fail[10] < 2){
                                  payload += ",";
                                  payload += "\"";
                                  payload += "radon10";  
                                  payload += "\":";
                                  payload += String(mb_radon_live_32bit_m[10]);
                                }

                                  payload += "}"; 
                            
                            things_list_t = payload;   //charcount8
                
    
    
    
   } 
   //**************************************************************************    
    






  void reconnect() 
  {

        #ifdef MQTT_DEBUG
           client_state_resault();
        #endif

   
    while (!client.connected()) 
    {
      #ifdef MQTT_DEBUG
      Serial.println(String(p_time) + " | MQTT start connecting to Server " + p_inputmqserver + "  ");
      #endif
      gMQTTConnectFlag = false;
                         ////if (!client.connect(thing_id, username, thing_key)) {

       p_inputmqpass.toCharArray(p_inputmqpassc, 40);
       p_inputmquser.toCharArray(p_inputmquserc, 48);
       p_inputmqclient.toCharArray(p_inputmqclientc, 40);
       
       // #ifdef MQTT_DEBUG
           //client_state_resault();
        //#endif
       
       //Serial.println(p_inputmqclient);
       //Serial.println(p_inputmquser);
       //Serial.println(p_inputmqpass);


      //if (client.connect(mqttDeviceId, mqttUsername, mqttPassword)) 
      //if (client.connect("ClientID", TOKEN, NULL)) {      //thingsboard

      //if (client.connect(p_inputmqclientc, "provision", p_inputmqpassc)) 
      

      //                               String key = "provision";
      //             String clientId = "provision";                                       
      // if (client.connect(clientId.c_str(), key.c_str(), NULL)) {
      //if (p_inputmqoptions == "1"){         //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
         //p_inputmqpassc = ""
      //}   

      if (client.connect(p_inputmqclientc, p_inputmquserc, p_inputmqpassc)) 
      {
        #ifdef MQTT_DEBUG
        Serial.println(String(p_time) + " | --> MQTT connect to Server!");
        #endif
        
        //log_list[log_list_count] = String(p_time) + " | MQTT: Start Subscribe!";
        //update_log(); nicht hier weil zweimal

        mqtt_con_err = false; // nicht versuchen reconnect, da jetzt verbunden
        mq_werteaktual = "<span class='Stil5'>MQTT Connected</div>"; 
        mQtt_aktiv = " class='Stil1a' "; //grün
        gMQTTUpdateFlag = true;  // freigabe erneut wenn erst verbunden werden musste
        gMQTTConnectFlag = true;

        #ifdef MQTT_DEBUG_min
           client_state_resault();
        #endif


        if (p_inputmqoptions == "1"){         //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
          client.subscribe(publishTopic); 
          client.subscribe(publishTopic3);  
          //client.subscribe(publishTopic4);  
          //client.subscribe(publishTopic5);  
          //client.subscribe(publishTopic6);  
          //client.subscribe(publishTopic7); 
          //client.subscribe(publishTopic8); 
          //client.subscribe(publishTopic9); 
          //client.subscribe(publishTopic10); 
          //client.subscribe(publishTopic11); 

          //client.subscribe(publishTopic12); 



          //********************************************************************************************
           //---- abboniere Attributes
           client.subscribe(RESPONSE_SUBSCRIBE_TOPIC);  // v1/devices/me/attributes/response/+
           #ifdef MQTT_DEBUG
             Serial.println(String(p_time) + " | --> MQTT subscribe : " + String(RESPONSE_SUBSCRIBE_TOPIC));
           #endif
           //---- abboniere sie Keys die gelsen werden sollen -----
           String payload8 = "{\"clientKeys\":\"uptime\",\"sharedKeys\":\"shared1,shared2\"}";
           char attributes[200];
           payload8.toCharArray(attributes, 200);
           client.publish(publishTopic11, attributes);  // v1/devices/me/attributes/request/$request_id  
           #ifdef MQTT_DEBUG
             Serial.println(String(p_time) + " | --> a MQTT publish : " + String(publishTopic11) + " | " + payload8); 
           #endif
          //********************************************************************************************


          //********************************************************************************************
           //---- abboniere Attributes
           //client.subscribe(publishTopic5);  // v1/devices/me/rpc/response/+
           //---- abboniere sie Keys die gelsen werden sollen -----
           //String payload8 = "{\"params\":\"lastSync,lastConnectTime,provisionState\"}"; 
           //char attributes[200];
           //payload8.toCharArray(attributes, 200);
           //client.publish(publishTopic6, attributes); 
          //********************************************************************************************



          //#ifdef MQTT_DEBUG
          //Serial.println(String(p_time) + " | --> MQTT subscribe : " + String(publishTopic12));
          //#endif
        }





      }else{
      
        #ifdef MQTT_DEBUG
            Serial.print(String(p_time) + " | Mqtt failed, reconnect count= " + String(mqttReconCount) + " | State: ");
            
            Serial.print(client.state());
            Serial.println(" | Mqtt try again in 10 seconds");

           client_state_resault();
        #endif

        //log_list[log_list_count] = String(p_time) + " | Mqtt failed, reconnect count= " + String(mqttReconCount);
        //update_log(); nicht hier weil zweimal
        mqtt_con_err = true;  // erneut versuchen zu verbinden
        //delay(10000);
        
        mqttReconCount ++;
        if(mqttReconCount > 3) {
           mqttReconCount = 0;
           //#ifdef MQTT_DEBUG
           Serial.println("--> Mqtt try again cancel upload!");
           //#endif
           mqtt_con_err = false;  // jetzt nicht mehr versuchen
           //log_list[log_list_count] = String(p_time) + " | MQTT: " + String(p_inputmqserver) + " connect error!";
           mqtt_con_err2 = true;
        
          //--------------------------------------------------------------------------------
          if(gReboot_TOKENFlag2 == 1){  // MQTT nur neu Speichern wenn Zeit abgelaufen ist    1= Sensor abgefragt

              if (p_inputmqoptions == "1"){         //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
               
                if(g_mb_mesh == true){      // mesh
                    lesen_things_l_mesh();
                }else{
                    lesen_things_l();  
                }

                #ifdef MQTT_DEBUG
                  Serial.println("--> Speichere Daten in Datei. Mesh: " + String(g_mb_mesh));
                #endif
                datei_schreiben13();  // FILE_APPEND
                charcount13_w = charcount13 + 1; //aktuell in der datei  
                Serial.println("-->  " + p_time + " | Aktueller MQTT Write Zeilen Zähler: " + String(charcount13_w)); 

              }


              gReboot_TOKENFlag2 = 0;
              Preferences preferences;
              preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
              preferences.putUInt("p_crebbot2", gReboot_TOKENFlag2);      
              preferences.end();  

          }    
          //--------------------------------------------------------------------------------
        
        
          return;
        }
        return;

      }



    }
  }
//---------------------------------------------------------------








//---------------------------------------------------------------
  void reconnectp() 
  {


    
     char PROV_ACCESS_TOKENp[] PROGMEM = "provision";
     char DEFAULT_CLIENT_IDp[] PROGMEM = "TbDev";
     divstatus2 = divred; // Status

    if(client.connected()) {

      client.subscribe(PROV_RESPONSE_TOPICp);       //  = "/provision/response";

        #ifdef MQTT_DEBUG
           client_state_resault();
        #endif

    }


    while (!client.connected()) 
    {
      #ifdef MQTT_DEBUG
      Serial.println(String(p_time) + " | MQTT start connecting to Server provision: " + p_inputmqserver + "  ");
      #endif
      //gMQTTConnectFlag = false;
        #ifdef MQTT_DEBUG
           client_state_resault();
        #endif


      if (client.connect(PROV_ACCESS_TOKENp, DEFAULT_CLIENT_IDp, NULL)) 
      {
        #ifdef MQTT_DEBUG
        Serial.println(String(p_time) + " | --> MQTT connect to Server provision!");
        #endif
        
        //log_list[log_list_count] = String(p_time) + " | MQTT: Start Subscribe!";
        //update_log(); nicht hier weil zweimal

        mqtt_con_err = false; // nicht versuchen reconnect, da jetzt verbunden
        mq_werteaktual = "<span class='Stil5'>MQTT Connected</div>"; 
        mQtt_aktiv = " class='Stil1a' "; //grün
        //gMQTTUpdateFlag = true;  // freigabe erneut wenn erst verbunden werden musste
        //gMQTTConnectFlag = true;
        #ifdef MQTT_DEBUG_min
        Serial.println("-->  " + p_time + " MQTT Connected P"); 
        #endif
        client.subscribe(PROV_RESPONSE_TOPICp);       //  = "/provision/response";
        divstatus2 = divgreen; // Status
        

        #ifdef MQTT_DEBUG
           client_state_resault();
        #endif



      } else 
      {
        #ifdef MQTT_DEBUG
        Serial.print(String(p_time) + " | Mqtt provision failed, reconnect count= " + String(mqttReconCount) + " | State: ");
        
        Serial.print(client.state());
        Serial.println(" | Mqtt try again in 10 seconds");
        #endif
        //log_list[log_list_count] = String(p_time) + " | Mqtt failed, reconnect count= " + String(mqttReconCount);
        //update_log(); nicht hier weil zweimal
        mqtt_con_err = true;  // erneut versuchen zu verbinden
        //delay(10000);
        #ifdef MQTT_DEBUG
           client_state_resault();
        #endif
        
        mqttReconCount ++;
        if(mqttReconCount > 5) {
           mqttReconCount = 0;
           //#ifdef MQTT_DEBUG
           Serial.println("--> Mqtt try again cancel provision!");
           //#endif
           mqtt_con_err = false;  // jetzt nicht mehr versuchen
           //log_list[log_list_count] = String(p_time) + " | MQTT: " + String(p_inputmqserver) + " connect error!";
           mqtt_con_err2 = true;



          //--------------------------------------------------------------------------------
          if(gReboot_TOKENFlag2 == 1){ // MQTT nur neu Speichern wenn Zeit abgelaufen ist    1= Sensor abgefragt
   
            if(g_mb_mesh == true){      // mesh
                lesen_things_l_mesh();
            }else{
                lesen_things_l();  
            }

            datei_schreiben13();  // FILE_APPEND
            charcount13_w = charcount13 + 1; //aktuell in der datei  
            Serial.println("-->  " + p_time + " | Aktueller mqtt write Zeilen Zähler: " + String(charcount13_w)); 

            gReboot_TOKENFlag2 = 0;
            Preferences preferences;
            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
            preferences.putUInt("p_crebbot2", gReboot_TOKENFlag2);      
            preferences.end();       
          }    
          //--------------------------------------------------------------------------------


          return;
        }
        return;

      }



    }
  }

//-----------------------------------------------------------------






  //******************************************************************************
  // aktualisiere DIV in Footer
  void updateDIVs(){

          if( p_inputpasswort == p_inputpasswort_admin){  
             //Admin
                   
              if(chart_page == 7){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = p_chart2in;
              }  
              if(chart_page == 1){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartout;
                 p_chart2_or_in = p_chart2in;
              }  
              if(chart_page == 2){     //2=Chart co2 anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = p_chart2out;
              }   
              if(chart_page == 3){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = p_chart2in;
              }   
              if(chart_page == 4){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = p_chart2in;
              } 
              if(chart_page == 5){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = p_chart2in;
              }  
              if(chart_page == 6){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = p_chart2in;
              }  
              if(chart_page == 0){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = p_chart2in;
              }  

                   

          }else{  
            //Stanbdard  
              if(chart_page == 7){     //1=Chart rADON anzeigen
                    p_chart_or_in = p_chartin;
                  if( p_inputpasswort == p_inputpasswort_admin){  
                    p_chart2_or_in = p_chart2in;
                  }else{  
                     p_chart2_or_in = "";
                  }
              }  
              if(chart_page == 1){     //1=Chart rADON anzeigen
                 //p_chart_or_in = p_chartout;
                 p_chart_or_in = " style='display: none;>";
                  if( p_inputpasswort == p_inputpasswort_admin){  
                    p_chart2_or_in = p_chart2in;
                  }else{  
                     p_chart2_or_in = p_chartin;
                  }          
              }  
              if(chart_page == 2){     //2=Chart co2 anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = p_chart2out;
              }   
              if(chart_page == 3){     //1=Chart rADON anzeigen
                 p_chart_or_in = "";
                 p_chart2_or_in = "";
              }   
              if(chart_page == 4){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = "";
              } 
              if(chart_page == 5){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = "";
              }  
              if(chart_page == 6){     //1=Chart rADON anzeigen
                 p_chart_or_in = p_chartin;
                 p_chart2_or_in = "";
              }  
              if(chart_page == 0){     //1=Chart rADON anzeigen
                 //p_chart_or_in = p_chartin;
                 p_chart_or_in = " style='display: none;>";
                 p_chart2_or_in = "";
              }   
             
               

          }   



  }
  //******************************************************************************






//********************************************************************************************************************************************
 // Freshbox schreiben lesen
 void updateFreshbox(){
  

   #ifdef Freshbox         //inputchart=3
         // Freshbox

            s_size = 0;
            buffer[s_size] = send_data_udp_1[0];
            s_size ++;
            buffer[s_size] = send_data_udp_1[1];
            s_size ++;
            buffer[s_size] = send_data_udp_1[2];
            s_size ++;
            buffer[s_size] = 0x10;
            s_size ++;            
            buffer[s_size] = current_id[0];    // current_id[17]
            s_size ++;
            buffer[s_size] = current_id[1];  
            s_size ++;
            buffer[s_size] = current_id[2];  
            s_size ++;
            buffer[s_size] = current_id[3]; 
            s_size ++;
            buffer[s_size] = current_id[4]; 
            s_size ++;
            buffer[s_size] = current_id[5]; 
            s_size ++;
            buffer[s_size] = current_id[6]; 
            s_size ++;
            buffer[s_size] = current_id[7]; 
            s_size ++;
            buffer[s_size] = current_id[8]; 
            s_size ++;
            buffer[s_size] = current_id[9]; 
            s_size ++;
            buffer[s_size] = current_id[10]; 
            s_size ++;
            buffer[s_size] = current_id[11]; 
            s_size ++;
            buffer[s_size] = current_id[12]; 
            s_size ++;
            buffer[s_size] = current_id[13]; 
            s_size ++;
            buffer[s_size] = current_id[14]; 
            s_size ++; 
            buffer[s_size] = current_id[15];  //Size 20  [19]
          
            s_size ++;
            buffer[s_size] = PWD_blockgroesse;
            s_size ++;
            buffer[s_size] = send_pwd[0];
            s_size ++;
            buffer[s_size] = send_pwd[1];
            s_size ++;
            buffer[s_size] = send_pwd[2];
            s_size ++;
            buffer[s_size] = send_pwd[3];        //Size 25  [24]

//**************************

          //----  1= lesen   2= scheiben  ----
          switch (toggleSchreiben) {
              case 0:
                break; 
              case 1:
                #ifdef Freshebug2
                Serial.println(" "); 
                Serial.println("------------------------------------------------");  
                Serial.print("UDP Send --> ");
                #endif
               
                #ifdef Freshebug2
                Serial.println("toggleAbfrage " + String(toggleAbfrage)); 
                #endif 
               
                // lesen
                //-----------------------------------------------------------------------
                //if(toggleAbfrage <= 5){ //damit nach schreiben das nicht angehängt wird
                  s_size ++;
                  buffer[s_size] = Fresh_Code_R;
                //}
             
                //-------------------------------------------------------------------------------
                switch (toggleAbfrage) {
                  case 0:
                    s_size ++;
                    buffer[s_size] = R_AnlageEA;                 //Size 27  [26]
                    break; 
                  case 1: 
                    s_size ++;
                    buffer[s_size] = R_Lueferstatus;              //Size 27  [26]
                    break;          
                  case 2:
                    s_size ++;
                    buffer[s_size] = R_Timerbetrieb;        //Size 27  [26]
                    break; 
                  case 3:
                    s_size ++;
                    buffer[s_size] = R_TimerLueferstatus;        //Size 27  [26]
                    break; 
                  case 4:
                    s_size ++;
                    buffer[s_size] = R_Calenderbetrieb;        //Size 27  [26]
                    break; 
                  case 5:
                    s_size ++;
                    buffer[s_size] = R_CalenderLueferstatus;        //Size 27  [26]
                    break;                                 
                  case 6:
                    s_size ++;
                    buffer[s_size] = R_RegelungImStandard;        //Size 27  [26]
                    break;  
                  case 7:
                    s_size ++;
                    buffer[s_size] = R_Heizregisters;        //Size 27  [26]
                    break; 
                  case 8:
                    s_size ++;
                    buffer[s_size] = R_Umluftklappe;        //Size 27  [26]
                    break; 
                  default:
                  
                    break; 
                }
                //-------------------------------------------------------------------------------

                toggleAbfrage ++;      //weiterschalten  
                if(toggleAbfrage >= toggleAbfrage_vorgabe){
                  toggleAbfrage = 0;
                }



                //toggleSchreiben = 0; //lesen stoppen
                #ifdef Freshebug2
                Serial.print(" Abfrageregister: 0x");  
                Serial.print(buffer[s_size],HEX); 
                #endif 

               //-----------------------------------------------------------------------
                break;          
              case 2:
                #ifdef Freshebug
                Serial.println(" "); 
                Serial.println("------------------------------------------------");  
                Serial.print("UDP Send --> ");
                #endif
                //schreiben
                //-----------------------------------------------------------------------
                

                  switch (caseFreshSchreiben) {   // 0=Anlage Stufe_1-5      1= Anlage EIN/AUS     2=Boost EIN    3=Boost AUS   4=Kalender EIN   5=Kalender AUS
                      case 0:
                        #ifdef Freshebug
                        Serial.println("Anlage Stufe_1-5"); 
                        #endif 
                        s_size ++;
                        buffer[s_size] = Fresh_Code_W;
                        s_size ++;
                        buffer[s_size] = W_Lueftungsstufe;
                        s_size ++;
                        buffer[s_size] = w_dummy_data;      //S_Stufe_1-5
                        #ifdef Freshebug
                        Serial.println("W_Lueftungsstufe" + String(w_dummy_data)); 
                        #endif  
                        break; 


                      case 1:
                        #ifdef Freshebug
                        Serial.println("Anlage EIN/AUS");  
                        #endif 
                        s_size ++;
                        buffer[s_size] = Fresh_Code_W;     //Ein aus
                        s_size ++;
                        buffer[s_size] = W_AnlageEA;
                        s_size ++;
                        buffer[s_size] = w_dummy_data_ein;      //Anlage EIN/AUS
                        caseFreshSchreiben = 0;  //umsteuerunn auf stadard lüftungsstufe
                        freshreWriteafteron = 2;
                        break; 


                      case 2:
                        #ifdef Freshebug
                        Serial.println("Anlage Boost EIN"); 
                        #endif 
                        w_dummy_data = S_Boost_Ein;
                        m_boost_aktive = true;

                        s_size ++;
                        buffer[s_size] = Fresh_Code_W;
                        s_size ++;
                        buffer[s_size] = W_Boostbertrieb;
                        s_size ++;
                        buffer[s_size] = w_dummy_data;      // ein
                        caseFreshSchreiben = 0;  //umsteuerunn auf stadard lüftungsstufe
                        #ifdef Freshebug
                        Serial.println("W_Boostbertrieb " + String(w_dummy_data));  
                        #endif 
                        break; 


                      case 3:
                        #ifdef Freshebug
                        Serial.println("Anlage Boost AUS"); 
                        #endif 
                        m_boost_aktive = false;
                        w_dummy_data = S_Boost_Aus;
                        s_size ++;
                        buffer[s_size] = Fresh_Code_W;
                        s_size ++;
                        buffer[s_size] = W_Boostbertrieb;
                        s_size ++;
                        buffer[s_size] = w_dummy_data;      // aus
                        caseFreshSchreiben = 0;  //umsteuerunn auf stadard lüftungsstufe
                        #ifdef Freshebug
                        Serial.println("W_Boostbertrieb " + String(w_dummy_data));  
                        #endif 
                        break; 



                      case 4:
                        #ifdef Freshebug
                        Serial.println("Anlage Kalender EIN"); 
                        #endif 

                        w_dummy_data = S_Kalender_Ein;
                        m_kalender_aktive = true;

                        s_size ++;
                        buffer[s_size] = Fresh_Code_W;
                        s_size ++;
                        buffer[s_size] = W_Kalenderbetrieb;
                        s_size ++;
                        buffer[s_size] = w_dummy_data;      // ein
                        caseFreshSchreiben = 0;  //umsteuerunn auf stadard lüftungsstufe

                        #ifdef Freshebug
                        Serial.println("W_Kalenderbetrieb " + String(w_dummy_data));  
                        #endif 
                        break; 



                      case 5:
                        #ifdef Freshebug
                        Serial.println("Anlage Kalender AUS"); 
                        #endif 

                        m_kalender_aktive = false;
                        w_dummy_data = S_Kalender_Aus;
                        s_size ++;
                        buffer[s_size] = Fresh_Code_W;
                        s_size ++;
                        buffer[s_size] = W_Kalenderbetrieb;
                        s_size ++;
                        buffer[s_size] = w_dummy_data;      // aus
                        caseFreshSchreiben = 0;  //umsteuerunn auf stadard lüftungsstufe

                        #ifdef Freshebug    
                        Serial.println("W_Kalenderbetrieb " + String(w_dummy_data)); 
                        #endif 
                        break; 




                      default:
                       caseFreshSchreiben = 0;  // 0=Anlage Stufe_1-5      1= Anlage EIN/AUS     2=Boost EIN    3=Boost AUS   4=Kalender EIN   5=Kalender AUS

                  }

                

                    //***************
                    //toggleSchreiben = 0; //schreiben/lesen stoppen
                    toggleSchreiben = 1;  //nur mal jetzt für dauernd lesen aktivieren     1=lesen  2=schreiben
                    //toggleAbfrage = 0;
                    #ifdef Freshebug
                    Serial.print(" Send Lüfterstufe: " + String(w_dummy_data)); 
                    #endif  

                //-----------------------------------------------------------------------
                break;             

              default:
                break; 
            }
              #ifdef Freshebug
              Serial.println(" ");  
              #endif             

              //**************************
                        
                            


                          //***************


              /*
                        Serial.println(" ");      
                        Serial.println(buffer[0],HEX);
                        Serial.println(buffer[1],HEX);
                        Serial.println(buffer[2],HEX);
                        Serial.println(buffer[3],HEX);
                        Serial.println(buffer[4],HEX);
                        Serial.println(buffer[5],HEX);
                        Serial.println(buffer[6],HEX);
                        Serial.println(buffer[7],HEX);
                        Serial.println(buffer[8],HEX);
                        Serial.println(buffer[9],HEX);
                        Serial.println(buffer[10],HEX);
                        Serial.println(buffer[11],HEX);
                        Serial.println(buffer[12],HEX);
                        Serial.println(buffer[13],HEX);
              */



                //s_size = s_size + 2; //gesammte länge
                //Serial.println(" ");
                s_chksum1 = 0;
                s_size ++;
                for(s_i = 2; s_i <= s_size-1; s_i++)
                {
                  
                  //Serial.print(String(s_i));
                  
                  s_chksum1 += buffer[s_i];
                  //Serial.print(String(s_i)+ ":");
                  //Serial.print(buffer[s_i],HEX);
                  //Serial.print(" ");
                }
                //Serial.println(" ");
                //s_size = s_size - 2;
                //Serial.println("s_i: "+ String(s_size));
                //Serial.println("IST : " + String(s_chksum1));
                send_crc[1] = highByte(s_chksum1);  //in case you're wondering this should be 0xA
                send_crc[0] = lowByte(s_chksum1);    // and this should be 0xB.

            //Serial.println("sizecrc0 " + String(s_size));
            //s_size ++;
            buffer[s_size] = send_crc[0];
            //Serial.println("sizecrc1 " +String(s_size));
            s_size ++;
            buffer[s_size] = send_crc[1];
            //Serial.println("sizecrc2 " +String(s_size));


            //Serial.println("s_size " + String(s_size));

            //Serial.println("crc " + String(send_crc[0]));
            //Serial.println("crc " + String(send_crc[1]));
            //Serial.println("crc " + String(buffer[27]));
            //Serial.println("crc " + String(buffer[28]));

          //Serial.println(" "); 
          //Serial.println(buffer[18],HEX);
          //Serial.println(buffer[19],HEX);
          //Serial.println(buffer[20],HEX);
          //Serial.println(buffer[21],HEX);
          //Serial.println(buffer[22],HEX);
          //Serial.println(buffer[23],HEX);     
          //Serial.println(buffer[24],HEX);
          //Serial.println(buffer[25],HEX);
          //Serial.println(buffer[26],HEX);
          //Serial.println(buffer[27],HEX);
          //Serial.println(buffer[28],HEX);
          //Serial.println(buffer[29],HEX);
          //Serial.println(buffer[30],HEX);


        
        if(toggleSchreiben ==1 || toggleSchreiben ==2) 
        {
       
                #ifdef Freshebug2
                Serial.print("-out-> "); 
                for(s_i = 0; s_i <= s_size; s_i++)
                {
                  Serial.print(buffer[s_i],HEX);
                  Serial.print(" ");
                }
                Serial.println(" "); 
                #endif


          getIpAddress(p_inputfreship); 
          //#ifdef WIFI_DEBUG
          //Serial.print("IP Address=");             
          //Serial.print(IpPartAddress[0]); Serial.print("."); Serial.print(IpPartAddress[1]); Serial.print("."); 
          //Serial.print(IpPartAddress[2]); Serial.print("."); Serial.println(IpPartAddress[3]); 
          //#endif        

          IPAddress udpAddress(IpPartAddress[0],IpPartAddress[1],IpPartAddress[2],IpPartAddress[3]);  

          //Serial.println(udpAddress); 
          //Serial.println(udpAddress2); 

         //Serial.println("kkkkkkkk");
                 

          
          s_size ++;  // weil Arry bei 0 beginnt

          //udp2.beginPacket(udpAddress,udpPort);
          //udp2.write(buffer, s_size);
          //udp2.endPacket();

          udp.broadcastTo(buffer, s_size, 4000);   
          
        }




    #endif



 }
//********************************************************************************************************************************************




















  //****************************************************************************

 void updateledviews(){
  
         if(p_sett21 == 1){
            p_sett21_s = p_sett21_1;
         }else{
            p_sett21_s = p_sett21_0; 
         }
 }

 void updatecloudviews(){
  
         if(p_sett22 == 1){
            p_sett22_s = p_sett22_1;
            p_tr_hidden3 = p_tr_hidden1;
         }else{
            p_sett22_s = p_sett22_0;
            p_tr_hidden3 = p_tr_hidden0; 
         }
 }

 void updatemeshviews(){
      p_mesh_in = p_mesh_in_v;
    if (p_sett06 == 1){  //Mesh Eingeschaltet 
      p_mesh_in = p_mesh_in_v;
      p_meshchart_in2 = p_meshchart_in2_v; 
   
    }else{
      p_mesh_in = p_mesh_in_h;
      p_meshchart_in2 = p_meshchart_in2_h; 

    } 

 }

 //****************************************************************************
  void updatehomeviews(){
      p_home_in = p_home_in_v;
   // if (p_sett06 == 1){  //Mesh Eingeschaltet 
      p_home_in = p_home_in_v;
      p_homechart_in2 = p_homechart_in2_v; 
   
    //}else{
     // p_home_in = p_home_in_h;
     // p_homechart_in2 = p_homechart_in2_h; 

    //} 

 }
 //**************************************************************************** 





 //****************************************************************************
 void read_div_values(){

 //#include "a1_vars.h"
    //------------ IP Setting ----------
    if(p_sett02 == 1 && b_logoff == true){  // IP Setting ON und Login
    file_var1 = "var s_inputstaticip = \"<input name='inputstaticip' type='text' title='IP Adresse' maxlength='15' " + String(plattern_ip) + " value='" + p_inputstaticip + "'>\";" +
                "var s_inputsubnetmask = \"<input name='inputsubnetmask' type='text' title='Subnetmask' maxlength='15' " + String(plattern_ip) + " value='" + p_inputsubnetmask + "'>\";" +
                "var s_inputgateway = \"<input name='inputgateway' type='text' title='Gateway' maxlength='15' " + String(plattern_ip) + " value='" + p_inputgateway + "'>\";" +
					      "var s_inputdnss = \"<input name='inputdnss' type='text' title='NTP Server f&uuml;r die Uhrzeit' maxlength='20' value='" + p_inputntp + "'></form>\";" +
					      "var s_inputname = \"<input name='inputname' type='text' title='DNS Name from Tracer' maxlength='10' pattern='^[a-z]{1}[0-9a-z]{2,10}' value='" + p_inputname + "'>\";" +
					      "var s_inputname2 = \"[ http://" + p_inputname + ".local/index.html ]\";" +
					      "";
    }else{
     file_var1 = ""; 
    }

    //------------ TCP Setting ----------
    if(p_sett03 == 1 && b_logoff == true){  // TCP Setting ON und Login
    file_var2 = "var s_inputtcpport = \"<input name='inputtcpport' type='number' title='Port für Modbus Standard[502]' maxlength='4' pattern='[0-9]{4}' value='" + p_inputtcpport + "'>\";" +
                "var s_inputwebport = \"<input name='inputwebport' type='number' title='Port für Web Standard[80 or 8080]' maxlength='4' pattern='[0-9]{4}' value='" + p_inputwebport + "'>\";" +
					      "";
    }else{
     file_var2 = ""; 
    }



    //------------ Cloud Setting ----------
    if(p_sett08 == 1 && b_logoff == true){  // CLOUD Setting ON und Login
    file_var3 =  "var s_cloud_server = \"<input name='inputcloudserver' type='text' title='Server Name' maxlength='40' value='" + p_inputcloudserver + "'>\";" +
                 "var s_cloud_inter = \"<input name='inputcloudinter' title='Sendeintervall in Minuten' type='number' pattern='[0-9]{1,2}' min='5' value='" + p_inputcloudinter + "'>\";" +
                 "var s_cloud_page = \"<input name='inputcloudpage' type='text' title='Pfad zum Server' maxlength='80' value='" + p_inputcloudpage + "'>\";" +   
                 "var s_cloud_pre = \"<input name='inputcloudpre' type='text' title='Pre Data' maxlength='40' value='" + p_inputcloudpre + "'>\";" +  
                 "var s_cloud_chain = \"<input name='inputcloudchain' type='text' title='Port' maxlength='6' value='" + p_inputcloudchain + "'>\";" +  
                 "var s_cloud_port = \"<input name='inputcloudport' type='text' title='Port' maxlength='4' value='" + p_inputcloudport + "'>\";" +   
                 //"var s_cloud_result = \"" + cloud_result + "\";" +
                 "var s_cloudttaktual = \"" + cloud_werteaktual + "\";" +
                 "var s_clouduploud = \"" + p_clouduploud + "\";" +

                  "";
    }else{
     file_var3 = ""; 
    }




    //------------ MQTT Setting ----------   
    if(p_sett07 == 1 && b_logoff == true){  // MQTT Setting ON und Login  16
    
       if (p_inputmqoptions == "1"){         //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
        p_mq_tr_01 = "<tr style='display: none;'>";   
        p_mq_tr_02 = "<tr style='display: none;'>";   
        p_mq_tr_03 = "<tr style='display: none;'>";   
        p_mq_tr_04 = "<tr style='display: none;'>";   
        p_mq_tr_05 = "<tr style='display: none;'>";    
      }else{
        p_mq_tr_01 = "<tr>";
        p_mq_tr_02 = "<tr>";
        p_mq_tr_03 = "<tr>";
        p_mq_tr_04 = "<tr>";
        p_mq_tr_05 = "<tr>";
      }
   
   
   
      if (p_inputmqoptions == "0"){         //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
      file_var4 =  "var s_mq_options = \"<input name='inputmqoptions' type='text' title='MQTT Option 0=Standard | 1=Thingsboard' minlength='1' maxlength='1' pattern='[0-1]' value='" + p_inputmqoptions + "'>\";" +
                  "var s_mq_mesh = \"<input name='inputmqmesh' type='number' title='MQTT Mesh [number of devices 0 = Mesh off | Mesh = 2-10]' minlength='1' min='0' max='10' pattern='[0-9]{1,2}' value='" + p_inputmqmesh + "'>\";" +
                  "var s_mq_server = \"<input name='inputmqserver' type='text' title='MQTT Server Adresse' minlength='1' maxlength='40' value='" + p_inputmqserver + "'>\";" +
                  "var s_mq_port = \"<input name='inputmqport' type='number' title='MQTT Port Standard [1883]' minlength='1' maxlength='4' value='" + p_inputmqport + "'>\";" +
                  "var s_mq_user = \"<input name='inputmquser' type='text' title='MQTT Username or Token' minlength='1' maxlength='40' value='" + p_inputmquser + "'>\";" +
                  "var s_mq_pass = \"<input name='inputmqpass' type='text' title='MQTT Passwort oder Key' minlength='1' maxlength='40' value='" + p_inputmqpass + "'>\";" +
                  "var s_mq_client = \"<input name='inputmqclient' type='text' title='MQTT Client ID or Device' minlength='1' maxlength='48' value='" + p_inputmqclient + "'>\";" +
                  "var s_mq_topic = \"<input name='inputmqtopic' type='text' title='MQTT Topic for Radon' maxlength='50' value='" + p_inputmqtopic + "'>\";" +
                  "var s_mq_topic1 = \"<input name='inputmqtopic1' type='text' title='MQTT Topic for Radon Eintr&auml;ge' maxlength='50' value='" + p_inputmqtopic1 + "'>\";" +
                  "var s_mq_topic2 = \"<input name='inputmqtopic2' type='text' title='MQTT Topic for Seriennummer' maxlength='50' value='" + p_inputmqtopic2 + "'>\";" +
                  "var s_mq_onoff = \"<input name='inputmqonoff' type='text' title='MQTT Switch ON/OFF' maxlength='3' pattern='on|off' value='" + p_mqonoff + "'>\";" +
                  "var s_mqttaktual = \"" + mq_werteaktual + "\";" +
                  "var s_mq_tr_01 = \"" + p_mq_tr_01 + "\";" +
                  "var s_mq_tr_02 = \"" + p_mq_tr_02 + "\";" +
                  "var s_mq_tr_03 = \"" + p_mq_tr_03 + "\";" +
                  "var s_mq_tr_04 = \"" + p_mq_tr_04 + "\";" +
                  "var s_mq_tr_05 = \"" + p_mq_tr_05 + "\";" +
                    "";
      }else{
      file_var4 =  "var s_mq_options = \"<input name='inputmqoptions' type='text' title='MQTT Option 0=Standard | 1=Thingsboard' minlength='1' maxlength='1' pattern='[0-1]' value='" + p_inputmqoptions + "'>\";" +
                  "var s_mq_mesh = \"<input name='inputmqmesh' type='number' title='MQTT Mesh [number of devices 0 = Mesh off | Mesh = 2-10]' minlength='1' min='0' max='10' pattern='[0-9]{1,2}' value='" + p_inputmqmesh + "'>\";" +
                  "var s_mq_server = \"<input name='inputmqserver' type='text' title='MQTT Server Adresse' minlength='1' maxlength='40' value='" + p_inputmqserver + "'>\";" +
                  "var s_mq_port = \"<input name='inputmqport' type='number' title='MQTT Port Standard [1883]' minlength='1' maxlength='4' value='" + p_inputmqport + "'>\";" +
                  "var s_mq_user = \"<input name='inputmquser' type='text' title='MQTT Username or Token' minlength='1' maxlength='40' value='" + p_inputmquser + "'>\";" +
                  "var s_mq_onoff = \"<input name='inputmqonoff' type='text' title='MQTT Switch ON/OFF' maxlength='3' pattern='on|off' value='" + p_mqonoff + "'>\";" +
                  "var s_mqttaktual = \"" + mq_werteaktual + "\";" +
                  "var s_mq_tr_01 = \"" + p_mq_tr_01 + "\";" +
                  "var s_mq_tr_02 = \"" + p_mq_tr_02 + "\";" +
                  "var s_mq_tr_03 = \"" + p_mq_tr_03 + "\";" +
                  "var s_mq_tr_04 = \"" + p_mq_tr_04 + "\";" +
                  "var s_mq_tr_05 = \"" + p_mq_tr_05 + "\";" +
                    "";  
      }

    }else{
     file_var4 = ""; 
    }
    //----------------------------------------



    //------------ Freshbox Setting ----------
    if(p_sett14 == 1 && b_logoff == true){  // Freshbox Setting ON und Login
    file_var5 =  "var s_inputfreshid = \"<input name='inputfreshid' type='text' title='ID Nummer der Freshbox' minlength='16' maxlength='16' value='" + String(current_id) + "'></form>\";" +        
                 "var s_inputfreshpwd = \"<input name='inputfreshpwd' type='password' title='Passwort der Freshbox' minlength='4' maxlength='4' pattern='[1-9]{4}' value='" + String((char)send_pwd[0]) + String((char)send_pwd[1]) + String((char)send_pwd[2]) + String((char)send_pwd[3]) + "'></form>\";" +
                 "var s_freshaktiv = \"<td " + fresh_aktiv + ">\";" +
                 "var s_fresh_onoff = \"<input name='inputfreshonoff' type='text' title='Freshbox switch ON or OFF' maxlength='3' pattern='on|off' value='" + p_freshonoff + "'>\";" +
                 "var s_freshaktual = \"" + fresh_werteaktual + "\";" +
                 "var s_inputstufe6 = \"<input name='inputstufe6' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe W&auml;chter' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe6 + "'>\";" +
                 "var s_inputstufe5 = \"<input name='inputstufe5' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 5' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe5 + "'>\";" +
                 "var s_inputstufe4 = \"<input name='inputstufe4' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 4' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe4 + "'>\";" +
                 "var s_inputstufe3 = \"<input name='inputstufe3' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 3' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe3 + "'>\";" +
                 "var s_inputstufe2 = \"<input name='inputstufe2' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 2' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe2 + "'>\";" +
                 "var s_inputstufe1 = \"<input name='inputstufe1' type='text' title='Radonschwelle f&uuml;r L&uuml;ftungsstufe 1' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputStufe1 + "'>\";" +
                 "var s_inputfunktion = \"<input name='inputfunktion' type='text' title='Funktion [on] schaltet L&uuml;fter selbstst&auml;ndig EIN oder AUS' maxlength='3' pattern='on|off' value='" + p_inputfunktion + "'>\";" +
                 "var s_fresh_st1 = \"" + State_Power_s + "\";" +
                 "var s_fresh_st2 = \"" + String(State_Speed_mode) + "\";" +
                 "var s_fresh_st3 = \"" + State_Timer_s + "\";" +
                 "var s_fresh_st4 = \"" + String(State_Timer_Speed_mode) + "\";" +
                 "var s_fresh_st5 = \"" + State_Calender_s + "\";" +
                 "var s_fresh_st6 = \"" + String(State_Calender_Speed_mode) + "\";" +
                  "";
    }else{
     file_var5 = ""; 
    }
    //----------------------------------------



    //------------ LED Setting ----------
    if(p_sett09 == 1 && b_logoff == true){  // LED Setting ON und Login
     file_var6 =   "var s_led_red = \"<input name='inputledred' type='text' title='Radonschwelle f&uuml;r Rot' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputledred + "'>\";" +
                   "var s_led_orange = \"<input name='inputledorange' type='text' title='Radonschwelle f&uuml;r Orange' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputledorange + "'>\";" +
                   "var s_led_green = \"<input name='inputledgreen' type='text' title='Radonschwelle f&uuml;r Gr&uuml;n' maxlength='5' pattern='[0-9]{1,5}' value='" + p_inputledgreen + "'>\";" +
                   "var s_led_gamma = \"<input name='inputledgamma' type='text' title='Helligkeit der LED ab Schwelle Gr&uuml;n aktiv' maxlength='3' value='" + p_inputledgamma + "'>\";" +   
                   "var s_led_onoff = \"<input name='inputledonoff' type='text' title='LED Option ON or OFF' maxlength='3' pattern='on|off' value='" + p_ledonoff + "'>\";" + 
                   "";
    }else{
     file_var6 = ""; 
    }
    //----------------------------------------


    //------------ AO1 Setting ----------
    if(p_sett19 == 1 && b_logoff == true){  // AO1 Setting ON und Login
     file_var10 =   "var s_ao1_og = \"<input name='inputao1og' type='number' title='Oberer Grenzbereich' maxlength='7' pattern='[0-9]{1,7}' max='1500000' value='" + p_inputao1og + "'>\";" +
                    "var s_ao1_ug = \"<input name='inputao1ug' type='number' title='Unterer Grenzbereich' maxlength='7' pattern='[0-9]{1,7}' max='1500000' value='" + p_inputao1ug + "'>\";" +
                    "var s_ao1_option = \"<input name='inputao1option' type='number' title='Option [0= 4-20mA | 1= 3,8-20,5mA | 2= 0-20mA | 3= 3,6-21mA]' maxlength='1' pattern='[0-2]{1}' max='2' value='" + p_inputao1option + "'>\";" +
                    "var s_ao1_korrektur = \"<input name='inputao1korrektur' type='number' title='Korrektur 0/4 mA' maxlength='7' pattern='[0-9]{1,7}' max='1500000' value='" + p_inputao1korrektur + "'>\";" +
                    "var s_ao1_korrektur2 = \"<input name='inputao1korrektur2' type='number' title='Korrektur 20 mA' maxlength='7' pattern='[0-9]{1,7}' max='1500000' value='" + p_inputao1korrektur2 + "'>\";" +
                    //"var s_ao1_namur = \"<input name='s_ao1namur' type='number' title='Namur' maxlength='7' pattern='[0-9]{1,7}' max='1500000' value='" + p_inputao1namur + "'>\";" +
                    
                    "var s_ao1_onoff = \"<input name='inputao1onoff' type='text' title='ao1 Option ON or OFF' maxlength='3' pattern='on|off' value='" + p_ao1onoff + "'>\";" + 
                    "";
    }else{
     file_var10 = ""; 
    }
    //----------------------------------------



    //------------ Schalter Setting ----------
    if(b_logoff == true){  //  Login
      file_var7 =   "var s_div_c02 = \"" + div_c02 + "\";" +          
                    //"var s_div_c01 = \"" + div_c01 + "\";" +
                    "var s_div_c03 = \"" + div_c03 + "\";" +
                    //"var s_div_c04 = \"" + div_c04 + "\";" +
                    "var s_div_c07 = \"" + div_c07 + "\";" +
                    "var s_div_c08 = \"" + div_c08 + "\";" +
                    "var s_div_c09 = \"" + div_c09 + "\";" +
                    "var s_div_c12 = \"" + div_c12 + "\";" +
                    #ifdef old_option
                    "var s_div_c13 = \"" + div_c13 + "\";" +
                    #endif

                    "var s_div_c14 = \"" + div_c14 + "\";" +
                    "var s_div_c19 = \"" + div_c19 + "\";" +
                  "";
    }else{
     file_var7 = ""; 
    }
    //----------------------------------------




    //------------ Schalter Setting ----------
    if(b_logoff == true){  //  Login
      file_var8 =   "var s_sett02_s = \"" + p_sett02_s + "\";" +   // IP Setting   
                    //"var s_sett01_s = \"" + p_sett01_s + "\";" +   // Status Setting
                    
                    "var s_sett03_s = \"" + p_sett03_s + "\";" +   // TCP Setting
                                                                  // RS485 Setting
                    //"var s_sett05_s = \"" + p_sett05_s + "\";" +   // Sensor Setting
                                                                  // Mesh Setting
                    "var s_sett07_s = \"" + p_sett07_s + "\";" +   // MQTT Setting
                    "var s_sett08_s = \"" + p_sett08_s + "\";" +   // Cloud Setting
                    "var s_sett09_s = \"" + p_sett09_s + "\";" +   // LED Setting
                                                                  //10 Push Setting
                                                                  //11 FAN Setting

                                                                  //13 LOG Setting
                    "var s_sett14_s = \"" + p_sett14_s + "\";" +   // Freshbox Setting
                    "var s_sett15_s = \"" + p_sett15_s + "\";" +   //Freshbox on/off Setting
                    "var s_sett16_s = \"" + p_sett16_s + "\";" +   //MQTT on/off Setting   
                    "var s_sett17_s = \"" + p_sett17_s + "\";" +   //LED on/off Setting
                    "var s_sett18_s = \"" + p_sett18_s + "\";" +   //Cloud on/off Setting   
                    "var s_sett19_s = \"" + p_sett19_s + "\";" +   //AO Setting  
                    "var s_sett29_s = \"" + p_sett29_s + "\";" +   //AO on/off  

                  "";
    }else{
     file_var8 = ""; 
    }
    //----------------------------------------

   
   
     p_view_tr_02 = "<tr style='display: none;'>";
     p_view_tr_03 = "<tr style='display: none;'>";
     p_view_tr_04 = "<tr style='display: none;'>";
     p_view_tr_05 = "<tr style='display: none;'>";
     p_view_tr_06 = "<tr style='display: none;'>";
     p_view_tr_07 = "<tr style='display: none;'>";
     p_view_tr_08 = "<tr style='display: none;'>";
     p_view_tr_09 = "<tr style='display: none;'>";
     p_view_tr_10 = "<tr style='display: none;'>";
     availableKeys = "['radon1']";

     if(p_inputmqmeshi == 2){
       p_view_tr_02 = "<tr>";
       availableKeys = "['radon1','radon2']";
     }
     if(p_inputmqmeshi == 3){
       p_view_tr_02 = "<tr>";
       p_view_tr_03 = "<tr>";
       availableKeys = "['radon1','radon2','radon3']";
     }
     if(p_inputmqmeshi == 4){
       p_view_tr_02 = "<tr>";
       p_view_tr_03 = "<tr>";
       p_view_tr_04 = "<tr>";
       availableKeys = "['radon1','radon2','radon3','radon4']";
     }
     if(p_inputmqmeshi == 5){
       p_view_tr_02 = "<tr>";
       p_view_tr_03 = "<tr>";
       p_view_tr_04 = "<tr>";
       p_view_tr_05 = "<tr>";
       availableKeys = "['radon1','radon2','radon3','radon4','radon5']";
     }
     if(p_inputmqmeshi == 6){
       p_view_tr_02 = "<tr>";
       p_view_tr_03 = "<tr>";
       p_view_tr_04 = "<tr>";
       p_view_tr_05 = "<tr>";
       p_view_tr_06 = "<tr>";
       availableKeys = "['radon1','radon2','radon3','radon4','radon5','radon6']";
     }
     if(p_inputmqmeshi == 7){
       p_view_tr_02 = "<tr>";
       p_view_tr_03 = "<tr>";
       p_view_tr_04 = "<tr>";
       p_view_tr_05 = "<tr>";
       p_view_tr_06 = "<tr>";
       p_view_tr_07 = "<tr>";
       availableKeys = "['radon1','radon2','radon3','radon4','radon5','radon6','radon7']";
     }
     if(p_inputmqmeshi == 8){
       p_view_tr_02 = "<tr>";
       p_view_tr_03 = "<tr>";
       p_view_tr_04 = "<tr>";
       p_view_tr_05 = "<tr>";
       p_view_tr_06 = "<tr>";
       p_view_tr_07 = "<tr>";
       p_view_tr_08 = "<tr>";
       availableKeys = "['radon1','radon2','radon3','radon4','radon5','radon6','radon7','radon8']";
     }
     if(p_inputmqmeshi == 9){
       p_view_tr_02 = "<tr>";
       p_view_tr_03 = "<tr>";
       p_view_tr_04 = "<tr>";
       p_view_tr_05 = "<tr>";
       p_view_tr_06 = "<tr>";
       p_view_tr_07 = "<tr>";
       p_view_tr_08 = "<tr>";
       p_view_tr_09 = "<tr>";
       availableKeys = "['radon1','radon2','radon3','radon4','radon5','radon6','radon7','radon8','radon9']";
     }
     if(p_inputmqmeshi == 10){
       p_view_tr_02 = "<tr>";
       p_view_tr_03 = "<tr>";
       p_view_tr_04 = "<tr>";
       p_view_tr_05 = "<tr>";
       p_view_tr_06 = "<tr>";
       p_view_tr_07 = "<tr>";
       p_view_tr_08 = "<tr>";
       p_view_tr_09 = "<tr>";
       p_view_tr_10 = "<tr>";
       availableKeys = "['radon1','radon2','radon3','radon4','radon5','radon6','radon7','radon8','radon9','radon10']";
     }


      if(g_mb_mesh == true){      // mesh
          p_view_tr_1a = "<tr style='display: none;'>";
          p_view_tr_1b = "<tr style='display: none;'>";
          p_view_tr_1c = "<tr style='display: none;'>";
          //p_view_tr_1d = "<tr style='display: none;'>";
      }else{
          p_view_tr_1a = "<tr>"; 
          p_view_tr_1b = "<tr>"; 
          p_view_tr_1c = "<tr>"; 
          //p_view_tr_1d = "<tr>"; 
      }
        
     if(g_mb_tracer_online[1] == 1){meshSti1 = mesh_bla;}else{meshSti1 = mesh_rot;}

     if(g_mb_tracer_online[2] == 1){meshSti2 = mesh_bla;}else{meshSti2 = mesh_rot;}
     if(g_mb_tracer_online[3] == 1){meshSti3 = mesh_bla;}else{meshSti3 = mesh_rot;}
     if(g_mb_tracer_online[4] == 1){meshSti4 = mesh_bla;}else{meshSti4 = mesh_rot;}
     if(g_mb_tracer_online[5] == 1){meshSti5 = mesh_bla;}else{meshSti5 = mesh_rot;}
     if(g_mb_tracer_online[6] == 1){meshSti6 = mesh_bla;}else{meshSti6 = mesh_rot;}
     if(g_mb_tracer_online[7] == 1){meshSti7 = mesh_bla;}else{meshSti7 = mesh_rot;}
     if(g_mb_tracer_online[8] == 1){meshSti8 = mesh_bla;}else{meshSti8 = mesh_rot;}
     if(g_mb_tracer_online[9] == 1){meshSti9 = mesh_bla;}else{meshSti9 = mesh_rot;}
     if(g_mb_tracer_online[10] == 1){meshSti10 = mesh_bla;}else{meshSti10 = mesh_rot;}

    //------------ MQTT Mesh Vars Anzeigen ----------
    if(g_mb_mesh == false){  //  Mesh Funktion nicht aktiv
    file_var9 = "var s_view_serienn = \"<tr><td colspan='2' class='Stil1'><div class='box2'></div> </td></tr><tr><td class='Stil1'>Seriennummer: </td><td height='30' class='Stil3'>" + mb_Seriennummer + "</td></tr>\";" +   // Seriennummer  
                 
                 "var s_radon1_live = \"<td height='30' class='Stil3'>" + String(mb_radon_live_32bit_m[1]) + "\";" +
                  
                  "var s_class_radon01 = \"<td class='Stil1'>Radon live:\";" +
                  "var s_view_tr_02 = \"" + p_view_tr_02 + "\";" +
                  "var s_view_tr_03 = \"" + p_view_tr_03 + "\";" +
                  "var s_view_tr_04 = \"" + p_view_tr_04 + "\";" +
                  "var s_view_tr_05 = \"" + p_view_tr_05 + "\";" +
                  "var s_view_tr_06 = \"" + p_view_tr_06 + "\";" +
                  "var s_view_tr_07 = \"" + p_view_tr_07 + "\";" +
                  "var s_view_tr_08 = \"" + p_view_tr_08 + "\";" +
                  "var s_view_tr_09 = \"" + p_view_tr_09 + "\";" +
                  "var s_view_tr_10 = \"" + p_view_tr_10 + "\";" +

                  "var s_view_tr_1a = \"" + p_view_tr_1a + "\";" + 
                  "var s_view_tr_1b = \"" + p_view_tr_1b + "\";" +
                  "var s_view_tr_1c = \"" + p_view_tr_1c + "\";" +
                  //"var s_view_tr_1d = \"" + p_view_tr_1d + "\";" +

                 "";
    }else{

    file_var9 =   "var s_view_tr_02 = \"" + p_view_tr_02 + "\";" +
                  "var s_view_tr_03 = \"" + p_view_tr_03 + "\";" +
                  "var s_view_tr_04 = \"" + p_view_tr_04 + "\";" +
                  "var s_view_tr_05 = \"" + p_view_tr_05 + "\";" +
                  "var s_view_tr_06 = \"" + p_view_tr_06 + "\";" +
                  "var s_view_tr_07 = \"" + p_view_tr_07 + "\";" +
                  "var s_view_tr_08 = \"" + p_view_tr_08 + "\";" +
                  "var s_view_tr_09 = \"" + p_view_tr_09 + "\";" +
                  "var s_view_tr_10 = \"" + p_view_tr_10 + "\";" +  

                  "var s_view_tr_1a = \"" + p_view_tr_1a + "\";" + 
                  "var s_view_tr_1b = \"" + p_view_tr_1b + "\";" +
                  "var s_view_tr_1c = \"" + p_view_tr_1c + "\";" +
                  //"var s_view_tr_1d = \"" + p_view_tr_1d + "\";" +

  
                  "var s_class_radon01 = \"<td class='Stil3r'>Radon 01:\";" +
                                
                  "var s_radon1_live = \"<td height='30' class='" + meshSti1 + "'>" + String(mb_radon_live_32bit_m[1]) + "\";" +
                 
                  "var s_radon2_live = \"<td height='30' class='" + meshSti2 + "'>" + String(mb_radon_live_32bit_m[2]) + " Bq/m&sup3;\";" +
                  "var s_radon3_live = \"<td height='30' class='" + meshSti3 + "'>" + String(mb_radon_live_32bit_m[3]) + " Bq/m&sup3;\";" +
                  "var s_radon4_live = \"<td height='30' class='" + meshSti4 + "'>" + String(mb_radon_live_32bit_m[4]) + " Bq/m&sup3;\";" +
                  "var s_radon5_live = \"<td height='30' class='" + meshSti5 + "'>" + String(mb_radon_live_32bit_m[5]) + " Bq/m&sup3;\";" +
                  "var s_radon6_live = \"<td height='30' class='" + meshSti6 + "'>" + String(mb_radon_live_32bit_m[6]) + " Bq/m&sup3;\";" +
                  "var s_radon7_live = \"<td height='30' class='" + meshSti7 + "'>" + String(mb_radon_live_32bit_m[7]) + " Bq/m&sup3;\";" +
                  "var s_radon8_live = \"<td height='30' class='" + meshSti8 + "'>" + String(mb_radon_live_32bit_m[8]) + " Bq/m&sup3;\";" +
                  "var s_radon9_live = \"<td height='30' class='" + meshSti9 + "'>" + String(mb_radon_live_32bit_m[9]) + " Bq/m&sup3;\";" +
                  "var s_radon10_live = \"<td height='30' class='" + meshSti10 + "'>" + String(mb_radon_live_32bit_m[10]) + " Bq/m&sup3;\";" +
                  "";

    }
    //----------------------------------------




 }
  //****************************************************************************





  //****************************************************************************
#ifdef vent_option
 void updatefanviews(){

       //Serial.println("vanAktiveConfig: " + String(vanAktiveConfig));   
       //Serial.println("p_vanonoff: " + p_vanonoff);    

      if (p_sett11 == 1){  //view FAN Eingeschaltet      || p_vanonoff == "on"
       
         if (p_vanonoff == "off"){
          p_vanchart_in = p_vanchart_in_h; 
          p_van_in = p_van_in_h;
          p_vanchart_in2 = p_vanchart_in2_h;
          p_vanconf_in3 = p_vanconf_in3_h;
          p_tr_pwm_i = p_tr_pwm;
         }else{
          p_vanchart_in = p_vanchart_in_v; 
          p_van_in = p_van_in_v;
          p_vanchart_in2 = p_vanchart_in2_v;
          p_vanconf_in3 = p_vanconf_in3_v;
          p_tr_pwm_i = String(f_pwm) + " %";
         }

         p_tr_hidden2 = p_tr_hidden1;  // Bei Sensorwerte anzeigen



      }else{
          p_vanchart_in = p_vanchart_in_h; 
          p_van_in = p_van_in_h;
          p_vanchart_in2 = p_vanchart_in2_h;
          p_vanconf_in3 = p_vanconf_in3_h;

          p_tr_hidden2 = p_tr_hidden0;   // Bei Sensorwerte nicht anzeigen
          p_tr_pwm_i = p_tr_pwm;

      }  

      //Serial.println("a: " + p_vanchart_in); 
      //Serial.println("a: " + p_van_in); 
      //Serial.println("a: " + p_vanchart_in2); 
      //Serial.println("a: " + p_vanconf_in3); 

 }
 #endif
 //-------------------------------


 #ifdef vent_option
   void updateluefeter(){

        vent_min_stufe = p_inputvanmin.toInt();
        vent_max_stufe = p_inputvanmax.toInt();
     
        // 300
        pwm_radon_min = vent_min_stufe;  
        //Serial.println("pwm_radon_min: " + String(pwm_radon_min));                    
        // 900
        pwm_radon_max = vent_max_stufe;
        //Serial.println("pwm_radon_max: " + String(pwm_radon_max));
        // 600
        pwm_radon_range = pwm_radon_max - pwm_radon_min;
        //Serial.println("pwm_radon_range: " + String(pwm_radon_range));
        pwm_faktor = pwm_radon_range / 21;  //raster
        //Serial.println("pwm_faktor: " + String(pwm_faktor));
        //     200                  500               300
        //      0!                  100                300
        //Serial.println("fval1: " + String(fval1));
        if(fval1>vent_min_stufe){
          pwm_radon_value = fval1 - vent_min_stufe; 
        }else{
          pwm_radon_value = 0;  
        }
        //Serial.println("pwm_radon_value: " + String(pwm_radon_value));

        pwm_raster = pwm_radon_value / pwm_faktor;
        //Serial.println("pwm_raster: " + String(pwm_raster));
    
                      msg_TGp[0] = 0xFE;
                      msg_TGp[1] = 0x01;
                      msg_TGp[2] = 0x01;
                      //Serial1.write(msg_TGp, 3);
                      //Serial.println("Taste 1: ");
  
                                            
                      msg_TGm[0] = 0xFE;
                      msg_TGm[1] = 0x02;
                      msg_TGm[2] = 0x02;
                      //Serial1.write(msg_TGm, 3);
                      //Serial.println("Taste 2: ");

          if(g_CRC_ok == true){ // Daten die ankommen ok

              if (pwm_raster <= 0) {
                if(f_pwm > 0){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m0: ");

                }
              }
              else if (pwm_raster <= 1) {
                if(f_pwm < 5){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                  //Serial.println("Taste p1: ");
                }
                if(f_pwm > 5){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m1: ");
                }
              }
              else if (pwm_raster <= 2) {
                if(f_pwm < 10){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                  //Serial.println("Taste p2: ");
                }
                if(f_pwm > 10){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m2: ");
                }
              }
              else if (pwm_raster <= 3) {
                if(f_pwm < 15){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                  //Serial.println("Taste p3: ");
                }
                if(f_pwm > 15){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m3: ");
                }
              }
              else if (pwm_raster <= 4) {
                if(f_pwm < 20){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                  //Serial.println("Taste p4: ");
                }
                if(f_pwm > 20){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m4: ");
                }
              }
              else if (pwm_raster <= 5) {
                if(f_pwm < 25){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                  //Serial.println("Taste p5: ");
                }
                if(f_pwm > 25){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m5: ");
                }
              }
              else if (pwm_raster <= 6) {
                if(f_pwm < 30){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 30){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m6: ");
                }
              }
              else if (pwm_raster <= 7) {
                if(f_pwm < 35){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 35){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m7: ");
                }
              }
              else if (pwm_raster <= 8) {
                if(f_pwm < 40){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 40){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m8: ");
                }
              }
              else if (pwm_raster <= 9) {
                if(f_pwm < 45){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 45){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m9: ");
                }
              }
              else if (pwm_raster <= 10) {
                if(f_pwm < 50){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 50){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m10: ");
                }
              }
              else if (pwm_raster <= 11) {
                if(f_pwm < 55){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 55){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m11: ");
                }
              }
              else if (pwm_raster <= 12) {
                if(f_pwm < 60){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 60){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m12: ");
                }
              }
              else if (pwm_raster <= 13) {
                if(f_pwm < 65){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 65){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m13: ");
                }
              }
              else if (pwm_raster <= 14) {
                if(f_pwm < 70){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 70){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m14: ");
                }
              }
              else if (pwm_raster <= 15) {
                if(f_pwm < 75){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 75){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste m15: ");
                }
              }
              else if (pwm_raster <= 16) {
                if(f_pwm < 80){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 80){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                }
              }
              else if (pwm_raster <= 17) {
                if(f_pwm < 85){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 85){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                }
              }
              else if (pwm_raster <= 18) {
                if(f_pwm < 90){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 90){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                }
              }
              else if (pwm_raster <= 19) {
                if(f_pwm < 95){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 95){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                }
              }
              else if (pwm_raster <= 20) {
                if(f_pwm < 100){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                }
                if(f_pwm > 100){
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                }
              }
              else {
                if(f_pwm < 100){
                  Serial1.write(msg_TGp, 3);
                  tG1_page = true;
                  //Serial.println("Taste px: ");
                }else{
                  Serial1.write(msg_TGm, 3);
                  tG2_page = true;
                  //Serial.println("Taste mx: ");
                }
              }
          }
   }
   #endif
  //**************************************************************************














//******************************************************************************
//                            Update Freshbox Radon                                        *
//******************************************************************************

  //Update RGB LED colors accordingly to temp and hum values
  void updateFreshboxRadon(){

    
   // if (State_Timer_mode == 1)



    var_fresh_t = mb_radon_ist_word; // Radonwert einlesen



            //-----------------------------------------------------
            if(freshdAktiveRead == true && ms7erg >= 10){ 
              freshdAktiveRead = false; // Daten nicht mehr aktuell
              freshdAktiveRead1 = false; // Daten nicht mehr aktuell
              freshdAktiveRead2 = false; // Daten nicht mehr aktuell
              freshdAktiveRead3 = false; // Daten nicht mehr aktuell
              freshdAktiveRead4 = false; // Daten nicht mehr aktuell
              freshdAktiveRead5 = false; // Daten nicht mehr aktuell
              freshdAktiveRead6 = false; // Daten nicht mehr aktuell

              divstatus9 = divred;  // Status
              fresh_werteaktual = "<span class='Stil6'>Freshbox connect error</div>";
            }
            //-----------------------------------------------------    

              #ifdef Freshebug3
                Serial.println(String(p_time) + " --> Lüfter schreiben");  
              #endif


    if(freshdAktiveRead == true && ms7erg <= 9 && var_fresh_t > 0){  // Auslesen erfolgreich und letzte Abfrage unter 10min und Radon größer als 0

              #ifdef Freshebug3
                Serial.println(" ......");  
              #endif

      //-----------------------------------------------------------------------------------------------
      if(p_inputfunktion == "on"){    //Wächerfuntion EIN     Senden auch bei Lüfter AUS  


            //####################################################################################
            // ist Radonwert über der Stufe 1, nur dann einschaltem
            if(var_fresh_t > b_inputStufe1){
                 
                  #ifdef Freshebug3
                    Serial.println(String(p_time) + " --> Lüfter ansteuern -> Radonwert erreicht!");  
                  #endif


                //***********************************************************************************************
                if(State_Calender_mode == 1){  // State Calender mode ON
                      //-- Radon über Lüfterstufe 1 ---
                      #ifdef Freshebug3
                        Serial.println(String(p_time) + " --> Lüfter ist im Kalendermodus aktiv!");  
                      #endif

                        //? das muss nicht hier sein weil erst eingeschaltet werden muss
                        senden_Lueferstufe = true; // Dennoch senden auch wenn Lüfter aus
                            
                              m_analge_war_kalendermodus = true; // Merker das aNLAGE im Kalendermodus war und dieser eingeschaltet wurde
                              
                              caseFreshSchreiben = 5; //wechsel auf schreiben Anlage EIN/AUS     // 0=Anlage Stufe_1-5      1= Anlage EIN/AUS     2=Boost EIN    3=Boost AUS   4=Kalender EIN   5=Kalender AUS
                              w_dummy_data_ein = S_AnlageAus; //Anlage EIN , also erst mal einschalten

                              freshreWriteafteron = 1; //auf 1 setzten für zweites schreiben, Lüftungsstufe


                }else{
                    
                      #ifdef Freshebug3
                        Serial.println(String(p_time) + " --> Lüfter ist nicht im Kalendermodus");  
                      #endif
                   
                      //-- Radon über Lüfterstufe 1 ---
                      //--- Kalendermode ist AUS -------
                      //-----------------------------------------------------------------------
                      if(State_Power == 1)   // Lüfter ist Eingeschaltet
                      {

                          senden_Lueferstufe = true; // Dennoch senden auch wenn Lüfter aus
                          #ifdef Freshebug3
                            Serial.println(String(p_time) + " --> Lüfter ist schon eingeschaltet");  
                          #endif

                      }else{ 

                          #ifdef Freshebug3
                            Serial.println(String(p_time) + " --> Lüfter einschalten und senden weil Lüfter ausgeschaltet ist");  
                          #endif

                        //? das muss nicht hier sein weil erst eingeschaltet werden muss
                        senden_Lueferstufe = true; // Dennoch senden auch wenn Lüfter aus
                              State_Power = 1;   //hier muss ich einfach 1 setzen damit beim erneuten durchlaufen hier nicht gelandet wird sondern bei Lüftungsstufe
                            
                              //????  soll ich mir das merken, das man wieder auschalten kann  ??????

                              m_analge_war_aus = true; // Merker das aNLAGE AUS war und eingeschaltet wurde

                              caseFreshSchreiben = 1; //wechsel auf schreiben Anlage EIN/AUS     // 0=Anlage Stufe_1-5      1= Anlage EIN/AUS     2=Boost EIN    3=Boost AUS   4=Kalender EIN   5=Kalender AUS
                              w_dummy_data_ein = S_AnlageEin; //Anlage EIN , also erst mal einschalten

                              freshreWriteafteron = 1; //auf 1 setzten für zweites schreiben, Lüftungsstufe
                              
                      }
                      //-----------------------------------------------------------------------


                }
                //***********************************************************************************************




            }else{

              #ifdef Freshebug3
                Serial.println(String(p_time) + " --> Lüfter noch nicht einschalten weil Radonwert noch unter Stufe 1");  
              #endif

            }
            //####################################################################################
        
          // hier vielleicht erst Lüfter einschalten !!!!!!!!!!!!!!!!!!!!!!!!!


      }else{  //Wächerterfunktion AUS

          // Wächterfunktion ist aus  Kalenderfuktion  
          if(State_Calender_mode == 0 && State_Timer_mode == 0){  //keine Kalendefrunktion und keine Timerfunktion aktiv
            if(State_Power == 1) // Lüfter ist Eingeschaltet
            {
              senden_Lueferstufe = true; // Dennoch senden auch wenn Lüfter aus
            }else{ 
              senden_Lueferstufe = false; //nicht senden, weil Wächterfunktion aus ist
            }
          }

      }
      //------------------------------------------------------------------------------------------------------------


      if (freshdAktiveConfig == 1 && senden_Lueferstufe == true){  //Freshbox Funktion Eingeschaltet und Lüfter darf angesteuert werden       if(p_sett14 == 1){  //Setting Freshbox  
       
        // if(m_boost_aktive == true){
          // w_dummy_data_boost = 2; // Boost ausschalten              // 0=nur lüftungsstufen   2=Boost AUS     6=Boost EIN
        // }else{
           w_dummy_data_boost = 0; //Kein Boot, nur Lüftungsstufen   // 0=nur lüftungsstufen   2=Boost AUS     6=Boost EIN
         //}
              #ifdef InfoDebug
                Serial.println(p_time + " | FRESHBOX Data Send");
              #endif


          if(var_fresh_t < b_inputStufe1){
              #ifdef Freshebug3
                 Serial.println("--> Stufe 0");  
              #endif
              if(State_Speed_mode>=2){
                  w_dummy_data = S_Stufe_1;
                  toggleSchreiben = 2; // 1=lesen  2=schreiben
              }
              //hier könnte man die Anlage noch abschalten zum Strom sparen
              if(m_analge_war_aus == true){ // Merker das aNLAGE AUS war und eingeschaltet wurde
                m_analge_muss_aus_schalten = true;
                m_analge_war_aus = false; // merker löschen

              }


          }else if(var_fresh_t < b_inputStufe2){
              #ifdef Freshebug3
                 Serial.println("--> Stufe 1");  
              #endif
              w_dummy_data = S_Stufe_1;
              toggleSchreiben = 2; // 1=lesen  2=schreiben


          }else if(var_fresh_t < b_inputStufe3){
              #ifdef Freshebug3
                 Serial.println("--> Stufe 2");  
              #endif
              w_dummy_data = S_Stufe_2;
              toggleSchreiben = 2; // 1=lesen  2=schreiben



          }else if(var_fresh_t < b_inputStufe4){
              #ifdef Freshebug3
                 Serial.println("--> Stufe 3");  
              #endif
              w_dummy_data = S_Stufe_3;
              toggleSchreiben = 2; /// 1=lesen  2=schreiben



          }else if(var_fresh_t < b_inputStufe5){
              #ifdef Freshebug3
                 Serial.println("--> Stufe 4");  
              #endif
              w_dummy_data = S_Stufe_4;
              toggleSchreiben = 2; // 1=lesen  2=schreiben


          }else if(var_fresh_t < b_inputStufe6){
              #ifdef Freshebug3
                 Serial.println("--> Stufe 5");  
              #endif
              w_dummy_data = S_Stufe_5;
              toggleSchreiben = 2; // 1=lesen  2=schreiben

          //}else{

              //#ifdef Freshebug3
                // Serial.println("--> Stufe Boost");  
              //#endif
              //w_dummy_data_boost = S_Stufe_6;    // 0=nur lüftungsstufen   2=Boost AUS     6=Boost EIN

             //toggleSchreiben = 2; // 1=lesen  2=schreiben
              


          }

           werteaktual_f = "<span class='Stil5'>L&uuml;fter Daten gesendet</div>";


              
      }

    }  // freshdAktiveRead  und  ms7erg <= 10

  }
  //******************************************************************************











//******************************************************************************
//                            Update LED                                        *
//******************************************************************************

  //Update RGB LED colors accordingly to temp and hum values
  void updateColors(){
   

      strip1.clear();
      #ifdef ESP32_PiCO_EVENT
        // tp.DotStar_SetPixelColor( 255, 128, 0 );
        tp.DotStar_Clear();
      #endif


    //Number of lit LEDs (temperature)
    int tempLEDs;
    long Farbe;
    tempLEDs = LED_COUNT;
      //if (p_sett09 == 1){  //view LED Eingeschaltet  
       
       // if (ledAktiveConfig == true){

        //if(p_sett21 == 1){
          var_led_t = mb_radon_ist_word;
        //}else{
          //var_led_t = eco2val1;
        //}



         //---------------------------------------------------------
         vredTo = ledRedVal + 100;    //rot ende     
         if(var_led_t>vredTo){
           vredTo = var_led_t + 20; //rot ende 
         }

         val3max = vredTo;  
         
         vredFrom = ledRedVal;      //rot start          ledRedVal;

         vyellowTo = ledRedVal;      //orange ende       ledRedVal;
         vyellowFrom = ledOrangeVal;    //orange start       ledOrangeVal;
         vgreenTo = ledOrangeVal;       //grün ende          ledOrangeVal;
         vgreenFrom = 10;
         //---------------------------------------------------------

          //vredTo = 400;

         
          if(var_led_t < ledGreenVal){
              #ifdef LEDDebug
                 Serial.println("--> LED off");  
              #endif
              Farbe = strip1.Color(0, 20, 0); //grün dunkel
              #ifdef ESP32_PiCO_EVENT
                if (ledAktiveConfig == true){  //view LED Eingeschaltet 
                tp.DotStar_SetPixelColor( 0, 20, 0 ); //grün dunkel
                }
                //tp.DotStar_Clear();
              #endif
              bgcolor_vorgabe = bgcolor_g;
              val3_color = "0, 250, 0, 0.3";  //grün



          }else if(var_led_t < ledOrangeVal){
              #ifdef LEDDebug
                 Serial.println("--> LED Green");  
              #endif
              Farbe = strip1.Color(0, ledgammaVal, 0);//grün
              #ifdef ESP32_PiCO_EVENT
                 if (ledAktiveConfig == true){  //view LED Eingeschaltet 
                 tp.DotStar_SetPixelColor( 0, ledgammaVal, 0 );
                 }
               // tp.DotStar_Clear();
              #endif
              bgcolor_vorgabe = bgcolor_g;
              val3_color = "0, 250, 0, 0.3";  //grün


          }else if(var_led_t < ledRedVal){
              #ifdef LEDDebug
                 Serial.println("--> LED Orange");  
              #endif
              Farbe = strip1.Color(ledgammaVal, ledgammaVal/3, 0);//orange
              #ifdef ESP32_PiCO_EVENT
                 if (ledAktiveConfig == true){  //view LED Eingeschaltet 
                 tp.DotStar_SetPixelColor(ledgammaVal, ledgammaVal/3, 0);
                 }
                //tp.DotStar_Clear();
              #endif
              bgcolor_vorgabe = bgcolor_o;
              val3_color = "250, 200, 0, 0.3"; //orange


          }else{

              #ifdef LEDDebug
                 Serial.println("--> LED Red");  
              #endif
              //Turn on LEDs RED
              
               /*
              for(int i=0; i<tempLEDs; i++) {
                //Serial.println(String(i));  
                strip1.setPixelColor(i, strip1.Color(ledgammaVal, 0, 0)); //rot
                strip1.show(); 
                delay(50); 
                strip1.setPixelColor(i, strip1.Color(0, 0, 0)); //rot 
              }
               */
              
              Farbe = strip1.Color(ledgammaVal, 0, 0);//rot
              #ifdef ESP32_PiCO_EVENT
                 if (ledAktiveConfig == true){  //view LED Eingeschaltet 
                 tp.DotStar_SetPixelColor(ledgammaVal, 0, 0);
                 }
                //tp.DotStar_Clear();
              #endif
              bgcolor_vorgabe = bgcolor_r;
              val3_color = "250, 0, 0, 0.3"; //rot


          }

          //Serial.println(val3_color);  


            if (ledAktiveConfig == true){  //view LED Eingeschaltet 
            strip1.fill(Farbe, 0, tempLEDs);
            strip1.show();
            }

        if (ledAktiveConfig == false){

              //Turn off LEDs 
              Farbe = strip1.Color(0, 0, 0);//off
              strip1.fill(Farbe, 0, tempLEDs);
              strip1.show();
              #ifdef ESP32_PiCO_EVENT
                // tp.DotStar_SetPixelColor(ledgammaVal, 0, 0);
                tp.DotStar_Clear();
              #endif
        }

     // }   if (p_sett09 == 1){  //view LED Eingeschaltet  deaktiviert, weil Gauge auch verwendet wird
      
      if (ledAktiveConfig == false){  //view LED Ausgeschaltet  
              //Turn off LEDs 
              Farbe = strip1.Color(0, 0, 0);//off
              strip1.fill(Farbe, 0, tempLEDs);
              strip1.show();
              #ifdef ESP32_PiCO_EVENT
                // tp.DotStar_SetPixelColor(ledgammaVal, 0, 0);
                tp.DotStar_Clear();
              #endif
              
      }




  }
  //******************************************************************************



  //******************************************************************************
  String header;
  //uint16_t webport_t = 80;
   uint16_t webport_t = atoi(p_inputwebport.c_str());

   void on_AsyncWebServer()
  {
      // Set web server port number to 80
      //WiFiServer server(webport);

      //p_inputwebport.toCharArray(p_inputwebportc, 4); 
      //uint16_t webport_t = atoi(p_inputtcpportc); 
      webport_t = atoi(p_inputwebport.c_str());


     
  }  
     
      

      AsyncWebServer server(webport_t);
      //AsyncWebSocket ws("/ws");
      //AsyncEventSource events("/events");


     // Variable to store the HTTP request
  
     

  //******************************************************************************




   //****************************************************************** 
  // getsearch
   void on_Led_Ip()
  {
  
      long Farbe;
      uint16_t led_tine_off = 100;
      uint16_t led_tine_on = 350; 

 
      int led_ip_1;
      int led_ip_2;
      int led_ip_3;

      led_ip_1 = hundreds;
      led_ip_2 = tens;
      led_ip_3 = ones;
     
      //Serial.println("- " + String(hundreds));
      //Serial.println("- " + String(tens));
      //Serial.println("- " + String(ones));


        Farbe = strip1.Color(153, 51, 255); //lila
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(50);
        Farbe = strip1.Color(0, 0, 0); //
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(50);
        Farbe = strip1.Color(153, 51, 255); //lila
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(50);        
        Farbe = strip1.Color(0, 0, 0); //
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(50);
        Farbe = strip1.Color(153, 51, 255); //lila
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(50);
        Farbe = strip1.Color(0, 0, 0); //
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(1000);

            

      for(int i=0; i<led_ip_1; i++) {
      
        Farbe = strip1.Color(255, 255, 255);
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(led_tine_off);

        Farbe = strip1.Color(0, 0, 0);
        strip1.fill(Farbe, 0, 255);
        strip1.show(); 
        delay(led_tine_on);

      }

      delay(1000);

      for(int i=0; i<led_ip_2; i++) {
      
        Farbe = strip1.Color(255, 0, 0);
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(led_tine_off);

        Farbe = strip1.Color(0, 0, 0);
        strip1.fill(Farbe, 0, 255);
        strip1.show(); 
        delay(led_tine_on);

      }

      delay(1000);

      for(int i=0; i<led_ip_3; i++) {
      
        Farbe = strip1.Color(0, 255, 0);
        strip1.fill(Farbe, 0, 255);
        strip1.show();
        delay(led_tine_off);

        Farbe = strip1.Color(0, 0, 0);
        strip1.fill(Farbe, 0, 255);
        strip1.show(); 
        delay(led_tine_on);

      } 

      

      //aus
      Farbe = strip1.Color(0, 0, 0);
      strip1.fill(Farbe, 0, 255);
      strip1.show(); 

      delay(3000);

  }
  //****************************************************************************





   //****************************************************************** 
  // getsearch
   void on_LED_Search()
  {
  
      p_getsearch = "0";
      int vorgabetime = 0;
      

      if (gLedSearchFlag == false){
        vorgabetime = 10;
      }else{
        vorgabetime = 100;
      }
      

      int tempLEDstart;
      int tempLEDboot = vorgabetime;
      long Farbe;
      tempLEDstart = LED_COUNT;

        for(int u=0; u<tempLEDboot; u++) {
           for(int i=0; i<tempLEDstart; i++) {
             if (gLedDeleteFlag == true){
               strip1.setPixelColor(i, strip1.Color(153, 51, 255)); //lila
             }else{  
               strip1.setPixelColor(i, strip1.Color(255, 255, 255)); //weiss
             }
             strip1.show(); 
             delay(50); 
             strip1.setPixelColor(i, strip1.Color(0, 0, 0)); //aus 
          }
        }
              
        Farbe = strip1.Color(0, 0, 0);
        strip1.fill(Farbe, 0, tempLEDstart);
        strip1.show();

        gledUpdateFlag = true;  // farbe einstellen wie aktuell gefordert
        gLedDeleteFlag = false;  // bit löschen für delete Garph
        gLedSearchFlag = false;  // Search bit löschen

 } 
  //****************************************************************** 



#ifdef PCB_v_7
//------------------------------------------------------------------------------------
 #ifdef v_4_20_mA_3 

       void sendHeader() {
      // Vorwort laut Datenblatt Seite 18

        digitalWrite(DA,0); // 0: auf DAC0 ausgeben
        CLOCK
        digitalWrite(DA,0); // 1 = gepuffert  0 = Unbuffered
        CLOCK
        digitalWrite(DA,1); // Gain:    1= 1x (VOUT = VREF * D/4096)      0=  2x (VOUT = 2 * VREF * D/4096)
        CLOCK
        digitalWrite(DA,1); // Chip aktiv
        CLOCK
      }   
    
    
    
      void sendWert(int wert) {
      // Header und Wert ausgeben
      
        digitalWrite(CS,0);       // Chip wählen
        sendHeader();             // Header senden
        for(int i=11;i>=0;i--){   // Daten senden
          digitalWrite(DA,((wert&(1<<i)))>>i);
          CLOCK
        }
        digitalWrite(CS,1);      // Chip abwählen
      }
      


  #endif  
//------------------------------------------------------------------------------------







//------------------------------------------------------------------------------------
 #ifdef v_4_20_mA 

      
      void analogWrite_ADC()
      {
       
        
            MCP.begin(5);
            //int channel = 0;
            //MCP.analogWrite(ao1_set_ADC, channel);
            //Serial.println(ao1_set_ADC);
            
            
            Serial.println("fastWriteA: " + String(ao1_set_ADC));
            MCP.fastWriteA(ao1_set_ADC);




      }  
  
  
  
      void analogWrite_test()
      {
        Serial.println(" ");
        Serial.println(__FUNCTION__);
        
      MCP.analogWrite(0, 0);
       /*
        for (int channel = 0; channel < MCP.channels(); channel++)
        {
          Serial.println("channel: " + String(channel));
          for (uint16_t value = 0; value < MCP.maxValue(); value += 0xFF)
          {
            
            MCP.analogWrite(value, channel);
            Serial.print(channel);
            Serial.print(" | ");
            Serial.println(value);
            //Serial.print("\t");
            //Serial.println(analogRead(A0));
            esp_task_wdt_reset();
            delay(200);
          }
            MCP.analogWrite(0, channel);
            Serial.print(channel);
            Serial.print(" | ");
            Serial.println(value);
        }
          */

      }


      void performance_test()
      {
        Serial.println();
        Serial.println(__FUNCTION__);

        start = micros();
        for (uint16_t value = 0; value < MCP.maxValue(); value++)
        {
          x = MCP.analogWrite(value, 0);
        }
        stop = micros();
        Serial.print(MCP.maxValue());
        Serial.print(" x MCP.analogWrite():\t");
        Serial.print(stop - start);
        Serial.print("\t");
        Serial.println((stop - start) / (MCP.maxValue() + 1.0) );
        delay(10);
        //esp_task_wdt_reset();

        start = micros();
        for (uint16_t value = 0; value < MCP.maxValue(); value++)
        {
          MCP.fastWriteA(value);
        }
        stop = micros();
        Serial.print(MCP.maxValue());
        Serial.print(" x MCP.fastWriteA():\t");
        Serial.print(stop - start);
        Serial.print("\t");
        Serial.println((stop - start) / (MCP.maxValue() + 1.0) );
        delay(10); 
      }

  #endif  
//------------------------------------------------------------------------------------


#endif  //#define PCB_v_7







 //******************************************************************************
 //                          Pushover PushSafer
 //******************************************************************************
#ifdef Pushover
WiFiClient client2;

 
//******************************************************************************
 String push_title = "                              ";
 String push_message = "                                                                                                    ";
#endif

/*
SOUND
0 = Lautlos
1 = Ahem (IM)
2 = Applaus (Mail)
3 = Pfeil (Reminder)
4 = Baby (SMS)
5 = Glocke (Alarm)
6 = Fahrradklingel (Alarm2)
7 = Boing (Alarm3)
8 = Buzzer (Alarm4)
9 = Kamera (Alarm5)
10 = Auto Hupe (Alarm6)
11 = Registrierkasse (Alarm7)
12 = Glockenspiel (Alarm8)
13 = Knarrende Tür (Alarm9)
14 = Kuckucksuhr (Alarm10)
15 = Verbindung trennen (Call)
16 = Hund (Call2)
17 = Türklingel (Call3)
18 = Fanfare (Call4)
19 = Pistole (Call5)
20 = Hupen (Call6)
21 = Maultrommel (Call7)
22 = Morsen (Call8)
23 = Elektrizität (Call9)
24 = Radio Tuner (Call10)
25 = Sirene
26 = Militär Trompeten
27 = Ufo
28 = Whah Whah Whah
29 = Mann sagt Goodbye
30 = Mann sagt Hello
31 = Mann sagt No
32 = Mann sagt Ok
33 = Mann sagt Ooohhhweee
34 = Mann sagt Warning
35 = Mann sagt Welcome
36 = Mann sagt Yeah
37 = Mann sagt Yes
38 = Beep kurz
39 = Weeeee kurz
40 = Cut in and out kurz
41 = Finger an Glas schnipsen kurz
42 = Wa Wa Waaaa kurz
43 = Laser kurz
44 = Wind Spiel kurz
45 = Echo kurz
46 = Zipper kurz
47 = HiHat kurz
48 = Beep 2 kurz
49 = Beep 3 kurz
50 = Beep 4 kurz
51 = The Alarm is armed
52 = The Alarm is disarmed
53 = The Backup is ready
54 = The Door is closed
55 = The Door is opend
56 = The Window is closed
57 = The Window is open
58 = The Light is off
59 = The Light is on
60 = The Doorbell rings
61 = Pager kurz
62 = Pager lang

ICONS
https://www.pushsafer.com/de/pushapi#api-read


        p_pushonoff = preferences.getString("p_pushon", "off"); 
        p_pushkey = preferences.getString("p_pushkey", "11111NoaO1ohRpg222226677"); 
        p_pushmessage = preferences.getString("p_pushmessage", "Push Message"); 
        p_pushtitle = preferences.getString("p_pushtitle", "Modbus Push"); 
        p_pushsound = preferences.getString("p_sound", "8"); 
        p_pushvibration = preferences.getString("p_vibration", "3"); 
        p_pushicon = preferences.getString("p_icon", "91"); 
        c = preferences.getString("p_iconcolor", "#FF0000"); 
        p_pushpriority = preferences.getString("p_priority", "2"); 
        p_pushdevice = preferences.getString("p_pushdevice", "41828"); 
        p_pushvalue = preferences.getString("p_pushvalue", "300"); 
        p_pushvaluei = p_pushvalue.toInt();

*/

#ifdef Pushover

  void push_nachricht()
  {

      gpushUpdateFlag = false;
     
      //p_pushvaluei = p_pushvalue.toInt();

      #ifdef PushDebug_min
        Serial.println("--> " + p_time + " Pushover connect"); 
      #endif
      //PushsaferKey = "XqLUBNqaO1oaRpggaX0h";
      PushsaferKey = p_pushkey;
      Pushsafer pushsafer(PushsaferKey, client2);

      
      if(client2.connect("pushsafer.com",80)){
         divstatus8 = divgreen;  // Status
      }else{
         divstatus8 = divred;  // Status
      }
      gpushOnlineUpdateFlag = true;

      String line_t = "                                                                                                   "; 
      String line_t2 = "                                                                                                   "; 
      
      line_t2 = p_pushmessage;
      #ifdef PushDebug
      Serial.println(line_t2);  
      #endif

        if (p_pushmessage.indexOf("xxxx")>=1) {   // Searchstring exists?
            line_t = p_pushmessage;
            uint32_t position1 = line_t.indexOf("xxxx") + 5;              
            uint32_t position4 = position1 - 5;
            uint32_t positionlen = line_t.length();
             
            //Serial.println();
            //Serial.print("--->> ");
            //Serial.println(position1);  //19
            //Serial.println(positionlen);  //39

            //Serial.print("--->> ");
            //Serial.println(line_t.substring(0, position4));  // adonwert von x
            line_t2 = line_t.substring(0, position4);
            line_t2 += p_pushvalue;      //mb_radon_ist_word
           // Serial.print("--->> ");
            //Serial.println(line_t.substring(position1, positionlen));
            line_t2 += line_t.substring(position1, positionlen);

            //r2_val1 = line_t.substring(position1, position4);

        }
        else if(p_pushmessage.indexOf("XXXX")>=1) {  

            line_t = p_pushmessage;
            uint32_t position1 = line_t.indexOf("XXXX") + 5;              
            uint32_t position4 = position1 - 5;
            uint32_t positionlen = line_t.length();
             
            //Serial.println();
            //Serial.print("--->> ");
            //Serial.println(position1);  //19
            //Serial.println(positionlen);  //39

            //Serial.print("--->> ");
            //Serial.println(line_t.substring(0, position4));  // adonwert von x
            line_t2 = line_t.substring(0, position4);
            line_t2 += p_pushvalue;   //eco2val1
           // Serial.print("--->> ");
            //Serial.println(line_t.substring(position1, positionlen));
            line_t2 += line_t.substring(position1, positionlen);

            //r2_val1 = line_t.substring(position1, position4);
                   

        }

      //line_t2 = "Radon error";
      push_message = line_t2;
      #ifdef PushDebug
      Serial.println(line_t2);  
      #endif

      struct PushSaferInput input;
      input.message = push_message;
      input.title = p_pushtitle;
      //input.sound = "8";
      input.sound = p_pushsound;
      //input.vibration = "3";
      input.vibration = p_pushvibration;
      //input.icon = "91";
      input.icon = p_pushicon;
      //input.iconcolor = "#FF0000";
      input.iconcolor = "#";
      input.iconcolor += p_pushiconcolor;
      //input.priority = "2";
      input.priority = p_pushpriority;
      //input.device = "41828";      // Device ID:  http://pushsafer.com
      input.device = p_pushdevice;  
      pushsafer.sendEvent(input);
      

      #ifdef PushDebug
      Serial.println(String(p_time) + " | Pushover send!");  
      #endif
     
      #ifdef PushDebug_min
        Serial.println("--> " + p_time + " Pushover send"); 
      #endif

     

  }
//******************************************************************************

#endif







//******************************************************************************
#ifdef Push2
//WiFiClient config;

gpushUpdateFlag = false;

//Config config;
char pushMessage[100];
bool testPushover = false;
char batCharString[5];


//globals
struct Config {//full configuration file
  char ssid[50];
  char pw[50];
  int wifiTimeout;

  char trigSelect[10];
  char triggerOpensMessage[50];
  char triggerClosesMessage[50];
  char buttonMessage[50];
  int  timerCountDown;
  char timerSelect[10];
  char StillOpenMessage[50];
  char StillClosedMessage[50];
  double batteryThreshold;
  double batteryOffset;
  char pushOverEnable[3];
  char pushUserKey[50];
  char pushAPIKey[50];
  char pushSaferEnable[3];
  char pushSaferKey[50];
  char iftttEnable[3];
  char iftttMakerKey[50];
  char udpEnable[3];
  char tcpEnable[3];
  char udpTargetIP[20];
  char udpStaticIP[20];
  char udpGatewayAddress[20];
  char udpSubnetAddress[20];
  char udpPrimaryDNSAddress[20];
  char udpSecondaryDNSAddress[20];
  char udpSSID[50];
  char udpPW[50];
  int udpPort;
  char rtcCountdownMinute[3];
  char mqttEnable[3];
  int mqttPort;
  char mqttServer[50];
  char mqttTopic[50];
  char mqttSecureEnable[3];
  char mqttUser[50];
  char mqttPW[50];
  char staticIPenable[3];
  char staticIP[20];
  char staticGatewayAddress[20];
  char staticSubnetAddress[20];
  char staticPrimaryDNSAddress[20];
  char staticSecondaryDNSAddress[20];
  int udpBlastCount;
  int udptimeBetweenBlasts;
  char highSpeed[3];

};

  char pushOverEnable[3];
  char pushUserKey[50];
  char pushAPIKey[50];
  char pushSaferEnable[3];
  char pushSaferKey[50];
   char trigName[50];
   String httpPush = "";
   String postPush = "";
   boolean _htmlPush = true;

  
            String _token = "uxmzobmehgsw7ggy91yvfee8hqf2ri";  //pushAPIKey;
            String _user = "Iphone_Holger";  //pushUserKey;
            //String _message = pushMessage;
            String _pushMessage = "Hallo ESP 32";//pushMessage;
            String _device = "Iphone_Holger";
            String _title = trigName;
            String _url = "";
            String _url_title = "";
            int8_t _priority = 0;
            uint16_t _retry;
            uint16_t _expire;
            
            //boolean _html;
            //uint16_t _timeout = 5000;
            String _sound = "bike";

    const char *root_cert =
    "-----BEGIN CERTIFICATE-----\n"
    "MIIFWjCCA0KgAwIBAgIQbkepxlqz5yDFMJo/aFLybzANBgkqhkiG9w0BAQwFADBH\n"
    "MQswCQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNlcnZpY2VzIExM\n"
    "QzEUMBIGA1UEAxMLR1RTIFJvb3QgUjIwHhcNMTYwNjIyMDAwMDAwWhcNMzYwNjIy\n"
    "MDAwMDAwWjBHMQswCQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNl\n"
    "cnZpY2VzIExMQzEUMBIGA1UEAxMLR1RTIFJvb3QgUjIwggIiMA0GCSqGSIb3DQEB\n"
    "AQUAA4ICDwAwggIKAoICAQDO3v2m++zsFDQ8BwZabFn3GTXd98GdVarTzTukk3Lv\n"
    "CvptnfbwhYBboUhSnznFt+4orO/LdmgUud+tAWyZH8QiHZ/+cnfgLFuv5AS/T3Kg\n"
    "GjSY6Dlo7JUle3ah5mm5hRm9iYz+re026nO8/4Piy33B0s5Ks40FnotJk9/BW9Bu\n"
    "XvAuMC6C/Pq8tBcKSOWIm8Wba96wyrQD8Nr0kLhlZPdcTK3ofmZemde4wj7I0BOd\n"
    "re7kRXuJVfeKH2JShBKzwkCX44ofR5GmdFrS+LFjKBC4swm4VndAoiaYecb+3yXu\n"
    "PuWgf9RhD1FLPD+M2uFwdNjCaKH5wQzpoeJ/u1U8dgbuak7MkogwTZq9TwtImoS1\n"
    "mKPV+3PBV2HdKFZ1E66HjucMUQkQdYhMvI35ezzUIkgfKtzra7tEscszcTJGr61K\n"
    "8YzodDqs5xoic4DSMPclQsciOzsSrZYuxsN2B6ogtzVJV+mSSeh2FnIxZyuWfoqj\n"
    "x5RWIr9qS34BIbIjMt/kmkRtWVtd9QCgHJvGeJeNkP+byKq0rxFROV7Z+2et1VsR\n"
    "nTKaG73VululycslaVNVJ1zgyjbLiGH7HrfQy+4W+9OmTN6SpdTi3/UGVN4unUu0\n"
    "kzCqgc7dGtxRcw1PcOnlthYhGXmy5okLdWTK1au8CcEYof/UVKGFPP0UJAOyh9Ok\n"
    "twIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNV\n"
    "HQ4EFgQUu//KjiOfT5nK2+JopqUVJxce2Q4wDQYJKoZIhvcNAQEMBQADggIBALZp\n"
    "8KZ3/p7uC4Gt4cCpx/k1HUCCq+YEtN/L9x0Pg/B+E02NjO7jMyLDOfxA325BS0JT\n"
    "vhaI8dI4XsRomRyYUpOM52jtG2pzegVATX9lO9ZY8c6DR2Dj/5epnGB3GFW1fgiT\n"
    "z9D2PGcDFWEJ+YF59exTpJ/JjwGLc8R3dtyDovUMSRqodt6Sm2T4syzFJ9MHwAiA\n"
    "pJiS4wGWAqoC7o87xdFtCjMwc3i5T1QWvwsHoaRc5svJXISPD+AVdyx+Jn7axEvb\n"
    "pxZ3B7DNdehyQtaVhJ2Gg/LkkM0JR9SLA3DaWsYDQvTtN6LwG1BUSw7YhN4ZKJmB\n"
    "R64JGz9I0cNv4rBgF/XuIwKl2gBbbZCr7qLpGzvpx0QnRY5rn/WkhLx3+WuXrD5R\n"
    "RaIRpsyF7gpo8j5QOHokYh4XIDdtak23CZvJ/KRY9bb7nE4Yu5UC56GtmwfuNmsk\n"
    "0jmGwZODUNKBRqhfYlcsu2xkiAhu7xNUX90txGdj08+JN7+dIPT7eoOboB6BAFDC\n"
    "5AwiWVIQ7UNWhwD4FFKnHYuTjKJNRn8nxnGbJN7k2oaLDX5rIMHAnuFl2GqjpuiF\n"
    "izoHCBy69Y9Vmhh1fuXsgWbRIXOhNUQLgD1bnF5vKheW0YMjiGZt5obicDIvUiLn\n"
    "yOd/xCxgXS/Dr55FBcOEArf9LAhST4Ldo/DUhgkC\n"
    "-----END CERTIFICATE-----\n";



//******************************************************************************
  void push_nachricht2()
  {


   //boolean pushOver() {
          //if (strcmp(config.pushOverEnable, "t") == 0) {//only if enabled

            WiFiClientSecure clientsec;
            uint32_t _timestamp = 0;
            //uint32_t postPushLength = 0;

            Serial.println("sending to pushover");
            Serial.println(_pushMessage);

          
            postPush = "token="; 
            postPush += _token;
            postPush += "&user="; 
            postPush += _user;
            postPush += "&title="; 
            postPush += _title;
            postPush += "&message="; 
            postPush += _pushMessage;
            postPush += "&device"; 
            postPush += _device;
            postPush += "&url="; 
            postPush += _url;
            postPush += "&url_title="; 
            postPush += _url_title;
            postPush += "&priority="; 
            postPush += _priority;
            postPush += "&retry="; 
            postPush += _retry;
            postPush += "&expire=";
            postPush += _expire;
            postPush += "&sound="; 
            postPush += _sound;

            if (_timestamp != 0) postPush += String("&timestamp=") + _timestamp;

            Serial.println(postPush);
          
          
            clientsec.setCACert(root_cert);          // Setze Google Fingerprint
         
            if (!clientsec.connect("api.pushover.net", 443)) {  // Starte SSL Verbindung   
              Serial.println("couldn't connect..");
              //clientsec.stop();
              return;
            }

            //String post = String("token=") + _token + "&user=" + _user + "&title=" + _title + "&message=" + _message + "&device=" + _device + "&url=" + _url + "&url_title=" + _url_title + "&priority=" + _priority + "&retry=" + _retry + "&expire=" + _expire + "&sound=" + _sound;

            //Serial.println(post);
            
            //if (_htmlPush == true) postPush += String("&html=1");
             //= String("POST /1/messages.json HTTP/1.1\r\nHost: api.pushover.net\r\nConnection: close\r\nAccept: Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nContent-Length: ") + post.length() + "\r\n\r\n" + post;
            //postPushLength = postPush.length();
           
            httpPush = "POST /1/messages.json HTTP/1.1\r\nHost: api.pushover.net\r\nConnection: close\r\nAccept: Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nContent-Length: " + String(postPush.length()) + "\r\n\r\n" + postPush;
            clientsec.print(httpPush);
            //let's wait for something to come back... only a few seconds
            unsigned long startTimePush = millis();
            while (millis() - startTimePush < 5000) {
              if (clientsec.available()){
                Serial.println("From Server");
                break;
              }
            }
            while (clientsec.available() != 0) {
              Serial.print(char(clientsec.read()));
            }
            clientsec.stop();

            //return true;

          //}
         // return false;
        //}


  }
  #endif
  //******************************************************************************




  //******************************************************************************
    #ifdef test_dns
    WiFiClient Client;
    #endif
  //******************************************************************************




  //******************************************************************************
    #ifdef Unix_Zeit
    // Variable to save current epoch time
    unsigned long epochTime; 
     
    // Function that gets current epoch time
    unsigned long getTime() {
      time_t now;
      struct tm timeinfo;
      if (!getLocalTime(&timeinfo)) {
        //Serial.println("Failed to obtain time");
        return(0);
      }
      time(&now);
      return now;
    }
    #endif
  //******************************************************************************






    #ifdef o_ThingsBoard3


        // Message arrived [/provision/response] le:95  {"credentialsValue":"ZQbwwGqhBbrfd3mYC3op","credentialsType":"ACCESS_TOKEN","status":"SUCCESS"}
        // {"errorMsg":"Failed to provision device!","status":"FAILURE"}
        void callback(char* topic, byte* payload, unsigned int length) {
          
          #ifdef MQTT_DEBUG
            Serial.print("Message arrived [");
            Serial.print(topic);
            Serial.print("] len:");
            Serial.print(String(length));
            Serial.print("  ");
          #endif

          payload_respone = "";


          for (int i = 0; i < length; i++) {
            //Serial.print((char)payload[i]);
            payload_respone = payload_respone + String((char)payload[i]);
          }
          //Serial.println();
          #ifdef MQTT_DEBUG
            Serial.println(payload_respone);
          #endif


          //----------------------------------------------
        
          // if(topic == "/provision/response"){}

          // if(topic == "v1/devices/me/attributes"){}

          //----------------------------------------------



            // {"errorMsg":"Failed to provision device!","status":"FAILURE"}
            if (strstr(payload_respone.c_str(), "ACCESS_TOKEN") != NULL)
            {

              if (strstr(payload_respone.c_str(), "SUCCESS") != NULL)
              {
                //Serial.println("SUCCESS");

                  if (strstr(payload_respone.c_str(), "credentialsValue") != NULL)
                  {
                    //Serial.println("credentialsValue");
                    
                      //  suchen  
                      int Suche1 = payload_respone.indexOf("credentialsValue"); 
                      //Serial.print("Position1 : "); 
                      //Serial.println(Suche1); //2

                      //  suchen  
                      int Suche2 = payload_respone.indexOf("credentialsType"); 
                      //Serial.print("Position2 : "); 
                      //Serial.println(Suche2); //44

                      // {"credentialsValue":"ZQbwwGqhBbrfd3mYC3op","credentialsType":
                      //   2+19                                      44-3
                      payload_token = payload_respone.substring(Suche1+19, Suche2-3); 
                      #ifdef MQTT_DEBUG
                        Serial.println("Provision Device Key erhalten.");
                        Serial.println(payload_token);
                      #endif

                      p_inputmquser = payload_token;
                      gACCESS_TOKENFlag = 1;  // provision fertig
                      WriteMqttToken();

                      client.disconnect();


                  }

              }

            }

          





        }
        //-------------------------------------------------------------------------------------------------------

        void(* resetFunc) (void) = 0;
        //-------------------------------------------------------------------------------------------------------





        //-------------------------------------------------------------------------------------------------------
           // o_ThingsBoard4
        String publish(String url, String postData) {

          client.publish(url.c_str(), postData.c_str());

              #ifdef InfoDebug
              Serial.println(p_time + " | MQTT publish c");
              #endif
                 
                    #ifdef MQTT_DEBUG
                    Serial.println("--> MQTT P Topic   : " + url);
                    Serial.println("--> MQTT P publish: " + postData);
                    #endif

          // read the status code and body of the response
          return "";
        }
        //-------------------------------------------------------------------------------------------------------




           //availableKeys: ['radon1', 'radon2', 'radon3', 'radon4] -> save as server attribute. if keys are updated, attribute should be changed
        void serverAttributeDevice() {
        
                   //   https://avantec-thingsboard.readthedocs.io/en/latest/thingsboard/thingsboard-mqtt-device-api.html  
                     
                     
                        char attributes[1000];
                        String payload8 = "";

                                  //***********************************************
                                  //--- Client attributes SEND
                                 

      
                                  //----- schreibe client keys
                                  //payload8 = "{\"availableKeys\":\"['radon1','radon2','radon3','radon4']\",\"uptime\":\"";     // {"availableKeys":"radon1"}
                                  
                                  payload8 = "{\"availableKeys\":\"";  
                                  payload8 += availableKeys; 
                                  payload8 += "\",\"uptime\":\""; 
                                  payload8 += String(epochTime_mqtt_minus);
                                  payload8 += "\"}";  
                                  payload8.toCharArray(attributes, 1000);
                                  client.publish(publishTopic3, attributes);  //  v1/devices/me/attributes
                                  #ifdef MQTT_DEBUG
                                    Serial.println(String(p_time) + " | --> MQTT publish Client Keys : " + String(publishTopic3) + " | " + payload8); 
                                  #endif



                                   // ACTIVITY_EVENT   SERVER_SCOPE   	lastConnectTime
                                  //********************************************************************************************
                                  //---- abboniere Attributes
                                  //client.subscribe(publishTopic5);  // v1/devices/me/rpc/response/+
                                  //---- abboniere sie Keys die gelsen werden sollen -----
                                  //payload8 = "{\"params\":\"lastSync,lastConnectTime,provisionState\"}"; 
                                  //payload8.toCharArray(attributes, 1000);
                                  //client.publish(publishTopic6, attributes); 
                                  //********************************************************************************************



                    //#ifdef MQTT_DEBUG
                    //Serial.println("--> MQTT S Topic   : " + String(publishTopic3));
                    //Serial.println("--> MQTT S attributes: " + String(attributes));
                   // #endif
        


        }
        //-------------------------------------------------------------------------------------------------------




        //availableKeys: ['radon1', 'radon2', 'radon3', 'radon4] -> save as server attribute. if keys are updated, attribute should be changed
        void clientAttributeDevice() {
        
                   //   https://avantec-thingsboard.readthedocs.io/en/latest/thingsboard/thingsboard-mqtt-device-api.html  
                     
                     
              //client.connect("dashboard.livair.io", "MymTy0F0fHVNKE1G6YNK", ""))  
              
              
              // Abo client and shared keys    
              //client.subscribe("v1/devices/me/attributes/response/+");
              //client.publish("v1/devices/me/attributes/request/1", "{\"clientKeys\":\"uptime\",\"sharedKeys\":\"shared1,shared2\"}");   
              
                
              // send to client attributs 
              //client.publish("v1/devices/me/attributes", "{\"radon1\":\"1\",\"radon2\":\"2\",\"radon3\":\"3\",\"radon4\":\"4\",\"batt\":\"1\",\"solar\":\"1\",\"uptime\":\"1654789258\"}"); 
              



              char attributes[1000];
              String payload8 = "";

              //***********************************************
              //--- Client attributes SEND
                                 
                                   
              //---- Keys aktiv lesen  -----
              //client.subscribe(RESPONSE_SUBSCRIBE_TOPIC);  // v1/devices/me/attributes/response/+
              payload8 = "{\"clientKeys\":\"uptime\",\"sharedKeys\":\"shared1,shared2\"}"; 
              payload8.toCharArray(attributes, 1000);
              client.publish(publishTopic11, attributes);  // v1/devices/me/attributes/request/$request_id  
              #ifdef MQTT_DEBUG
                Serial.println(String(p_time) + " | --> MQTT publish shared attributes: " + String(publishTopic11) + " | " + payload8);  
              #endif
  
              // ACTIVITY_EVENT   SERVER_SCOPE   	lastConnectTime
              //********************************************************************************************
                                  //---- abboniere Attributes
                                  //client.subscribe(publishTopic5);  // v1/devices/me/rpc/response/+
                                  //---- abboniere sie Keys die gelsen werden sollen -----
                                  //payload8 = "{\"params\":\"lastSync,lastConnectTime,provisionState\"}"; 
                                  //payload8.toCharArray(attributes, 1000);
                                  //client.publish(publishTopic6, attributes); 
              //********************************************************************************************



               //#ifdef MQTT_DEBUG
               //Serial.println("--> MQTT S Topic   : " + String(publishTopic3));
               //Serial.println("--> MQTT S attributes: " + String(attributes));
              // #endif
        


        }
        //-------------------------------------------------------------------------------------------------------







                  
        //-------------------------------------------------------------------------------------------------------

        void provisionDevice() {
        

                    String payload = "{\"";
                    payload += "deviceName";  //topic0
                    payload += "\":";
                    payload += device_id_s;
                    payload += ",";

                    payload += "\"";
                    payload += "provisionDeviceKey";  //topic1
                    payload += "\":";
                    payload += provisionDeviceKey;
                    payload += ",";

                    payload += "\"";
                    payload += "provisionDeviceSecret";  //topic2
                    payload += "\":";
                    payload += provisionDeviceSecret;

                    payload += "}"; 



                    char attributes[1000];

                    payload.toCharArray(attributes, 1000);
                    client.publish(publishTopic2, attributes);
                    #ifdef MQTT_DEBUG
                    Serial.println("--> MQTT P Topic   : " + String(publishTopic2));
                    Serial.println("--> MQTT P attributes: " + String(attributes));
                    #endif
        


        }
        //-------------------------------------------------------------------------------------------------------




                  void generate_device_id() {
                        char mac_add[2];
                        char hardware_revision[1];
                        char random_number[3];
                        //Serial.println(WiFi.macAddress().c_str());
                        strcpy(hardware_revision, "T");
                        //Serial.print("hardware_revision ");
                        //Serial.println(hardware_revision);
                        strcat(device_id, hardware_revision);
                        strncpy(mac_add, WiFi.macAddress().c_str(), 2);
                        strcat(device_id, mac_add);
                        memset(mac_add, 0, 2);
                        //Serial.print("mac_add ");
                        //Serial.println(mac_add);
                        int num = random(100, 999);
                        sprintf(random_number, "%d", num);
                        //Serial.print("random_number ");
                        //Serial.println(random_number);
                        strcat(device_id, random_number);
                        memset(random_number, 0, 3);
                        //Serial.print("random_number ");
                        //Serial.println(random_number);
                        strncpy(mac_add, WiFi.macAddress().c_str() + 15, 2);
                        strcat(device_id, mac_add);
                        //Serial.print("mac_add ");
                        //Serial.println(mac_add);

                        //Serial.print("device_id Char: ");
                        //Serial.println(device_id);

                        device_id_s = String(device_id);
                        //Serial.print("device_id: ");
                        //Serial.println(device_id_s);
                        //WriteMqttToken();

                          Preferences preferences;
                          preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                          preferences.putString("p_device_id", device_id_s);                         //provision Variable speichern

                  }





        #endif


        #ifdef onWIFI_wps
        /*
        Change the definition of the WPS mode
        from WPS_TYPE_PBC to WPS_TYPE_PIN in
        the case that you are using pin type
        WPS
        */
        #define ESP_WPS_MODE      WPS_TYPE_PBC
        #define ESP_MANUFACTURER  "ESPRESSIF"
        #define ESP_MODEL_NUMBER  "ESP32"
        #define ESP_MODEL_NAME    "ESPRESSIF IOT"
        #define ESP_DEVICE_NAME   "ESP STATION"

        static esp_wps_config_t config;

        void wpsInitConfig(){
          config.crypto_funcs = &g_wifi_default_wps_crypto_funcs;
          config.wps_type = ESP_WPS_MODE;
          strcpy(config.factory_info.manufacturer, ESP_MANUFACTURER);
          strcpy(config.factory_info.model_number, ESP_MODEL_NUMBER);
          strcpy(config.factory_info.model_name, ESP_MODEL_NAME);
          strcpy(config.factory_info.device_name, ESP_DEVICE_NAME);
        }

        String wpspin2string(uint8_t a[]){
          char wps_pin[9];
          for(int i=0;i<8;i++){
            wps_pin[i] = a[i];
          }
          wps_pin[8] = '\0';
          return (String)wps_pin;
        }

          void wpsStart(){
              if(esp_wifi_wps_enable(&config)){
                Serial.println("    WPS Enable Failed");
              } else if(esp_wifi_wps_start(0)){
                Serial.println("    WPS Start Failed");
              }
          }

          void wpsStop(){
              if(esp_wifi_wps_disable()){
                Serial.println("WPS Disable Failed");
              }
          }


        void WiFiEvent(WiFiEvent_t event, system_event_info_t info){
          switch(event){
            case SYSTEM_EVENT_STA_START:
              Serial.println("Station Mode Started");
              break;
            case SYSTEM_EVENT_STA_GOT_IP:
              Serial.println("Connected to :" + String(WiFi.SSID()));
              Serial.print("Got IP: ");
              Serial.println(WiFi.localIP());
              break;
            case SYSTEM_EVENT_STA_DISCONNECTED:
              Serial.println("Disconnected from station, attempting reconnection");
              WiFi.reconnect();
              break;
            case SYSTEM_EVENT_STA_WPS_ER_SUCCESS:
              Serial.println("WPS Successfull, stopping WPS and connecting to: " + String(WiFi.SSID()));
              esp_wifi_wps_disable();
              delay(10);
              WiFi.begin();
              break;
            case SYSTEM_EVENT_STA_WPS_ER_FAILED:
              Serial.println("WPS Failed, retrying");
              esp_wifi_wps_disable();
              esp_wifi_wps_enable(&config);
              esp_wifi_wps_start(0);
              break;
            case SYSTEM_EVENT_STA_WPS_ER_TIMEOUT:
              Serial.println("WPS Timedout, retrying");
              esp_wifi_wps_disable();
              esp_wifi_wps_enable(&config);
              esp_wifi_wps_start(0);
              break;
            case SYSTEM_EVENT_STA_WPS_ER_PIN:
              Serial.println("WPS_PIN = " + wpspin2string(info.sta_er_pin.pin_code));
              break;
            default:
              break;
          }
        }

        #endif


      int adjSeconds = 120; // set this to the number of seconds to adjust per day, positive values speed up clock, negative values slow clock down

      // system variables
      unsigned long prevMillis = 0;
      unsigned long sysTime = 0;  // increments once per second

      unsigned long adjustedSysTime = 0;  // increments once per second plus/minus adjsutment
      unsigned long adjustedPrevMillis = 0;


    void adjTime(unsigned long now){
      // this function adds milliseconds times adjSecs every 86 seconds
      if( now - adjustedPrevMillis >= 1000){ 
        adjustedPrevMillis += 1000;
        if( (++adjustedSysTime) % 86 == 0)  {         
          adjustedPrevMillis += adjSeconds;
          Serial.print("At adjustedSysTime= ");
          Serial.print(adjustedSysTime,DEC);
          Serial.print(" now= ");
          Serial.print(now,DEC);
          Serial.print(" now - adj=");
          Serial.print(now - adjustedPrevMillis, DEC);
          Serial.print(" adding ");
          Serial.print(adjSeconds,DEC);
          Serial.print(" msecs, adjPrevMs= ");
          Serial.println(adjustedPrevMillis,DEC);         
        }    
      }      
    }



  //******************************************************************************
  //******************************************************************************
  //**                          S E T U P                                      ***
  //******************************************************************************
  //******************************************************************************
// Setup() - initialization happens here
void setup() {



  //esp_task_wdt_init(WDT_TIMEOUT, true); //enable panic so ESP32 restarts
  //esp_task_wdt_add(NULL); //add current thread to WDT watch

    //disableCore0WDT();
    //disableCore1WDT();
    //disableLoopWDT();

  //------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
     pinMode(PIN_version, INPUT_PULLUP); // Pin als Eingang definieren (INTERNER Pullup-Wid.)    //1 = Normal Version     //0 = Nur LED Version     #define WIFI_nur_LED
   


     // neue Paltine mit Pad  
     #ifndef WIFI_nur_LED_old_pcb
      if (digitalRead(PIN_version)== HIGH){
        zustandVersion = true;  //1 = Normal Version      #define WIFI_nur_LED
      } else{
        zustandVersion = false; //0 = Nur LED Version     #define WIFI_nur_LED
      }
     #endif
     //zustandVersion = true; 

     #ifdef PCB_v_5  //ab 6 richtig
      zustandVersion = true;
     #endif

     zustandVersion = true;
     
       // alte Paltine ohne Pad  
        #ifdef WIFI_nur_LED_old_pcb
          #ifdef WIFI_nur_LED_old_version_standard
              zustandVersion = true;  //1 = Normal Version      #define WIFI_nur_LED
          #else
              zustandVersion = false; //0 = Nur LED Version     #define WIFI_nur_LED
          #endif
        #endif




       //+++++++++++++++++++++++++++++ 
       if (zustandVersion == 1){     //1 = Normal Version 
                    
         ledAktiveConfig = false;
         p_ledonoff = "off";
         p_sett09t = 0;
         p_sett09 = 0;
         p_sett09_s = p_sett09_0;
                    
       } else{
                    
         ledAktiveConfig = true;
         p_ledonoff = "on";
         p_sett09t = 1;
         p_sett09 = 1;
         p_sett09_s = p_sett09_1;

       }
       //+++++++++++++++++++++++++++++ 


      //--< GPIO >--
      //< analog >
      //*0-3,3V ->0-4095 2^12
      pinMode(PIN_AI_VSS, INPUT);  // AKKU
      pinMode(PIN_AI_VCAPA, INPUT); // SOLAR
      //</ analog >

  
     pinMode(relaisIN1, OUTPUT);  // Relais  
   //------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------




    g_mb_tracer_online_fail[1] = 2;
    g_mb_tracer_online_fail[2] = 2;
    g_mb_tracer_online_fail[3] = 2;
    g_mb_tracer_online_fail[4] = 2;
    g_mb_tracer_online_fail[5] = 2;
    g_mb_tracer_online_fail[6] = 2;
    g_mb_tracer_online_fail[7] = 2;
    g_mb_tracer_online_fail[8] = 2;
    g_mb_tracer_online_fail[9] = 2;
    g_mb_tracer_online_fail[10] = 2;





   #ifdef BLE_Serial_WG
   //void setup

        gettimeofday(&now, NULL);

        Serial.printf("start ESP32 %d\n",bootcount++);

        Serial.printf("deep sleep (%lds since last reset, %lds since last boot)\n",now.tv_sec,now.tv_sec-last);

        last = now.tv_sec;
        
        // Create the BLE Device
        BLEDevice::init("");

        // Create the BLE Server
        // BLEServer *pServer = BLEDevice::createServer(); // <-- no longer required to instantiate BLEServer, less flash and ram usage

        pAdvertising = BLEDevice::getAdvertising();
        
        setBeacon();
        // Start advertising
        pAdvertising->start();
        Serial.println("Advertizing started...");
        delay(100);
        pAdvertising->stop();
        Serial.printf("enter deep sleep\n");
        //esp_deep_sleep(1000000LL * GPIO_DEEP_SLEEP_DURATION);
        Serial.printf("in deep sleep\n");

   #endif





  //******************************************************************************
  //                              VARS CALC                                      *
  //******************************************************************************
        val3max = 300;
        vredTo = val3max;
        vredFrom = 200;
        vyellowTo = vredFrom;
        vyellowFrom = 100;
        vgreenTo = vyellowFrom;
        vgreenFrom = 50;

        val1max = 600;
        vredTo2 = val1max;
        vredFrom2 = 500;
        vyellowTo2 = vredFrom2;
        vyellowFrom2 = 400;
        vgreenTo2 = vyellowFrom2;
        vgreenFrom2 = 300;

        val2max = 60;
        vredTo3 = val2max;
        vredFrom3 = 50;
        vyellowTo3 = vredFrom3;
        vyellowFrom3 = 40;
        vgreenTo3 = vyellowFrom3;
        vgreenFrom3 = 30;

        val1_color = "0, 0, 0, 0.3";
        val2_color = "0, 0, 0, 0.3";
        val3_color = "0, 0, 0, 0.3";


  //******************************************************************************
  //                       Starte Debug Seriell                                  *
  //******************************************************************************
  Serial.begin(115200);
  while (!Serial) {}
  //Serial.println("__ Serial Debug OK __");


  #ifdef PCB_v_7
       //+++++++++++++++++++++++++++++ 
        #ifdef v_4_20_mA 
               // setup()

            //Serial.println(__FILE__);

            MCP.begin(5);
            
            Serial.print("MCP_DAC_LIB_VERSION: ");
            Serial.println(MCP_DAC_LIB_VERSION);
            Serial.println(" ");
            
            Serial.print("CHANNELS:\t");
            Serial.println(MCP.channels());
            
            Serial.print("MAXVALUE:\t");
            Serial.println(MCP.maxValue());

            Serial.print("Aktiv:\t");
            Serial.println(MCP.isActive());

            Serial.print("GAIN:\t");
            Serial.println(MCP.getGain());  //1 oder 2

            Serial.print("Speed:\t");
            Serial.println(MCP.getSPIspeed());

            Serial.print("Buffer:\t");
            Serial.println(MCP.getBufferedMode());


            delay(100);

            //MCP.setGain(0);

            //Serial.print("GAIN:\t");
            //Serial.println(MCP.getGain());
            //delay(100); 


            MCP.begin(5);
           // int channel = 0;
            


            Serial.print("GAIN:\t");
            Serial.println(MCP.getGain());

           // MCP.setPercentage(0, channel);
            //MCP.analogWrite(2048, channel);
            //Serial.println(2048);

            //Serial.println(MCP.getGain());



            
           // Serial.println("fastWriteA: " + String(ao1_set_ADC));
            //MCP.fastWriteA(ao1_set_ADC);


           // MCP.analogWrite(2048, 0);
            //MCP.fastWriteA(2048);

            //MCP.setPercentage(10, 0);

            //performance_test();
            //analogWrite_test();
            //analogWrite_calc();

            Serial.println("\nDone...");

        #endif
       //+++++++++++++++++++++++++++++ 

       //+++++++++++++++++++++++++++++ 
        #ifdef v_4_20_mA_2 

        // put your setup code here, to run once:
        myDac.begin();

        #endif
       //+++++++++++++++++++++++++++++ 



       //+++++++++++++++++++++++++++++ 
        #ifdef v_4_20_mA_3

          pinMode(DA,OUTPUT); // alles Ausgänge
          pinMode(CL,OUTPUT);
          pinMode(CS,OUTPUT);


        #endif
       //+++++++++++++++++++++++++++++ 



       //+++++++++++++++++++++++++++++ 
        #ifdef v_4_20_mA_4

              Serial.print("I2C to 0-25 mA analog current moudle initialization ... ");
                
              #ifdef I2C_PIN_REMAP_ENABLE
                uint8_t status = module.begin(I2C_SCL_PIN, I2C_SDA_PIN);  //I2C scl and sda pins redefine
              #else
                uint8_t status = module.begin(); // Default to use the pins used by the MCU hardware I2C Wire object
              #endif

            if(status != 0){
              Serial.print("failed. Error code: ");
              Serial.println(status);
              Serial.println("Error Code: ");
              Serial.println("\t1: _scl or _sda pin is invaild.");
              Serial.println("\t2: Device not found, please check if the device is connected.");
              //while(1) yield();
            }
            Serial.println("done!");
            
            /**
             * @fn output
             * @brief Set the device to output the current of 0-25mA
             * @param current_mA  The output current value, range: 0-25mA
             * @return The DAC value corresponding to the output current value
             * @note calibration4-20mA After calibration, the output function will output the calibrated current value and return the calibrated DAC value
             */
            //uint16_t dac = module.output(/*current_mA =*/10); //Control the DAC module to output the current of 10mA and return the DAC value corresponding to the current of 10mA
            //Serial.print("DAC value: "); Serial.println(dac);

            /**
             * @fn output_mA
             * @brief Set DAC value to control the device to output the current of 0-25mA.
             * @param dac  Specific DAC value, range 0-0xFFF
             * @note DAC value range is 0-0xFFF, 0-0xFFF DAC value corresponds to the output current of 0-25mA, the formula of DAC value converting to actual current: Iout = (DAC/0xFFF)*25mA
             * @return The actual current, unit mA
             */
            //float current = module.output_mA(/*dac =*/0x666);  //Control the DAC module to output the current corresponding to a DAC value of 0x666 and return the current corresponding to the value, unit mA
            //Serial.print("Output current :"); Serial.print(current); Serial.println(" mA.");
            
            //module.store(); Serial.println("Save current configuration."); //Uncomment this line of code, and the current config above will be saved and will not be lost after power down.

        //------------------------------------------------------------------------------------------------------------------------------------------------

  
          /**
           * @fn calibration4-20mA
           * @brief Calibrate the current within 4-20mA
           * @param dac_4   Range 0-0xFFF, the calibration is invalid if the value is out of range, the DAC value corresponding to current of 4mA generally fluctuates at about 655, the actual value needs to be tested by the user in actual applications
           * @param dac_20  Range 0-0xFFF, the calibration is invalid if the value is out of range, the DAC value corresponding to current of 20mA generally fluctuates at about 3277, the actual value needs to be tested by the user in actual applications
           * @note The method of obtaining the DAC value corresponding to the current of 4mA in actual applications: use output_mA(uint16_t dac) function, pass the DAC parameter fluctuating at about 655, the actual DAC value is the one input into the instrument when the measured current is 4mA.
           * @n The method of obtaining the DAC value corresponding to the current of 20mA in actual applications: use output_mA(uint16_t dac) function, pass the DAC parameter fluctuating at about 3277, the actual DAC value is the one input into the instrument when the measured current is 20mA.
           * @note Parameter dac_4 and dac_20 should meet the conditions: dac_4 < dac_20, after the calibration is enabled, output function will output the calibrated current value
           */


            int akorrval2 = 0;
            if(ao1KorrekturVal < 0){
              akorrval2 = abs(ao1KorrekturVal);

                calc_down2_f = calc_down - akorrval2;
                if(calc_down2_f < 0){calc_down2_f = 0;} //nicht unter 0

                calc_down2 = abs(calc_down2_f);
              
              
            }else{
              calc_down2 = calc_down + akorrval2;
            }
          

            if(ao1Korrektur2Val < 0){
              akorrval2 = abs(ao1Korrektur2Val);

                calc_top2 = calc_top - akorrval2;
                if(calc_top2 <= calc_down2){calc_top2 = calc_down2 + 1;}

            }else{
              calc_top2 = calc_top + akorrval2;
            }

          Serial.print("calibration  4mA: "); Serial.println(calc_down2);
          Serial.print("calibration 20mA: "); Serial.println(calc_top2);
          module.calibration4_20mA(/*dac_4 =*/calc_down2, /*dac_20 =*/calc_top2);
          /**
           * @fn output
           * @brief Set the device to output the current of 0-25mA
           * @param current_mA  The output current value, range: 0-25mA
           * @return The DAC value corresponding to the output current value
           * @note calibration4-20mA After calibration, the output function will output the calibrated current value and return the calibrated DAC value
           */
          // Set 4mA
          uint16_t dac2 = module.output(/*current_mA =*/4.0); //Control the DAC module to output the current of 10mA and return the DAC value corresponding to the current of 10mA
          Serial.print("calibration4-20mA + DAC value x: "); Serial.println(dac2);





        #endif
       //+++++++++++++++++++++++++++++ 




       //+++++++++++++++++++++++++++++ 
        #ifdef v_4_20_mA_5   //DAC8760

          Serial.println("SPI DAC8760 0-25 mA  and  0-10 Volt analog current moudle initialization ... ");


          // put your setup code here, to run once:
          Serial.print("MOSI: ");
          Serial.println(MOSI);
          Serial.print("MISO: ");
          Serial.println(MISO);
          Serial.print("SCK: ");
          Serial.println(SCK);
          Serial.print("SS: ");
          Serial.println(SS);  

          Serial.print("MOSI: ");
          Serial.println(SPI_HW_MOSI_PIN);
          Serial.print("MISO: ");
          Serial.println(SPI_HW_MISO_PIN);
          Serial.print("SCK: ");
          Serial.println(SPI_HW_SCK_PIN);
          Serial.print("SS: ");
          Serial.println(SPI_HW_SS_PIN);  


         // (0x01<<CTRL_RANGE)|(0<<CTRL_OVR)|(1<<CTRL_OUTEN)
          Serial.println((0x01<<0)|(1<<14)|(1<<12));  


          // put your setup code here, to run once:
          dac.begin();
          //dac.write(0); //0 32767 65535
          dac.write(32767); //0 32767 65535


        #endif
       //+++++++++++++++++++++++++++++ 




    #endif  //#define PCB_v_7

    //pushOver();

  //******************************************************************************
  //                                EEPROM                                       *
  //******************************************************************************
    EEPROM.begin(EEPROM_SIZE);
    
    //Write data into eeprom
    int address = 0;
    int boardId = 80;  //uint16_t

    EEPROM.write(address, boardId);//EEPROM.put(address, boardId);
    //address += sizeof(boardId); //update address value

    //float param = 26.5;
    //EEPROM.writeFloat(address, param);//EEPROM.put(address, param);
    EEPROM.commit();


    //Read data from eeprom
      address = 0;
      int readId;
      readId = EEPROM.read(address); //EEPROM.get(address,readId);
      #ifdef EEPROM_DEBUG
        Serial.print("Read Id = ");
        Serial.println(readId);
      #endif  
      address += sizeof(readId); //update address value

      float readParam;
      EEPROM.get(address, readParam); //readParam=EEPROM.readFloat(address);
      #ifdef EEPROM_DEBUG
        Serial.print("Read param = ");
        Serial.println(readParam);
      #endif
      EEPROM.end();



  //******************************************************************************
  //                            Starte LED                                       *
  //******************************************************************************
    // Gib deinen Setup-Code hier ein, um ihn einmal auszuführen:
    strip1.begin();
    strip1.show();
    strip1.setPixelColor(0, strip1.Color(0, 0, 0));
    strip1.setPixelColor(1, strip1.Color(0, 0, 0));
    strip1.setPixelColor(2, strip1.Color(0, 0, 0));
    strip1.setPixelColor(3, strip1.Color(0, 0, 0));
    strip1.show();




  //******************************************************************************
  //                            Start  EEPROM                                    *
  //****************************************************************************** 
  //  https://randomnerdtutorials.com/esp32-save-data-permanently-preferences/
  
  Preferences preferences;
  preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
  //preferences.clear();                                  //Alle "Dateien" unter dem Ordner eenvs löschen
  //preferences.remove("ee_var_01");                          //"Datei" ee_var_01 löschen

  //unsigned int ee_int_01 = preferences.getUInt("ee_int_01", 0);  //"Datei" ee_int_01 auslesen und in ee_int_01 counter schreiben", 0" bedeutet, falls ee_int_01 nicht existiert standardwert 0 übergeben
  //unsigned long ee_long_01 = preferences.getULong("ee_long_01", 0); 
  //String ee_string_01 = preferences.getString("ee_string_01", "0"); 
  //uint8_t ee_char_01 = preferences.getUChar("ee_char_01", 0);
   



   millissave =  preferences.getUInt("ee_timesave", millis());   //"Datei"  auslesen
  
  // adjustTime(-7200); //2 Stunden zurück
   //adjustTime(3600); // 1 Stunde vor

  //------------------------- 
  ee_var_01 = preferences.getUInt("ee_var_01", 0); 
  ee_var_01++;                                               //Variable counter um 1 erhöhen
  #ifdef NVS_DEBUG
  Serial.printf("Boot Anzahl: %u\n", ee_var_01);          //Variable counter Seriell ausgeben
  #endif
  preferences.putUInt("ee_var_01", ee_var_01);                  //Variable counter unter "Datei" ee_var_01 speichern
  //------------------------

  //------------------------- 
  ee_var_02 = preferences.getUInt("ee_var_02", 0); 
  //Serial.printf("Saving: %u\n", ee_var_02);                     //Variable counter Seriell ausgeben
  preferences.putUInt("ee_var_02", ee_var_02);                  //Variable counter unter "Datei" ee_var_02 speichern
  //------------------------



  ee_wifires = preferences.getUInt("ee_wifires", 0);              //"Datei" ee_wifires auslesen
  ee_wifires++; 
  preferences.putUInt("ee_wifires", ee_wifires);                  //Variable counter unter "Datei" ee_wifires speichern 
  #ifdef NVS_DEBUG
  Serial.printf("Boot Anzahl für Reset WLAN: %u\n", ee_wifires);          //Variable counter Seriell ausgeben
  #endif
  //Serial.printf("Boot Anzahl für Reset WLAN: %u\n", ee_wifires);          //Variable counter Seriell ausgeben
  

      //---------------- WLAN RESET mit Boot Counter  -----------------------
      if (ee_wifires >= reset_wifires){       //5
     // if (ee_wifires >= 15){  
            ee_wifires = 0;



            Preferences preferences;
            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

            preferences.putUInt("ee_wifires", ee_wifires);                  //Variable counter unter "Datei"  speichern
            
            ee_portalTimeout = 620;
            preferences.putUInt("ePortalTime", ee_portalTimeout);                  //Variable counter unter "Datei" ee_portalTimeout speichern 
            
            gCONNECTEDflag = 0;
            preferences.putUInt("gCONNflag", gCONNECTEDflag);                  //Variable  speichern 


            preferences.putString("p_staticip", "");                    //Variable speichern
            preferences.putString("p_subnetmask", "");                  //Variable speichern
            preferences.putString("p_gateway", "");                     //Variable speichern
            preferences.putString("p_wifidns", "");                     //Variable speichern
            preferences.putString("p_ipchange", "0");                     //Variable speichern

            preferences.end();                                      //Preferences beenden


            



            Serial.println("Erase WLAN settings and restart ...");
            //Serial.printf("Portal Timeout: %u\n", ee_portalTimeout);          //Variable counter Seriell ausgeben
            #ifdef BLE_WIFI_disable
             
              Serial.println("WIFI resetSettings");
              WiFiManager wifiManager;
              //wifiManager.WiFi_eraseConfig();
                IPAddress _ip,_gw,_sn,_dns1,_dns2;
                _ip.fromString("");
                _gw.fromString("");
                _sn.fromString("");
                _dns1.fromString("");
                _dns2.fromString("");
                wifiManager.setSTAStaticIPConfig(_ip, _gw, _sn , _dns1);
                //wifiManager.setSTAStaticIPConfig(IPAddress(), IPAddress(), IPAddress(), IPAddress());
              wifiManager.erase(true);

             //delay(200);
             // wifiManager.resetSettings();
            #endif
            delay(500);
            
            ESP.restart(); 
      }
        //----------------------------------------------------------------------


       ee_ip_search = preferences.getUInt("ee_ipsearch", 0);              //"Datei" auslesen
  
  


        //******************************************************************************
        //                             EEPROM   lesen                                  *
        //****************************************************************************** 
        //Serial.println(p_inputstaticip); 

        gCONNECTEDflag= preferences.getUInt("gCONNflag", 0);             // 1=WLAN ist verbunden

        p_inputpwchange = preferences.getString("p_inputpwchange", "          ");  //aktuellen PW
        
        if (p_inputpwchange != "          "){
          if (p_inputpwchange != ""){
            p_inputpasswort_vorgabe = p_inputpwchange; //PW übergeben
            //if (p_inputpasswort_vorgabe != "root"){
             // #ifdef WEB_DEBUG
               // Serial.println("PW wurde geändert: " + p_inputpasswort_vorgabe);
              //#endif 
            //}
          }
        }
        p_inputpasswort_vorgabe.toCharArray(p_inputpasswort_vorgabec, PW_VORG_LEN);
        p_inputpwchange = ""; // leeren das im Web nichts drinsteht
        

        p_inputstaticip = preferences.getString("p_staticip", "152.158.158.251"); 
        p_inputsubnetmask = preferences.getString("p_subnetmask", "255.255.255.0"); 
        p_inputntp = preferences.getString("p_ntp", "pool.ntp.org"); 
        p_inputname = preferences.getString("p_name", "tracer"); 
        p_inputipchange = preferences.getString("p_ipchange", "0"); 
        p_inputwifidns = preferences.getString("p_wifidns", "152.158.158.251"); 


        p_inputfreship = preferences.getString("p_fresh_ip", "192.168.4.1"); 
        p_inputfreshid = preferences.getString("p_fresh_id", "0034003F59525307"); 
        p_inputfreshid.toCharArray(current_id, 17); 
        p_inputfreshpwd = preferences.getString("p_fresh_pwd", "1111"); 
        p_freshonoff = preferences.getString("p_freshon", "off"); 

        p_inputStufe1 = preferences.getString("p_freshSt1", "50");
        p_inputStufe2 = preferences.getString("p_freshSt2", "100"); 
        p_inputStufe3 = preferences.getString("p_freshSt3", "150"); 
        p_inputStufe4 = preferences.getString("p_freshSt4", "200"); 
        p_inputStufe5 = preferences.getString("p_freshSt5", "300");  
        p_inputStufe6 = preferences.getString("p_freshSt6", "130");  

        p_inputfunktion = preferences.getString("p_freshfunkt", "off");  



        b_inputStufe1 = atoi(p_inputStufe1.c_str());
        b_inputStufe2 = atoi(p_inputStufe2.c_str());
        b_inputStufe3 = atoi(p_inputStufe3.c_str());
        b_inputStufe4 = atoi(p_inputStufe4.c_str());
        b_inputStufe5 = atoi(p_inputStufe5.c_str());
        b_inputStufe6 = atoi(p_inputStufe6.c_str());


        getIpAddress(p_inputfreship); 
        IPAddress udpAddress(IpPartAddress[0],IpPartAddress[1],IpPartAddress[2],IpPartAddress[3]);  
        

       // epochTime  epochTime_s  ULong64

        epochTime_start = preferences.getULong64("epochTime", 0);
        p_timeon = preferences.getInt("p_timeon", 0);
        

        p_inputip01 = preferences.getString("p_inputip01", "000.000.000.000"); 
        p_inputip02 = preferences.getString("p_inputip02", "000.000.000.000"); 
        p_inputip03 = preferences.getString("p_inputip03", "000.000.000.000"); 
        p_inputip04 = preferences.getString("p_inputip04", "000.000.000.000"); 
        p_inputip05 = preferences.getString("p_inputip05", "000.000.000.000"); 
        
        if (p_inputip01 != "000.000.000.000"){ 
          p_mesh_IP_resault = p_inputip01;
        }else{
          p_mesh_IP_resault = "";
        }

        p_room01 = preferences.getString("p_room01", "----------"); 
        p_room02 = preferences.getString("p_room02", "----------"); 
        p_room03 = preferences.getString("p_room03", "----------"); 
        p_room04 = preferences.getString("p_room04", "----------"); 
        p_room05 = preferences.getString("p_room05", "----------"); 

        p_ipparson = preferences.getString("p_ipparson", "0"); 



        p_mqonoff = preferences.getString("p_mqon", "off"); 
        p_inputmqclient = preferences.getString("p_mqclie", ""); 
        p_inputmqserver = preferences.getString("p_mqserv", "dashboard.livair.io"); 
        p_inputmqoptions = preferences.getString("p_mqoption", "1");     //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
        p_inputmqmesh = preferences.getString("p_mqmesh", "0");        //0 = aus    1-10 = Anzahl
        p_inputmqmeshi = atoi(p_inputmqmesh.c_str()); 
        if(p_inputmqmeshi == 0){
           g_mb_mesh = false; 
        }else{
           g_mb_mesh = true; 
        }


        
        p_inputmqport = preferences.getString("p_mqport", "1883"); 
        p_inputmquser = preferences.getString("p_mquser", "usertoken"); 
        p_inputmqpass = preferences.getString("p_mqpass", ""); 
        p_inputmqtopic = preferences.getString("p_mqtopic", "radon"); 
        p_inputmqtopic1 = preferences.getString("p_mqtopic1", "eintraege"); 
        p_inputmqtopic2 = preferences.getString("p_mqtopic2", "sernr"); 
        p_time_mesh_uplod = preferences.getString("p_mqtupl", "--:--:--"); 

        gACCESS_TOKENFlag = preferences.getUInt("p_token", 0);   // provision fertig
        //Serial.println("read gACCESS_TOKENFlag " + String(gACCESS_TOKENFlag));
        device_id_s = preferences.getString("p_device_id", "00000000"); 

        if (p_mqonoff == "on") mqttdAktiveConfig = true;
        if (p_mqonoff == "off") mqttdAktiveConfig = false;


        g12FileRead = preferences.getUInt("p_12file", 0);   // in datei gespeicherte zeilen   //lese ab dieser zeile 
        g13FileRead = preferences.getUInt("p_13file", 0);   // in datei gespeicherte zeilen   //lese ab dieser zeile 

        p_cloudonoff = preferences.getString("p_clon", "off"); 
        p_inputcloudserver = preferences.getString("p_clserv", "rec.radoncloud.com"); 
        p_inputclouduser = preferences.getString("p_cluser", "user"); 
        p_inputclouddevice = preferences.getString("p_cldevice", "5487"); 
        p_inputcloudpage = preferences.getString("p_clpage", "s_get.php"); 
        p_inputcloudpre = preferences.getString("p_clpre", "submit=Daten"); 
        p_inputcloudport = preferences.getString("p_clport", "443"); 
        p_inputcloudchain = preferences.getString("p_clchain", "&p"); 
        p_inputcloudkey = preferences.getString("p_clkey", "3as44643euW"); 
        p_inputcloudinter = preferences.getString("p_clinter", "15"); 
        p_inputcloudinteri = p_inputcloudinter.toInt(); 
        p_inputcloudporti = p_inputcloudport.toInt(); 
        gReboot_TOKENFlag = preferences.getUInt("p_crebbot", 0);   // nur neu Speichern wenn Zeit abgelaufen ist
        gReboot_TOKENFlag2 = preferences.getUInt("p_crebbot2", 0);   // MQTT nur neu Speichern wenn Zeit abgelaufen ist    1= Sensor abgefragt

        p_inputcloudserver.toCharArray(p_inputcloudserverc, CLOUD_SERVER_LEN);
        p_inputcloudpage.toCharArray(p_inputcloudpagec, DB_PAGE_LEN);
        p_inputcloudpre.toCharArray(p_inputcloudprec, DB_PRE_LEN);
        p_inputcloudport.toCharArray(p_inputcloudportc, DB_PORT_LEN);
        p_inputcloudchain.toCharArray(p_inputcloudchainc, DB_CHAIN_LEN);
        

        // <a href='http://www.auto-steuerung.de/wetter/air9/chart.php?streamid=1gh78569edKL&messid=13' target='_blank'>Cloud Anlalyse</a>
        cloud_link = "<a href='http://www.auto-steuerung.de/wetter/air9/chart.php?streamid=";
        cloud_link += p_inputcloudkey;
        cloud_link += "&messid=";
        cloud_link += p_inputclouddevice;
        cloud_link += "&ctime=24";
        cloud_link += "' target='_blank'>Cloud Anlalyse</a>";



        p_inputgateway = preferences.getString("p_gateway", "192.168.178.1"); 
        p_inputtcpport = preferences.getString("p_tcpport", "502"); 
        p_inputwebport = preferences.getString("p_webport", "80"); 
        p_inputbaudrate = preferences.getString("p_baudrate", "9600"); 
        p_inputdatabits = preferences.getString("p_databits", "8"); 
        p_inputparity = preferences.getString("p_parity", "none"); 
        p_inputstopbit = preferences.getString("p_stopbit", "1"); 
        p_inputrestimeout = preferences.getString("p_restimeout", "1000"); 
        
        
        if (zustandVersion == 1){     //1 = Normal Version 
          ee_portalTimeout = preferences.getUInt("ePortalTime", 620);              //"Datei" ee_portalTimeout auslesen
          p_ledonoff = preferences.getString("p_ledon", "off"); 
          lEd_aktiv = " class='Stil1c' ";
        } else{
          ee_portalTimeout = preferences.getUInt("ePortalTime", 1);              //60    "Datei" ee_portalTimeout auslesen
          p_ledonoff = preferences.getString("p_ledon", "on");
          lEd_aktiv = " class='Stil1a' "; 
        }





        p_inputledred = preferences.getString("p_ledred", "200"); 
        p_inputledorange = preferences.getString("p_ledorange", "100"); 
        p_inputledgreen = preferences.getString("p_ledgreen", "50"); 
        p_inputledfunk = preferences.getString("p_ledfunk", "radon"); 
        p_inputledgamma = preferences.getString("p_ledtime", "200"); 

        p_inputao1og = preferences.getString("p_ao1og", "5000"); 
        p_inputao1ug = preferences.getString("p_ao1ug", "50"); 
        p_inputao1option = preferences.getString("p_ao1option", "0"); 
        p_inputao1korrektur = preferences.getString("p_ao1korrektur", "0"); 
        p_inputao1korrektur2 = preferences.getString("p_ao1korrektur2", "0"); 
        p_inputao1namur = preferences.getString("p_ao1namur", "0");   
        p_ao1onoff = preferences.getString("p_ao1on", "off"); 



        #ifdef vent_option
        p_vanonoff = preferences.getString("p_vanon", "off"); 
        p_inputvanmax = preferences.getString("p_vanmax", "600"); 
        p_inputvanmin = preferences.getString("p_vanmin", "300");
        #endif
        

        p_pushonoff = preferences.getString("p_pushon", "off"); 
        p_pushkey = preferences.getString("p_pushkey", "11111NoaO1ohRpg222226677"); 
        p_pushmessage = preferences.getString("p_pushmessage", "Push Message"); 
        p_pushtitle = preferences.getString("p_pushtitle", "Modbus Push"); 
        p_pushsound = preferences.getString("p_sound", "8"); 
        p_pushvibration = preferences.getString("p_vibration", "3"); 
        p_pushicon = preferences.getString("p_icon", "91"); 
        p_pushiconcolor = preferences.getString("p_iconcolor", "FF0000"); 
        p_pushpriority = preferences.getString("p_priority", "2"); 
        p_pushdevice = preferences.getString("p_pushdevice", "41828"); 
        p_pushvalue = preferences.getString("p_pushvalue", "300"); 
        p_pushvaluei = p_pushvalue.toInt();

        p_sett01 = preferences.getUInt("p_sett01", 1); // Status Setting
        p_sett02 = preferences.getUInt("p_sett02", 0); // IP Setting
        p_sett03 = preferences.getUInt("p_sett03", 0); // TCP Setting
        p_sett04 = preferences.getUInt("p_sett04", 0); // RS485 Setting
        p_sett05 = preferences.getUInt("p_sett05", 1); // Sensor Setting
        p_sett06 = preferences.getUInt("p_sett06", 0); // Mesh Setting
        p_sett07 = preferences.getUInt("p_sett07", 1); // MQTT Setting
        p_sett08 = preferences.getUInt("p_sett08", 0); // Cloud Setting
        // 09 5 zeilen weiter unten
        p_sett15 = preferences.getUInt("p_sett15", 0); // Freshbox on/off    
        p_sett16 = preferences.getUInt("p_sett16", 0); // MQTT on/off    
        p_sett17 = preferences.getUInt("p_sett17", 0); // LED on/off   
        p_sett18 = preferences.getUInt("p_sett18", 0); // Cloud on/off   

        p_sett19 = preferences.getUInt("p_sett19", 0); // AO Setting
        p_sett29 = preferences.getUInt("p_sett29", 0); // AO on/off       
        


        if (zustandVersion == 1){     //1 = Normal Version 
          p_sett09 = preferences.getUInt("p_sett09", 0); // LED Setting
        } else{
          p_sett09 = preferences.getUInt("p_sett09", 1); // LED Setting
        }
        //#ifndef WIFI_nur_LED
        //p_sett09 = preferences.getUInt("p_sett09", 0); // LED Setting
        //#else
        //p_sett09 = preferences.getUInt("p_sett09", 1); // LED Setting
        //#endiftoCharArray
        p_sett10 = preferences.getUInt("p_sett10", 0); // Push Setting
        p_sett11 = preferences.getUInt("p_sett11", 0); // FAN Setting
        p_sett13 = preferences.getUInt("p_sett13", 0); // LOG Setting
        p_sett14 = preferences.getUInt("p_sett14", 0); // Freshbox Setting

        p_sett20 = preferences.getUInt("p_sett20", 1); 
        p_sett21 = preferences.getUInt("p_sett21", 1); 
        p_sett22 = preferences.getUInt("p_sett22", 1); 

        
        //Serial.println("p_sett02: " + String(p_sett02));
        //Serial.println("p_sett13: " + String(p_sett13));
        //Serial.println("p_sett20: " + String(p_sett20));

        changesetValue();
        
        p_cloud_ID_resault = device_id_s;   //"    " + p_inputclouddevice;


        ledRedVal = atoi(p_inputledred.c_str());
        ledOrangeVal = atoi(p_inputledorange.c_str());
        ledGreenVal = atoi(p_inputledgreen.c_str());
        ledgammaVal = atoi(p_inputledgamma.c_str());
        if(ledgammaVal == 0){
        ledgammaVal = 1;
        }
        if(ledgammaVal > 255){
        ledgammaVal = 255;
        p_inputledgamma = "255";
        preferences.putString("p_ledtime", p_inputledgamma);                         //Variable speichern
        }


        ao1OGVal = atoi(p_inputao1og.c_str());
        ao1UGVal = atoi(p_inputao1ug.c_str());
        ao1OptionVal = atoi(p_inputao1option.c_str());
        ao1KorrekturVal = atoi(p_inputao1korrektur.c_str());
        ao1Korrektur2Val = atoi(p_inputao1korrektur2.c_str());
        ao1nanurVal = atoi(p_inputao1namur.c_str());

        if(ao1OptionVal > 1){
          ao1OptionVal = 1;
        }
        if(ao1nanurVal > 1){
          ao1nanurVal = 1;
        }


        p_inputtcpport.toCharArray(p_inputtcpportc, 4); 
        port = atoi(p_inputtcpportc); 

        #ifdef vent_option
        vent_min_stufe = p_inputvanmin.toInt();
        vent_max_stufe = p_inputvanmax.toInt();
        #endif

        p_inputntp.toCharArray(p_inputntpc, 30); 
        //Serial.println("1p_inputntpc: " + String(p_inputntpc));
        NTPClient timeClient(ntpUDP, p_inputntpc); 


                p_APname_p = "Radon Tracer";
                if(device_id_s!="00000000"){
                  p_APname_p += " ";
                  p_APname_p += device_id_s;
                }
                p_APname_p.toCharArray(p_APname_c, APname_LEN);


          //-------------------------------------------------------------------------------
          //------------------------------------------------------------------------------


           /*
          Serial.println("p_sett16 " + String(p_sett16));
          Serial.println("p_mqonoff " + String(p_mqonoff));
          Serial.println("p_sett07 " + String(p_sett07));
          Serial.println("mqttdAktiveConfig " + String(mqttdAktiveConfig));
           */


        Serial.println("---------------------------------------------");
        Serial.println("  |");
        Serial.println("-->  Reading Store Data... ");
        Serial.println("  |");
        //Serial.println("---------------------------------------------");


     delay(0);



      //******************************************************************************
      //                       Starte WiFi Verbindung                                *
      //******************************************************************************
      #ifdef BLE_WIFI_disable

        Serial.println("---------------------------------------------");
        Serial.println("  |");
        if (zustandVersion == 1){     //1 = Normal Version 
          Serial.println("-->  Init WLAN...");
        } else{
          Serial.println("-->  Init LED...");
        }
        Serial.println("  |");
        //Serial.println("---------------------------------------------");


          Serial.println("---------------------------------------------");
          Serial.println("  |");
          Serial.println("  V");

          
         
          // #ifdef WIFI_nur_LED
            // Serial.println("    Init --> Start LED");    //     INIT--> 
          // #else
            // Serial.println("    Init --> Start Server");
           //#endif


          //WiFiManager
          //Local intialization. Once its business is done, there is no need to keep it around
          WiFiManager wifiManager;

        #ifdef onWIFI_wps
          Serial.println("    Starting WPS");
          wpsInitConfig();
          esp_wifi_wps_enable(&config);
          esp_wifi_wps_start(0);
          //wpsStart();

        #endif  



                
                wifiManager.setAPname(p_APname_c);   //p_APname_c   device_id_s   


           //wifiManager.WiFi_Mode(WIFI_AP_STA);
           WiFi.mode(WIFI_AP_STA); 
           #ifdef WIFI_DEBUG
            //wifiManager.getModeString(tempgetmode);
            //Serial.println();
            //Serial.print("WLan Mode: ");
            //Serial.println(tempgetmode);
           #endif


          //DEBUG_ERROR
          //#define DEBUG_NOTIFY
          //#define DEBUG_VERBOSE
          //DEBUG_DEV
          //DEBUG_MAX
          
          #ifdef WIFI_DEBUG
          wifiManager.setDebugOutput(true); 
          #else
          wifiManager.setDebugOutput(false);  
          #endif

          if(p_inputipchange == "1"){
            if (p_inputstaticip != "152.158.158.251"){
            
              #ifdef WIFI_DEBUG
              Serial.println("Wifi IP Adress User Config..");
              #endif


              IPAddress _ip,_gw,_sn,_dns1,_dns2;
              _ip.fromString(p_inputstaticip);
              _gw.fromString(p_inputgateway);
              _sn.fromString(p_inputsubnetmask);

              // p_inputwifidns
              _dns1.fromString(p_inputwifidns);
              _dns2.fromString("8.8.8.8");

              //_dns.fromString(static_dns);
              wifiManager.setSTAStaticIPConfig(_ip, _gw, _sn , _dns1);
              // p_inputipchange = preferences.getString("p_ipchange", "0"); 
              #ifdef WIFI_DEBUG
              Serial.println("Wifi IP Adress User Config finish!");
              #endif

            }
          }


          //wifiManager.setHostname("tracer");
          wifiManager.setHostname(p_inputnamec); //tracer.local
          // Das hab ich selber gemacht.
          //wifiManager.setAPname("Radon Tracer");

            //const char* menu[] = {"wifi","wifinoscan","info","param","close","sep","erase","restart","exit"};
            
          //const char* menu[] = {"wifi","wifinoscan","restart","exit"};
          const char* menu[] = {"wifi","wifinoscan","erase","restart","exit"};
          wifiManager.setMenu(menu,4);

          wifiManager.setConfigPortalTimeout(ee_portalTimeout);  // Zeit in secunden
          //Serial.println("1ee_portalTimeout " + String(ee_portalTimeout)); 
            //in seconds
            //wifiManager.setTimeout(300);

            

            // wifiManager.setConnectRetries(3);
            // wifiManager.setDarkMode(true);
            // wifiManager.setParamsPage(false);
            #ifdef WIFI_nur_LED
             //wifiManager.setWiFiAutoReconnect(false);
             //wifiManager.setConfigPortalBlocking(true);
            #endif

              wifiManager.setTitle("WLAN Config");




            //   https://convertio.co/de/gif-svg/
            //   https://www.svgminify.com/de.html
            //  https://jsfiddle.net/defenderkhan/0bsLdqfp
              
            //wifiManager.setCustomHeadElement("<style>html{filter: invert(100%); -webkit-filter: invert(100%);}</style>");
            wifiManager.setCustomHeadElement("<style>html{ background-color: #A5C0CE;}</style><div class='s'><svg width='76pt' height='91pt' version='1.0' viewBox='0 0 76 91'><g transform='translate(0 91) scale(.1 -.1)'><path d='m0 755c0-85 3-155 6-155 7 0 364 300 364 306 0 2-83 4-185 4h-185v-155z'/><path d='m405 891c32-29 329-277 343-285 9-6 12 27 12 148v156h-187c-183 0-187 0-168-19z'/><path d='m380 480c0-268 3-410 10-410 19 0 147 134 184 193 50 78 87 178 94 257 7 65 7 65 41 70l35 5-176 148c-97 81-179 147-182 147s-6-184-6-410zm110 55v-45h-45-45v45 45h45 45v-45zm0-125v-50h-45-45v50 50h45 45v-50z'/><path d='m410 535c0-33 2-35 35-35s35 2 35 35-2 35-35 35-35-2-35-35z'/><path d='m410 405c0-33 2-35 35-35s35 2 35 35-2 35-35 35-35-2-35-35z'/><path d='m0 290v-290h380 380v290 290h-40-40v-44c0-138-117-343-261-457l-39-31-47 39c-138 113-253 320-253 457 0 35-1 36-40 36h-40v-290zm70 202c0-9-5-24-10-32-7-11-10-5-10 23 0 23 4 36 10 32 6-3 10-14 10-23zm639-14c0-38-1-40-10-19-8 22-4 61 7 61 2 0 4-19 3-42zm-639-58c-5-22-8-27-9-13-1 21 9 56 14 51 2-2 0-19-5-38zm617 18c-3-8-6-5-6 6-1 11 2 17 5 13 3-3 4-12 1-19zm-525-174c44-74 127-165 185-203 25-17 42-31 36-31-28 0-140 105-198 186-46 63-105 179-105 204 0 8 11-11 24-43s39-83 58-113zm535 124c-3-7-5-2-5 12s2 19 5 13c2-7 2-19 0-25zm-36-25c-12-20-14-14-5 12 4 9 9 14 11 11 3-2 0-13-6-23zm20-20c-12-20-14-14-5 12 4 9 9 14 11 11 3-2 0-13-6-23zm-508-141c36-48 115-127 172-170l30-23-34 18c-71 38-232 232-256 308-4 11 7-4 23-32 17-29 46-74 65-101zm465 57c-12-22-28-45-36-51-7-7 1 12 19 40 38 62 50 69 17 11zm-28 2c-5-11-15-23-21-27-6-3-3 5 6 20 20 30 30 35 15 7zm-30-45c0-2-8-10-17-17-16-13-17-12-4 4s21 21 21 13zm-23-67c-20-22-55-57-79-77s-9-2 32 41c41 42 76 77 78 77s-12-18-31-41zm-7 28c0-1-26-27-57-57l-58-55 55 58c50 53 60 62 60 54zm-120-111c0-2-8-10-17-17-16-13-17-12-4 4s21 21 21 13zm-10-41c-7-8-17-15-23-15s-2 7 9 15c25 19 30 19 14 0z'/><path d='m280 535c0-34 1-35 40-35s40 1 40 35-1 35-40 35-40-1-40-35z'/><path d='m280 410v-40h40 40v40 40h-40-40v-40z'/></g></svg>");


            //WiFiManagerParameter custom_text("<p>Radontec.de</p>");
            //wifiManager.addParameter(&custom_text);

            //Serial.println("<-- WIFI2 "); 

              wifiManager.setSaveConfigCallback(saveConfigCallback);
              //#ifndef WIFI_nur_LED
              //Serial.println("<-- WIFI3 "); 
              wifiManager.setWebServerCallback(WebServerCallback);
                 //Serial.println("<-- WIFI4 "); 
              //#endif
              wifiManager.setConfigResetCallback(ConfigResetCallback);
              //Serial.println("<-- WIFI5 "); 

              wifiManager.setSaveParamsCallback(SaveParamsCallback);
              //Serial.println("<-- WIFI6 "); 
              // wifiManager.setPreSaveConfigCallback(PreSaveConfigCallback);
             
             // #ifndef WIFI_nur_LED
                // #ifdef BLE_WIFI_disable
              wifiManager.setAPCallback(configModeCallback);
                // #endif
              //#endif
              //wifiManager.setShowInfoUpdate(true);
              //wifiManager.setShowInfoErase(true);


        //wifiManager.setWiFiAutoReconnect(true);
              
              //wifiManager.getWiFiespInfo();
              //wifiManager.getInfoData("k");


        

              //wifiManager.setRetryAttempts(20);
              //set custom ip for portal   
              //wifiManager.setAPStaticIPConfig(IPAddress(10,0,1,1), IPAddress(10,0,1,1), IPAddress(255,255,255,0));
              //fetches ssid and pass from eeprom and tries to connect
              //if it does not connect it starts an access point with the specified name
              //here  "Auto ConnectAP"
              //and goes into a blocking loop awaiting configuration

              delay(0);
              #ifdef WIFI_DEBUG
                Serial.println("-->     start Auto Connect "); 
              #endif

              //wifiManager.setAPname("Radon Tracer");
              //#ifdef ap_set_passwort 
                 p_inputpasswort_vorgabe.toCharArray(p_inputpasswort_vorgabec, PW_VORG_LEN);
                 wifiManager.autoConnect(p_APname_c, p_inputpasswort_vorgabec);
              //#else
                 //wifiManager.autoConnect(p_APname_c);
              //#endif





               //WiFi.disconnect();

               //wifiManager.WiFi_autoReconnect();
               
               //WiFi.enableSTA(true);
              
              
                   //wifiManager.WiFi_Mode(WIFI_AP_STA);
                    WiFi.mode(WIFI_AP_STA); 
                    #ifdef WIFI_DEBUG
                      //wifiManager.getModeString(tempgetmode);
                      //Serial.println();
                      //Serial.print("WLan Mode: ");
                      //Serial.println(tempgetmode);
                    #endif
             


              #ifdef WIFI_DEBUG
                Serial.println("-->     ende AutoConnect "); 
              #endif

             // WiFi.useStaticBuffers(true);

                //tries to connect to last known settings if it does not connect it starts an access point with the specified name
                //here  "AutoConnectAP" with password "password" and goes into a blocking loop awaiting configuration
              

             //wifiManager.setConfigPortalBlocking(true);
             
             
             #ifdef WIFI_DEBUG
               //Serial.println("[WIFI] SAVED: " + (String)(wifiManager.getWiFiIsSaved() ? "YES" : "NO"));
               if(wifiManager.getWiFiIsSaved()){
                 Serial.println("[WIFI] SAVED: YES");
               }else{
                 Serial.println("[WIFI] SAVED: NO");
               }
             #endif


            //if (!wifiManager.startConfigPortal("Radon Tracer", p_inputpasswort_vorgabec)) {
             // Serial.println("failed to connect and hit timeout");
              //delay(1000);
            //}

            //startWebPortal();

//---------------------------------------------------------------
                //Serial.println("<-- gCONNECTEDflag: " + String(gCONNECTEDflag));  // 1=WLAN ist verbunden

                currentMillis = millis();
                              
                wifiManager.setAPname(p_APname_c);   //p_APname_c   device_id_s   

                p_inputpasswort_vorgabe.toCharArray(p_inputpasswort_vorgabec, PW_VORG_LEN);
                WiFi.softAP(p_APname_c, p_inputpasswort_vorgabec);//password option   
                
                //WiFi.softAP(ssid, password, 11, false, 8);
                //WiFi.softAPConfig(local_IP, local_IP, subnet);
                  
                    #ifdef WIFI_DEBUG
                    Serial.print("IP: ");
                    Serial.println(WiFi.softAPIP(p_APname_c, p_inputpasswort_vorgabec));
                    #endif


            if (abbruch_portal == true && gCONNECTEDflag == 1){
           
              
              delay(0);
              //nix einfach starten weil WLAN noch nicht wieder online
                    #ifdef WIFI_DEBUG
                    Serial.println("-->     nix einfach starten weil WLAN noch nicht wieder online");
                    #endif
                    //Serial.println("    http://192.168.4.1/index.html");

            }else{      
                
             
             
                //Serial.println("!!wifiManager.autoConnect");
                //#ifdef ap_set_passwort 
                

              if (WiFi.status() != WL_CONNECTED) {

                wifiManager.autoConnect(p_APname_c, p_inputpasswort_vorgabec);
               //if (!wifiManager.autoConnect(p_APname_c, p_inputpasswort_vorgabec)) {
                //#else
                 // if (!wifiManager.autoConnect(p_APname_c)) {
                //#endif            
                             
                  //#ifndef WIFI_nur_LED
                  if (zustandVersion == 1 && gCONNECTEDflag == 0){     //1 = Normal Version     // 1=WLAN war verbunden
                 
                    
                    //Preferences preferences;
                    //preferences.end();                                      //Preferences beenden
                    #ifdef WIFI_DEBUG
                      Serial.println("[WIFI] SAVED: " + (String)(wifiManager.getWiFiIsSaved() ? "YES" : "NO"));
                      Serial.println("-->     wifi failed to connect, we should reset as see if it connects");
                    #endif
                    delay(1000);
                    ESP.restart(); 


                  //#else
                  } else{

                    #ifdef WIFI_DEBUG
                      Serial.println(" "); 
                      Serial.println("-->  " + p_time + " Wifi not Connect, >> boot...");  // or only LED
                    #endif

                    ee_portalTimeout = 1;                                            //30 kürzer wegen neu Booten
                    //Serial.printf("2 Portal Timeout: %u\n", ee_portalTimeout);          //Variable counter Seriell ausgeben
                    preferences.putUInt("ePortalTime", ee_portalTimeout);                  //Variable counter unter "Datei" ee_portalTimeout speichern 
                     
                    wifiNotConnectFlag = true;
                    
                     long Farbe1;
                      //Turn off LEDs 
                      Farbe1 = strip1.Color(0, 0, 0);//off
                      strip1.fill(Farbe1, 0, 4);
                      strip1.show();   

                  }

              }else{
                
                  #ifdef WIFI_DEBUG
                    //Serial.println(" "); 
                    //Serial.println("-->  " + p_time + " Wifi auto Connect"); 
                  #endif
              
                    ee_portalTimeout = 1;                                            //30   kürzer wegen neu Booten
                    //Serial.printf("3 Portal Timeout: %u\n", ee_portalTimeout);          //Variable counter Seriell ausgeben
                    preferences.putUInt("ePortalTime", ee_portalTimeout);                  //Variable counter unter "Datei" ee_portalTimeout speichern 
          
               
                     long Farbe1;
                      //Turn off LEDs 
                      Farbe1 = strip1.Color(0, 0, 0);//off
                      strip1.fill(Farbe1, 0, 4);
                      strip1.show();   
              
               
              }

            }
        
//---------------------------------------------------------------

      #endif  //Wifimanager deaktiv


        //Serial.println(WiFi.mode(WIFI_STA));   //1=ok
 
    // IP Change for WIFIMANAGER

    if(p_inputipchange == "0"){
      #ifdef WIFI_DEBUG
        Serial.println("WriteipValuechange()  p_inputipchange = 0");
      #endif

      p_inputstaticip = WiFi.localIP().toString();                    //Variable speichern
      p_inputgateway = WiFi.gatewayIP().toString();                   //Variable speichern
      p_inputsubnetmask = WiFi.subnetMask().toString();               //Variable speichern
      p_inputwifidns = WiFi.dnsIP(0).toString();               //Variable speichern


      p_inputwifidns = WiFi.dnsIP(0).toString();               //Variable speichern
      WriteipValuechange();
    }
    
    if(WiFi.localIP() =! p_inputstaticip){
      #ifdef WIFI_DEBUG
       Serial.println("WiFi.localIP() =! p_inputstaticip");
      #endif
      p_inputstaticip = WiFi.localIP().toString();                    //Variable speichern
      p_inputgateway = WiFi.gatewayIP().toString();                   //Variable speichern
      p_inputsubnetmask = WiFi.subnetMask().toString();               //Variable speichern
      p_inputwifidns = WiFi.dnsIP(0).toString();               //Variable speichern

      WriteipValuechange();
    }

      #ifdef WIFI_DEBUG
        Serial.print(F("    IP   --> "));
       Serial.println(WiFi.localIP());
      #endif
   
    #ifdef WIFI_DEBUG
     
    #ifdef BLE_WIFI_disable 
      //Serial.println("-----------------------------------");
      //Serial.print(F("Wifimanager IP    --> "));
      //Serial.println(WiFi.localIP());
      //Serial.print(F("Wifimanager GW    --> "));
      //Serial.println(WiFi.gatewayIP());
      //Serial.print(F("Wifimanager SM    --> "));
      //Serial.println(WiFi.subnetMask());
      //Serial.print(F("Wifimanager DNS 1 --> "));
      //Serial.println(WiFi.dnsIP(0));
      //Serial.println("-----------------------------------");
    #endif



      //Serial.print("Config IP    --> ");             
      //Serial.println(p_inputstaticip);   
      //Serial.print("Config GW    --> "); 
      //Serial.println(p_inputgateway);
      //Serial.print("Config SM    --> "); 
      //Serial.println(p_inputsubnetmask);    
      //Serial.print(F("Config DNS 1 --> "));
      //Serial.println(p_inputwifidns);  // p_inputwifidns   WiFi.dnsIP(0)
      //Serial.print(F("Config NTP   --> "));
      //Serial.println(p_inputntp);  
      //Serial.println("-----------------------------------");
    #else
   



      #ifdef IPM_DEBUG
        Serial.println("---------------------------");
        Serial.print(F("Wifimanager IP    --> "));
        Serial.println(WiFi.localIP());
        Serial.print(F("Wifimanager GW    --> "));
        Serial.println(WiFi.gatewayIP());
        Serial.print(F("Wifimanager SM    --> "));
        Serial.println(WiFi.subnetMask());
        Serial.print(F("Wifimanager DNS 1 --> "));
        Serial.println(WiFi.dnsIP(0));
        Serial.println("---------------------------");
      #endif

    #endif


      if (zustandVersion == 1){     //1 = Normal Version 
      //Serial.print(F("    http://"));
      //Serial.println(WiFi.localIP());


      //Serial.print(F("    http://"));
      //Serial.print(F(WiFi.localIP()));
      //Serial.println("/index.html");
      
      p_inputstaticip = WiFi.localIP().toString();                    //Variable speichern


      //Serial.println(wifiManager.getConfigPortalSSID());

      Serial.println("    http://192.168.4.1/index.html");
      Serial.println("    http://" + p_inputstaticip + "/index.html");
      Serial.println("    http://" + String(p_inputnamec) + ".local/index.html");

        //Serial.print(F("    DNS  --> "));
        //Serial.println(WiFi.dnsIP(0));
      }
    
    //Serial.println("init 1");

                getIpAddress(p_inputstaticip); 
                //#ifdef WIFI_DEBUG
                  //Serial.print("IP Address=");             
                  //Serial.print(IpPartAddress[0]); Serial.print("."); Serial.print(IpPartAddress[1]); Serial.print("."); 
                  //Serial.print(IpPartAddress[2]); Serial.print("."); Serial.println(IpPartAddress[3]); 
                //#endif 

                  ones  = (IpPartAddress[3]%10);
                  tens      = ((IpPartAddress[3]/10)%10);
                  hundreds      = ((IpPartAddress[3]/100)%10);
                  #ifdef IPM_DEBUG
                    Serial.println("- " + String(hundreds));
                    Serial.println("- " + String(tens));
                    Serial.println("- " + String(ones));
                  #endif



    


      /*
      //setze hier statische IP
      IPAddress _ip,_gw,_sn,_dns;
      _ip.fromString(static_ip);
      _gw.fromString(static_gw);
      _sn.fromString(static_sn);
      _dns.fromString(static_dns);
      wifiManager.setSTAStaticIPConfig(_ip, _gw, _sn);
      */


     // Serial.println("init 2");


    //wifiManager.setAPCallback(configModeCallback);
    //fetches ssid and pass and tries to connect
    //if it does not connect it starts an access point with the specified name
    //here  "Auto ConnectAP"
    //and goes into a blocking loop awaiting configuration
    /*
    if (!wifiManager.autoConnect()) {
      Serial.println("failed to connect and hit timeout");
      //reset and try again, or maybe put it to deep sleep
      ESP.restart();
      delay(1000);
    }*/
    


    /*
      // Connect to WiFi
      WiFi.begin(ssid, pass);
      delay(200);
      while (WiFi.status() != WL_CONNECTED) {
        Serial.print('.');
        delay(1000);
      }
    */

    //Serial.println("zustandVersion " + String(zustandVersion));


      //******************************************************************************
      //                       Starte BLE Verbindung                                *
      //******************************************************************************
      #ifdef BLE_Server

        if (WiFi_status == WL_CONNECTED) {
           
            Serial.println("Bluetooth start.");
            BLEDevice::init("Long name works now");
            BLEServer *pServer = BLEDevice::createServer();
            BLEService *pService = pServer->createService(SERVICE_UUID);
            BLECharacteristic *pCharacteristic = pService->createCharacteristic(
                                                  CHARACTERISTIC_UUID,
                                                  BLECharacteristic::PROPERTY_READ |
                                                  BLECharacteristic::PROPERTY_WRITE
                                                );
            
            Serial.println("Bluetooth go.");
            pCharacteristic->setValue("Hello World says Neil");
            pService->start();
            // BLEAdvertising *pAdvertising = pServer->getAdvertising();  // this still is working for backward compatibility
            BLEAdvertising *pAdvertising = BLEDevice::getAdvertising();
            pAdvertising->addServiceUUID(SERVICE_UUID);
            pAdvertising->setScanResponse(true);
            pAdvertising->setMinPreferred(0x06);  // functions that help with iPhone connections issue
            pAdvertising->setMinPreferred(0x12);
            BLEDevice::startAdvertising();
            Serial.println("Characteristic defined! Now you can read it in your phone!");
        }

      #endif
     //*******************************************************************************************************






    #ifdef BLE_multi2

      // Create the BLE Device
        BLEDevice::init("ESP32");

        // Create the BLE Server
        pServer = BLEDevice::createServer();
        pServer->setCallbacks(new MyServerCallbacks());

        // Create the BLE Service
        BLEService *pService = pServer->createService(SERVICE_UUID);

        // Create a BLE Characteristic
        pCharacteristic = pService->createCharacteristic(
                            CHARACTERISTIC_UUID,
                            BLECharacteristic::PROPERTY_READ   |
                            BLECharacteristic::PROPERTY_WRITE  |
                            BLECharacteristic::PROPERTY_NOTIFY |
                            BLECharacteristic::PROPERTY_INDICATE
                          );

        // https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.descriptor.gatt.client_characteristic_configuration.xml
        // Create a BLE Descriptor
        pCharacteristic->addDescriptor(new BLE2902());

        // Start the service
        pService->start();

        // Start advertising
        BLEAdvertising *pAdvertising = BLEDevice::getAdvertising();
        pAdvertising->addServiceUUID(SERVICE_UUID);
        pAdvertising->setScanResponse(false);
        pAdvertising->setMinPreferred(0x0);  // set value to 0x00 to not advertise this parameter
        BLEDevice::startAdvertising();
        Serial.println("Waiting a client connection to notify...");
        delay(500);
        
    #endif



    #ifdef BLE_Serial
      Serial.println("Bluetooth start.");
      SerialBT.begin("ESP32test"); //Name des ESP32
      Serial.println("Der ESP32 ist bereit. Verbinde dich nun über Bluetooth.");

    #endif


    #ifdef BLE_Serialparing2
      
      Serial.println("Start bluetooth!");
      SerialBT.enableSSP();
      SerialBT.onConfirmRequest(BTConfirmRequestCallback);
      SerialBT.onAuthComplete(BTAuthCompleteCallback);
      Serial.println("Send bluetooth!");
      SerialBT.begin("ESP32test"); //Bluetooth device name
      Serial.println("The device started, now you can pair it with bluetooth!");

    #endif



 // Serial.println("init 3");



  //******************************************************************************
  //                          Starte Webserver                                   *
  //******************************************************************************

  on_AsyncWebServer();
  
  //*******************************************************************************

   //   Serial.println("init 4");

    #ifdef test_dns
    char servername[]="google.com";  // remote server we will connect to
    Serial.println("\nStarting connection... " + String(servername));
    // if you get a connection, report back via serial:
    if (Client.connect(servername, 80)) {
      Serial.println("connected");
      // Make a HTTP request:
      Client.println("GET /search?q=arduino HTTP/1.0");
      Client.println();
    }else{
     Serial.println("not connected!!!");
    
    }
   #endif




  #ifdef Freshbox 
    //udp2.begin(localPort); 
  #endif





  //******************************************************************************
  //                            Weller Lüfter                                    *
  //******************************************************************************

  //HardwareSerial Serial1(1);

#ifdef ESP32_PiCO
  #define SERIAL1_RXPIN 33             // receive  UART1  SD3  GPIO10
  #define SERIAL1_TXPIN 26             //34  transmit  UART1  SD2  GPIO 9 
#else
  #define SERIAL1_RXPIN 33              // receive  UART1  SD3  GPIO10
  #define SERIAL1_TXPIN 26             //34  transmit  UART1  SD2  GPIO 9 
#endif

  Serial1.begin(1200, SERIAL_8N1, SERIAL1_RXPIN, SERIAL1_TXPIN);
  Serial.setTimeout(200); // standard 1000 milliseconds
  inputString.reserve(20);
  //SoftwareSerial mySerial(SERIAL1_RXPIN, SERIAL1_TXPIN); // RX, TX


  //*******************************************************************************



  //    Serial.println("init 5");


  //******************************************************************************
  //                       Starte Modbus RTU                                     *
  //******************************************************************************

  // Init Serial1/2 conneted to the RTU Modbus
 // (Fill in your data here!)

#ifdef PCB_v_5  //ab 6 richtig
  #define SERIAL2_RXPIN 18            // receive  UART2    gelb    GPIO16  PIN25  RXD2  pico 18
  #define SERIAL2_TXPIN 19            // transmit  UART2   grün    GPIO17  PIN27  TXD2  pico 19
#else
  #define SERIAL2_RXPIN 22  //18            // receive  UART2    gelb    GPIO16  PIN25  RXD2  pico 18
  #define SERIAL2_TXPIN 25  //19            // transmit  UART2   grün    GPIO17  PIN27  TXD2  pico 19
#endif




  //Serial2.begin(9600, SERIAL_8N1, GPIO_NUM_17, GPIO_NUM_16);

  Serial2.begin(mbus_baud, SERIAL_8N1, SERIAL2_RXPIN, SERIAL2_TXPIN);


  //#ifdef WEB_DEBUG
  //Serial.println("__ Serial 1 OK __");
  //#endif
  //-------------------------------------------------------------
  

  //    Serial.println("init 6");

//******************************************************************************
//                       Setup Modbus server                                   *
//******************************************************************************
#ifndef MB_Gateway

  // Set up test memory
  //for (uint16_t i = 0; i < 4; ++i) {
    //memo[i] = (i * 2) << 8 | ((i * 2) + 1);
  //}

  // Define and start RTU server
  MBserver.registerWorker(2, READ_INPUT_REGISTER, &FC03);     // FC=04 for serverID=2
  Serial.println("init 7");
  p_inputtcpport.toCharArray(p_inputtcpportc, 4); 
  port = atoi(p_inputtcpportc); 
  Serial.println("init 8");
  MBserver.start(port, 2, 20000);
  //-------------------------------------------------------------

#endif





  //    Serial.println("init finish");

     Serial.println("  A");   
     Serial.println("  |");
     Serial.println("---------------------------------------------");
       
   // Serial.println("---------------------------------------------");
    Serial.println("  |");
    Serial.println("-->  boot... ");
    Serial.println("  |");
    Serial.println("---------------------------------------------");
    Serial.println(" ");
//------------------------------------------------------------------------------





  //******************************************************************************
  //                       Starte SPIFFS Dateisystem                             *
  //****************************************************************************** 

   
    if(!SPIFFS.begin(FORMAT_SPIFFS_IF_FAILED)){
        #ifdef NVS_DEBUG
        Serial.println("SPIFFS Mount Failed");
        #endif
        return;
    }else{
        #ifdef NVS_DEBUG
        Serial.println("SPIFFS mounted correctly.");   
        #endif 
    }
    

 
    #ifdef NVS_space_DEBUG
    // Get all information of SPIFFS
    unsigned int totalBytes = SPIFFS.totalBytes();
    unsigned int usedBytes = SPIFFS.usedBytes();
    //Serial.println("-----------------------------------");
    Serial.println("===== NVS File system info =====");
    Serial.print("Total space:      ");
    Serial.print(totalBytes);
    Serial.println(" byte");
    Serial.print("Total space used:  ");
    Serial.print(usedBytes);
    Serial.println(" byte");
    Serial.println("-----------------------------------"); 
    Serial.println(); 
    #endif 
    //listDir(SPIFFS, "/", 0);
    //writeFile(SPIFFS, "/hello.txt", "Hello ");
    //appendFile(SPIFFS, "/hello.txt", "World!\r\n");
    //readFile(SPIFFS, "/lightman.js");
    //readFile(SPIFFS, "/lightman.js");
    //readFile(SPIFFS, "/mobil04.html");
   // renameFile(SPIFFS, "/hello.txt", "/foo.txt");
    //readFile(SPIFFS, "/foo.txt");
    //deleteFile(SPIFFS, "/foo.txt");
    //testFileIO(SPIFFS, "/test.txt");
   // deleteFile(SPIFFS, "/test.txt");
    //Serial.println( "Test complete" );
    
  // Dateisystem formatieren
  //SPIFFS.format();



  //datei_schreiben();
  //datei_lesen();
  //datei_lesen_line();

  //----------------------------------------------------------------




  //******************************************************************************
  //                           Starte MQTT Setup                                 *
  //****************************************************************************** 

    
    //client.setServer(mqttServer, mqttport);

    p_inputmqserver.toCharArray(p_inputmqserverc, 40);
    p_inputmqporti = p_inputmqport.toInt();

    p_inputmqmeshi = atoi(p_inputmqmesh.c_str());   

    //Serial.println("4p_inputmqmeshi " + p_inputmqmeshi);
    //Serial.println(p_inputmqmesh);
    
        //WiFiClient Client;
        //const int httpPortmqtt = 1883;
        //IPAddress servermqtt(52,54,110,50);  // io.adafruit.com
        //IPAddress servermqtt(207,154,203,193);  // livair.io

    //client.setServer(servermqtt, p_inputmqporti);
    //client.setServer(p_inputmqserverc, p_inputmqporti);




    #ifdef o_ThingsBoard3

        //Serial1.begin(9600);
        //Serial1.write('c');
        //Serial1.write('\n');

        //myFS = new LittleFS_MBED();

        //if (!myFS->init())
        //{
         // Serial.println("LITTLEFS Mount Failed");

          //return;
        //}

        //String fv = WiFi.firmwareVersion();
        //if (fv < WIFI_FIRMWARE_LATEST_VERSION) {
          //Serial.println("Please upgrade the firmware");
       // }

        //client.setServer(serverAddress.c_str(), 8080);
        client.setServer(p_inputmqserverc, p_inputmqporti);
        client.setCallback(callback);




 
        // Message arrived [/provision/response] {"errorMsg":"Failed to provision device!","status":"FAILURE"}
        // Message arrived [/provision/response] {"credentialsValue":"ozh8RhbEYQowgpo6eObo","credentialsType":"ACCESS_TOKEN","status":"SUCCESS"}
        
        //callback();

  


       

        //client.disconnect();

        // you're connected now, so print out the status:


    #endif






  //******************************************************************************
  //                           Starte CO2 Setup                                 *
  //****************************************************************************** 
  #ifdef CO2_on
   
    #ifdef CO2_DEBUG
    Serial.println("setup: Starting CCS811 basic demo");
    Serial.print("setup: ccs811 lib  version: ");
    Serial.println(CCS811_VERSION);
    #endif

    // Enable I2C
    Wire.begin();
  
    // Enable CCS811
    ccs811.set_i2cdelay(50); // Needed for ESP8266 because it doesn't handle I2C clock stretch correctly
    //bool okco2 ;
     //= ccs811.begin();
    ccs811.begin();
    #ifdef CO2_DEBUG
    //if ( !okco2 ) Serial.println("setup: CCS811 begin FAILED");
    #endif

    #ifdef CO2_DEBUG
    // Print CCS811 versions
    Serial.print("setup: hardware    version: "); Serial.println(ccs811.hardware_version(), HEX);
    Serial.print("setup: bootloader  version: "); Serial.println(ccs811.bootloader_version(), HEX);
    Serial.print("setup: application version: "); Serial.println(ccs811.application_version(), HEX);
    #endif
  
    // Start measuring
    //okco2 = 
    ccs811.start(CCS811_MODE_10SEC);
    #ifdef CO2_DEBUG
    //if ( !okco2 ) Serial.println("setup: CCS811 start FAILED");
    #endif


  #endif



  //******************************************************************************
  //                     INIT Async WebServer Request                            *
  //****************************************************************************** 

    // Route for root / web page
  server.on("/", HTTP_GET, [](AsyncWebServerRequest *request){
     
      pauseWebpage = 2;
    esp_task_wdt_reset();
      #ifdef WEB_DEBUG
        
        
        /*
        Serial.println(request->url());
        Serial.print("Received request from client with IP: ");
        IPAddress remote_ip = request->client()->remoteIP();
        request_remoteIP_temp = remote_ip.toString(); 
        Serial.println(request_remoteIP_01);
        */

        //request_remoteIP_temp = request_remoteIP_01;

        /*
        Serial.println(request->version());       // uint8_t: 0 = HTTP/1.0, 1 = HTTP/1.1
        Serial.println(request->method());        // enum:    HTTP_GET, HTTP_POST, HTTP_DELETE, HTTP_PUT, HTTP_PATCH, HTTP_HEAD, HTTP_OPTIONS
        Serial.println(request->url());          // String:  URL of the request (not including host, port or GET parameters)
        Serial.println(request->host());         // String:  The requested host (can be used for virtual hosting)
        Serial.println(request->contentType());   // String:  ContentType of the request (not avaiable in Handler::canHandle)
        Serial.println(request->contentLength()); // size_t:  ContentLength of the request (not avaiable in Handler::canHandle)
        Serial.println(request->multipart());     // bool:    True if the request has content type "multipart"
        */
      #endif


      select_reboot = 1;
      p_inputsavebit = "savebit";
      p_inputsavebit_txt = "";    

      p_getapmodus = "";
      p_getreboot = "";
      p_getsearch = "";
      p_getdelete = "";
      p_getdeleteup = "";
      //p_getfreshlearn = "";
      p_getscan = "";
      p_getradonaktual = "";
      val4 ++;





       #ifdef WEB_DEBUG
        Serial.println("-->  " + p_time + " Page:" + String(chart_page) +  " HTML laden b"); 
        #endif

     chart_page = 0;

      //gauge_page = false;  

            if(gauge_page == true){  
              request->send(200, "text/html", SendHTMLc(val1, val2, val3, val4, val5, val6, val7, val8, val9, val10, bgcolor_vorgabe, esp32_uptime, p_uptime2, val3_color, p_uhrzeit)); 
            }else{
              if(g_mb_mesh == false){ 
                request->send(200, "text/html", SendHTMLf(val1, val2, val3, val4, val5, val6, val7, val8, val9, val10, bgcolor_vorgabe, esp32_uptime, p_uptime2, val3_color, p_uhrzeit)); 
              }else{
                request->send(200, "text/html", SendHTMLfmesh(valm1, valm2, valm3, valm4, valm5, valm6, valm7, valm8, valm9, valm10, bgcolor_vorgabeg, bgcolor_vorgaber, esp32_uptime, p_uptime2, val3_color, p_uhrzeit,p_time_mesh_uplod_s,AI_VSS_mv_s)); 
             }
            }







      #ifdef WEB_DEBUG
        Serial.println("-->  " + p_time + " Page:" + String(chart_page) +  " HTML laden fertig"); 
      #endif


  });



  server.on("/index.html", HTTP_GET, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG2
      Serial.println(request->url());
      Serial.print("Received request from client with IP: ");
      Serial.println(request->client()->remoteIP());
      #endif
      select_reboot = 1;
      p_inputsavebit = "savebit";
      p_inputsavebit_txt = "";

      p_getapmodus = "";
      p_getreboot = "";
      p_getsearch = "";
      p_getdelete = "";
      p_getdeleteup = "";
      //p_getfreshlearn = "";
      p_getscan = "";
      p_getradonaktual = "";
      val4 = 0;
      val5 = 0;
      val6 = 0;
      val7 = 0;
      pauseWebpage = 5;

      //if(chart_page == 3 || chart_page == 4 || chart_page == 5){
        chart_page = 0;
      //}

      updateDIVs();
      read_div_values();
    esp_task_wdt_reset();


       #ifdef WEB_DEBUG
        Serial.println("-->  " + p_time + " Page:" + String(chart_page) +  " HTML laden b"); 
        #endif

     chart_page = 0;

      //gauge_page = false;  

            if(gauge_page == true){  
              request->send(200, "text/html", SendHTMLc(val1, val2, val3, val4, val5, val6, val7, val8, val9, val10, bgcolor_vorgabe, esp32_uptime, p_uptime2, val3_color, p_uhrzeit)); 
            }else{
              if(g_mb_mesh == false){ 
                request->send(200, "text/html", SendHTMLf(val1, val2, val3, val4, val5, val6, val7, val8, val9, val10, bgcolor_vorgabe, esp32_uptime, p_uptime2, val3_color, p_uhrzeit)); 
              }else{
                request->send(200, "text/html", SendHTMLfmesh(valm1, valm2, valm3, valm4, valm5, valm6, valm7, valm8, valm9, valm10, bgcolor_vorgabeg, bgcolor_vorgaber, esp32_uptime, p_uptime2, val3_color, p_uhrzeit,p_time_mesh_uplod_s,AI_VSS_mv_s)); 
             }
            }


      #ifdef WEB_DEBUG
        Serial.println("-->  " + p_time + " Page:" + String(chart_page) +  " HTML laden fertig"); 
      #endif





  });


  server.on("/index.htm", HTTP_GET, [](AsyncWebServerRequest *request){
      //Serial.println(request->url());
      select_reboot = 1;
      p_inputsavebit = "savebit";
      p_inputsavebit_txt = "";   

      p_getapmodus = "";
      p_getreboot = "";
      p_getsearch = "";
      p_getdelete = "";
      p_getdeleteup = "";
      //p_getfreshlearn = "";
      p_getscan = "";
      p_getradonaktual = "";  
      pauseWebpage = 5;

      //if(chart_page == 3 || chart_page == 4 || chart_page == 5 || chart_page == 1 || chart_page == 2){
        //chart_page = 0;
      //}

    updateDIVs();
    read_div_values();
    esp_task_wdt_reset();

      #ifdef WEB_DEBUG
        Serial.println("-->  " + p_time + " Page:" + String(chart_page) +  " HTML laden b"); 
      #endif

     chart_page = 0;

      //gauge_page = false;  

            if(gauge_page == true){  
              request->send(200, "text/html", SendHTMLc(val1, val2, val3, val4, val5, val6, val7, val8, val9, val10, bgcolor_vorgabe, esp32_uptime, p_uptime2, val3_color, p_uhrzeit)); 
            }else{
              if(g_mb_mesh == false){ 
                request->send(200, "text/html", SendHTMLf(val1, val2, val3, val4, val5, val6, val7, val8, val9, val10, bgcolor_vorgabe, esp32_uptime, p_uptime2, val3_color, p_uhrzeit)); 
              }else{
                request->send(200, "text/html", SendHTMLfmesh(valm1, valm2, valm3, valm4, valm5, valm6, valm7, valm8, valm9, valm10, bgcolor_vorgabeg, bgcolor_vorgaber, esp32_uptime, p_uptime2, val3_color, p_uhrzeit,p_time_mesh_uplod_s,AI_VSS_mv_s)); 
             }
            }


      #ifdef WEB_DEBUG
        Serial.println("-->  " + p_time + " Page:" + String(chart_page) +  " HTML laden fertig"); 
      #endif




  });



  server.on("/radon.html", HTTP_GET, [](AsyncWebServerRequest *request){
      //Serial.println(request->url());
      #ifdef WEB_DEBUG2
      //Serial.println(request->url());
      //Serial.print("Received request from client with IP: ");
      //Serial.println(request->client()->remoteIP());
      #endif

      #ifdef onWIFI_wps
      esp_wifi_wps_start(0);
      wpsStart();
      #endif

      select_reboot = 1;
      p_inputsavebit = "savebit";
      p_inputsavebit_txt = "";   

      p_getapmodus = "";
      p_getreboot = "";
      p_getscan = "";
      p_getradonaktual = "";  
      p_getsearch = "";
      p_getdelete = "";
      p_getdeleteup = "";
      //p_getfreshlearn = "";
      pauseWebpage = 5;


      request->send(200, "text/html", SendHTMLd(val1, val2, rval3, rval4, rval5, rval6, rval7)); 




  });



  
  server.on("/radon.xml", HTTP_GET, [](AsyncWebServerRequest *request){
      //Serial.println(request->url());
      #ifdef WEB_DEBUG2
      //Serial.println(request->url());
      //Serial.print("Received request from client with IP: ");
      //Serial.println(request->client()->remoteIP());
      #endif

      #ifdef onWIFI_wps
      esp_wifi_wps_start(0);
      wpsStart();
      #endif

      select_reboot = 1;
      p_inputsavebit = "savebit";
      p_inputsavebit_txt = "";   

      p_getapmodus = "";
      p_getreboot = "";
      p_getscan = "";
      p_getradonaktual = "";  
      p_getsearch = "";
      p_getdelete = "";
      p_getdeleteup = "";
      //p_getfreshlearn = "";
      pauseWebpage = 5;


      request->send(200, "text/xml", SendHTMLh(rval3, rval4, rval5, rval6)); 




  });
 

 
  server.on("/jquery.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    #ifdef WEB_DEBUG3
    Serial.println("jquery.js load start");
    #endif
    #ifdef Web_wait
      delay(300);
    #endif
    request->send(SPIFFS, "/jquery.js", "text/javascript");
  });

    server.on("/favicon.ico", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2  
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    //request->send(SPIFFS, "/chart.js", "text/javascript");
    request->send(SPIFFS, "/favicon-32x32.png", "image/png");
  });

    server.on("/data.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2  
    Serial.println(request->url());
    #endif
    #ifdef WEB_DEBUG3
    Serial.println("data.js load start");
    #endif
    pauseWebpage = 5;
    request->send(SPIFFS, "/data.js", "text/javascript");
  });

  /*
    server.on("/chart.min.js", HTTP_GET, [](AsyncWebServerRequest *request){
    Serial.println(request->url());
    pauseWebpage = 5;
    request->send(SPIFFS, "/chart.min.js", "text/javascript");
  });
  */

  server.on("/lightman.js", HTTP_GET, [](AsyncWebServerRequest *request){
    Serial.println(request->url());
    pauseWebpage = 5;
    #ifdef Web_wait
      delay(300);
    #endif
    #ifdef WEB_DEBUG3
    Serial.println("lightman.js load start");
    #endif
    esp_task_wdt_reset();
    request->send(SPIFFS, "/lightman.js", "text/javascript");
  });






  server.on("/styles.css", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif

    pauseWebpage = 5;

    #ifdef WEB_DEBUG3
    Serial.println("styles.css load start");
    #endif
    #ifdef Web_wait
      delay(300);
    #endif
    esp_task_wdt_reset();
    //if(chart_page <= 2|| chart_page == 6){
      request->send(SPIFFS, "/styles.css", "text/css", len_file1);
    //}
  });

#ifdef old_option
  server.on("/styles2.css", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    #ifdef Web_wait
      delay(300);
    #endif
    esp_task_wdt_reset();
    //if(chart_page <= 2|| chart_page == 6){
      request->send(SPIFFS, "/styles2.css", "text/css", len_file2);
    //}
  });
#endif
  
 
  server.on("/ipaddress-validation.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    request->send(SPIFFS, "/ipaddress-validation.js", "text/javascript");
  });
 
  server.on("/line.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    request->send(SPIFFS, "/line.js", "text/javascript");
  });
 
  server.on("/jsthree.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    if(chart_page == 7){
    #ifdef Web_wait
      delay(300);
    #endif
    esp_task_wdt_reset();
    #ifdef WEB_DEBUG3
    Serial.println("jsthree0.js load start");
    #endif
      request->send(SPIFFS, "/jsthree0.js", "text/javascript", len_file3);
    #ifdef Web_wait
      delay(300);
    #endif
    esp_task_wdt_reset();
    //#ifdef WEB_DEBUG2
    //Serial.println("jsthree0.js load fertig");
    //#endif
    }else{
    #ifdef Web_wait
      delay(300);
    #endif
    esp_task_wdt_reset();
      request->send(SPIFFS, "/jsthree.js", "text/javascript", len_file4);
      #ifdef WEB_DEBUG3
      Serial.println("jsthree.js load start");
      #endif
    }
  });


  server.on("/jsthree1.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    #ifdef Web_wait
      delay(300);
    #endif
    esp_task_wdt_reset();
    #ifdef WEB_DEBUG3
    Serial.println("jsthree1.js load start");
    #endif
      request->send(SPIFFS, "/jsthree1.js", "text/javascript", len_file5);
    //#ifdef WEB_DEBUG2
    //Serial.println("jsthree1.js load fertig");
    //#endif
    esp_task_wdt_reset();
    //Serial.println("jsthree1.js ende");

  });

  server.on("/jsthree2.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    #ifdef Web_wait
      delay(300);
    #endif
    esp_task_wdt_reset();
    #ifdef WEB_DEBUG3
    Serial.println("jsthree2.js load start");
    #endif
    request->send(SPIFFS, "/jsthree2.js", "text/javascript", len_file6);
    //#ifdef WEB_DEBUG2
    //Serial.println("jsthree2.js load fertig");
    //#endif
    esp_task_wdt_reset();
    //Serial.println("jsthree2.js ende");

  });  

  #ifdef old_option
  server.on("/gloader.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    #ifdef Web_wait
      delay(300);
    #endif
    request->send(SPIFFS, "/gloader.js", "text/javascript", len_file8);

  });
  #endif


  server.on("/zonehead.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG3
    Serial.println("zonehead.js load start");
    #endif
    pauseWebpage = 5;
    #ifdef Web_wait
      delay(300);
    #endif
    esp_task_wdt_reset();
    request->send(SPIFFS, "/zonehead.js", "text/javascript", len_file7);

    #ifdef WEB_DEBUG2
    Serial.println("zonehead.js load fertig");
    #endif
    if(mb_afrg_Radon == 1){  // Abfrage wenn aktion gestartet
      ms6 = millis();
      mb_afrg_Radon = 2; 
    }

    //---------------------------------
    //-- LED IP ende weil Abdresse gefunden wurde.
     if (ee_ip_search == 0){
      if(select_apmodus == 0){    //nicht beim Reset, weil dor dann später die var gespeichert wird
         ee_ip_search = 1;
         Preferences preferences;
         preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
         preferences.putUInt("ee_ipsearch", ee_ip_search);                  //Variable unter "Datei" ee_ipsearch speichern   
      }
    }
    //---------------------------------

  });  
   
  server.on("/newurl.js", HTTP_GET, [](AsyncWebServerRequest *request){
    #ifdef WEB_DEBUG2
    Serial.println(request->url());
    #endif
    pauseWebpage = 5;
    request->send(SPIFFS, "/newurl.js", "text/javascript");
  });  
   
   /*
  server.on("/chartlbl.js", HTTP_GET, [](AsyncWebServerRequest *request){
    Serial.println(request->url());
    pauseWebpage = 5;
    request->send(SPIFFS, "/chartlbl.js", "text/javascript");
    Serial.println("/chartlbl.js ende");
  });  
*/



      server.on("/chartdiv.js", HTTP_GET, [](AsyncWebServerRequest *request){
        // Serial.println("/chartdiv.js " + String(chart_page));
         pauseWebpage = 5;
        //request->send(SPIFFS, "/chartdiv.js", "text/javascript");

            if(chart_page == 1 || chart_page == 6){     
                             
                   stringdata = "data : [" + String(charInts[0]) + "," + String(charInts[1]) + "," + String(charInts[2]) + "," + String(charInts[3]) + "," + String(charInts[4]) + "," + String(charInts[5]) + "," + String(charInts[6]) + "," + String(charInts[7]) + "," + String(charInts[8]) + "," + String(charInts[9]) + "," + String(charInts[10]) + "," + String(charInts[11]) + "," + String(charInts[12]) + "," + String(charInts[13]) + "," + String(charInts[14]) + "," + String(charInts[15]) + "," + String(charInts[16]) + "," + String(charInts[17]) + "," + String(charInts[18]) + "," + String(charInts[19]) + "," + String(charInts[20]) + "," + String(charInts[21]) + "," + String(charInts[22]) + "," + String(charInts[23]) + "," + String(charInts[24]) + "," + String(charInts[25]) + "," + String(charInts[26]) + "," + String(charInts[27]) + "," + String(charInts[28]) + "," + String(charInts[29]) + "," + String(charInts[30]) + "," + String(charInts[31]) + "," + String(charInts[32]) + "," + String(charInts[33]) + "," + String(charInts[34]) + "," + String(charInts[35]) + "," + String(charInts[36]) + "," + String(charInts[37]) + "," + String(charInts[38]) + "," + String(charInts[39]) + "," + String(charInts[40]) + "," + String(charInts[41]) + "," + String(charInts[42]) + ",],";
                             
                                  request->send(200, "text/javascript", "var ctx = document.getElementById('myChart').getContext('2d');var myChart = new Chart(ctx, {type:'line',data: {" 
                                        + stringtime + 
                                        "datasets: [ { " 
                                        + stringdata +
                                        "lineTension: 0.3, linecapBezierPoints: 1.9,label: \"Live Radon Bq/m3\",borderColor: \"rgb(62,149,205)\",backgroundColor: \"rgb(62,149,205,0.1)\",borderWidth:2,pointStyle:'rectRot',tension: 0.1,pointRadius:2,}]},});"
                                       
                                        "var ctx2 = document.getElementById('myChart2').getContext('2d');var myChart2 = new Chart(ctx2, {type:'bar',data: {" 
                                        + stringtime2 + 
                                        "datasets: [ { " 
                                        + stringdata2 +
                                        "lineTension: 0.5,linecapBezierPoints: 2.9,label: \"Day Radon Bq/m3\",borderColor: [\""+ rgbchart01 +"\",\""+ rgbchart02 +"\",\""+ rgbchart03 +"\",\""+ rgbchart04 +"\",\""+ rgbchart05 +"\",\""+ rgbchart06 +"\",\""+ rgbchart07 +"\",\""+ rgbchart08 +"\",\""+ rgbchart09 +"\",\""+ rgbchart10 +"\",\""+ rgbchart11 +"\",\""+ rgbchart12 +"\",\""+ rgbchart13 +"\",\""+ rgbchart14 +"\"],backgroundColor: \"rgb(62,149,205,0.4)\",borderWidth:2,}]},});"
                                                                               
                                        );
            }
               //Serial.println("/chartdiv.js ende ");
      });  

  #ifdef old_option    

      server.on("/chartdiv3.js", HTTP_GET, [](AsyncWebServerRequest *request){
        // Serial.println("/chartdiv3.js " + String(chart_page));
         pauseWebpage = 10;
        //request->send(SPIFFS, "/chartdiv.js", "text/javascript");
          //#ifdef CO2_on
            if(chart_page == 2){ 
                     stringdata = "data : [" + String(charInts3[0]) + "," + String(charInts3[1]) + "," + String(charInts3[2]) + "," + String(charInts3[3]) + "," + String(charInts3[4]) + "," + String(charInts3[5]) + "," + String(charInts3[6]) + "," + String(charInts3[7]) + "," + String(charInts3[8]) + "," + String(charInts3[9]) + "," + String(charInts3[10]) + "," + String(charInts3[11]) + "," + String(charInts3[12]) + "," + String(charInts3[13]) + "," + String(charInts3[14]) + "," + String(charInts3[15]) + "," + String(charInts3[16]) + "," + String(charInts3[17]) + "," + String(charInts3[18]) + "," + String(charInts3[19]) + "," + String(charInts3[20]) + "," + String(charInts3[21]) + "," + String(charInts3[22]) + "," + String(charInts3[23]) + "," + String(charInts3[24]) + "," + String(charInts3[25]) + "," + String(charInts3[26]) + "," + String(charInts3[27]) + "," + String(charInts3[28]) + "," + String(charInts3[29]) + "," + String(charInts3[30]) + "," + String(charInts3[31]) + "," + String(charInts3[32]) + "," + String(charInts3[33]) + "," + String(charInts3[34]) + "," + String(charInts3[35]) + "," + String(charInts3[36]) + "," + String(charInts3[37]) + "," + String(charInts3[38]) + "," + String(charInts3[39]) + "," + String(charInts3[40]) + "," + String(charInts3[41]) + "," + String(charInts3[42]) + ",],";
    
                                  request->send(200, "text/javascript", "var ctx3 = document.getElementById('myChart3').getContext('2d');var myChart = new Chart(ctx3, {type:'line',data: {" 

                                         + stringtime + 
                                        "datasets: [ { " 
                                        + stringdata +
                                        "lineTension: 0.3, linecapBezierPoints: 1.9,label: \"CO2 ppm\",borderColor: \"rgb(162,149,25)\",backgroundColor: \"rgb(162,149,25,0.1)\",borderWidth:2,pointStyle:'rectRot',tension: 0.1,pointRadius:2,}]},"
                                        

                                       "options: {interaction: {intersect: false,mode: 'index',},"
                                       "plugins: {title: {display: true,text: (ctx3) => 'Tooltip position mode: ' + ctx3.chart.options.plugins.tooltip.position,},}}"

                                        "});"
                                       
                                        );
            }
          //#endif 
              // Serial.println("/chartdiv3.js ende ");
      });  



      server.on("/chartdiv4.js", HTTP_GET, [](AsyncWebServerRequest *request){
        // Serial.println("/chartdiv4.js " + String(chart_page));
         pauseWebpage = 10;
        //request->send(SPIFFS, "/chartdiv.js", "text/javascript");
          //#ifdef CO2_on
            if(chart_page == 2 || chart_page == 6){ 
                     stringdata = "data : [" + String(charInts4[0]) + "," + String(charInts4[1]) + "," + String(charInts4[2]) + "," + String(charInts4[3]) + "," + String(charInts4[4]) + "," + String(charInts4[5]) + "," + String(charInts4[6]) + "," + String(charInts4[7]) + "," + String(charInts4[8]) + "," + String(charInts4[9]) + "," + String(charInts4[10]) + "," + String(charInts4[11]) + "," + String(charInts4[12]) + "," + String(charInts4[13]) + "," + String(charInts4[14]) + "," + String(charInts4[15]) + "," + String(charInts4[16]) + "," + String(charInts4[17]) + "," + String(charInts4[18]) + "," + String(charInts4[19]) + "," + String(charInts4[20]) + "," + String(charInts4[21]) + "," + String(charInts4[22]) + "," + String(charInts4[23]) + "," + String(charInts4[24]) + "," + String(charInts4[25]) + "," + String(charInts4[26]) + "," + String(charInts4[27]) + "," + String(charInts4[28]) + "," + String(charInts4[29]) + "," + String(charInts4[30]) + "," + String(charInts4[31]) + "," + String(charInts4[32]) + "," + String(charInts4[33]) + "," + String(charInts4[34]) + "," + String(charInts4[35]) + "," + String(charInts4[36]) + "," + String(charInts4[37]) + "," + String(charInts4[38]) + "," + String(charInts4[39]) + "," + String(charInts4[40]) + "," + String(charInts4[41]) + "," + String(charInts4[42]) + ",],";
    
                                  request->send(200, "text/javascript", "var ctx4 = document.getElementById('myChart4').getContext('2d');var myChart = new Chart(ctx4, {type:'line',data: {" 

                                         + stringtime + 
                                        "datasets: [ { " 
                                        + stringdata +
                                        "lineTension: 0.3, linecapBezierPoints: 1.9,label: \"TVAC ppb\",borderColor: \"rgb(112,149,85)\",backgroundColor: \"rgb(112,49,85,0.1)\",borderWidth:2,pointStyle:'rectRot',tension: 0.1,pointRadius:2,}]},"
                                        
                                        "options: {tooltips: {callbacks: {labelColor(tooltipItem, chart) {return {borderColor: 'rgb(255, 0, 0)',backgroundColor: 'rgb(255, 0, 0)'};},"
                                        " labelTextColor(tooltipItem, chart) {return 'lightgray';}}},"
                                        " scales: {yAxes: [{ticks: {beginAtZero: true}}]}}"    
                                        
                                        "});"
                                       
                                        );
            }
          //#endif 
            //   Serial.println("/chartdiv4.js ende ");
      });  




    server.on("/chartdiv5.js", HTTP_GET, [](AsyncWebServerRequest *request){
        // Serial.println("/chartdiv5.js " + String(chart_page));
         pauseWebpage = 10;

            if(chart_page == 6){ 
                     stringdata = "data : [" + String(charInts5[0]) + "," + String(charInts5[1]) + "," + String(charInts5[2]) + "," + String(charInts5[3]) + "," + String(charInts5[4]) + "," + String(charInts5[5]) + "," + String(charInts5[6]) + "," + String(charInts5[7]) + "," + String(charInts5[8]) + "," + String(charInts5[9]) + "," + String(charInts5[10]) + "," + String(charInts5[11]) + "," + String(charInts5[12]) + "," + String(charInts5[13]) + "," + String(charInts5[14]) + "," + String(charInts5[15]) + "," + String(charInts5[16]) + "," + String(charInts5[17]) + "," + String(charInts5[18]) + "," + String(charInts5[19]) + "," + String(charInts5[20]) + "," + String(charInts5[21]) + "," + String(charInts5[22]) + "," + String(charInts5[23]) + "," + String(charInts5[24]) + "," + String(charInts5[25]) + "," + String(charInts5[26]) + "," + String(charInts5[27]) + "," + String(charInts5[28]) + "," + String(charInts5[29]) + "," + String(charInts5[30]) + "," + String(charInts5[31]) + "," + String(charInts5[32]) + "," + String(charInts5[33]) + "," + String(charInts5[34]) + "," + String(charInts5[35]) + "," + String(charInts5[36]) + "," + String(charInts5[37]) + "," + String(charInts5[38]) + "," + String(charInts5[39]) + "," + String(charInts5[40]) + "," + String(charInts5[41]) + "," + String(charInts5[42]) + ",],";
    
                                  request->send(200, "text/javascript", "var ctx5 = document.getElementById('myChart5').getContext('2d');var myChart = new Chart(ctx5, {type:'line',data: {" 

                                         + stringtime + 
                                        "datasets: [ { " 
                                        + stringdata +
                                        "lineTension: 0.3, linecapBezierPoints: 1.9,label: \"Fan %\",borderColor: \"rgb(162,149,25)\",backgroundColor: \"rgb(162,149,25,0.1)\",borderWidth:2,pointStyle:'rectRot',tension: 0.1,pointRadius:2,}]},"
                                        
                               //      "options: {interaction: {intersect: false,mode: 'index',},"
                                       "options: {interaction: {intersect: false,mode: 'index',},scales: {yAxes: [{ticks: {beginAtZero: true,min: 0,max: 100,stepSize: 10,}}]},"
                                       "plugins: {title: {display: true,text: (ctx5) => 'Tooltip position mode: ' + ctx3.chart.options.plugins.tooltip.position,},}}"

                                        "});"
                                       
                                        );
            }

      });  

    server.on("/chartdiv6.js", HTTP_GET, [](AsyncWebServerRequest *request){
        // Serial.println("/chartdiv6.js " + String(chart_page));
         pauseWebpage = 10;

            if(chart_page == 6){ 
                     stringdata = "data : [" + String(charInts[0]) + "," + String(charInts[1]) + "," + String(charInts[2]) + "," + String(charInts[3]) + "," + String(charInts[4]) + "," + String(charInts[5]) + "," + String(charInts[6]) + "," + String(charInts[7]) + "," + String(charInts[8]) + "," + String(charInts[9]) + "," + String(charInts[10]) + "," + String(charInts[11]) + "," + String(charInts[12]) + "," + String(charInts[13]) + "," + String(charInts[14]) + "," + String(charInts[15]) + "," + String(charInts[16]) + "," + String(charInts[17]) + "," + String(charInts[18]) + "," + String(charInts[19]) + "," + String(charInts[20]) + "," + String(charInts[21]) + "," + String(charInts[22]) + "," + String(charInts[23]) + "," + String(charInts[24]) + "," + String(charInts[25]) + "," + String(charInts[26]) + "," + String(charInts[27]) + "," + String(charInts[28]) + "," + String(charInts[29]) + "," + String(charInts[30]) + "," + String(charInts[31]) + "," + String(charInts[32]) + "," + String(charInts[33]) + "," + String(charInts[34]) + "," + String(charInts[35]) + "," + String(charInts[36]) + "," + String(charInts[37]) + "," + String(charInts[38]) + "," + String(charInts[39]) + "," + String(charInts[40]) + "," + String(charInts[41]) + "," + String(charInts[42]) + ",],";
    
                                  request->send(200, "text/javascript", "var ctx5 = document.getElementById('myChart6').getContext('2d');var myChart = new Chart(ctx5, {type:'line',data: {" 

                                         + stringtime + 
                                        "datasets: [ { " 
                                        + stringdata +
                                        "lineTension: 0.3, linecapBezierPoints: 1.9,label: \"Live Radon Bq/m3\",borderColor: \"rgb(62,149,205)\",backgroundColor: \"rgb(62,149,205,0.1)\",borderWidth:2,pointStyle:'rectRot',tension: 0.1,pointRadius:2,}]}," 
                                        

                                       "options: {interaction: {intersect: false,mode: 'index',},"
                                       "plugins: {title: {display: true,text: (ctx5) => 'Tooltip position mode: ' + ctx3.chart.options.plugins.tooltip.position,},}}"

                                        "});"
                                       
                                        );
            }

      });    

  server.on("/chartdiv7.js", HTTP_GET, [](AsyncWebServerRequest *request){
        // Serial.println("/chartdiv7.js " + String(chart_page));
         pauseWebpage = 10;
        //request->send(SPIFFS, "/chartdiv7.js", "text/javascript");
          //#ifdef luefter_on
            if(chart_page == 6){ 
                     stringdata = "data : [" + String(charInts7[0]) + "," + String(charInts7[1]) + "," + String(charInts7[2]) + "," + String(charInts7[3]) + "," + String(charInts7[4]) + "," + String(charInts7[5]) + "," + String(charInts7[6]) + "," + String(charInts7[7]) + "," + String(charInts7[8]) + "," + String(charInts7[9]) + "," + String(charInts7[10]) + "," + String(charInts7[11]) + "," + String(charInts7[12]) + "," + String(charInts7[13]) + "," + String(charInts7[14]) + "," + String(charInts7[15]) + "," + String(charInts7[16]) + "," + String(charInts7[17]) + "," + String(charInts7[18]) + "," + String(charInts7[19]) + "," + String(charInts7[20]) + "," + String(charInts7[21]) + "," + String(charInts7[22]) + "," + String(charInts7[23]) + "," + String(charInts7[24]) + "," + String(charInts7[25]) + "," + String(charInts7[26]) + "," + String(charInts7[27]) + "," + String(charInts7[28]) + "," + String(charInts7[29]) + "," + String(charInts7[30]) + "," + String(charInts7[31]) + "," + String(charInts7[32]) + "," + String(charInts7[33]) + "," + String(charInts7[34]) + "," + String(charInts7[35]) + "," + String(charInts7[36]) + "," + String(charInts7[37]) + "," + String(charInts7[38]) + "," + String(charInts7[39]) + "," + String(charInts7[40]) + "," + String(charInts7[41]) + "," + String(charInts7[42]) + ",],";
   
                                  request->send(200, "text/javascript", "var ctx7 = document.getElementById('myChart7').getContext('2d');var myChart = new Chart(ctx7, {type:'line',data: {" 

                                         + stringtime + 
                                        "datasets: [ { " 
                                        + stringdata +
                                        "lineTension: 0.3, linecapBezierPoints: 1.9,label: \"Radon Fan Bq/m3\",borderColor: \"rgb(62,149,205)\",backgroundColor: \"rgb(62,149,205,0.1)\",borderWidth:2,pointStyle:'rectRot',tension: 0.1,pointRadius:2,}]}," 
                                        

                                       "options: {interaction: {intersect: false,mode: 'index',},"
                                       "plugins: {title: {display: true,text: (ctx5) => 'Tooltip position mode: ' + ctx7.chart.options.plugins.tooltip.position,},}}"

                                        "});"
                                       
                                        );
            }
          //#endif 
              // Serial.println("/chartdiv7.js ende ");
      });  

      #endif 


          //------------------------------------------------------------------------------------------------
        server.onNotFound([](AsyncWebServerRequest *request){
            #ifdef WEB_DEBUG_error
            Serial.printf("NOT_FOUND: ");
            //#endif
            if(request->method() == HTTP_GET)
              //#ifdef WEB_DEBUG2
              Serial.printf("GET");
              //#endif
            else if(request->method() == HTTP_POST)
              //#ifdef WEB_DEBUG2
              Serial.printf("POST");
              //#endif
            else if(request->method() == HTTP_DELETE)
              //#ifdef WEB_DEBUG2
              Serial.printf("DELETE");
              //#endif
            else if(request->method() == HTTP_PUT)
              //#ifdef WEB_DEBUG2
              Serial.printf("PUT");
              //#endif
            else if(request->method() == HTTP_PATCH)
              //#ifdef WEB_DEBUG2
              Serial.printf("PATCH");
              //#endif
            else if(request->method() == HTTP_HEAD)
              //#ifdef WEB_DEBUG2
              Serial.printf("HEAD");
              //#endif
            else if(request->method() == HTTP_OPTIONS)
              //#ifdef WEB_DEBUG2
              Serial.printf("OPTIONS");
              //#endif
            else
              //#ifdef WEB_DEBUG2
              Serial.printf("UNKNOWN");
              Serial.printf(" http://%s%s\n", request->host().c_str(), request->url().c_str());
              //#endif

            if(request->contentLength()){
              //#ifdef WEB_DEBUG2
              Serial.printf("_CONTENT_TYPE: %s\n", request->contentType().c_str());
              Serial.printf("_CONTENT_LENGTH: %u\n", request->contentLength());
              //#endif
            }
            


            int headers = request->headers();
            int i;
            for(i=0;i<headers;i++){
              AsyncWebHeader* h = request->getHeader(i);
              #ifdef WEB_DEBUG_error
              Serial.printf("_HEADER[%s]: %s\n", h->name().c_str(), h->value().c_str());
              #endif
            }

            int params = request->params();
            for(i=0;i<params;i++){
              AsyncWebParameter* p = request->getParam(i);
              if(p->isFile()){
                #ifdef WEB_DEBUG_error
                Serial.printf("_FILE[%s]: %s, size: %u\n", p->name().c_str(), p->value().c_str(), p->size());
                #endif
              } else if(p->isPost()){
                #ifdef WEB_DEBUG_error
                Serial.printf("_POST[%s]: %s\n", p->name().c_str(), p->value().c_str());
                #endif
              } else {
                #ifdef WEB_DEBUG_error
                Serial.printf("_GET[%s]: %s\n", p->name().c_str(), p->value().c_str());
                #endif
              }
            }

            #endif

            request->send(404);
          });
          //------------------------------------------------------------------------------------------------






  server.on("/get", HTTP_GET, [](AsyncWebServerRequest * request) {

      #ifdef WEB_DEBUG2
      //Serial.println(request->url());
      //Serial.print("Received request from client with IP: ");
      //Serial.println(request->client()->remoteIP());
      #endif
    pauseWebpage = 5;
    //request->send(200, "text/plain", readRoom2temp().c_str());

    int paramsNr = request->params();
    //Serial.println(paramsNr);
 
    for(int i=0;i<paramsNr;i++){
        AsyncWebParameter* p = request->getParam(i);
        //AsyncWebParameter* p = request->getParam(0);
        #ifdef WEB_DEBUG
        Serial.println("----------------------------------");
        Serial.println("Logout Timer: " + String(Web_logout_time) + " Minuten");
       // Serial.print("Param name: ");
       // Serial.println(p->name());
        //Serial.print("Param value: ");
        #endif
        


        //-------------------------------------------------------
        if(p->name() == "inputchart"){

       //---------------------------------
        if (chart_page >= 4 || chart_page == 2){
          chart_page = 0; 
        }
       //---------------------------------


          if (p->value() == "0"){
            chart_page = 0;
          }else{
            chart_page = 0; //erst löschen
            if (p->value() == "1"){
            chart_page = 1;   //Chart  oder Anzeigen
            }
            if (p->value() == "2"){
            chart_page = 2;   //ChaRT CO2  Anzeigen
            }
            if (p->value() == "3"){
            chart_page = 0;   //live  oder Anzeigen
            } 
            if (p->value() == "4"){
            gMESHUpdateFlag = true;
            gMESHUpdateFlag2 = true;
            gMESHUpdateFlag3 = true;
            gMESHUpdateFlag4 = true;
            gMESHUpdateFlag5 = true;
            chart_page = 4;   //live  oder Anzeigen
            } 
            if (p->value() == "5"){
            chart_page = 5;   //fan
            } 
            if (p->value() == "6"){
            chart_page = 6;   //Chart  fan
            } 
            if (p->value() == "7"){
            chart_page = 7;   //conig
            p_inputsavebit = " ";
            p_inputsavebit_txt = "";  
            } 

          }

        }
        //-------------------------------------------------

        //-------------------------------------------------------
        if(p->name() == "loginoutt"){

          if (chart_page == 7){
           if(web_write_ok == 0){  
              zone_view ="display: block; overflow: hidden; height: 105px; padding-top: 0px; margin-top: 0px; padding-bottom: 0px; margin-bottom: 0px;'";
              //zone_view ="";
           }else{
              //zone_view ="<div class='zoneblock' style='display: block; overflow: hidden; height: 105px; padding-top: 0px; margin-top: 0px; padding-bottom: 0px; margin-bottom: 0px;'>";  
              zone_view ="display: block; overflow: hidden; height: 105px; padding-top: 0px; margin-top: 0px; padding-bottom: 0px; margin-bottom: 0px;'";
              //zone_view ="";
           }
          }
        }
        //-------------------------------------------------





       //---------------------------------------------------- 
        if(p->name() == "inputpasswort"){
            p_inputpasswort = p->value();
            
              p_inputpasswort_vorgabe_calc = gHour+2;
              p_inputpasswort_vorgabe_calc = p_inputpasswort_vorgabe_calc*100;
              p_inputpasswort_vorgabe_calc = p_inputpasswort_vorgabe_calc/gDay;
              p_inputpasswort_vorgabe2 = String(p_inputpasswort_vorgabe_calc);
            


            if(p_inputpasswort == p_inputpasswort_vorgabe2 || p_inputpasswort == p_inputpasswort_vorgabe || p_inputpasswort == p_inputpasswort_admin){  
                if(web_write_ok == 1){ 
                    //schon pw eingegeben
            
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                    
                }else{ 
                    //pw ok       
                    web_write_ok = 1;
                    bit_setdiv = true;
                   if(p->name() != "inputchart"){
                    
                      web_write_green_red = 1;
                      p_inputsavebit = "savebit_green";
                      p_inputsavebit_txt = "Passwort OK";
                      
                   }

                }
         
                    if(p_inputpasswort == p_inputpasswort_admin){  
                      p_tr_ad_hidden2 = p_tr_hidden1; 
                      Web_logout_time = 61;
                    }else{
                      p_tr_ad_hidden2 = p_tr_hidden0;  // Ausblenden wenn nicht Admin
                    }

            }else{
              //pw  falsch  
                 web_write_ok = 0; 
                 bit_setdiv = true;
              if(p->name() != "inputchart"){
                web_write_green_red = 2;  
                p_inputsavebit = "savebit_red";
                p_inputsavebit_txt = "Wrong Passwort";
              }
            }  
        }
        //-------------------------------------------------------

        //-------------------------------------------------------
        // ab hier nur wenn PW richtig eingeben
        //-------------------------------------------------------

        #ifdef WEB_DEBUG
        Serial.println("web_write_ok: " + String(web_write_ok));
        Serial.println("wp->name()  : " + p->name());
        Serial.println("wp->value() : " + p->value());
        #endif
                    //#ifdef NVS_DEBUG
                    //Serial.println("---- Bit  GRAPH del. = " + String(gGraphDeleteFlag));
                    //#endif
            //-----------------------------------------------
              if(p->name() == "getgauge"){
  
                    p_getgetgauge = p->value();
                   
                    if (p_getgetgauge == "0"){
                      gauge_page = false;
                    }else{
                      gauge_page = true;
                    }

                    // gauge_page = !gauge_page; // switch the display

              }
            //-----------------------------------------------

            //-----------------------------------------------
              tG_x_page = 0;
              if(p->name() == "TG1"){
  
                    p_getTG1 = p->value();

                      tG_x_page = 1;
                     // Serial.println("Taste 1: ");
                      
                      msg_TG[0] = 0xFE;
                      msg_TG[1] = 0x01;
                      msg_TG[2] = 0x01;
                      Serial1.write(msg_TG, 3);
                      delay(300);
                      Serial1.write(msg_TG, 3);
                      //Serial.println("Taste 1: ");
              }
              if(p->name() == "TG2"){
  
                    p_getTG2 = p->value();

                      tG_x_page = 2;
                     // Serial.println("Taste 2: ");
                                            
                      msg_TG[0] = 0xFE;
                      msg_TG[1] = 0x02;
                      msg_TG[2] = 0x02;
                      Serial1.write(msg_TG, 3);
                      delay(300);
                      Serial1.write(msg_TG, 3);
                      //Serial.println("Taste 2: ");
              }
              if(p->name() == "TG3"){
  
                    p_getTG3 = p->value();

                      tG_x_page = 3;
                     // Serial.println("Taste 3: ");
                                            
                      msg_TG[0] = 0xFE;
                      msg_TG[1] = 0x04;
                      msg_TG[2] = 0x04;
                      Serial1.write(msg_TG, 3);
                      delay(300);
                      Serial1.write(msg_TG, 3);
              }
              if(p->name() == "TG4"){
  
                    p_getTG4 = p->value();

                      tG_x_page = 4;
                     // Serial.println("Taste 4: ");
                                            
                      msg_TG[0] = 0xFE;
                      msg_TG[1] = 0x08;
                      msg_TG[2] = 0x08;
                      Serial1.write(msg_TG, 3);
                      delay(300);
                      Serial1.write(msg_TG, 3);
           
              }
              if(p->name() == "Quitt"){
  
                    p_getQuitt = p->value();

                      tG_x_page = 5;
                      Serial.println("Taste Quitt: ");
                                            
                      msg_TG[0] = 0xFE;
                      msg_TG[1] = 0x01;
                      msg_TG[2] = 0x01;
                      Serial1.write(msg_TG, 3);
                      delay(200);
                      Serial1.write(msg_TG, 3);
                      delay(200);
                      Serial1.write(msg_TG, 3);                     
              }
            //-----------------------------------------------


        if(p->name() != "inputpasswort"){
       
         if(web_write_ok == 1){   
            #ifdef WEB_DEBUG
            Serial.println("schreiben freigegeben........... ");
            #endif
            if(p->name() == "inputstaticip"){
                //if(p_inputstaticip == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputstaticip = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Reboot in 10 sec.";
                    splitAdress = p_inputstaticip;
                    //WriteipValuechange();
             
                    abfrage_eingabe = 1;
               // } 
            //------------------------------------------------
            }
            else if(p->name() == "inputsubnetmask"){
               // if(p_inputsubnetmask == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputsubnetmask = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Reboot in 10 sec.";
                    splitAdress = p_inputsubnetmask;
                   // WriteipValuechange();
              
                    abfrage_eingabe = 1;
                //}
            //-----------------------------------------------
            }
            else if(p->name() == "inputgateway"){
               // if(p_inputgateway == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputgateway = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Reboot in 10 sec.";
                    splitAdress = p_inputgateway;
                    //WriteipValuechange();
          
                    abfrage_eingabe = 1;
               // }
            //-----------------------------------------------
            }
            else if(p->name() == "inputdnss"){ //NTP
               // if(p_inputntp == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputntp = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Reboot in 10 sec.";
                    splitAdress = p_inputntp;
                   // WriteipValuechange();
              
               // }
            //-----------------------------------------------
            }
            else if(p->name() == "inputname"){ //Name
               //Serial.println("-->value() : " + p->value());
               //if(p_inputname == p->value()){ 
                    //wert gleich

                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputname = p->value();
                    p_inputsavebit = "savebit_green";
                   // p_inputsavebit_txt = "DNS Saved, please reboot";
                    p_inputsavebit_txt = "Reboot in 10 sec.";
                    p_inputname.toCharArray(p_inputnamec, 10); 
                    #ifdef BLE_WIFI_disable
                      WiFiManager wifiManager;
                      wifiManager.setHostname(p_inputnamec); //tracer.local
                    #endif
                    //WriteipValuechange();
                    WriteipValuechange();
                    select_reboot = 2;
           
               // }

            //-----------------------------------------------
           

          
              }
            else if(p->name() == "inputfreshonoff"){
                //if(p_mqonoff == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{  
                   
                    p_freshonoff = p->value();
                   /*  
                    if (p->value() == "on") freshdAktiveConfig = true;
                    if (p->value() == "off") freshdAktiveConfig = false;
                    if(freshdAktiveConfig == true) {
                      fresh_aktiv = " class='Stil1a' ";
                      fresh_werteaktual = "<span class='Stil5'>Freshbox aktiviert</div>";
                    }
                    if(freshdAktiveConfig == false) {
                      fresh_aktiv = " class='Stil1b' ";
                      fresh_werteaktual = "Freshbox deaktiviert";
                    }
                    */
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Freshbox " + p->value() + " Saved";

                   p_sett15t = 0; // hier 0 machen, weil off nicht bei setting15 gesendet wird.    
               
               // }

              //-----------------------------------------------


                }
            else if(p->name() == "setting15"){
                      //#ifdef WEB_DEBUG
                        //Serial.println("setting setting15 ändern... ");
                      //#endif
                    p_settxx = p->value(); 
                    p_sett15t = p_settxx.toInt();        // s_div_c15    div_c15     
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
             //-----------------------------------------------         



            
            }
            else if(p->name() == "inputfreshid"){
               // if(p_inputfreshid == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputfreshid = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
                    //Serial.println("p->name() " + p_inputfreshid); 
                    //splitAdress = p_inputfreshid;
                    //WritefreshValue();
                 
                
                //}
            //-----------------------------------------------
                       
         


            }
            else if(p->name() == "inputfreshpwd"){
               // if(p_inputfreshpwd == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputfreshpwd = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
                    //Serial.println("p->name() " + p_inputfreshpwd); 
                    //splitAdress = p_inputfreshpwd;
                    //WritefreshValue();
            
                    
                //}
            //-----------------------------------------------


           
            }
            else if(p->name() == "inputfreship"){
               // if(p_inputfreship == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputfreship = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
                    //Serial.println("p->name() " + p_inputfreship); 
                    //splitAdress = p_inputfreship;
                    //WritefreshValue();
                 
                    
                //}

            //-----------------------------------------------

                }
            else if(p->name() == "inputstufe5"){
                //if(p_inputstufe5 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputStufe5 = p->value();  
                    //Serial.println("p_inputStufe5 " + p_inputStufe5);                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
             
                    //WritefreshValue();
                //}
            //-----------------------------------------------
           
                }
            else if(p->name() == "inputstufe4"){
                //if(p_inputstufe4 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputStufe4 = p->value();  
                    //Serial.println("p_inputStufe4 " + p_inputStufe4);                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
              
                    //WritefreshValue();
                //}
            //-----------------------------------------------
           
                }
            else if(p->name() == "inputstufe3"){
                //if(p_inputstufe3 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputStufe3 = p->value();  
                    //Serial.println("p_inputStufe3 " + p_inputStufe3);                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
             
                    //WritefreshValue();
                //}
            //-----------------------------------------------
           
                }
            else if(p->name() == "inputstufe2"){
                //if(p_inputstufe2 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputStufe2 = p->value();  
                    //Serial.println("p_inputStufe2 " + p_inputStufe2);                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
              
                    //WritefreshValue();
                //}
            //-----------------------------------------------
           
                }
            else if(p->name() == "inputstufe1"){
                //if(p_inputstufe1 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputStufe1 = p->value();  
                    //Serial.println("p_inputStufe1 " + p_inputStufe1);                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
           
                    //WritefreshValue();
                //}
            //-----------------------------------------------
           
                }
            else if(p->name() == "inputfunktion"){
                //if(p_inputfunktion == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{   

                    p_inputfunktion = p->value();
                    //Serial.println("p->name() w: " + p_inputfunktion); 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Freshbox " + p->value() + " Saved";
                         

                    //WritefreshValue();
                //}
            //-----------------------------------------------
           
            //-----------------------------------------------
                }
            else if(p->name() == "inputstufe6"){
                //if(p_inputstufe6 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputStufe6 = p->value();  
                    //Serial.println("p_inputStufe6 " + p_inputStufe6);                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Saved";
            
                    WritefreshValue();
                //}


           
            }
            else if(p->name() == "inputtcpport"){
               // if(p_inputtcpport == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputtcpport = p->value();
                    p_inputsavebit = "savebit_green";
                    //p_inputsavebit_txt = "TCP Port Saved";
                    p_inputsavebit_txt = "Reboot in 10 sec.";
                    
                   // WriteSensorValue();
                    select_reboot = 2;
               // }
            //-----------------------------------------------
            }
            else if(p->name() == "inputwebport"){
               // if(p_inputwebport == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputwebport = p->value();
                    p_inputsavebit = "savebit_green";
                    //p_inputsavebit_txt = "Webport Saved";
                    p_inputsavebit_txt = "Reboot in 10 sec.";
                    select_reboot = 2;
                
                    WriteWebValue();
               // }
            //-----------------------------------------------
            }
            else if(p->name() == "inputbaudrate"){
               // if(p_inputbaudrate == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{   
                    if(p_inputpasswort == p_inputpasswort_admin){  
                      p_inputbaudrate = p->value();
                      p_inputsavebit = "savebit_green";
                      p_inputsavebit_txt = "RS485 Saved";
                  
                     // WriteSensorValue();
                    }else{
                      web_write_green_red = 2;  
                      p_inputsavebit = "savebit_red";
                      p_inputsavebit_txt = "No Admin";
                    }

               // }


            //-----------------------------------------------
            }
            else if(p->name() == "inputdatabits"){
                //if(p_inputdatabits == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{  
                  if(p_inputpasswort == p_inputpasswort_admin){    
                      p_inputdatabits = p->value();
                      p_inputsavebit = "savebit_green";
                      p_inputsavebit_txt = "RS485 Saved";
               
                     // WriteSensorValue();
                  }else{
                      web_write_green_red = 2;  
                      p_inputsavebit = "savebit_red";
                      p_inputsavebit_txt = "No Admin";
                  }
                //}
            //-----------------------------------------------
            }
            else if(p->name() == "inputparity"){
                //if(p_inputparity == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                  if(p_inputpasswort == p_inputpasswort_admin){    
                      p_inputparity = p->value();
                      p_inputsavebit = "savebit_green";
                      p_inputsavebit_txt = "RS485 Saved";
                
                     // WriteSensorValue();
                  }else{
                      web_write_green_red = 2;  
                      p_inputsavebit = "savebit_red";
                      p_inputsavebit_txt = "No Admin";
                  }
               //}
            //-----------------------------------------------
            }
            else if(p->name() == "inputstopbit"){
                //if(p_inputstopbit == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{  
                  if(p_inputpasswort == p_inputpasswort_admin){    
                      p_inputstopbit = p->value();
                      p_inputsavebit = "savebit_green";
                      p_inputsavebit_txt = "RS485 Saved";
               
                      //WriteSensorValue();
                  }else{
                      web_write_green_red = 2;  
                      p_inputsavebit = "savebit_red";
                      p_inputsavebit_txt = "No Admin";
                  }
                //}
            //-----------------------------------------------
            }
            else if(p->name() == "inputrestimeout"){
               // if(p_inputrestimeout == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   //p_inputsavebit_txt = "";
                //}else{    
                    p_inputrestimeout = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "RS485 Saved";
        
                    WriteSensorValue();
                //}
        
        
            }
            else if(p->name() == "inputpwchange"){
                if(p_inputpwchange == p->value()){ 
                    //wert gleich
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                }else{    
                    p_inputpwchange = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "New PW saved, wait, sensor restarts";
                 
                    WritePW();
                }
        
        
            //-----------------------------------------------
               }
            if(p->name() == "inputip01"){
               // if(p_inputip01 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputip01 = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                    mesh_01_val = " class='Stil1' ";
                    if (p_inputip01 != "000.000.000.000"){
                     mesh_werteaktual = "<span class='Stil5'>Mesh aktiviert</div>"; 
                     mesh_aktiv = " class='Stil1a' ";
                    }else{
                     mesh_werteaktual = "Mesh deaktiviert";  
                     mesh_aktiv = " class='Stil1b' ";  
                    }
                    
                    ip_write_sel = 1;
                  //  Writeip15Value();
              

               // } 
            //-----------------------------------------------
               }
            if(p->name() == "inputip02"){
               // if(p_inputip02 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputip02 = p->value();
                    mesh_02_val = " class='Stil1' ";
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                    ip_write_sel = 2;
                    //Writeip15Value();
               

                //} 
            //-----------------------------------------------
               }
            if(p->name() == "inputip03"){
                //if(p_inputip03 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_inputip03 = p->value();
                    mesh_03_val = " class='Stil1' ";
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                    ip_write_sel = 3;
                    //Writeip15Value();
          

                //} 
            //-----------------------------------------------
               }
            if(p->name() == "inputip04"){
               // if(p_inputip04 == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputip04 = p->value();
                    mesh_04_val = " class='Stil1' ";
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                    ip_write_sel = 4;
                    //Writeip15Value();
              

                //} 
            //-----------------------------------------------
               }
            if(p->name() == "inputip05"){
               // if(p_inputip05 == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_inputip05 = p->value();
                    mesh_05_val = " class='Stil1' ";
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                    ip_write_sel = 5;
                   // Writeip15Value();
           

               // }                 
            //-----------------------------------------------
                }
            if(p->name() == "room01"){
               // if(p_room01 == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_room01 = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                    //Writeip15Value();
          

               // }                 
            //-----------------------------------------------
                }
            if(p->name() == "room02"){
               // if(p_room02 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_room02 = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                   // Writeip15Value();
             

               // }                 
            //-----------------------------------------------                     
                 }
            if(p->name() == "room03"){
               // if(p_room03 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_room03 = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                   // Writeip15Value();
           

                //}                 
            //-----------------------------------------------          
                }
            if(p->name() == "room04"){
               // if(p_room04 == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_room04 = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                    //Writeip15Value();
             

               // }                 
            //-----------------------------------------------  
                }
            if(p->name() == "room05"){
               // if(p_room05 == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_room05 = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Mesh Saved";
                    Writeip15Value();
            

                //}                 
            //-----------------------------------------------           
           
                }
            else if(p->name() == "inputcloudserver"){
               // if(p_inputcloudserver == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputcloudserver = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
              
                   // WriteCloudValue();
                //}
            //-----------------------------------------------
                }
            else if(p->name() == "inputclouddevice"){
              //  if(p_inputclouddevice == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputclouddevice = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
            
                   // WriteCloudValue();
                //} 
            //-----------------------------------------------
                }
            else if(p->name() == "inputclouduser"){
               // if(p_inputclouduser == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
               // }else{    
                    p_inputclouduser = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
          
                   // WriteCloudValue();
               // } 

            //-----------------------------------------------
                }
            else if(p->name() == "inputcloudpage"){
               // if(p_inputcloudpage == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_inputcloudpage = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
           
                   // WriteCloudValue();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "inputcloudpre"){
               // if(p_inputcloudpre == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_inputcloudpre = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
           
                   // WriteCloudValue();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "inputcloudchain"){
               // if(p_inputcloudchain == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_inputcloudchain = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
           
                   // WriteCloudValue();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "inputcloudport"){
               // if(p_inputcloudport == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_inputcloudport = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
           
                   // WriteCloudValue();
               // }
            //-----------------------------------------------

              }
            else if(p->name() == "inputcloudonoff"){
               // if(p_cloudonoff == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_cloudonoff = p->value();

                    
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud " + p->value() + " Saved";
          
                    p_sett18t = 0; // hier 0 machen, weil off nicht bei setting18 gesendet wird.    
                    p_sett18 = p_sett18t; 
                    p_sett18_s = p_sett18_0;


                    //WriteCloudValue();
               // }
            //-----------------------------------------------
                }
             else if(p->name() == "setting18"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting setting18 ändern... ");
                      #endif
                    p_settxx = p->value(); 
                    p_sett18t = p_settxx.toInt(); 
                    p_sett18_s = p_sett17_1;      
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
             //-----------------------------------------------         

             
                }
                
            else if(p->name() == "inputcloudkey"){
                //if(p_inputcloudkey == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputcloudkey = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
          
                    p_sett22t = 0;  // Auf 0 weil Slider keine 0 sendet, ur eine 1 wenn eingeschaltet.
                    //WriteCloudValue();
                    //b_WriteCloudValue = true;
               //}
           //-----------------------------------------------

                }
                
            else if(p->name() == "inputcloudinter"){
                //if(p_inputcloudinter == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputcloudinter = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
          
                    p_sett22t = 0;  // Auf 0 weil Slider keine 0 sendet, ur eine 1 wenn eingeschaltet.
                    //WriteCloudValue();
                    b_WriteCloudValue = true;
               //}
           //-----------------------------------------------

                }
            else if(p->name() == "setting22"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting Cloud ändern... ");
                      #endif
                    p_settxx = p->value(); 
                    p_sett22t = p_settxx.toInt();         
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Cloud Saved";
                 
                    //bit_set_led = true;   //  WriteLedValue();

            //-----------------------------------------------

 



       //-----------------------------------------------
              }
            else if(p->name() == "inputao1onoff"){
   
                      #ifdef WEB_DEBUG
                        Serial.println("inputao1onoff ändern... ");
                      #endif

                    p_ao1onoff = p->value();

                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "AO1 " + p->value() + " Saved";
                    p_sett29t = 0; //weil keine 0 kommt
                    p_sett29 = p_sett29t; 
                    p_sett29_s = p_sett29_0;
                    //Writeao1Value();


                     
            
            //-----------------------------------------------


                }
            else if(p->name() == "setting29"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting setting29 ändern... ");
                      #endif
                    p_settxx = p->value(); 
                    p_sett29t = p_settxx.toInt();  
                    p_sett29 = p_sett29t;   
                    p_sett29_s = p_sett29_1;   
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
             //-----------------------------------------------         



                }
            else if(p->name() == "inputao1og"){
  
                    p_inputao1og = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "AO1 Saved";
             
                   // Writeao1Value();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "inputao1ug"){
   
                    p_inputao1ug = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "AO1 Saved";
                
                    //Writeao1Value();
                //}
            //-----------------------------------------------
                }
            else if(p->name() == "inputao1option"){
  
                    p_inputao1option = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "AO1 Saved";
           
                    
                    //Writeao1Value();
         
            //-----------------------------------------------
                }
            else if(p->name() == "inputao1korrektur"){
  
                    p_inputao1korrektur = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "AO1 Saved";
           
                    
                    //Writeao1Value();

         
            //-----------------------------------------------
                }
            else if(p->name() == "inputao1korrektur2"){
  
                    p_inputao1korrektur2 = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "AO1 Saved";
           
                    
                    Writeao1Value();
                    b_Writeao1Value = true;  // hier das bit für schreiben aktivieren bevor der Slider ausgewertet wird. (war bei LED, hier wird glaube ich nicht benötigt.)
         
            //-----------------------------------------------
                }
            else if(p->name() == "s_ao1namur"){
  
                    p_inputao1namur = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "AO1 Saved";
           
                    
                    //Writeao1Value();
                    //b_Writeao1Value = true;  // hier das bit für schreiben aktivieren bevor der Slider ausgewertet wird. (war bei LED, hier wird glaube ich nicht benötigt.)
         




            //-----------------------------------------------
              }
            else if(p->name() == "inputledonoff"){
   
                      #ifdef WEB_DEBUG
                        Serial.println("inputledonoff ändern... ");
                      #endif

                    p_ledonoff = p->value();

                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "LED " + p->value() + " Saved";
                    p_sett17t = 0; //weil keine 0 kommt
                    p_sett17 = p_sett17t; 
                    p_sett17_s = p_sett17_0;
                    //WriteLedValue();
                    msLed = millis() - 9 * 1000L;

                     
            
            //-----------------------------------------------


                }
            else if(p->name() == "setting17"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting setting17 ändern... ");
                      #endif
                    p_settxx = p->value(); 
                    p_sett17t = p_settxx.toInt();  
                    p_sett17 = p_sett17t;   
                    p_sett17_s = p_sett17_1;   
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
             //-----------------------------------------------         



                }
            else if(p->name() == "inputledred"){
                //if(p_inputledred == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputledred = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "LED Saved";
             
                   // WriteLedValue();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "inputledorange"){
                //if(p_inputledorange == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputledorange = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "LED Saved";
                
                    //WriteLedValue();
                //}
            //-----------------------------------------------
                }
            else if(p->name() == "inputledgreen"){
               // if(p_inputledgreen == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputledgreen = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "LED Saved";
           
                    
                   // WriteLedValue();
               // }
         
            //-- LED ---

            //-----------------------------------------------
                }
            else if(p->name() == "inputledfunk"){
               // if(p_inputledfunk == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputledfunk = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "LED Saved";
               
                    //WriteLedValue();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "inputledgamma"){
                //if(p_inputledgamma == p->value()){ 
                    //wert gleich
                     // #ifdef WEB_DEBUG
                        //Serial.println("inputledgamma gleich ");
                     // #endif
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{  
                      #ifdef WEB_DEBUG
                        Serial.println("inputledgamma ändern... ");
                      #endif
                    p_inputledgamma = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "LED Saved";
                    
       

                    WriteLedValue();
                    p_sett21t = 0;  // Auf 0 weil Slider keine 0 sendet, ur eine 1 wenn eingeschaltet.
                    b_WriteLedValue = true;  // hier das bit für schreiben aktivieren bevor der Slider ausgewertet wird.
                    msLed = millis() - 9 * 1000L;
                //}
           //-----------------------------------------------
                }
            else if(p->name() == "setting21"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting LED ändern... ");
                      #endif
                    
                    p_settxx = p->value(); 
                    p_sett21t = p_settxx.toInt();         
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "LED Saved";
          
                    

                    //bit_set_led = true;   //  WriteLedValue();

            //-----------------------------------------------
         
 

               //     


           //-----------------------------------------------
                }
            else if(p->name() == "setting01"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett01t = 0;
                    p_settxx = p->value(); 
                    p_sett01t = p_settxx.toInt();        // s_div_c01    div_c01     
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
             
                    bit_settx = true;
                    
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting02"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett02t = 0;
                    p_settxx = p->value(); 
                    p_sett02t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
            
                    bit_settx = true;
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting03"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett03t = 0;
                    p_settxx = p->value(); 
                    p_sett03t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
                
                    bit_settx = true;                  
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting04"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett04t = 0;
                    p_settxx = p->value(); 
                    p_sett04t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
              
                    bit_settx = true;
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting05"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett05t = 0;
                    p_settxx = p->value(); 
                    p_sett05t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
               
                    bit_settx = true;
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting06"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett06t = 0;
                    p_settxx = p->value(); 
                    p_sett06t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
               
                    bit_settx = true;
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting07"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett07t = 0;
                    p_settxx = p->value(); 
                    p_sett07t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
           
                    bit_settx = true;
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting08"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett08t = 0;
                    p_settxx = p->value(); 
                    p_sett08t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
        
                    bit_settx = true;
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting09"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett09t = 0;
                    p_settxx = p->value(); 
                    p_sett09t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
       
                    bit_settx = true;
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting10"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett10t = 0;
                    p_settxx = p->value(); 
                    p_sett10t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
         
                    bit_settx = true;
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting11"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett11t = 0;
                    p_settxx = p->value(); 
                    p_sett11t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
             
                    bit_settx = true;
                    //WriteSettingValue();
                  
            //-----------------------------------------------
                }
            else if(p->name() == "setting13"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting ändern... ");
                      #endif
                    p_sett13t = 0;
                    p_settxx = p->value(); 
                    p_sett13t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
           
                    bit_settx = true;
                    //WriteSettingValue();
            //-----------------------------------------------
                }
            else if(p->name() == "setting14"){
                      #ifdef WEB_DEBUG
                        Serial.println("Freshbox ändern... ");
                      #endif
                    p_sett14t = 0;
                    p_settxx = p->value(); 
                    p_sett14t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
           
                    bit_settx = true;
                    //WriteSettingValue();
            //-----------------------------------------------
                }
            else if(p->name() == "setting19"){
                      #ifdef WEB_DEBUG
                        Serial.println("AO1 ändern... ");
                      #endif
                    p_sett19t = 0;
                    p_settxx = p->value(); 
                    p_sett19t = p_settxx.toInt();                 
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
           
                    bit_settx = true;
                    //WriteSettingValue();  
  
                         
      
           //-----------------------------------------------
           #ifdef vent_option
              }
            else if(p->name() == "inputvanonoff"){
  
                      #ifdef WEB_DEBUG
                        Serial.println("inputfanonoff ändern... ");
                      #endif

                    p_vanonoff = p->value();
                    if (p->value() == "on") vanAktiveConfig = true;
                    if (p->value() == "off") vanAktiveConfig = false;
                    if(vanAktiveConfig == true){
                       van_aktiv = " class='Stil1a' ";
                       van_werteaktual = "<span class='Stil5'>FAN aktiviert</div>";

                    }
                    if(vanAktiveConfig == false){
                       van_aktiv = " class='Stil1b' ";
                       van_werteaktual = "FAN deaktiviert";
                    }
                    
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "FAN " + p->value() + " Saved";
     
                    //WriteLedValue();
                    msLed = millis() - 9 * 1000L;

            //-----------------------------------------------
                }
            else if(p->name() == "inputvanmax"){
  
                    p_inputvanmax = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "FAN Saved";
         
                   // WriteLedValue();

            //-----------------------------------------------
                }
            else if(p->name() == "inputvanmin"){
  
                    p_inputvanmin = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "FAN Saved";
         
                    //WritevanValue();
                    bit_set_fan = true;
                    p_sett20t = 0;  // Auf 0 weil Slider keine 0 sendet, ur eine 1 wenn eingeschaltet.
                    b_WritevanValue = true; // hier bit setzten für schreiben aktiv weil slider eventuell nicht angesprungen wird.


           
              //-- FAN ---
              //-----------------------------------------------
                }
              else if(p->name() == "setting20"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting FAN ändern... ");
                      #endif
                    p_settxx = p->value(); 
                    p_sett20t = p_settxx.toInt();         
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "FAN Saved";
             
                    //WritevanValue();
                    bit_set_fan = true;   // changeFanValue();
             #endif
            //-----------------------------------------------
              }
            else if(p->name() == "inputpushoff"){
                //if(p_pushonoff == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_pushonoff = p->value();
                    if (p->value() == "on") pushAktiveConfig = true;
                    if (p->value() == "off") pushAktiveConfig = false;
                    if(pushAktiveConfig == true){
                       push_aktiv = " class='Stil1a' ";
                       push_werteaktual = "<span class='Stil5'>Push aktiviert</div>";

                    }
                    if(pushAktiveConfig == false){
                       push_aktiv = " class='Stil1b' ";
                       push_werteaktual = "Push deaktiviert";
                    }
                    
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "LED " + p->value() + " Saved";
        
                    //WritePushValue();

               // }
            //-----------------------------------------------
                }
            else if(p->name() == "pushkey"){
               // if(p_pushkey == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_pushkey = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
           
                    //WritePushValue();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "pushmessage"){
                if(p_pushmessage == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                }else{    
                    p_pushmessage = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
         
                    //WritePushValue();
                }
            //-----------------------------------------------
                }
            else if(p->name() == "pushtitle"){
               // if(p_pushtitle == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_pushtitle = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
        
                    //WritePushValue();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "pushsound"){
               // if(p_pushsound == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_pushsound = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
             
                    //WritePushValue();
               // }
            //-----------------------------------------------
                }
            else if(p->name() == "pushvibration"){
               // if(p_pushvibration == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_pushvibration = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
  
                    //WritePushValue();
               // } 
            //-----------------------------------------------
                }
            else if(p->name() == "pushicon"){
               // if(p_pushicon == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_pushicon = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
    
                    //WritePushValue();
                //}  
            //-----------------------------------------------
                }
            else if(p->name() == "pushiconcolor"){
               // if(p_pushiconcolor == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_pushiconcolor = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
          
                    //WritePushValue();
                //}  
            //-----------------------------------------------
                }
            else if(p->name() == "pushpriority"){
                //if(p_pushpriority == p->value()){ 
                    //wert gleich
                  //  p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
               // }else{    
                    p_pushpriority = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
 
                    //WritePushValue();
                //}  
            //-----------------------------------------------
                }
            else if(p->name() == "pushdevice"){
               // if(p_pushdevice == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_pushdevice = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
 
                    //WritePushValue();
                //}  
            //-----------------------------------------------
                }
            else if(p->name() == "pushvalue"){
               // if(p_pushvalue == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
 
                //}else{    
                    p_pushvalue = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Push Saved";
 
                    WritePushValue();
               //}  



            //-----------------------------------------------
              }
            else if(p->name() == "inputmqonoff"){
                //if(p_mqonoff == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_mqonoff = p->value();

                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT " + p->value() + " Saved";
    
                    p_sett16t = 0;   //hier 0 weit schalter keine 0 überträgt
                    p_sett16_s = p_sett16_0;
               // }
            //-----------------------------------------------
          
          

                }
             else if(p->name() == "setting16"){
                      #ifdef WEB_DEBUG
                        Serial.println("setting setting16 ändern... ");
                      #endif
                    p_settxx = p->value(); 
                    p_sett16t = p_settxx.toInt(); 
                    p_sett16_s = p_sett16_1;      
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "please reload Page";
             //-----------------------------------------------         


          
          
              }
            else if(p->name() == "inputmqclient"){
                //if(p_inputmqclient == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqclient = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";
    
                    //WriteMqttValue();

               // }
            //-----------------------------------------------
                }
            else if(p->name() == "inputmqoptions"){
              //  if(p_inputmqoptions == p->value()){     
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqoptionst = p_inputmqoptions; //temp für auzwwahl bei inputmqmesh
                    p_inputmqoptions = p->value();           //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]         
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";
        
                    //WriteMqttValue();
              // }
            //-----------------------------------------------

                }
            else if(p->name() == "inputmqserver"){
              //  if(p_inputmqserver == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqserver = p->value();                  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";
          
                    //WriteMqttValue();
              // }
            //-----------------------------------------------
              }
            else if(p->name() == "inputmqmesh"){
               // if(p_inputmqmesh == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqmesh = p->value();
                    //Serial.println("--> wp->name(): " + p->name());
                    //Serial.println("--> wp->value(): " + p->value());
                    //Serial.println(p_inputmqmesh);
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";
     
                    if (p_inputmqoptionst == "1"){   //hier schon speichern weil die anderen nicht angezeigt werden
                      WriteMqttValue();
                    }
                //}
            //-----------------------------------------------
              }
            else if(p->name() == "inputmqport"){
               // if(p_inputmqport == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqport = p->value();
                    //Serial.println("--> wp->name(): " + p->name());
                    //Serial.println("--> wp->value(): " + p->value());
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";
     
                    //WriteMqttValue();
                //}
            //-----------------------------------------------
                }
            else if(p->name() == "inputmquser"){
                //if(p_inputmquser == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputmquser = p->value();                    
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";
    
                   // WriteMqttValue();
                //}
            //-----------------------------------------------
                  }
            else if(p->name() == "inputmqpass"){
               // if(p_inputmqpass == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqpass = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";
   
                   // WriteMqttValue();
                //}
            //-----------------------------------------------
                    }
            else if(p->name() == "inputmqtopic"){
               // if(p_inputmqtopic == p->value()){ 
                    //wert gleich
                   // p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqtopic = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";

                    //WriteMqttValue();
               // }
            //-----------------------------------------------
                    }
            else if(p->name() == "inputmqtopic1"){
               // if(p_inputmqtopic1 == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                   // p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqtopic1 = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";

                    //WriteMqttValue();
               // }
            //-----------------------------------------------
                    }
            else if(p->name() == "inputmqtopic2"){
               // if(p_inputmqtopic2 == p->value()){ 
                    //wert gleich
                    //p_inputsavebit = "savebit";
                    //p_inputsavebit_txt = "";
                //}else{    
                    p_inputmqtopic2 = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "MQTT Saved";
    
                    WriteMqttValue();
                //}
            //-----------------------------------------------
                    }
            else if(p->name() == "loginoutt"){
  
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Logout";
                    Web_logout_time = 0;
                    web_write_ok = 0 ; 
                    bit_setdiv = true;


            //-----------------------------------------------
            }
            else if(p->name() == "getapmodus"){
                if(p_getapmodus == p->value()){ 
                    //wert gleich
                    // Wenn Scan erfogreich, dann p_getapmodus=""
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                }else{    
                    p_getapmodus = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "AP WIFI Modus aktiviert";

                    select_apmodus = 1;

                }





            }
            else if(p->name() == "getreboot"){
                if(p_getreboot == p->value()){ 
                    //wert gleich
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                    select_reboot = 0;
                }else{    
                    // hier noch speer wenn neu Bootet und Variable leer ist und vom Browser erneut versehentlich gesendet wurde
              #ifdef WEB_DEBUG
              Serial.println("getreboot: " + p_getreboot);
              #endif
                    //-*********************************  
                    Preferences preferences;
                    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                    p_timeon = 0;
                    preferences.putInt("p_timeon", p_timeon);                         //Variable speichern
                    //-*********************************  

                    p_getreboot = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Reboot in 10 sec.";
                    select_reboot = 2;
                }
            //-----------------------------------------------
            }
            else if(p->name() == "getsearch"){
                if(p_getsearch == p->value()){ 
                    //wert gleich
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                    select_reboot = 0;
                }else{    

                    p_getsearch = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Search start...";
                    ms6 = millis();
                    gLedSearchFlag = true;
                    strip1.setPixelColor(0, strip1.Color(255, 255, 255)); //weiss
                    strip1.setPixelColor(1, strip1.Color(255, 255, 255)); //weiss
                    strip1.setPixelColor(2, strip1.Color(255, 255, 255)); //weiss
                    strip1.setPixelColor(3, strip1.Color(255, 255, 255)); //weiss
                    strip1.show(); 

                } 
            //-----------------------------------------------
            }
            else if(p->name() == "getdelete"){
                if(p_getdelete == p->value()){ 
                    //wert gleich
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                    select_reboot = 0;
                    //Turn off LEDs 
                    strip1.setPixelColor(0, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(1, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(2, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(3, strip1.Color(0, 0, 0)); //0
                    strip1.show(); 
                   

                }else{    

                    p_getdelete = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Graph delete...";
                   
                    ms6 = millis();
                    gLedDeleteFlag = true;
                    gGraphDeleteFlag = true;
                    #ifdef NVS_DEBUG
                    Serial.println("---- Bit  GRAPH delete = " + String(gGraphDeleteFlag));
                    #endif
                    strip1.setPixelColor(0, strip1.Color(153, 51, 255)); //lila
                    strip1.setPixelColor(1, strip1.Color(153, 51, 255)); //lila
                    strip1.setPixelColor(2, strip1.Color(153, 51, 255)); //lila
                    strip1.setPixelColor(3, strip1.Color(153, 51, 255)); //lila
                    strip1.show(); 

                } 
              //-----------------------------------------------

           //-----------------------------------------------
            }
            else if(p->name() == "getdeleteup"){
                if(p_getdeleteup == p->value()){ 
                    //wert gleich
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                    //select_reboot = 0;
                    //Turn off LEDs 
                    //strip1.setPixelColor(0, strip1.Color(0, 0, 0)); //0
                    //strip1.setPixelColor(1, strip1.Color(0, 0, 0)); //0
                    //strip1.setPixelColor(2, strip1.Color(0, 0, 0)); //0
                    //strip1.setPixelColor(3, strip1.Color(0, 0, 0)); //0
                    //strip1.show(); 
                    epochTime_start = epochTime;  // timeClient.getEpochTime();   getTime();
                    p_uptime = "0 [min]"; 
                    p_uptime2 = "[min]"; 

                }else{    

                    p_getdeleteup = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Uptime reset...";
                    epochTime_start = epochTime;  // timeClient.getEpochTime();   getTime();
                    p_uptime = "0 [min]"; 
                    p_uptime2 = "[min]"; 
                    WriteTimeValue();
                    //ms6 = millis();
                    //gLedDeleteFlag = true;
                    //gGraphDeleteFlag = true;
                    #ifdef NVS_DEBUG
                    Serial.println("---- Bit  Uptime Reset = " + String(p_getdeleteup));
                    #endif
                    //strip1.setPixelColor(0, strip1.Color(153, 51, 255)); //lila
                    //strip1.setPixelColor(1, strip1.Color(153, 51, 255)); //lila
                    //strip1.setPixelColor(2, strip1.Color(153, 51, 255)); //lila
                    //strip1.setPixelColor(3, strip1.Color(153, 51, 255)); //lila
                    //strip1.show(); 

                } 
              //-----------------------------------------------

            //-----------------------------------------------
            }
            else if(p->name() == "getfreshlearn"){
                if(p_getfreshlearn == p->value()){  //wenn schon aktiviert wurde
                    Serial.println("p->name() = " + String(p->name()));
                    //wert gleich
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                    p_inputsavebit_txt = "Freshbox ID Serach Stop";
                    State_anf_schreib_ID_bit = false;
                    p_getfreshlearn = ""; // freigeben für neuen Start


                    fresh_werteaktual = "<span class='Stil5'>Freshbox ID Change abgebrochen</div>";


                    //Turn off LEDs 
                    strip1.setPixelColor(0, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(1, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(2, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(3, strip1.Color(0, 0, 0)); //0
                    strip1.show(); 


                }else{ 
                    #ifdef Freshebug   
                    Serial.println("---p->name() = " + String(p->name()));
                    #endif
                    p_getfreshlearn = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Freshbox ID reset...";
                    State_anf_schreib_ID_bit = true;


                    fresh_werteaktual = "<span class='Stil6'>Freshbox ID Change aktiv</div>";


                    #ifdef Freshebug
                    Serial.println("---- Freshbox ID reset = " + String(p_getfreshlearn));
                    #endif
                    strip1.setPixelColor(0, strip1.Color(0, 94, 185)); //blau
                    strip1.setPixelColor(1, strip1.Color(0, 94, 185)); //blau
                    strip1.setPixelColor(2, strip1.Color(0, 94, 185)); //blau
                    strip1.setPixelColor(3, strip1.Color(0, 94, 185)); //blau
                    strip1.show(); 

                } 
              //-----------------------------------------------



           //-----------------------------------------------
            }
            else if(p->name() == "getwerksreset"){
                if(p_getwerksreset == p->value()){  //wenn schon aktiviert wurde
                    //Serial.println("p->name() = " + String(p->name()));
                    //wert gleich
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                    p_inputsavebit_txt = "Reset Stop";
                    State_anf_werksreset = false;
                    p_getwerksreset = ""; // freigeben für neuen Start


                   // fresh_werteaktual = "<span class='Stil5'>Werksreset abgebrochen</div>";


                    //Turn off LEDs 
                    strip1.setPixelColor(0, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(1, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(2, strip1.Color(0, 0, 0)); //0
                    strip1.setPixelColor(3, strip1.Color(0, 0, 0)); //0
                    strip1.show(); 


                }else{    
                    //Serial.println("---p->name() = " + String(p->name()));
                    p_getwerksreset = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Reset";
                    State_anf_werksreset = true;


                   // fresh_werteaktual = "<span class='Stil6'>Werksreset aktiv</div>";


                    #ifdef NVS_DEBUG
                    Serial.println("---- Werksreset = " + String(p_getwerksreset));
                    #endif
                    strip1.setPixelColor(0, strip1.Color(255, 0, 0)); //rot
                    strip1.setPixelColor(1, strip1.Color(255, 0, 0)); //rot
                    strip1.setPixelColor(2, strip1.Color(255, 0, 0)); //rot
                    strip1.setPixelColor(3, strip1.Color(255, 0, 0)); //rot
                    strip1.show(); 

                } 
              //-----------------------------------------------



       //-----------------------------------------------
            }
            else if(p->name() == "getwerksportal"){
                if(p_getwerksportal == p->value()){  //wenn schon aktiviert wurde
                    //Serial.println("p->name() = " + String(p->name()));
                    //wert gleich
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                    p_inputsavebit_txt = "Portal Stop";
                    //State_anf_werksreset = false;
                    p_getwerksportal = ""; // freigeben für neuen Start


                   // fresh_werteaktual = "<span class='Stil5'>Werksreset abgebrochen</div>";


                    //Turn off LEDs 
                    //strip1.setPixelColor(0, strip1.Color(0, 0, 0)); //0
                    //strip1.setPixelColor(1, strip1.Color(0, 0, 0)); //0
                    //strip1.setPixelColor(2, strip1.Color(0, 0, 0)); //0
                    //strip1.setPixelColor(3, strip1.Color(0, 0, 0)); //0
                    //strip1.show(); 


                }else{    
                    //Serial.println("---p->name() = " + String(p->name()));
                    p_getwerksportal = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "Portal";
                    State_anf_werksportal = true;


                   // fresh_werteaktual = "<span class='Stil6'>Werksreset aktiv</div>";


                    //#ifdef NVS_DEBUG
                    Serial.println("---- Portal = " + String(p_getwerksportal));
                    //#endif
                    //strip1.setPixelColor(0, strip1.Color(255, 0, 0)); //rot
                    //strip1.setPixelColor(1, strip1.Color(255, 0, 0)); //rot
                    //strip1.setPixelColor(2, strip1.Color(255, 0, 0)); //rot
                    //strip1.setPixelColor(3, strip1.Color(255, 0, 0)); //rot
                    //strip1.show(); 

                } 
              //-----------------------------------------------



            //-----------------------------------------------
            }
            else if(p->name() == "getscan"){
                if(p_getscan == p->value()){ 
                    //wert gleich
                    // Wenn Scan erfogreich, dann p_MB_scan_resault=""
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                }else{  
              #ifdef WEB_DEBUG
              Serial.println("getscan: " + p_getscan);
              #endif
                  if(p_inputpasswort == p_inputpasswort_admin){   
                    p_getscan = p->value();
                    p_inputsavebit = "savebit_green";
                    p_inputsavebit_txt = "SCAN RTU Slaves, wait 2 minutes and Reload Page";
  
                    select_slave_scan = 1;  //0= aus  1= scan start  2= ohne Scan 
                    start_slave_scan = 0;     //MESH 1= scan gestartet  0 = erneut starten
                    slave_scan_until = 50; 

                    #ifdef WEB_DEBUG
                    Serial.println("-->  " + p_time + " Get scan: " + String(slave_scan_until) +  " "); 
                    #endif

                  }else{
                      web_write_green_red = 2;  
                      p_inputsavebit = "savebit_red";
                      p_inputsavebit_txt = "No Admin";
                  }
                }
            //-----------------------------------------------
            }
            else if(p->name() == "getradonaktual"){
                if(p_getradonaktual == p->value()){ 
                    //wert gleich
                    // 
                    p_inputsavebit = "savebit";
                    p_inputsavebit_txt = "";
                }else{    
                #ifdef WEB_DEBUG
                Serial.println("Sensor abfrage gestartet ");
                #endif
                    p_getradonaktual = p->value();
                    mb_werteaktual = "Sensor abfrage gestartet";
                    #ifdef MBDebug
                    Serial.println("--> gestartet"); 
                    #endif 
                    val_sensor_aktual = 2;


                    mb_afrg_Radon = 1; // Abfrage start nach reload Page

                    p_inputsavebit_txt = "Sensor abfrage gestartet";
                    p_inputsavebit = "savebit_green";

                    // Read register

                }
                //-----------------------------------------------








            }  
            //---------------------------------------------------

          }else{
              if(p->name() != "inputchart"){
                  p_inputsavebit = "savebit_red";
                  p_inputsavebit_txt = "Please Login";
              }
          }  // if(web_write_ok == 1){ 
        } // if(p->name() != "inputpasswort"){




        if(p_inputpasswort == p_inputpasswort_admin){  
          Web_logout_time = 61;
        }else{
          Web_logout_time = 11;
        }

        //Serial.println("-->  [APP] min Free memory  : " + String(esp_get_minimum_free_heap_size()) + " bytes");


        if(web_write_ok == 1){ 
           p_logout_or_in= p_logout;
           divpw = divon2;  
           divsetting = divon2;
           b_logoff = true;

            if (f_alarm == 2) {
              divfanq_hid = divfan_hid1;
              divfan_hid = divfan_hid0;  
            }else{
              divfanq_hid = divfan_hid0;      // divfan_hid0= unsichtbar
              divfan_hid = divfan_hid1;  
            }
       
        }else{  
          // p_logout_or_in= p_login;
           p_logout_or_in= " style='display: none;>";
           divpw = divhidden2; 
           divsetting = divhidden2; 
           b_logoff = false;

            if (f_alarm == 2) {
              divfanq_hid = divfan_hid1;
              divfan_hid = divfan_hid0;  
            }else{
              divfanq_hid = divfan_hid0;      // divfan_hid0= unsichtbar
              divfan_hid = divfan_hid0;  
            }

        }  
        //-------------------------------------------------------
        #ifdef WEB_DEBUG
        Serial.println("wp->name()  : " + p->name());
        Serial.println("wp->value() : " + p->value());
        Serial.println("-------------------");
        #endif
    }


   //--------- hier sichern weil durch den Slider Radon/CO2 die Auswahl nicht möglich ist dort zu schreiben -------------------
      if(b_WriteLedValue == true){

        b_WriteLedValue = false;
        WriteLedValue();

      }
   //---------------------------

   //--------- hier sichern weil durch den Slider Radon/Mesh die Auswahl nicht möglich ist dort zu schreiben -------------------
      if(b_WriteCloudValue == true){

        b_WriteCloudValue = false;
        WriteCloudValue();

      }
   //---------------------------

 
   //--------- hier sichern weil durch den Slider Radon/CO2 die Auswahl nicht möglich ist dort zu schreiben ------------------- 
      #ifdef vent_option
        if(b_WritevanValue == true){

          b_WritevanValue = false;
          WritevanValue();

          if (p_sett20 == 1 ){
            p_sett20_s = p_sett20_1;
          }else{
            p_sett20_s = p_sett20_0; 
          }

        }

        if (bit_set_fan == true){
          bit_set_fan = false;
          changeFanValue();
          // Mesh nicht aktiv dann Buttonn zurückschreiben
          
           if (p_sett06 == 0 || p_inputip01 == "000.000.000.000" || b_fan_Notmesh == true){  //view Mesh ausgeschaltet  
         // if (b_fan_Notmesh == true){
            b_fan_Notmesh = false;
            p_sett20 = 1;  
            p_sett20t = 1;  
            p_sett20_s = p_sett20_1;
            WritevanValue(); 
          }
        }  
      #endif 
       //---------------------------


      //---------------------------
            updateDIVs(); 
            read_div_values();
            if (bit_settx == true){
              WriteSettingValue();
              changesetValue();
              bit_settx = false;
            }
            
            if (bit_setdiv == true){
              changesetValue();
              bit_setdiv = false;
            }
      //---------------------------


       //---------------------------------
        if (p_sett06 == 1 && p_inputip01 != "000.000.000.000"){  //view Mesh Eingeschaltet  
          tr_h_3 = divon2;  //  Mesh anzeigen
          tr_h_3a = tr_h_3;
        }else{
          tr_h_3 = divhidden2;  //  Mesh nicht anzeigen
          tr_h_3a = tr_h_3;
          divstatus3 = divgrau; //bei Status
        }

        if (mqttdAktiveConfig == true){  //view MQTT Eingeschaltet  
          tr_h_2 = divon2;  // divon2  MQTT anzeigen
          tr_h_2a = tr_h_2;
        }else{
           tr_h_2 = divhidden2;  //  MQTT nicht anzeigen
           tr_h_2a = tr_h_2;
        }


        if (cloudAktiveConfig == true){  //view Cloud Eingeschaltet  
           tr_h_1 = divon2;  //  Cloud anzeigen
           tr_h_1a = tr_h_1;
        }else{
           tr_h_1 = divhidden2;  //  Cloud nicht anzeigen
           tr_h_1a = tr_h_1;
        }

        if (vanAktiveConfig == true){  //view Lüfter Eingeschaltet  
           tr_h_4 = divon2;  //  Lüfter Alarm anzeigen
           tr_h_4a = tr_h_4;
        }else{
           tr_h_4 = divhidden2;  //  Lüfter Alarm nicht anzeigen
           tr_h_4a = tr_h_4;
        }

        if (pushAktiveConfig == true){  //view Push Eingeschaltet  
           tr_h_5 = divon2;  //  Push anzeigen
           tr_h_5a = tr_h_5;
        }else{
           tr_h_5 = divhidden2;  //  Push nicht anzeigen
           tr_h_5a = tr_h_5;
        }

       
        if (freshdAktiveConfig == true){  //view freshbox Eingeschaltet  
          tr_h_6 = divon2;  // divon2  fresh anzeigen
          tr_h_6a = tr_h_6;
        }else{
           tr_h_6 = divhidden2;  //  fresh nicht anzeigen
           tr_h_6a = tr_h_6;
        }

        if (b_logoff == true){  // login ok
          tr_h_7 = divon2;  // divon2   anzeigen
          tr_h_7a = tr_h_7;

          //  p_inputstaticip     "<a href='http://modbus.local/radon.xml' target='_blank'>XML</a>";
          p_xml_html = "<a href='http://";
          p_xml_html += p_inputstaticip;
          p_xml_html += "/radon.xml' target='_blank'>XML</a>";

          p_xml_html2 = "<a href='http://";
          p_xml_html2 += p_inputstaticip;
          p_xml_html2 += "/radon.html' target='_blank'>HTML</a>";

        }else{
           tr_h_7 = divhidden2;  //   nicht anzeigen
           tr_h_7a = tr_h_7;
        }
       
       //---------------------------------




        
        //Serial.println(request->url());
        #ifdef WEB_DEBUG_error
        Serial.print("Received request from client with IP: ");
        IPAddress remote_ip = request->client()->remoteIP();
        request_remoteIP_temp = remote_ip.toString(); 
        Serial.println(request_remoteIP_01);
        #endif
        

        if(p_inputpasswort == p_inputpasswort_admin){ 
          p_MB_scan_resaults = p_MB_scan_resaulta;
        }else{  
          p_MB_scan_resaults = p_MB_scan_resaulta;
        }



       //---------------------------------
        //if (chart_page >= 4 || chart_page == 2){
          //chart_page = 0; 
        //}
        if (chart_page >= 8 || chart_page == 2 || chart_page == 3 || chart_page == 4 || chart_page == 5 || chart_page == 6){
          chart_page = 0; 
        }

       //---------------------------------





        if (chart_page == 5){
            if (vanAktiveConfig == true){   //FAN aktiv
              if(p_sett20 == 1){   //dieser sensor
                if (sensor_mb_ok == 0){  //MB nicht gefunden

                  select_slave_scan = 1;  //0= aus  1= scan start  2= ohne Scan 
                  #ifdef WEB_DEBUG
                  Serial.println("-->  " + p_time + " select_slave_scan:" + String(select_slave_scan) +  " ."); 
                  #endif
                  
                }
              }
            }
        }  


    //---------------------------------
    //-- LED IP ende weil Abdresse gefunden wurde.
     if (ee_ip_search == 0){
      if(select_apmodus == 0){    //nicht beim Reset, weil dor dann später die var gespeichert wird
         ee_ip_search = 1;
         Preferences preferences;
         preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
         preferences.putUInt("ee_ipsearch", ee_ip_search);                  //Variable unter "Datei" ee_ipsearch speichern   
      }
    }
    //---------------------------------


        // request->send(SPIFFS, "/index.html", "text/html");
        #ifdef WEB_DEBUG
        Serial.println("-->  " + p_time + " Page:" + String(chart_page) +  " HTML laden d"); 
        #endif


  
          if(chart_page == 7){ 

              if(b_logoff == true){  // login
                //-------------------------------------------------------------------
               
                    //--------------------------------------------------------------------------------------------------
                    if(p_sett08 == 1 && p_sett07 == 0 && p_sett14 == 0){ // CLOUD ON   MQTT OFF  Freshbox OFF
                        
                        request->send_P(200, "text/html", index_html01, processor); //LOGIN + CLOUD ON   MQTT OFF  Freshbox OFF

                    }else{ 
                    
                       //------------------
                       if(p_sett08 == 0 && p_sett07 == 0 && p_sett14 == 1){ // CLOUD OFF   MQTT OFF  Freshbox ON

                          //Serial.print("index_html02: ");
                          request->send_P(200, "text/html", index_html02, processor); //LOGIN + CLOUD OFF   MQTT OFF  Freshbox ON
                      
                       }else{ 
                        
                          //------------------
                          if(p_sett08 == 0 && p_sett07 == 1 && p_sett14 == 0){ // CLOUD OFF   MQTT ON  Freshbox OFF
                              request->send_P(200, "text/html", index_html03, processor); //LOGIN + CLOUD OFF   MQTT ON  Freshbox OFF
                          }else{ 
                              request->send_P(200, "text/html", index_html, processor); //LOGIN + all
                          }
                          //------------------

                       }
                       //------------------

                    } 
                    //--------------------------------------------------------------------------------------------------
             
                //-------------------------------------------------------------------
              }else{
                request->send_P(200, "text/html", index_html0, processor);  // LOG OFF
              }          

            #ifdef WEB_DEBUG
            Serial.println("-->  " + p_time + " (200, text/html, index_html, processor)"); 
            #endif
          }

            if(chart_page == 1){ 
              request->send_P(200, "text/html", index_htmlb, processor);  
            }
            if(chart_page == 2){  
              request->send_P(200, "text/html", index_htmld, processor);   
            }
            if(chart_page == 6){  
              request->send_P(200, "text/html", index_htmle, processor);   
            }
       

          if(chart_page == 0){  
            if(gauge_page == true){  
              request->send(200, "text/html", SendHTMLc(val1, val2, val3, val4, val5, val6, val7, val8, val9, val10, bgcolor_vorgabe, esp32_uptime, p_uptime2, val3_color, p_uhrzeit)); 
            }else{
              if(freshdAktiveConfig == true){
                s_freshbox = "<tr><th scope='row'><div align='right'>Freshbox:</div></th><td><div align='center'><strong>";
                s_freshbox += String(val5);
                s_freshbox += "</strong></div></td><td><div align='left'> Stufe</div></td></tr>";
              }else{
                s_freshbox = "";
              }
              if(g_mb_mesh == false){ 
                request->send(200, "text/html", SendHTMLf(val1, val2, val3, val4, val5, val6, val7, val8, val9, val10, bgcolor_vorgabe, esp32_uptime, p_uptime2, val3_color, p_uhrzeit)); 
              }else{
                request->send(200, "text/html", SendHTMLfmesh(valm1, valm2, valm3, valm4, valm5, valm6, valm7, valm8, valm9, valm10, bgcolor_vorgabeg, bgcolor_vorgaber, esp32_uptime, p_uptime2, val3_color, p_uhrzeit,p_time_mesh_uplod_s,AI_VSS_mv_s)); 
             }
            }
          }


          #ifdef old_option
          if(chart_page == 4){  
            request->send(200, "text/html", SendHTMLe(r0_val1, r0_val2, r0_val3, r1_val1, r1_val2, r1_val3, r2_val1, r2_val2, r2_val3, r3_val1, r3_val2, r3_val3, r4_val1, r4_val2, r4_val3, r5_val1, r5_val2, r5_val3)); 
          }
          #endif
        
         #ifdef vent_option
          if(chart_page == 5){  
            request->send(200, "text/html", SendHTMLg(fval1, fval2, fval3, fval4, fval5, fval6, fval7, fval8, fval9, fval10, f_alarm_s, divfan7, vent_max_stufe, vent_min_stufe, f_Rsource)); 
          }
         #endif


    
        #ifdef WEB_DEBUG
        Serial.println("-->  " + p_time + " Page:" + String(chart_page) +  " HTML laden fertig"); 
        #endif



      //-----------------------------------
      // VARS ändern für die Anzeigen
        p_sett01t = 0;
        p_sett02t = 0;  //IP Setting
        p_sett03t = 0;
        p_sett04t = 0;
        p_sett05t = 0;
        p_sett06t = 0;
        p_sett07t = 0;
        p_sett08t = 0;
        p_sett09t = 0;
        p_sett10t = 0;
        p_sett11t = 0;
        p_sett13t = 0;
        p_sett14t = 0;

        p_sett17t = 0; //LED Setting im LED Menue, damit bei auf auch aus angezeigt wird wenn seite selber neu läd
        
        p_sett19t = 0;

        p_sett20t = 0;
        p_sett21t = 0;
        p_sett22t = 0;


     //-----   ------
      updateledviews();
      #ifdef vent_option
        updatefanviews();
      #endif
      updatemeshviews();
      updatecloudviews();
      updatehomeviews();

                

    //---------------------------------------------------------



    #ifdef WEB_DEBUG
    Serial.println("-->  " + p_time + " HTML Senden fertig"); 
    #endif
    //-- reeset
    //p_inputsavebit = "savebit";
    //p_inputsavebit_txt = "";
    
  });  //server.on("/get", HTTP_GET, [](AsyncWebServerRequest * request) {

  // Route to set GPIO to HIGH
  #ifdef old_option
  server.on("/on", HTTP_GET, [](AsyncWebServerRequest *request){
    //digitalWrite(ledPin, HIGH);  
    #ifdef WEB_DEBUG
    Serial.println("--> on route"); 
    #endif
    request->send(SPIFFS, "/index.html", String(), false, processor2);
  });
  #endif


  server.on("/post", HTTP_POST, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG
      Serial.println("--> Post route");
      #endif
    request->send(200, "text/plain", "Post route");
  });
    server.on("getapmodus", HTTP_POST, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG
      Serial.println("--> Post route");
      #endif
    request->send(200, "text/plain", "Post route");
  });
    server.on("getreboot", HTTP_POST, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG
      Serial.println("--> Post route");
      #endif
    request->send(200, "text/plain", "Post route");
  });
    server.on("getsearch", HTTP_POST, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG
      Serial.println("--> Post route");
      #endif
    request->send(200, "text/plain", "Post route");
  });
    server.on("getdelete", HTTP_POST, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG
      Serial.println("--> Post route");
      #endif
    request->send(200, "text/plain", "Post route");
  });
    server.on("getscan", HTTP_POST, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG
      Serial.println("--> Post route");
      #endif
    request->send(200, "text/plain", "Post route");
  });  
 
  server.on("/put", HTTP_PUT, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG
      Serial.println("--> Put route");
      #endif
    request->send(200, "text/plain", "Put route");
  });
 
  //server.on("/get", HTTP_GET, [](AsyncWebServerRequest *request){
     // Serial.println("--> Get route");
    //request->send(200, "text/plain", "Get route");
  //});
 
  server.on("/any", HTTP_ANY, [](AsyncWebServerRequest *request){
      #ifdef WEB_DEBUG
      Serial.println("--> Any route");
      #endif
    request->send(200, "text/plain", "Any route");
  });






   p_inputname.toCharArray(p_inputnamec, 10);  

  #ifndef OTA_on_NMDS_off

    //******************************************************************************
    //                               MDNS                                          *
    //******************************************************************************
      // Set up mDNS responder:
      // - first argument is the domain name, in this example
      //   the fully-qualified domain name is "esp32.local"
      // - second argument is the IP address to advertise
      //   we send our IP address on the WiFi network


    if (!MDNS.begin(p_inputnamec)) {
        Serial.println("Error setting up MDNS responder!");
        while(1) {
            delay(1000);
        }
    }
    #ifdef WEB_DEBUG
    //Serial.println("mDNS responder started!");
    // Serial.println("http://" + String(p_inputnamec) + ".local/index.html");
    //Serial.println("TCP server started");
    #endif

  #endif





  //******************************************************************************
  //                        Starte Async WebServer                               *
  //****************************************************************************** 
  #ifdef BLE_WIFI_disable
    //if(WiFi.status() != WL_CONNECTED) {
      #ifdef WEB_DEBUG
        Serial.println("--> Kein WLAN Async WebServer off");
      #endif
      Async_WebServer_start = 0;
    //}else{
      server.begin();
      #ifdef WEB_DEBUG
        Serial.println("--> WLAN on Async WebServer on");
      #endif

      Async_WebServer_start = 1 ;
    //}
  #endif








  
  //******************************************************************************
  //                               ArduinoOTA                                          *
  //******************************************************************************
  #ifdef OTA_on_NMDS_off 
   ArduinoOTA
    .onStart([]() {
      String type;
      if (ArduinoOTA.getCommand() == U_FLASH)
        type = "sketch";
      else // U_SPIFFS
        type = "filesystem";

      // NOTE: if updating SPIFFS this would be the place to unmount SPIFFS using SPIFFS.end()
      Serial.println("Start updating " + type);
    })
    .onEnd([]() {
      Serial.println("\nEnd");
    })
    .onProgress([](unsigned int progress, unsigned int total) {
      Serial.printf("Progress: %u%%\r", (progress / (total / 100)));
    })
    .onError([](ota_error_t error) {
      Serial.printf("Error[%u]: ", error);
      if (error == OTA_AUTH_ERROR) Serial.println("Auth Failed");
      else if (error == OTA_BEGIN_ERROR) Serial.println("Begin Failed");
      else if (error == OTA_CONNECT_ERROR) Serial.println("Connect Failed");
      else if (error == OTA_RECEIVE_ERROR) Serial.println("Receive Failed");
      else if (error == OTA_END_ERROR) Serial.println("End Failed");
    });


    ArduinoOTA.setHostname(p_inputnamec);
    //ArduinoOTA.setPassword("1235");
    ArduinoOTA.begin();

  #else
  //******************************************************************************
  //                               MDNS                                          *
  //******************************************************************************
    // Add service to MDNS-SD
    MDNS.addService("http", "tcp", 80);
  


  #endif
 //********************************************************************************





  //******************************************************************************
  //                             Starte Zeitserver                               *
  //****************************************************************************** 
   //-----------------------------------------
    /*
    setupDateTime();
    Serial.println(DateTime.now());
    Serial.println("--------------------");
    Serial.println(DateTime.toString());
    Serial.println(DateTime.toISOString());
    Serial.println(DateTime.toUTCString());
    Serial.println("--------------------");
    Serial.println(DateTime.format(DateFormatter::COMPAT));
    Serial.println(DateTime.format(DateFormatter::DATE_ONLY));
    Serial.println(DateTime.format(DateFormatter::TIME_ONLY));
    Serial.println("--------------------");
    DateTimeParts p = DateTime.getParts();
    Serial.printf("%04d/%02d/%02d %02d:%02d:%02d %ld (%s)\n", p.getYear(),
                  p.getMonth(), p.getMonthDay(), p.getHours(), p.getMinutes(),
                  p.getSeconds(), p.getTime(), p.getTimeZone());
    Serial.println("--------------------");
    showTime();
   */
  
    //Serial.println("1--> NTP_setup");
    NTP_setup();
    NTP_setup_clac();
    Timeupdate();


    #ifdef Unix_Zeit
      p_inputntp.toCharArray(p_inputntpc, 30);  
      //Serial.println("2p_inputntpc: " + String(p_inputntpc));
      configTime(0, 0, p_inputntpc);
    #endif



  //******************************************************************************
  //                             INIT  Modbus                                    *
  //****************************************************************************** 
  // Set RTU Modbus message timeout to 2000ms
    MB.setTimeout(resp_tim_out);
    
  // Start ModbusRTU background task
    MB.begin(1);

   ModbusMessage n, m;  
   // Define message
  // ModbusMessage msg1;  

  // Define and start WiFi bridge
  // ServerID 2: Server with remote serverID 4, accessed through RTU client MB
  // Only FCs 03 and 04 accepted
  #ifdef MB_Gateway
   
    MBbridge.attachServer(1, 1, READ_HOLD_REGISTER, &MB);
    MBbridge.addFunctionCode(1, READ_INPUT_REGISTER);
    //MBbridge.addFunctionCode(1, READ_HOLD_REGISTER);
    MBbridge.addFunctionCode(1, WRITE_HOLD_REGISTER);
    m.setMessage(1, ANY_FUNCTION_CODE, 0, 10);
    
    n = MBbridge.localRequest(m);
    
    char dataStringb[50] = {0};
    sprintf(dataStringb, "%02X %02X %02X %02X %02X",Expec_b[0],Expec_b[1],Expec_b[2],Expec_b[3],Expec_b[4]);  
    testOutput(makeVector(dataStringb), n);   
 

    // Check: print out all combinations served to Serial

    MBbridge.listServer();
 
    // Start the bridge. Port 502, 4 simultaneous clients allowed, 600ms inactivity to disconnect client

    MBbridge.start(port, m_max_clients, 60000);
  #endif  
    
    //#ifdef MBDebug
    //Serial.printf("Use the shown IP and port %d to send requests!\n", port);
    //#endif
    


  //**************************************************************************************
  // Set up ModbusRTU client.
  // - provide onData handler function
    MB.onDataHandler(&handleData);
  // - provide onError handler function
    //MB.onErrorHandler(&handleError);
  //-----------------------------------------------------------------------




   






  //******************************************************************************
  //                     Ende SETUP Start Programm                               *
  //****************************************************************************** 

   //NTPCallback();
   //Serial.println("1--> NTPCallback2()");
   NTPCallback2();


   //Timeupdate();
   gRADONupdateFlag = true;

   //Serial.printf("IP address: %u.%u.%u.%u\n", wIP[0], wIP[1], wIP[2], wIP[3]);




   if (p_mqonoff == "on"){
      mqttdAktiveConfig = true;
   }else{
      mqttdAktiveConfig = false; 
   } 

   if(mqttdAktiveConfig == true){

     if (mqtt_con_err2 == true){  // nach 5 Versuchen
       mq_werteaktual = "<span class='Stil6'>MQTT Error</div>"; //rot
       mQtt_aktiv = " class='Stil1b' ";//rot
     }else{
        if (divstatus2 == divgreen) {
                mq_werteaktual = "<span class='Stil5'>MQTT activated</div>";//grün
                mQtt_aktiv = " class='Stil1a' "; //grün
        }
        else if (divstatus2 == divred) {
                mq_werteaktual = "<span class='Stil5'>MQTT Error</div>";//rot
                mQtt_aktiv = " class='Stil1b' "; //rot
        }
        else {
                mq_werteaktual = "<span class='Stil6a'>MQTT prepared</div>"; //grau
                mQtt_aktiv = " class='Stil1c' ";//grau
        }
     }

   }
   if(mqttdAktiveConfig == false) mQtt_aktiv = " class='Stil1c' ";



   if (p_freshonoff == "on"){
      freshdAktiveConfig = true;
   }else{
      freshdAktiveConfig = false; 
   }  
   if(freshdAktiveConfig == true){
    fresh_aktiv = " class='Stil1a' ";
    fresh_werteaktual = "<span class='Stil5'>Freshbox aktiviert</div>";
   }
   if(freshdAktiveConfig == false) fresh_aktiv = " class='Stil1c' ";




   if (p_cloudonoff == "on"){
      cloudAktiveConfig = true;
   }else{
      cloudAktiveConfig = false; 
   }  
   if(cloudAktiveConfig == true){ 
      cloud_aktiv = " class='Stil1c' ";
      cloud_werteaktual = "CLOUD aktiviert";
   }
   if(cloudAktiveConfig == false) cloud_aktiv = " class='Stil1c' ";
   
   

   if (p_ledonoff == "on"){
      ledAktiveConfig = true;
   }else{
      ledAktiveConfig = false; 
   }  
   if(ledAktiveConfig == true){ 
      lEd_aktiv = " class='Stil1a' ";
      led_werteaktual = "<span class='Stil5'>LED aktiviert</div>";
   }
   if(ledAktiveConfig == false) lEd_aktiv = " class='Stil1c' ";
   
   #ifdef vent_option
    if (p_vanonoff == "on"){
        vanAktiveConfig = true;
    }else{
        vanAktiveConfig = false; 
        gWerte3UpdateFlag = 3;
    }  
   #endif

   if(vanAktiveConfig == true){ 
      van_aktiv = " class='Stil1a' ";
      van_werteaktual = "<span class='Stil5'>FAN aktiviert</div>";
   }
   if(vanAktiveConfig == false) van_aktiv = " class='Stil1c' ";
   


   if (p_pushonoff == "on"){
      pushAktiveConfig = true;
   }else{
      pushAktiveConfig = false; 
   }  
   if(pushAktiveConfig == true){ 
      push_aktiv = " class='Stil1a' ";
      push_werteaktual = "<span class='Stil5'>Push aktiviert</div>";
   }
   if(pushAktiveConfig == false) push_aktiv = " class='Stil1c' ";




   if (p_ao1onoff == "on"){
      ao1AktiveConfig = true;
   }else{
      ao1AktiveConfig = false; 
   }  
   if(ao1AktiveConfig == true){ 
      ao1_aktiv = " class='Stil1a' ";
                       if(ao1OptionVal==0){
                         ao1_werteaktual = "<span class='Stil5'>4-20mA aktiviert</div>";
                        }
                        if(ao1OptionVal==1){
                         ao1_werteaktual = "<span class='Stil5'>3.8-20.5mA aktiviert</div>";
                        } 
                        if(ao1OptionVal==2){
                         ao1_werteaktual = "<span class='Stil5'>0-20mA aktiviert</div>";
                        } 

   }
   if(ao1AktiveConfig == false) ao1_aktiv = " class='Stil1c' ";




   msRs485 = millis();
   msRs485_start = msRs485;          


   //****************************************************************** 
   #ifdef led_on 

        gLedSearchFlag = false;
        //on_LED_Search();


  #endif
  //****************************************************************** 




  //******************************************************************************
  //                         Starte Watchdog                                     *
  //******************************************************************************
  //Serial.println("Configuring WDT");
  esp_task_wdt_init(WDT_TIMEOUT, true); //enable panic so ESP32 restarts
  esp_task_wdt_add(NULL); //add current thread to WDT watch




  //datei_lesen_line6();
  //datei_lesen_line5();
  datei_lesen_line3();
  //datei_lesen_line2();
  //datei_lesen_line7();


    //log_list[log_list_count] = String(p_time) + " | ESP32: Restart";
   // update_log();
    //Serial.println(p_time);



    if(device_id_s == "00000000"){

           Serial.println(p_time + " | Generate ID ");

     generate_device_id();
    }



}
//-------------------- setup() -----------------------------------------
//-----------------------------------------------------------------------------------
//------------------------------------------------------------------------------------





//----- loop() -----
void loop() {
  

      esp_task_wdt_reset();

      //ws.cleanupClients();

      #ifdef ESP32_PiCO_EVENT

          // Cycle the DotStar colour every 25 milliseconds
          //tp.DotStar_CycleColor(25);

          // You can set the DotStar colour directly using r,g,b values
          // tp.DotStar_SetPixelColor( 255, 128, 0 );

          // You can set the DotStar colour directly using a uint32_t valueesp_task_wdt_reset2 sec.
          // tp.DotStar_SetPixelColor( 0xFFC900 );

          // You can clear the DotStar too
          // tp.DotStar_Clear();

          // To power down the DotStar for deep sleep you call this
          // tp.DotStar_SetPower( false );

      #endif


      //if (digitalRead(PIN_version)== HIGH){
        // zustandVersion = true;  //1 = Normal Version      #define WIFI_nur_LED
        //} else{
        // zustandVersion = false; //0 = Nur LED Version     #define WIFI_nur_LED
        //}



    WiFi_status = WiFi.status();

    //if(WiFi_status != WL_CONNECTED) {           
        //WiFi.reconnect();
    //}


    read_div_values();

    
      //unsigned long allSeconds=millis()/1000;     //ab start
      //int runHours= allSeconds/3600;
      //int secsRemaining=allSeconds%3600;
      //int runMinutes=secsRemaining/60;
      //int runSeconds=secsRemaining%60;     
      //Serial.println(allSeconds);
      //Serial.println("secsRemaining " + String(secsRemaining));
      //Serial.println("runSeconds " + String(runSeconds));
      //Serial.println("runMinutes " + String(runMinutes));
      //Serial.println("runHours " + String(runHours));



        int second_, minute_, hour_;
        hour_ = timeClient.getHours();
        minute_ = timeClient.getMinutes();
        second_ = timeClient.getSeconds();
        sprintf_P(DateAndTimeString, PSTR("%02d:%02d:%02d"),  hour_, minute_, second_);  
        p_time = DateAndTimeString;




      /*
      WL_IDLE_STATUS	0
      WL_NO_SSID_AVAIL	1
      WL_SCAN_COMPLETED	2
      WL_CONNECTED	3
      WL_CONNECT_FAILED	4
      WL_CONNECTION_LOST	5
      WL_DISCONNECTED	6
      */
     
   


    #ifdef BLE_Serial_WG
    //void loop

    #endif



  #ifdef PCB_v_7
   //---------------------------------------
   #ifdef v_4_20_mA_3 


    sendWert(ao1_set_ADC);


   #endif
   //---------------------------------------
  #endif


    #ifndef mit_MQTT
      p_sett07 = 0; //0 = MQTT dekativieren
    #endif


        //-------< READ Analog >--------
        intV_AI_VSS = analogRead(PIN_AI_VSS);     // AKKU
        intV_AI_VCAPA = analogRead(PIN_AI_VCAPA); // SOLAR
        //-------</ READ Analog >--------




        // Wert in Volt umrechnen für ADC - ESP32
        AI_VSS_mv = (intV_AI_VSS * 3300.0 / 4095.0) / 1000UL;
        AI_VCAPA_mv = (intV_AI_VSS * 3300.0 / 4095.0) / 1000UL;

     
            if( p_inputpasswort == p_inputpasswort_admin){  
             //Admin
              p_sett08 = 1; //Cloud
              p_sett09 = 1; //LED
              p_sett10 = 1; //Push
              p_sett11 = 1; //FAN
              p_sett19 = 1; //AO1

              p_sett21 = 1; // Source Radon only
              p_sett21t = 1; // Source Radon only
              p_sett20_s = p_sett20_1;  // Source Radon only
              p_sett06 = 1; //0= Mesh aktivieren
              p_sett04 = 1; //RS485 Setting

              divGateway_hid1 = divGateway_hid; 
              divGateway_hid1_2 = divGateway_hid_2; 
              p_co2chart_hid = p_co2chart_in2;
              divGateway_hid1_4 = divGateway_hid_4;  //Werksreset einblenden


            }else{  
              //Stanbdard
              //p_sett08 = 0; //Cloud
              //p_sett09 = 0; //LED
              p_sett10 = 0; //Push
              p_sett11 = 0; //FAN

              p_sett21 = 1; // Source Radon only
              p_sett21t = 1; // Source Radon only
              p_sett20_s = p_sett20_1;  // Source Radon only
            
              #ifndef mit_Mesh
              p_sett06 = 0; //0= Mesh deaktivieren
              #endif

              p_sett04 = 0; //RS485 Setting

              divGateway_hid1 = divGateway_hid0;  //Schaslter ausblenden
              divGateway_hid1_2 = divGateway_hid0_2;  //Serach ausblenden
              p_co2chart_hid = p_co2chart_out2;  // co2 link ausblenden bei live Seite
              divGateway_hid1_4 = divGateway_hid0_4;  //Werksreset ausblenden

            }    
     



          if(p_sett15 == 1){  //ON OFF Freshbox
            p_sett15_s = p_sett15_1;
            p_freshonoff = "on";
          }else{
            p_sett15_s = p_sett15_0;
            p_freshonoff = "off";
          }

          if(p_sett14 == 1){  //ON OFF Freshbox Setting
            divGateway_hid1_3 = divGateway_hid_3; //Fresh ID Change einblenden
          }else{
            divGateway_hid1_3 = divGateway_hid0_3;  //Fresh ID Change ausblenden
          }



          if(p_sett16 == 1){  //ON OFF MQTT
            p_sett16_s = p_sett16_1;
            p_mqonoff = "on";
          }else{
            p_sett16_s = p_sett16_0;
            p_mqonoff = "off";
          }

          if(p_sett17 == 1){  //ON OFF LED
            p_sett17_s = p_sett17_1;
            p_ledonoff = "on";
          }else{
            p_sett17_s = p_sett17_0;
            p_ledonoff = "off";
          }

          if(p_sett18 == 1){  //ON OFF LED    cloudAktiveConfig
            p_sett18_s = p_sett18_1;
            p_cloudonoff = "on";
          }else{
            p_sett18_s = p_sett18_0;
            p_cloudonoff = "off";
          }

          if(p_sett29 == 1){  //on/off    AO
            p_sett29_s = p_sett29_1;
            p_ao1onoff = "on";
          }else{
            p_sett29_s = p_sett29_0;
            p_ao1onoff = "off";
          }




            //----------------------------------------------------------
            #ifdef Freshbox
                  if (freshdAktiveConfig == true) { 
                  
                    
                    if(freshdAktiveRead == true){ 
                      werteaktual_f = "<span class='Stil5'>L&uuml;fter Daten aktuell</div>";
                    }else{
                      werteaktual_f = "L&uuml;fter Daten nicht aktuell";
                    }
                  }else{
                    werteaktual_f = "<span class='Stil5'> </div>";
                    
                  }
            #endif
           //----------------------------------------------------------




                 if(p_inputpasswort == p_inputpasswort_admin){  //divGateway_hid1_4
                   divGateway_hid1_4 = divGateway_hid_4; 
                 }else{
                   divGateway_hid1_4 = divGateway_hid0_4;  //Werksreset ausblenden
                 }

     //----------------------------------------------------------




     //----------------------------------------------------------
        if(g_restart_pw_change == true && g_restart_pw_change_t == 0){
         
          g_restart_pw_change = false;
          
            Preferences preferences;
            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
            delay(100);
            preferences.end();                                      //Preferences beenden
            delay(500);
            ESP.restart(); 

        }

     //----------------------------------------------------------







     //============================================================================
    if(WiFi_status != WL_CONNECTED){  
        cloud_werteaktual = "<span class='Stil6'>WIFI nicht verbunden</div>";
        gcloudWIFIFlag = false;
    }else{
        gcloudWIFIFlag = true;
    } 


  


  
      //  gMQTTUpdateFlag
      if (cloudAktiveConfig == false){  //Cloud ausgeschaltet 
        b_RadonCloudUpload4 = false;
      }  

  if(fail2Timeinfo == false){  //false = jahr größer 1970 = Jahr OK
   if(b_RadonCloudUpload4 == true){
       b_RadonCloudUpload4 = false;

              
              #ifdef RADONCLOUD_DEBUG
                Serial.println("-->  [APP] min Free memory  : " + String(esp_get_minimum_free_heap_size()) + " bytes");
              #endif

              
                cloud_werteaktual = "<span class='Stil5'>CLOUD aktiviert</div>";
              
                datei_lesen_line12();
                charcount12_w = charcount12;


              if(gReboot_TOKENFlag == 1){  // nur neu Speichern wenn Zeit abgelaufen ist
                lesen_next_cloud();
                datei_schreiben12();  // FILE_APPEND
                charcount12_w = charcount12 + 1; //aktuell in der datei  
                #ifdef RADONCLOUD_DEBUG
                  Serial.println("-->  " + p_time + " | Aktueller write Zeilen Zähler: " + String(charcount12_w)); 
                #endif
                gReboot_TOKENFlag = 0;
                Preferences preferences;
                preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                preferences.putUInt("p_crebbot", gReboot_TOKENFlag);      
                preferences.end();       
              }

              


              g_write_cloudlist = false;   //gerade wird angefangen zu schreiben in cloud

              must_transfer = charcount12_w;
              cloud_connect_error_count ++;
    
              #ifdef RADONCLOUD_DEBUG
              Serial.println("-->  " + p_time + " | " + String(must_transfer) + " Zeilen gespeichert."); 
              #endif


              Preferences preferences;
              preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
              g12FileRead = preferences.getUInt("p_12file", 0);     // in datei gespeicherte zeilen lesen   //lese ab dieser zeile 
              preferences.end(); 
              must_transfer = must_transfer - g12FileRead;
              #ifdef RADONCLOUD_DEBUG
              Serial.println("-->  " + p_time + " | ab der Zeile " + String(g12FileRead) + " lesen.");  
              Serial.println("-->  " + p_time + " | lese " + String(must_transfer) + " Zeilen.");  
              #endif        
            

              // esp_get_minimum_free_heap_size()
              if(cloud_connect_error_count > 10){
                cloud_connect_error_count = 0;                     
                delay(200);
                ESP.restart();  
              }


                  
            //==================================            
              String data;
              uint16_t zeilenZaehler = 0;
              int ir12 = 0;
              File file = SPIFFS.open(dateiGr12, "r");



          while(file.available()) {


            data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...

            if(ir12 >= g12FileRead){

                //=======================================================  
                  WiFiClientSecure radonClient1;
                  radonClient1.setInsecure();  // ESP32-HTTPS-Anfragen ohne Zertifikat
                  #ifdef RADONCLOUD_DEBUG
                    Serial.println("-->  " + p_time + " | set Secure.");
                  #endif
                
                  #ifdef RADONCLOUD_DEBUG
                  Serial.print("-->  " + p_time + " | Starting connection to server...: https= ");
                  Serial.print(p_inputcloudserverc);
                  Serial.println(" | Port: " + String(p_inputcloudporti) );
                  #endif             
              
              
                if (!radonClient1.connect(p_inputcloudserverc, p_inputcloudporti)){
                    
                      divstatus1 = divred;  // Status
                      cloud_aktiv = " class='Stil1b' ";
                      cloud_werteaktual = "<span class='Stil6'>Cloud connect failed!</div>";
                      g_save_cloudlist = false; //bit löschen
          
                      g_i_secure = true;  //fehler
                      i_secure ++;

                      g_abort_cloudlist_2 = true; // abbruch beim schreiben
                      

                        #ifdef RADONCLOUD_DEBUG_min
                        Serial.println("-->  " + p_time + " | Server connection failed!");
                        Serial.print("-->  " + p_time + " | Error: ");
                        #endif
                        char err_bufc[100];
                        String err_buf;
                        
                        if (radonClient1.lastError(err_bufc, 100) < 0) {
                            
                            err_buf = String(err_bufc);
                            #ifdef RADONCLOUD_DEBUG
                            Serial.println(err_buf);
                            #endif

                            // UNKNOWN ERROR CODE (0001)        bei falschem server
                            // BIGNUM - Memory allocation failed      bei server ok
                            // RSA - The public key operation failed : BIGNUM - Memory allocation failed      bei server ok
                            // X509 - The CRT/CRL/CSR format is invalid, e.g. different type expected    ohne setInsecure();

                        } else {
                          #ifdef RADONCLOUD_DEBUG
                            Serial.println("Connection error!");
                          #endif
                        }
                        
                        int Suche = err_buf.indexOf("BIGNUM - Memory allocation failed"); 
                        if(Suche > 0 ){
                            Serial.println("---------------");
                            Serial.println("- ESP.restart -");
                            Serial.println("---------------");

                            //ESP.restart();  
                        }

                        break;

                }else{
                            
                        cloud_connect_error_count = 0;
                        cloud_aktiv = " class='Stil1a' ";
                        cloud_werteaktual = "<span class='Stil5'>CLOUD connected</div>";
                        
                        g_i_secure = false;
                
                        #ifdef RADONCLOUD_DEBUG_min
                        Serial.println("-->  " + p_time + " | Connected to Server erfolgreich.");
                        #endif
                        // Make a HTTP request:

                        divstatus1 = divgreen;  // Status

                        // g12FileRead   das muss noch eingebunden werden wenn > 0
                        String client_send_str2 = "GET /" + p_inputcloudpage + "?" + data + " HTTP/1.1\r\n" + 
                                          "Host: " + p_inputcloudserver + "\r\n" + "Connection: close\r\n\r\n";
                          // Send the sensor data to the mysql server
                          #ifdef RADONCLOUD_DEBUG
                            Serial.println(client_send_str2);
                          #endif
                          radonClient1.print(client_send_str2);
                          esp_task_wdt_reset();
                          g_save_cloudlist = false; //bit löschen
                  
                  
                            //----------------------------------------------------
                                String line_t = ""; 
                                unsigned long lasttime = millis();
                                while (!radonClient1.available() && millis() - lasttime < 3000) {delay(1);esp_task_wdt_reset();}   // wait max 6s for data
                                // Read all the lines of the reply from server and print them to Serial
                          
                                  esp_task_wdt_reset();
                                  while (radonClient1.available()) {
                                  String line = radonClient1.readStringUntil('\n');
                                  #ifdef RADONCLOUD_DEBUG
                                    Serial.println(line);
                                  #endif
                                  int Suche1 = line.indexOf("OK"); 
                                  if(Suche1 > 0 ){
                                    //Serial.println("ok: " + String(Suche2));
                                    g_save_cloudlist = true; //erfolgreich gesendet
                                  }
                                  int Suche2 = line.indexOf("Apache"); 
                                  if(Suche2 > 0 ){
                                    //Serial.println("ok: " + String(Suche2));
                                    g_save_cloudlist = true; //erfolgreich gesendet
                                  }
                                }
                            //----------------------------------------------------
                                              
                          if (g_save_cloudlist == true){
                              must_transfer --;   
                              g_write_cloudlist = true;   //gerade wird angefangen zu schreiben in cloud
                              #ifdef RADONCLOUD_DEBUG_min
                                Serial.println("-->  " + p_time + " | Cloud send success"); 
                              #endif
                          }else{
                              
                              if(data == ""){
                                must_transfer --;
                                g_write_cloudlist = true;  //gerade wird angefangen zu schreiben in cloud
                              }// Wenn zeile leer ist, auch abziehen.
                              #ifdef RADONCLOUD_DEBUG_min
                                Serial.println("-->  " + p_time + " | Cloud no reply from server!"); 
                              #endif 
                          }
                  
                  
                        #ifdef RADONCLOUD_DEBUG
                          Serial.print("RadonCloud = "); Serial.println(client_send_str2);
                        #endif
                        cloud_werteaktual = "<span class='Stil5'>Cloud last upload " + p_time + "</div>";
                        gcloudUpdateFlag = false;

                      radonClient1.stop();   
                  
                  }  //radonClient1.connect              
                  
                  
           
                  esp_task_wdt_reset();              

              //======================================================= 

            }   // if(ir12 >= g12FileRead)

            ir12++;
            zeilenZaehler++;
            
          }  //while(file.available()) 


                              #ifdef RADONCLOUD_DEBUG_min
                                Serial.println("-->  " + p_time + " | File close!"); 
                              #endif 

          file.close();   
          
              #ifdef RADONCLOUD_DEBUG_min
              Serial.println("-->  | " + String(g12FileRead) + " | " + String(must_transfer)  + " | " + String(charcount12_w));  
              #endif
              
              if(must_transfer==0){
                p_clouduploud = "<span class='Stil5'>Data transfer complete</span>"; 
              }else{
                p_clouduploud = String(must_transfer) + " data in memory"; 
              }
                
              // ist     must_transfer
              // soll    charcount12_w
                
              if(must_transfer <= 0 || g_save_cloudlist == true){
                  // alles übertragen
                  gcharcount12Del = true;        //alles aus der Datei löschen
                  g_abort_cloudlist_2 = false;   // kein abbruch beim schreiben
                  g_write_cloudlist = false;      //schreiben ist beendet
              
                  File filew = SPIFFS.open(dateiGr12, "w");
                  #ifdef RADONCLOUD_DEBUG_min
                    Serial.println("Datei " + String(dateiGr12) + " löschen. Alles übertragen.");
                  #endif
                  filew.close(); 

                      g12FileRead = 0; 
                      count12fehlt = 0; 
                      must_transfer = 0; 
                      charcount12_w = 0; 
                      if(g12FileRead >500){g12FileRead=500;}
                      Preferences preferences;
                      preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                      preferences.putUInt("p_12file", g12FileRead);            //schreibe      ab dieser zeile lesen
                      preferences.end();  

              }else{
                // charcount12_w=7    must_transfer=7
                // einiges fehlt, hier z.B. nur 3 zeilen gesendet
                // 0
                // 1
                // 2

                // 3
                // 4
                // 5
                // 6

                //   3             7               7-3=4
                count12fehlt = charcount12_w - must_transfer;
                // ab Zeile 4 dann übertragen
                count12fehlt ++; 

                gcharcount12Del = false;      // nicht alles aus der Datei löschen
                g_abort_cloudlist_2 = true;   // abbruch beim schreiben
                g_write_cloudlist = false;     //schreiben ist beendet
              
                  //-------------------------------------------

                  // hier den wert speichern um später dort zu starten
                  g12FileRead = count12fehlt-1;
                  if(g12FileRead >500){g12FileRead=500;}
                  Preferences preferences;
                  preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                  preferences.putUInt("p_12file", g12FileRead);            //lese ab dieser zeile 
                  preferences.end();  


                  #ifdef RADONCLOUD_DEBUG_min
                      Serial.println("-->  " + p_time + " | ENDE: ab Zeile " + String(g12FileRead) + " muss gelesen werden."); 
                  #endif    
          

                  //-------------------------------------------
              }  
          
      
          
          
              #ifdef RADONCLOUD_DEBUG_min
                Serial.println("-->  [APP] min Free memory  : " + String(esp_get_minimum_free_heap_size()) + " bytes");
                Serial.println("---------------------------------------------");
                //Serial.printf("$%d %d %d;", tmp.length(), ESP.getFreeHeap(), ESP.getMaxAllocHeap());
              #endif



    }  // b_RadonCloudUpload4   
  } // fail2Timeinfo == false)  //false = jahr größer 1970 = Jahr OK      
//=======================================================          
          
          













   #ifdef o_ThingsBoard3

    // wenn noch  p_inputmquser = "usertoken" dann kann man den abfragen


    if (gACCESS_TOKENFlag == 0){  // 0= provision noch nicht gemacht
    
      if(provisionRequestSent == false){ 
        if(WiFi_status == WL_CONNECTED) {

          ms8erg = millis();  //5min
          ms8 = millis();

             Serial.println(p_time + " | Provision Start");

          reconnectp();
          if (mqtt_con_err == false){    // nicht  reconnect, weil jetzt verbunden

            client.subscribe(PROV_RESPONSE_TOPICp);       //  = "/provision/response";
            
            provisionDevice();    // client.publish     /provision/request

          } 
          

          provisionRequestSent = true;  // provision sperre 


        }
      }

      client.loop();

    }



client.loop();

   
#endif
//----------------------------------------------------------




    if (State_anf_werksreset == true){  

      State_anf_werksreset = false;
      
      p_inputmquser = "usertoken"; //TOKEN
      gACCESS_TOKENFlag = 0; // 1= provision  gemacht  
      device_id_s ="00000000";

      p_inputmqserver = "dashboard.livair.io"; 
      p_inputmqoptions =  "1";     //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
        
      p_inputmqport = "1883"; 

      p_inputmqmesh = "0";
      p_inputmqmeshi = 0;
   
      if(p_inputmqmeshi == 0){
        g_mb_mesh = false; 
      }else{
        g_mb_mesh = true; 
      }

      p_inputmqpass =  ""; 
      p_inputmqtopic = "radon"; 
      p_inputmqtopic1 = "eintraege"; 
      p_inputmqtopic2 = "sernr"; 

      p_mqonoff = "off";
      p_sett16 = 1;


      WriteMqttReset();

      File filew = SPIFFS.open(dateiGr13, "w");
      #ifdef MQTT_DEBUG
        Serial.println("Datei " + String(dateiGr13) + " löschen.");
      #endif
      filew.close(); 


      delay(5000);
      ESP.restart(); 


    }






//----------------------------------------------------------

  if(wifiNotConnectFlag == false){
    if(gLedIPSearchFlag == true){
      if (ee_ip_search == 0){
        on_Led_Ip();
        led_ip_count ++;

        if (led_ip_count >= 20){ 
          led_ip_count = 0;
          ee_ip_search = 1;
          Preferences preferences;
          preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
          preferences.putUInt("ee_ipsearch", ee_ip_search);                  //Variable unter "Datei" ee_ipsearch speichern 
        }
      }
    }
  }

//--------------------------------------------------------------



     //--------------------------------------------------------
     #ifdef vent_option
      updatefanviews();
     #endif
      updatemeshviews();
      updateledviews();
      updatehomeviews();

          // Tools
            if(web_write_ok == 1){ 
              div_c12 = divonc12;
            }else{
              div_c12 = divonc12h; 
            }

    //---------------------------------------------------------


#ifdef test_dns
  if (Client.available()) {
    char c = Client.read();
    Serial.print(c);
  }

  if (!Client.connected()) {
    Serial.println();
    Serial.println("disconnecting.");
    Client.stop();
    for(;;)
      ;
  }
#endif



   //*******************************************************
         // Daten wurden empfangen vom Lüfter
         if(State_schreib_ID_bit == true)  {
              
              State_schreib_ID_bit = false;
              State_anf_schreib_ID_bit = false;

              WritefreshValue();

              strip1.setPixelColor(0, strip1.Color(0, 0, 0)); //0
              strip1.setPixelColor(1, strip1.Color(0, 0, 0)); //0
              strip1.setPixelColor(2, strip1.Color(0, 0, 0)); //0
              strip1.setPixelColor(3, strip1.Color(0, 0, 0)); //0
              strip1.show(); 

              p_getfreshlearn = "";    //löschen Taste freigeben

           }
   //*******************************************************






   //*******************************************************
    #ifdef BLE_multi3

       // notify changed valueble
        if (deviceConnected) {
            pCharacteristic->setValue((uint8_t*)&valueble, 4);
            pCharacteristic->notify();
            valueble++;
            delay(10); // bluetooth stack will go into congestion, if too many packets are sent, in 6 hours test i was able to go as low as 3ms
        }
        // disconnecting
        if (!deviceConnected && oldDeviceConnected) {
            delay(500); // give the bluetooth stack the chance to get things ready
            pServer->startAdvertising(); // restart advertising
            Serial.println("start advertising");
            oldDeviceConnected = deviceConnected;
        }
        // connecting
        if (deviceConnected && !oldDeviceConnected) {
            // do stuff here on connecting
            oldDeviceConnected = deviceConnected;
        }

    #endif
   //*******************************************************




   //*******************************************************
    #ifdef BLE_Serial

        if (Serial.available()) {
          SerialBT.write(Serial.read());
        }
        if (SerialBT.available()) {
          Serial.write(SerialBT.read());
        }
        //delay(100);

    #endif
   //*******************************************************


   //*******************************************************
    #ifdef BLE_Serialparing3

      if (confirmRequestPending)
      {
        if (Serial.available())
        {
          int dat = Serial.read();
          if (dat == 'Y' || dat == 'y')
          {
            SerialBT.confirmReply(true);
          }
          else
          {
            SerialBT.confirmReply(false);
          }
        }
      }
      else
      {
        if (Serial.available())
        {
          SerialBT.write(Serial.read());
        }
        if (SerialBT.available())
        {
          Serial.write(SerialBT.read());
        }
        delay(20);
      }

    #endif
   //*******************************************************




//*******************************************************
    #ifdef vent_option
    if (p_sett11 == 1 && p_vanonoff == "on" && f_alarm != 2){  //view FAN Eingeschaltet      || p_vanonoff == "on"
      if(g_CRC_ok == true){ // Daten die anklommen ok
        
        if (tG1_page == true){
          tG1_page = false;

            msg_TG[0] = 0xFE;
            msg_TG[1] = 0x01;
            msg_TG[2] = 0x01;
            Serial1.write(msg_TG, 3);
            delay(300);
            Serial1.write(msg_TG, 3);
            Serial.println("Auto Taste +: ");
        }

        if (tG2_page == true){
          tG2_page = false;

            msg_TG[0] = 0xFE;
            msg_TG[1] = 0x02;
            msg_TG[2] = 0x02;
            Serial1.write(msg_TG, 3);
            delay(300);
            Serial1.write(msg_TG, 3);
            Serial.println("Auto Taste -: ");
        }

      }
    }

    if (p_sett11 == 1 && p_vanonoff == "on" && f_alarm == 2 && tG_x_page == 5){  //view FAN Eingeschaltet und Alarm und Quitt gedrückt    || p_vanonoff == "on"
      if(g_CRC_ok == true){ // Daten die anklommen ok

            msg_TG[0] = 0xFE;
            msg_TG[1] = 0x01;
            msg_TG[2] = 0x01;
            Serial1.write(msg_TG, 3);
            delay(300);
            Serial1.write(msg_TG, 3);
            Serial.println("Auto Taste Quitt: ");

      }
    }
    #endif
//*********************************************************



    if(gbootUpdateFlag == true){
      if(millis() > 200){
      // Serial.println("-- gbootUpdateFlag --"); 
       gbootUpdateFlag = false;
       ms_timer = millis();
       ms1 = ms_timer;
       ms2 = ms_timer;
       ms3 = ms_timer;
       ms4 = ms_timer;
       ms5 = ms_timer;
       ms6 = ms_timer;
       ms7 = ms_timer;
       ms8 = ms_timer;
       ms9 = ms_timer;
       ms10 = ms_timer;
       ms12 = ms_timer;
       currentMillis = ms_timer;

       msRs485 = ms_timer;
       msRs485_start = ms_timer;
      }
    }


   //--- Timer -------------------------------------
   //-------------
   // alle 1sec.
   if (millis() - ms3 > 1000) {
      ms3 = millis(); 
      g_01sec_UpdateFlag = true;
      //Serial.println("-- Start 1sec --");
  
      //Serial.println(g_2sec_count);

     g_02sec_UpdateFlag = true;


     #ifdef FAN_DEBUG
      Serial.println("count<20: " + String(g_crc_counter) + "  |CRC=1  " + String(g_CRC_ok) + "  |p=0  " + String(pauseErrorFan) + "  |  " + String(pauseWebpage));
     #endif

   }



   // alle 10sec.
   if (millis() - ms2 > 10000) {
      ms2 = millis(); 
      g_10sec_UpdateFlag = true;
      //Serial.println("-- Start 10sec --");
   }




    // alle 60sec.
   if (millis() - ms1 > 60000) {
      ms1 = millis(); 
      //Serial.println("-- Start 60sec --");
      g_60sec_UpdateFlag = true;


      
      
   } 



   // alle 2sec.
   if (millis() - ms12 > 2000) {
      ms12 = millis(); 
      //g_02sec_UpdateFlag = true;
      //Serial.println("-- Start 2sec --");

   }



   if (g_02sec_UpdateFlag == true) {
     g_02sec_UpdateFlag = false;
     //Serial.println("-- Start 2 sec.. --");
             if(dirctionadc == false){
              ao1_set_test = ao1_set_test + 35;
             }else{
              ao1_set_test = ao1_set_test - 35;
             }
             
             if(ao1_set_test >= calc_top2){
              ao1_set_test = calc_top2;
              dirctionadc = true;
             }
             if(ao1_set_test <= calc_down2){
              ao1_set_test = calc_down2;
              dirctionadc = false;
             }


        #ifdef PCB_v_7  
          #ifdef v_4_20_mA_4 
             ao1_set_test2 = ao1_set_test;
             module.init(I2C_SCL_PIN, I2C_SDA_PIN);
          //ao1_set_test2 = calc_down2;
             float dac0 = module.output_mA(ao1_set_test2); 
             Serial.print("-->  " + p_time + " "); Serial.print("DAC0 value: "); Serial.print(dac0);Serial.print(" mA | DC: ");Serial.println(ao1_set_test2);
          #endif
        #endif

   }


   //------------------------------------------------------------------------------------
    




    //------------------------------------------------------------------------------------
    currentMillis = millis();
     if(WiFi_status == WL_CONNECTED){  

        previousMillis = currentMillis;

        if(gCONNECTEDflag == 0){   
            gCONNECTEDflag = 1;    // 1=WLAN ist verbunden
            Preferences preferences;
            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden                                     
            preferences.putUInt("gCONNflag", gCONNECTEDflag);                  //Variable  speichern 
            preferences.end();                                      //Preferences beenden
            //Serial.println("--> gCONNECTEDflag: " + String(gCONNECTEDflag));
        }
    } 


    // if WiFi is down, try reconnecting
    //                                      17000             16000            5000
    if ((WiFi_status != WL_CONNECTED) && (currentMillis - previousMillis >=interval)) {
      //Serial.print(millis());
         Serial.println("Restart WIFI lost...");

          millissave = epochTime;   // getTime();
          if(millissave > 1577833200){ // > 2020.1.1
            //Serial.println("millissave: " + String(millissave));
            millissave_t = millissave + 60; //rebootzeit
            millissave_t = millissave_t - (gUTC * 3600);
            Preferences preferences;
            preferences.putUInt("ee_timesave", millissave_t);         //Variable counter unter "Datei"  speichern
            preferences.end();                                      //Preferences beenden
          }

          delay(1000);
          ESP.restart(); 
    }
    
   //------------------------------------------------------------------------------------
  





   // alle 5min. provision
   if(provisionRequestSent == true && gACCESS_TOKENFlag == 0){  //provision gerade geamcht    und   noch kein provision erfolgreich
   if (millis() - ms8 > 300 * 1000L) {
      ms8 = millis();
      g_8_05min_UpdateFlag = true; // erneut provision Starten
      provisionRequestSent = false; // erneut provision Starten
      #ifdef TimeDebug
        //Serial.println("-- Start 5min --");
      #endif
   }
   }


   // alle 5min.
   if (millis() - ms5 > 300 * 1000L) {
      ms5 = millis();
      g_05min_UpdateFlag = true; 
      #ifdef TimeDebug
        //Serial.println("-- Start 5min --");
      #endif
   }

    // alle 60min.
   if (millis() - ms4 > 3600 * 1000L) {
      ms4 = millis(); 
      g_60min_UpdateFlag = true;
      #ifdef TimeDebug
        Serial.println("-- Start 60min --");
      #endif
   } 

    // alle 1440min.
   if (millis() - ms9 > 86400 * 1000L) {
      ms9 = millis(); 
      g_1440min_UpdateFlag = true;
      #ifdef TimeDebug
        Serial.println("-- Start 600min --");
      #endif
   } 

   //----------------------------------------------
  
  /*
   // alle 10sec.
    if (millis() - ms_timer > 10 * 1000L) {
      ms_timer = millis();
        Serial.println("-- 10sec. --");
        Serial.println(millis()); 
        Serial.println(ms_timer); 
        Serial.println(ms1); 
        Serial.println(ms2); 
        Serial.println(ms3); 
        Serial.println(ms4); read_div_values
        Serial.println(ms5); 
        Serial.println(ms6); 
        Serial.println(msRs485); 
        Serial.println(msRs485_start); 

        

    }
    */
    //---------------------------------------------


      #ifdef OTA_on_NMDS_off
        ArduinoOTA.handle();
      #else
        //MDNS.update();
      #endif



    //---------------------------------------------------------------------
      if(select_reboot == 2){                           // ESP Restart vom Webserver gesendet
        //damit nach dem neustart nicht von Browser erneut reboot kommt
       
        

          // eventuell noch das bit nach Zeit löschen??????
          if (ipchangeandreeboot == 1){    // IP Adresse gerändert
           
            ipchangeandreeboot = 0;

              if (p_inputstaticip != "152.158.158.251"){

                #ifdef BLE_WIFI_disable
                WiFiManager wifiManager;
                #endif
                //wifiManager.setSTAStaticIPConfig(IPAddress(192,168,178,162), IPAddress(192,168,178,1), IPAddress(255,255,255,0)); 
                IPAddress _ip,_gw,_sn,_dns1,_dns2;
                _ip.fromString(p_inputstaticip);
                _gw.fromString(p_inputgateway);
                _sn.fromString(p_inputsubnetmask);
                _dns1.fromString(p_inputwifidns);
                _dns2.fromString("8.8.8.8");

                //_dns.fromString(static_dns);
                #ifdef BLE_WIFI_disable
                  wifiManager.setSTAStaticIPConfig(_ip, _gw, _sn , _dns1);
                #endif
                // p_inputipchange = preferences.getString("p_ipchange", "0"); 



                #ifdef WIFI_DEBUG      
                    Serial.println("IP Change for WIFIMANAGER");
                #endif


                getIpAddress(p_inputstaticip); 
                #ifdef WIFI_DEBUG
                Serial.print("IP Address=");             
                Serial.print(IpPartAddress[0]); Serial.print("."); Serial.print(IpPartAddress[1]); Serial.print("."); 
                Serial.print(IpPartAddress[2]); Serial.print("."); Serial.println(IpPartAddress[3]); 
                #endif 


                IPAddress local_IP( IpPartAddress[0], IpPartAddress[1], IpPartAddress[2], IpPartAddress[3] );
                #ifdef WIFI_DEBUG
                  Serial.println(local_IP);
                #endif  
                getIpAddress(p_inputsubnetmask);
                #ifdef WIFI_DEBUG
                Serial.print("Submask="); 
                Serial.print(IpPartAddress[0]); Serial.print("."); Serial.print(IpPartAddress[1]); Serial.print("."); 
                Serial.print(IpPartAddress[2]); Serial.print("."); Serial.println(IpPartAddress[3]); 
                #endif
                IPAddress subnet(IpPartAddress[0], IpPartAddress[1], IpPartAddress[2], IpPartAddress[3]);
                #ifdef WIFI_DEBUG
                  Serial.println(subnet);
                #endif
                getIpAddress(p_inputgateway);  
                #ifdef WIFI_DEBUG      
                Serial.print("IP gateway="); 
                Serial.print(IpPartAddress[0]); Serial.print("."); Serial.print(IpPartAddress[1]); Serial.print("."); 
                Serial.print(IpPartAddress[2]); Serial.print("."); Serial.println(IpPartAddress[3]);  
                #endif
                IPAddress gateway(IpPartAddress[0], IpPartAddress[1], IpPartAddress[2], IpPartAddress[3]);
                #ifdef WIFI_DEBUG
                  Serial.println(gateway);
                #endif
                IPAddress primaryDNS(8, 8, 8, 8); 
                IPAddress secondaryDNS(8, 8, 4, 4);
                // This part of code will try create static IP address
                #ifdef WIFI_DEBUG
                #ifdef BLE_WIFI_disable
                  if (!WiFi.config(local_IP, gateway, subnet, gateway, primaryDNS)) {
                  //if (!WiFi.config(local_IP, gateway, subnet, primaryDNS, secondaryDNS)) {  
                    Serial.println("STA Failed to configure");
                  }
                #endif
                #endif

                
              }

          abfrage_eingabe = 0;

          }
       
            Preferences preferences;
            preferences.end();                                      //Preferences beenden

          delay(5000);
          ESP.restart(); 

      }
    //-----select_reboot == 2-------------------------------------------





    //-------------------------- M A S T E R -----------------------------------------
                   // select_slave_scan == 1
       //hier noch optimieren, wenn 2 konfiguriert und 2 geefunden, dann nicht mehr suchen?????
       //   p_inputmqmeshi     g_mb_sensor_found   if (p_inputmqmeshi != g_mb_sensor_found){
    if (p_inputmqmeshi != g_mb_sensor_found){
    if(g_mb_mesh == true){  
      if (start_slave_scan == 0){
        start_slave_scan = 1;    //MESH 1= scan gestartet  0 = erneut starten
        g_mb_sensor_found = 0; 
        

        scan_max = p_inputmqmeshi+1;

          for (uint8_t scan_ids = 1; scan_ids < scan_max; scan_ids++) { 

                esp_task_wdt_reset(); 
                if(scan_ids >= scan_max){return;}
                //client_id = scan_ids; 
                #ifdef MBDebug_min
                Serial.println(" ");
                Serial.println(p_time + " | Suche Mesh Sensor Adressen - Adresse: " + String(scan_ids) + " | Baud " + String(mbus_baud));
                #endif

                MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, scan_ids, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  if (err == TIMEOUT) {
            
                      ModbusError me(err);
                      #ifdef MBDebug_master
                      //Serial.print("-->  Sensor ");
                      Serial.print(p_time + " | Mesh Sensor Adresse: ");
                      Serial.printf("%d : %s\n", scan_ids, (const char *)me);
                      #endif

                    
                      g_mb_tracer_online[scan_ids] = 0;     // Sensor nicht gefunden
                      g_mb_tracer_result[scan_ids]= "--";



                      if(scan_ids == 1){
                        p_inputsavebit_txt = "<span class='Stil6'>Sensor connect failed!</div>";
                        divstatus4 = divred; //bei Status

                        g_mb_sensor_online = false;
                        abfr_mb_finish = 2;

                      }

                      #ifdef MBDebug_master
                        //Serial.println("Sensor " + String(scan_ids) +  " connect failed!");
                      #endif

                  } else {
            
                      ModbusError me(err);
                      //#ifdef MBDebug_master
                      //Serial.print("-->  Sensor ");
                      //Serial.printf("%d : %s\n", scan_ids, (const char *)me);
                     // #endif
                #ifdef MBDebug_min
                  Serial.print(p_time + " | Antwort von Mesh Sensor: ");
                  Serial.printf("%d : %s\n", scan_ids, (const char *)me);
                #endif   

                      g_mb_tracer_online[scan_ids] = 1;   // Sensor gefundenp_MB_scan_resault
                      g_mb_tracer_result[scan_ids]= "ok";
                      g_mb_sensor_found = g_mb_sensor_found + 1;

   


                      if(scan_ids == 1){
                        p_inputsavebit_txt = "Sensor Werte aktualisiert";
                        sensor_mb_ok = 1;
                        g_mb_sensor_online = true;

                        //sprintf(dataStringb, "0x%02X",scan_ids);  
                        //p_MB_scan_resault = "<span class='Stil5'>    " + String(dataStringb) + "</div>  [" + String(g_mb_sensor_found) + "]"; 
                        abfr_mb_finish = 1;
                        divstatus4 = divgreen; //bei Status
                        
                      }
                      

                      #ifdef MBDebug_master
                        //Serial.println("Sensor " + String(scan_ids) +  " connect success.");
                      #endif

                  }  
              
          } 
          
          
            if(g_mb_tracer_online[1] == 1){
              p_MB_scan_resault = "<span class='Stil5'>  0x01</div><span class='Stil6a'>[" + String(g_mb_sensor_found) + "]</div>";
              p_MB_scan_resaulta = "<span class='Stil5'>  0x01</div><span class='Stil6a'>[" + String(g_mb_sensor_found) + "] | Baud: " + String(mbus_baud_last) + "</div>";
            }else{
              p_MB_scan_resault = "<span class='Stil6'>  0x01</div><span class='Stil6a'>[" + String(g_mb_sensor_found) + "]</div>";
              p_MB_scan_resaulta = "<span class='Stil6'>  0x01</div><span class='Stil6a'>[" + String(g_mb_sensor_found) + "] | Baud: " + String(mbus_baud_last) + "</div>";
            }
          
     mb_tracer_number = 1; //lesen starten
          Serial.println(" ");
          if(g_mb_sensor_found == 1){
            Serial.println(p_time + " | " + String(g_mb_sensor_found) + " Sensor gefunden | " + String(p_inputmqmeshi) + " Senoren konfiguriert");
          }else{
            Serial.println(p_time + " | " + String(g_mb_sensor_found) + " Sensoren gefunden | " + String(p_inputmqmeshi) + " Senoren konfiguriert");
          }
          Serial.println(" ");

          //hier noch optimieren, wenn 2 konfiguriert und 2 geefunden, dann nicht mehr suchen?????



          
          //#ifdef MBDebug_master
            //scan_max = p_inputmqmeshi+1;
            //for (uint8_t scan_ids = 1; scan_ids < scan_max; scan_ids++) { 

             // Serial.println("Tracer[" + String(scan_ids) + "] " + String(g_mb_tracer_online[scan_ids]));

            //}
          //#endif
          
          
          

      }
    }
    }
    //-----------------------------------------------------------------  



      
      
        //-------- R E A D  S E N S O R S ---------------------------------------------------------  
       // if (select_slave_scan == 0){     //0= aus  1= scan start  2= ohne Scan 
        if(g_mb_mesh == true){   
         
          //------- 1 ------------------------------------------------------------------ 
            scan_ids_mb = 1;
            //if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 1){mb_tracer_number = 3;} //überspringen
            if(mb_tracer_number == 1){
              mb_tracer_number = 2;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 7); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                    g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }

                  gWerte1UpdateFlag = 3;
                //}
          } 
          //------------------------------------------------------------------------- 

         
         
          //------- 2 ------------------------------------------------------------------ 
            scan_ids_mb = 2;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 3){mb_tracer_number = 5;} //überspringen  
            //if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 3){mb_tracer_number = 5;} //überspringen
            if(mb_tracer_number == 3){  //+1
              mb_tracer_number = 4;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
                  


          } 
          //------------------------------------------------------------------------- 

          //------- 3 ------------------------------------------------------------------ 
            scan_ids_mb = 3;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 5){mb_tracer_number = 7;} //überspringen 
            //if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 5){mb_tracer_number = 7;} //überspringen
            if(mb_tracer_number == 5){
              mb_tracer_number = 6;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
          }
          //------------------------------------------------------------------------- 


          //------- 4 ------------------------------------------------------------------ 
            scan_ids_mb = 4;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 7){mb_tracer_number = 9;} //überspringen
            //if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 7){mb_tracer_number = 9;} //überspringen
            if(mb_tracer_number == 7){
              mb_tracer_number = 8;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
          }
          //------------------------------------------------------------------------- 


          //------- 5 ------------------------------------------------------------------ 
            scan_ids_mb = 5;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 9){mb_tracer_number = 11;} //überspringen
           // if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 9){mb_tracer_number = 11;} //überspringen
            if(mb_tracer_number == 9){
              mb_tracer_number = 10;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
               
          }
          //------------------------------------------------------------------------- 


          //------- 6 ------------------------------------------------------------------ 
            scan_ids_mb = 6;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 11){mb_tracer_number = 13;} //überspringen
           //if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 11){mb_tracer_number = 13;} //überspringen
            if(mb_tracer_number == 11){
              mb_tracer_number = 12;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
          }
          //------------------------------------------------------------------------- 


          //------- 7 ------------------------------------------------------------------ 
            scan_ids_mb = 7;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 13){mb_tracer_number = 15;} //überspringen
            //if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 13){mb_tracer_number = 15;} //überspringen
            if(mb_tracer_number == 13){
              mb_tracer_number = 14;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
          }
          //------------------------------------------------------------------------- 


          //------- 8 ------------------------------------------------------------------ 
            scan_ids_mb = 8;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 15){mb_tracer_number = 17;} //überspringen
           // if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 15){mb_tracer_number = 17;} //überspringen
            if(mb_tracer_number == 15){
              mb_tracer_number = 16;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
          }
          //------------------------------------------------------------------------- 


          //------- 9 ------------------------------------------------------------------ 
            scan_ids_mb = 9;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 17){mb_tracer_number = 19;} //überspringen
            //if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 17){mb_tracer_number = 19;} //überspringen
            if(mb_tracer_number == 17){
              mb_tracer_number = 18;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
          }
          //------------------------------------------------------------------------- 


          //------- 10 ----------------------------------------------------------------- 
            scan_ids_mb = 10;
            if(scan_ids_mb > p_inputmqmeshi && mb_tracer_number == 19){mb_tracer_number = 21;} //überspringen
            //if(g_mb_tracer_online[scan_ids_mb] == 0 && mb_tracer_number == 19){mb_tracer_number = 21;} //überspringen
            if(mb_tracer_number == 19){
              mb_tracer_number = 20;

                  #ifdef MBDebug_min
                   //Serial.println(""); 
                   //Serial.println(p_time + " | Sensor " + String(scan_ids_mb) + " Abfrage"); 
                  #endif

              
              g_mb_sensor_abfrage[scan_ids_mb] = 1;   // Sensor abgefragt
              client_id = scan_ids_mb;           

                  MB.setTimeout(500);
                  ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                  Error err = n.getError();
                  ModbusError me(err);
                  if (err != SUCCESS) {
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    g_mb_tracer_radon[client_id] = 0;     // n ok
                    g_mb_tracer_online[client_id] = 0;     // Sensor nicht gefunden
                    g_mb_tracer_online_fail[client_id] ++;
                    if(g_mb_tracer_online_fail[client_id] >= 2){g_mb_tracer_online_fail[client_id] = 2;}
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage abbruch"); 
                    mb_tracer_number ++;
                  }else{
                    //--- ABFRAGE FUNKTION Radon -----
                    Serial.print(p_time + " | Sensor : ");   
                    Serial.printf("%d : %s\n", client_id, (const char *)me);
                    MB.setTimeout(resp_tim_out);
                    Error errd = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 2); 
                    ModbusError me(errd);
                    g_mb_tracer_radon[client_id] = 1;     // ok
                    g_mb_tracer_online[client_id] = 1;     // Sensor gefunden
                     g_mb_tracer_online_fail[client_id] = 0;
                    Serial.println(p_time + " | Sensor  " + String(client_id) + " Abfrage..."); 
                  }
          }
          //------------------------------------------------------------------------- 



          //------------------------------------------------------------  
          if(mb_tracer_number == 21){
             
             mb_tracer_number = 22;

                //------------------------------------
                gLEDColorUpdateFlag = true;  
                gledUpdateFlag = true;
                gSensordRadonFlag = true;  // Haupt bit für 15min abfrage
                //Serial.println("b gSensordRadonFlag: " + String(gSensordRadonFlag));
                //------------------------------------ 
            
                #ifndef mit_Mesh
                  gWerte3UpdateFlag = 3;
                #endif

                #ifndef mit_CO2
                  gWerte2UpdateFlag = 3;
                #endif
            
              //        radon                     co2                      mesh      
                if (gWerte1UpdateFlag == 3 && gWerte2UpdateFlag == 3 && gWerte3UpdateFlag == 3){
                  
                  if (minUpdateFlag == true){
                  
                    minUpdateFlag = false;
                    //MQTTFailUpdateFlag = true;
                    gcloudUpdateFlag = true; 
                    gGRAPHUpdateFlag = true; 
                    gSensorLogFlag = true;
                    gMQTTUpdateFlag = true;              
                  }

                }

                gGRAPHReadFlag = true;
                val_sensor_aktual = 11;

                //#ifdef MBDebug_master
                  //Serial.println(" "); 
                  //Serial.println("-->  Sensoren aktualisiert");  
                  //Serial.println(" ");
                //#endif 
                mb_werteaktual = "<span class='Stil5'>Sensor Daten aktuell</div>";


          }
          //-----------------------------------------------------------------

        }  
        //}   select_slave_scan == 0    //0= aus  1= scan start  2= ohne Scan 
        //-------- R E A D  S E N S O R S ---------------------------------------------------------  





    //------------------------------------------------------------------------
    if(p_inputmqmeshi == 0){
      g_mb_mesh = false; 
    }else{
      g_mb_mesh = true; 
    }

  
        //  Serial2.begin(mbus_baud, SERIAL_8N1, SERIAL2_RXPIN, SERIAL2_TXPIN);
        if (baud_chance > 0){
         
          esp_task_wdt_reset(); 
          switch(baud_chance)
           {
              case 0x0001:
                baud_chance = 0;
                Serial2.flush(); // wait for last transmitted data to be sent 
                mbus_baud = 9600;
                Serial.println(p_time + " | Change Baud " + String(mbus_baud));
                Serial2.begin(mbus_baud, SERIAL_8N1, SERIAL2_RXPIN, SERIAL2_TXPIN);
                while(Serial2.available()) Serial2.read();
                baud_chance = 0;
                return;
              case 0x0002:
                baud_chance = 0;
                Serial2.flush(); // wait for last transmitted data to be sent 
                mbus_baud = 19200;
                Serial.println(p_time + " | Change Baud " + String(mbus_baud));
                Serial2.begin(mbus_baud, SERIAL_8N1, SERIAL2_RXPIN, SERIAL2_TXPIN);
                while(Serial2.available()) Serial2.read();
                baud_chance = 0;
                return;
            }

        }         




    //-------------------------------------------------------------------
    if(g_mb_mesh == false){

        if (select_slave_scan == 2){   //0= aus  1= scan start  2= ohne Scan 
          select_slave_scan = 0;    //0= aus  1= scan start  2= ohne Scan 

          MB.setTimeout(500);
            ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
            Error err = n.getError();
            if (err == TIMEOUT) {
              p_inputsavebit_txt = "<span class='Stil6'>Sensor connect failed!</div>";
              abfr_mb_finish = 2;
              divstatus4 = divred; //bei Status
              sensor_mb_ok = 0;
              p_MB_scan_resault = "<span class='Stil6'>nothing found until ID: 0 </div>";
              p_MB_scan_resaulta = "<span class='Stil6'>nothing found until ID: 0 </div>";
              #ifdef MBDebug
              Serial.println("READ_HOLD_REGISTER  --  Sensor nicht erreichbar");
              #endif 
              g_mb_sensor_online = false;
              // log_list[log_list_count] = String(p_time) + " | Modbus: Radon Sensor connect failed!";
              #ifdef MBDebug_min
                Serial.println(p_time + " | Modbus Radon Sensor connect failed! | ID: " + String(client_id));
              #endif
            } else {
              p_inputsavebit_txt = "Sensor Werte aktualisiert";
              #ifdef MBDebug
              Serial.println("READ_HOLD_REGISTER   --  Sensor erreichbar"); 
              #endif
              sensor_mb_ok = 1;
              g_mb_sensor_online = true;
 
                p_MB_scan_resault = "<span class='Stil5'>     0x01 </div>";
                p_MB_scan_resaulta = "<span class='Stil5'>     0x01 | Baud" + String(mbus_baud_last) + "</div>";



              #ifdef MBDebug_min
                Serial.println(p_time + " | Modbus Radon Sensor connect success | ID: " + String(client_id));
              #endif

                if (vanAktiveConfig == true){   //FAN aktiv
                  changeFanValue();
                }

              abfr_mb_finish = 1;
              divstatus4 = divgreen; //bei Status
            } 

        }
    
    




    
        if (select_slave_scan == 1){   //0= aus  1= scan start  2= ohne Scan 
            select_slave_scan = 0;  //0= aus  1= scan start  2= ohne Scan 

            esp_task_wdt_reset(); 
            
            #ifdef InfoDebug
                Serial.println(" ");
                Serial.println(p_time + " | SENSOR Scan Start | Baud " + String(mbus_baud));
            #endif
            //#ifdef MBDebug
              //Serial.println("mbus_baud ist: " + String(mbus_baud)); 
            //#endif

            uint16_t start_address = 1; //20
            uint16_t words = 1;
            uint16_t scan_server_t = 1;
            char dataStringb[50] = {0};
            
            // Timeout auf 500ms setzen - müsste reichen...
            MB.setTimeout(1000);

            for (uint32_t scan_server = 1; scan_server < slave_scan_until+1; scan_server++) {
              // Wir benutzen scan_server auch als Token!
              
              scan_server_t = scan_server;
              if(scan_server_t == 0){scan_server_t = 1;}
              //ModbusMessage n = MB.syncRequest(scan_server_t, (uint8_t)scan_server_t, READ_HOLD_REGISTER, start_address, words);
                #ifdef MBDebug_min
                  Serial.println(" ");
                  Serial.println(p_time + " | Suche Sensor Adressen - Adresse: " + String(scan_server_t));
                #endif


              ModbusMessage n = MB.syncRequest(1, (uint8_t)scan_server_t, READ_HOLD_REGISTER, start_address, words);
              Error err = n.getError();
              if (err == TIMEOUT) {
                //Serial.printf("%d antwortet nicht.\n", scan_server);
                p_MB_scan_resault = "<span class='Stil6'>nothing found until ID: " + String(scan_server_t) + "</div>";
                p_MB_scan_resaulta = "<span class='Stil6'>nothing found until ID: " + String(scan_server_t) + "</div>";

                  ModbusError me(err);
                  #ifdef MBDebug_min
                    Serial.print(p_time + " | Sensor Adresse: ");
                    Serial.printf("%d : %s\n", scan_server_t, (const char *)me);
                  #endif     

                g_mb_sensor_online = false; 

                divstatus4 = divred; //bei Status
              } else {

                ModbusError me(err);
                #ifdef MBDebug_min
                  Serial.print(p_time + " | Antwort von Sensor: ");
                  Serial.printf("%d : %s\n", scan_server_t, (const char *)me);
                #endif

                if(scan_server_t != scan_server){scan_server = scan_server_t;}
                  sprintf(dataStringb, "0x%02X",scan_server_t);  

                   p_MB_scan_resault = "<span class='Stil5'>    " + String(dataStringb) + "</div>";
                   p_MB_scan_resaulta = "<span class='Stil5'>    " + String(dataStringb) + " | Baud: " + String(mbus_baud_last) + "</div>";
 
                
                g_mb_sensor_online = true; 


                
                  //p_MB_scan_resault += " OK</div>";
                  divstatus4 = divgreen; //bei Status
                  if (vanAktiveConfig == true){   //FAN aktiv
                    changeFanValue();
                  }
                  //Serial.println(p_MB_scan_resault);
                  MB.setTimeout(resp_tim_out);
                  break;
                  
              }
            }
           
            Serial.println(" "); 
            //Serial.println("scan_server_t: " + String(scan_server_t) + "   slave_scan_until " + String(slave_scan_until)); 
           
            //    2                  10
            if(scan_server_t >= slave_scan_until && mbus_baud == 9600){
              baud_chance = 2; //19200
              //Serial.println("baud_chance_t: " + String(baud_chance)); 
              select_slave_scan = 1;  //neue runde wenn bei 9600 und 10 Sensoren nicht gefunden wurde   //0= aus  1= scan start  2= ohne Scan 
            }else{

              
              mbus_baud_last = 9600;  //dort was gefunden

              if(mbus_baud == 19200){  
                if(scan_server_t >= slave_scan_until){  
                  baud_chance = 1; //9600
                  mbus_baud_last = mbus_baud;
                  mbus_baud = 9600; // verstellt wirds oben
                  #ifdef MBDebug
                    Serial.println("mbus_baud1 chance: " + String(mbus_baud)); 
                  #endif
                }else{
                  slave_scan_until = 10;  // zuzrückändern von Admin Login
                  baud_chance = 1; //9600
                  mbus_baud_last = mbus_baud;  //dort was gefunden
                  mbus_baud = 9600; // verstellt wirds oben
                  #ifdef MBDebug
                    Serial.println("mbus_baud2 chance: " + String(mbus_baud)); 
                  #endif
                }
             }

            }

            client_id = scan_server_t; 
            
        } //select_slave_scan == 1

    }  // g_mb_mesh == false
   //----- select_slave_scan == 1 ---------------------------------------------
   
   

    //---------------------------------------------------------------------------
    if(g_mb_mesh == false){
          if (gRADONupdateFlag  == true){
              gRADONupdateFlag = false;
              
              esp_task_wdt_reset(); 
              
              mb_werteaktual = "Sensor value wait.."; //beim start erstmal error anzeigen
              val_sensor_aktual = 2;
              abfr_mb_finish = 0;
              //Serial.println(" "); 
              //Serial.println("--------------------------"); 
              //id_sec_time ++;
              //Serial.println(String(id_sec_time) + " Sekunde"); 
              
              //Read register

                //client_id ++;
                if (client_id == 0){client_id = 1;} 
                if (client_id >= 10){client_id = 1;} 
               
                //client_id = 1; 
                
                  #ifdef MBDebug_min
                  Serial.println(p_time + " | Fix Adresse set to: " + String(client_id)); 
                  #endif
                  

                MB.setTimeout(500);
                ModbusMessage n = MB.syncRequest(1, client_id, READ_HOLD_REGISTER, 0, 1);
                Error err = n.getError();
                if (err == TIMEOUT) {
                  p_inputsavebit_txt = "<span class='Stil6'>Sensor connect failed!</div>";
                  abfr_mb_finish = 2;
                  divstatus4 = divred; //bei Status
                  sensor_mb_ok = 0;
                  g_mb_sensor_online = false;
                  // log_list[log_list_count] = String(p_time) + " | Modbus: Radon Sensor connect failed!";
                  #ifdef MBDebug_min
                    Serial.println(p_time + " | Modbus. Radon Sensor connect failed! | Adresse: " + String(client_id) + " nicht erreichbar");
                  #endif
                } else {
                  p_inputsavebit_txt = "Sensor Werte aktualisiert";
                  #ifdef MBDebug
                  Serial.println("READ_HOLD_REGISTER | Sensor " + String(client_id) + "  erreichbar");
                  #endif
                  sensor_mb_ok = 1;
                  g_mb_sensor_online = true;
                  //log_list[log_list_count] = String(p_time) + " | Modbus: Radon Sensor connect success";
                  #ifdef MBDebug_min
                    Serial.println(p_time + " | Modbus. Radon Sensor connect success | Adresse: " + String(client_id));
                  #endif
                  abfr_mb_finish = 1;
                  divstatus4 = divgreen; //bei Status
                }

                  if (gSensorLogFlag == true){
                    gSensorLogFlag = false;
                    //update_log();
                  }

                if (abfr_mb_finish == 1) {
                
                
                  //---------------------
                  if (abfr_mb_finish_f4 == 0){

                      //--- ABFRAGE FUNKTION 4 -----
                      MB.setTimeout(resp_tim_out);
                      Error errd = MB.addRequest(1, client_id, READ_INPUT_REGISTER, 6, 5);    // void handleData(ModbusMessage response, uint32_t token) 
                      //rror errd = MB.addRequest(1, client_id, READ_INPUT_REGISTER, 0, 6);
                      //while (abfr_mb_finish <= 0) {
                      // Serial.println("------------------------ abfr --"); 
                        //Serial.println(errd); 
                        
                        if (errd!=SUCCESS ) {
                            //ModbusError e(err);
                            abfr_mb_finish = 2;
                            //LOG_E("aaaError creating request: %02X - %s\n", (int)e, (const char *)e);
                            p_inputsavebit_txt = "Sensor abfrage fehlgeschlagen";
                            sensor_mb_ok = 0;
                            g_mb_sensor_online = false;
                            #ifdef MBDebug
                            Serial.println("READ_INPUT_REGISTER 6, 5  --  Sensor abfrage fehlgeschlagen"); 
                            #endif
                            divstatus4 = divred; //bei Status
                            gWerte1UpdateFlag = 1;
                        }else{
                            //Serial.println("ok");
                            #ifdef MBDebug
                            Serial.println("READ_INPUT_REGISTER 6, 5  --  Sensor Werte aktualisiert"); 
                            #endif
                            g_mb_sensor_online = true;
                            p_inputsavebit_txt = "Sensor Werte aktualisiert";
                            sensor_mb_ok = 1;
                            abfr_mb_finish = 1;
                            divstatus4 = divgreen; //bei Status
                            gWerte1UpdateFlag = 3;
                        }

                  }
                      // nur jedes 10te mal Anfragen
                      abfr_mb_finish_f4 ++;
                      if (abfr_mb_finish_f4 > 10){abfr_mb_finish_f4 = 0;}
                    //----------------------------



                      //--- ABFRAGE FUNKTION 3 -----
                      MB.setTimeout(resp_tim_out);
                      Error errd2 = MB.addRequest(1, client_id, READ_HOLD_REGISTER, 20, 7);   //  void handleData(ModbusMessage response, uint32_t token) 

                      if (errd2!=SUCCESS ) {
                          //ModbusError e(err);
                          abfr_mb_finish = 2;
                          //LOG_E("aaaError creating request: %02X - %s\n", (int)e, (const char *)e);
                          p_inputsavebit_txt = "Sensor abfrage fehlgeschlagen";
                          sensor_mb_ok = 0;
                          g_mb_sensor_online = false;
                          #ifdef MBDebug
                          Serial.println("READ_HOLD_REGISTER 20, 7  --  Sensor abfrage fehlgeschlagen"); 
                          #endif
                          divstatus4 = divred; //bei Status
                          gWerte1UpdateFlag = 1;
                      }else{
                          //Serial.println("ok");
                          #ifdef MBDebug
                          Serial.println("READ_HOLD_REGISTER 20, 7  --  Sensor Werte aktualisiert"); 
                          #endif
                          g_mb_sensor_online = true;
                          p_inputsavebit_txt = "Sensor Werte aktualisiert";
                          sensor_mb_ok = 1;
                          abfr_mb_finish = 1;
                          divstatus4 = divgreen; //bei Status
                          gWerte1UpdateFlag = 3;
                      }

                  
                }

                #ifdef MBDebug
                    Serial.println("ABFRAGE Sensoren Ende");
                    Serial.println("--------------------------"); 
                #endif       
            


                gFrashupdateFlag = true;


          }
      }
    //----- gRADONupdateFlag = true ---------------------------------------------

   






  //-*------------------------------------------
  if (gACCESS_TOKENFlag == 0){ 
    if (p_inputmqoptions == "0"){  //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
      

      Preferences preferences;
      preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

      gACCESS_TOKENFlag = 1;  // provision fertig

      preferences.putUInt("p_token", gACCESS_TOKENFlag);                         //provision Variable speichern
      preferences.end(); 

    }  
  }  
  //-*------------------------------------------        


  //-----------------------------------------------------------------------------
  //------------------------  M Q T T ---- N E W ------------------------------ 
  //-----------------------------------------------------------------------------
  if (MQTT_VAR_NEW == true){    //MQTT neu   
      if(mqttdAktiveConfig == true){   //view MQTT Eingeschaltet
           if(gACCESS_TOKENFlag == 1){    // 1= provision  gemacht   
          
            if(fail2Timeinfo == false){  //false = jahr größer 2000 = Jahr OK 
                
                  if (g2_15minRadonFlag == true || gcharcount13read == true) {   //0/10/20/3040/50    //lesen beim booten
                        //Serial.println("mqttdAktiveConfig");
                        //delay(1000);
        
                    //----------------------------------------------------------------
                    if(gcharcount13read == true){  //lesen beim booten
                      gcharcount13read = false;
                        if (p_inputmqoptions == "1"){       //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
                          // erst mal lesen was in der Datei ist.
                          datei_lesen_line13();
                          charcount13_w = charcount13;
                          must_transfer3 = charcount13_w;
                        }
                        if (p_inputmqoptions == "0"){       //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
                          // erst mal lesen was in der Datei ist.
                          datei_lesen_line14();
                          charcount14_w = charcount14;
                          must_transfer4 = charcount14_w;
                          datei_lesen_line15();
                          charcount15_w = charcount15;
                          must_transfer5 = charcount15_w;
                        }
        
                        #ifdef MQTT_DEBUG_last
                          Serial.println("--> " + p_time + " | " + String(must_transfer3) + " MQTT Mesh Zeilen gespeichert."); 
                        #endif
                    }
                    //----------------------------------------------------------------
        
                      
                        if (g2_15minRadonFlag == true) {    //Sensor abgefragt
                            g2_15minRadonFlag = false;
        
                            #ifdef MQTT_DEBUG_last
                              Serial.println("-->  " + p_time + " | MQTT Mesh 10min abfrage."); 
                            #endif
        
                            if (p_inputmqoptions == "1"){       //0 = Adafruit [user/pwd]    1 = Thingsboard [Token] 
                              // erst mal lesen ob was in der Datei ist.
                              datei_lesen_line13();
                              charcount13_w = charcount13;
                              must_transfer3 = charcount13_w;
                            }
                            if (p_inputmqoptions == "0"){       //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
                              // erst mal lesen was in der Datei ist.
                              datei_lesen_line14();
                              charcount14_w = charcount14;
                              must_transfer4 = charcount14_w;
                              datei_lesen_line15();
                              charcount15_w = charcount15;
                              must_transfer5 = charcount15_w;
                            }
        
                              #ifdef MQTT_DEBUG_last
                                Serial.println("-->  [APP] min Free memory  : " + String(esp_get_minimum_free_heap_size()) + " bytes");
                              #endif
        
                          //-----------------------------------------------------------         
                            if (p_inputmqoptions == "1"){       //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
                              #ifdef MQTT_DEBUG_last
                                Serial.println("-->  " + p_time + " | " + String(must_transfer3) + " MQTT Mesh Zeilen gespeichert."); 
                              #endif
                  
                              Preferences preferences;
                              preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                              g13FileRead = preferences.getUInt("p_13file", 0);     // in datei gespeicherte zeilen lesen   //lese ab dieser zeile 
                              preferences.end(); 
                              must_transfer3 = must_transfer3 - g13FileRead;
                              #ifdef MQTT_DEBUG_last
                                Serial.println("-->  " + p_time + " | ab der Zeile " + String(g13FileRead) + " lesen.");  
                                Serial.println("-->  " + p_time + " | lese " + String(must_transfer3) + " MQTT Mesh Zeilen.");  
                              #endif  
                            }
                          //-----------------------------------------------------------     
                          //-----------------------------------------------------------         
                            if (p_inputmqoptions == "0"){       //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
                              #ifdef MQTT_DEBUG_last
                                Serial.println("-->  " + p_time + " | " + String(must_transfer4) + " MQTT Zeilen gespeichert."); 
                                Serial.println("-->  " + p_time + " | " + String(must_transfer5) + " MQTT Zeilen gespeichert."); 
                              #endif
                  
                              Preferences preferences;
                              preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                              g14FileRead = preferences.getUInt("p_14file", 0);     // in datei gespeicherte zeilen lesen   //lese ab dieser zeile 
                              g15FileRead = preferences.getUInt("p_15file", 0);     // in datei gespeicherte zeilen lesen   //lese ab dieser zeile 
                              preferences.end(); 
                              must_transfer4 = must_transfer4 - g14FileRead;
                              must_transfer5 = must_transfer5 - g15FileRead;
        
        
                              #ifdef MQTT_DEBUG_last
                                Serial.println("-->  " + p_time + " | ab der Zeile " + String(g14FileRead) + " lesen.");  
                                Serial.println("-->  " + p_time + " | lese " + String(must_transfer4) + " MQTT Zeilen.");  
                                Serial.println("-->  " + p_time + " | ab der Zeile " + String(g15FileRead) + " lesen.");  
                                Serial.println("-->  " + p_time + " | lese " + String(must_transfer5) + " MQTT Zeilen.");  
                              #endif  
                            }
                          //-----------------------------------------------------------                          
        
                          
                            if (!client.connected()) 
                            {
        
                      
                                #ifdef MQTT_DEBUG
                                  Serial.println(String(p_time) + " | MQTT b Start Reconnect");
                                #endif
        
                                reconnect();
        
                                #ifdef MQTT_DEBUG
                                  //Serial.println(String(p_time) + " | MQTT bb Start Reconnect");
                                #endif
        
                                if (gMQTTConnectFlag != true){  //nicht erfolgreich verbunden nach void reconnect
                                    if (mqtt_con_err2 == true){  // nach 5 Versuchen
                                    // log_list[log_list_count] = String(p_time) + " | MQTT: " + String(p_inputmqserver) + " connect error!";
                                      mq_werteaktual = "<span class='Stil6'>MQTT connect error</div>"; 
                                      mqtt_con_err2 = false;
                                      divstatus2 = divred;  // Status
                                      mQtt_aktiv = " class='Stil1b' ";//rot
                                                        
                                    }else{
                                      
                                      divstatus2 = divred;  // Status
                                      mq_werteaktual = "<span class='Stil6'>MQTT Reconnect</div>"; 
                                      mQtt_aktiv = " class='Stil1b' "; //rot
                                    }
                                }else{
                                    // hier wurde gMQTTUpdateFlag = true gesetzt
                                    //log_list[log_list_count] = String(p_time) + " | MQTT: " + String(p_inputmqserver) + " Connect";
                                    mq_werteaktual = "<span class='Stil6'>MQTT Connect</div>"; 
                                    mQtt_aktiv = " class='Stil1a' "; //grün
                                    divstatus2 = divgreen;  // Status
                                }
                                //update_log();
                                
                          
        
                            }//else{    
        
                            if (client.connected()){ 
        
                                      //client.loop();
                                    
                                    mq_werteaktual = "<span class='Stil5'>MQTT Mesh Connected</div>"; 
                                    mQtt_aktiv = " class='Stil1a' "; //grün
                                    #ifdef MQTT_DEBUG_min
                                      Serial.println(p_time + " | MQTT Connect"); 
                                    #endif
                                    #ifdef MQTT_DEBUG
                                      Serial.println("-->  MQTT Mesh Start publish!");
                                      Serial.println("-->  MQTT Variante: " + p_inputmqoptions);
                                    #endif
                                    divstatus2 = divgreen; // Status
        
                                    p_inputmqtopic.toCharArray(p_inputmqtopicc, 50);
                                    p_inputmqtopic1.toCharArray(p_inputmqtopic1c, 50);
                                    p_inputmqtopic2.toCharArray(p_inputmqtopic2c, 50);
                                    //p_inputmqtopic3.toCharArray(p_inputmqtopic3c, 50);  // nur Adafruit wird später umgeladen
        
                                    
        
        
        
        
                                  //**********************************************************************************
                                  if (p_inputmqoptions == "1"){         //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
                                    if (gACCESS_TOKENFlag == 1){      // 1= provision  gemacht  
        
       
        
                                        char attributes[1000];
                                        //gALast_DataentryFlag = charcount8;
        
                                        if(must_transfer3>0){
                                            gLostvaluesFlag = true;
                                        }else{
                                            gLostvaluesFlag = false;
                                        }
        
                                        //-------------------------------------------
                                        
        
        
                                      if(gLostvaluesFlag == true){
                                          
                                            //==================================            
                                              String data;
                                              uint16_t zeilenZaehler = 0;
                                              int ir13 = 0;
                                              File file = SPIFFS.open(dateiGr13, "r");
                                        
                                        
                                  
                                              while(file.available()) {
                                        
                                        
                                                data = file.readStringUntil('\n'); // lesen bis Zeilenumbruch...
                                        
                                                if(ir13 >= g13FileRead){    // erst ab bestimmter Zeile lesen
                                                
                                                  data.toCharArray(attributes, 1000);
                                                  client.publish(publishTopic, attributes);
                                                  
                                                  #ifdef MQTT_DEBUG
                                                  Serial.println("--> MQTT Topic   : " + String(publishTopic));
                                                  Serial.println("--> MQTT publish: " + String(attributes));
                
                                                  Serial.println(p_time + " | MQTT Mesh publish OLD Data: " + data);
                                                  #endif
                                                  
                                                
                                                } // ir13 >= g13FileRead
                                                
                                              esp_task_wdt_reset();  
                                              
                                              ir13++;
                                              zeilenZaehler++;                               
                                          
                                              }     // while(file.available())
        
                                            if(g_mb_mesh == true){      // mesh
                                              lesen_next_things_mesh();
                                            }else{
                                              lesen_next_things();    // jetzt noch die letze Datenreihe übertragen
                                            }
                                            things_list_t.toCharArray(attributes, 1000);
                                            client.publish(publishTopic, attributes);
                                            #ifdef MQTT_DEBUG
                                                Serial.println(p_time + " | MQTT Mesh publish last Data: " + String(publishTopic) + " | " + things_list_t);
                                            #endif

                                                serverAttributeDevice();

                                                clientAttributeDevice();
              
                                            
                                          
                                          
                                          }else{  // gLostvaluesFlag == true  lost Daten
        
        
                                                if(g_mb_mesh == true){      // mesh
                                                  lesen_next_things_mesh();
                                                }else{
                                                  lesen_next_things();    // jetzt noch die letze Datenreihe übertragen
                                                }
                                              things_list_t.toCharArray(attributes, 1000);
                                              client.publish(publishTopic, attributes);
                                              #ifdef MQTT_DEBUG
                                                  Serial.println(p_time + " | MQTT Mesh publish new Data: " + things_list_t);
                                              #endif

                                               serverAttributeDevice();
        
                                               clientAttributeDevice();
        
        
                                          }    // gLostvaluesFlag == false   nur aktuelle Daten übertragen
                                          
                                        #ifdef MQTT_DEBUG
                                        Serial.println("-->  | " + String(g13FileRead) + " | " + String(must_transfer3)  + " | " + String(charcount13_w));                  
                                        #endif
                                        //----------------------------------------------  
                                        // valm1
                                             
         



                                                                      
                                              #ifdef InfoDebug
                                              Serial.println(p_time + " | MQTT Mesh publish");
                                              Serial.println(" ");
                                               #endif
                                              //#ifdef MQTT_DEBUG
                                              //Serial.println(p_time_mesh_uplod );
                                              //#endif
        
                                      //----------------------------------------------  
                                        // alles übertragen
                                        
                                        //g_abort_cloudlist_2 = false;   // kein abbruch beim schreiben
                                        //g_write_cloudlist = false;      //schreiben ist beendet
                                    
                                        File filew = SPIFFS.open(dateiGr13, "w");
                                        #ifdef MQTT_DEBUG
                                          Serial.println("Datei " + String(dateiGr13) + " löschen. MQTT Mesh alles übertragen.");
                                        #endif
                                        filew.close(); 
                                
                                            g13FileRead = 0; 
                                            count13fehlt = 0; 
                                            must_transfer3 = 0; 
                                            charcount13_w = 0; 
                                            if(g13FileRead >500){g13FileRead=500;}
                                            Preferences preferences;
                                            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                                           
                                            preferences.putUInt("p_13file", g13FileRead);            //schreibe      ab dieser zeile lesen
        
                                            p_time_mesh_uplod = p_time;
                                            preferences.putString("p_mqtupl", p_time_mesh_uplod);         //Variable counter unter "Datei"  speichern
        
                                            preferences.end();  
                                          //----------------------------------------------  
                                                                
        
        
                                  }  // 1= provision  gemacht  
                                  
                                  }   //1 = Thingsboard [Token]
                                  //**********************************************************************************
        
        
        
                                  //**********************************************************************************
                                  if (p_inputmqoptions == "0"){         //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
           
        
                                        //char attributes[1000];
                                        //gALast_DataentryFlag = charcount8;
        
                                        #ifdef MQTT_DEBUG
                                          Serial.println("--> MQTT Variante: " + p_inputmqoptions);
                                        #endif
      
                                        uint32_t positionlen = p_inputmqtopic.length();
                                        if (positionlen >= 1) { 
                                        #ifdef MQTT_DEBUG
                                          Serial.println("--> MQTT Topic: " + p_inputmqtopic);
                                          Serial.println("--> MQTT Value: " + String(mb_radon_ist_word));
                                        #endif
                                          client.publish(p_inputmqtopicc, String(mb_radon_ist_word).c_str());
                                        }
                                        #ifdef CO2_on
                                          uint32_t positionlen1 = p_inputmqtopic1.length();
                                          if (positionlen1 >= 1) { 
                                          #ifdef MQTT_DEBUG
                                          Serial.println("--> MQTT Topic: " + p_inputmqtopic1);
                                          //Serial.println("--> MQTT Value: " + String(eco2val1));
                                          Serial.println("--> MQTT Value: " + String(mb_radon_eintrarge));
                                          #endif
                                            #ifdef CO2_on
                                              client.publish(p_inputmqtopic1c, String(mb_radon_eintrarge).c_str());  
                                            #else
                                              client.publish(p_inputmqtopic1c, String(eco2val1).c_str());  
                                            #endif
                                          }
                                          uint32_t positionlen2 = p_inputmqtopic2.length();
                                          if (positionlen2 >= 1) { 
                                          #ifdef MQTT_DEBUG
                                            Serial.println("--> MQTT Topic: " + p_inputmqtopic2);
                                            #ifdef CO2_on
                                            Serial.println("--> MQTT Value: " + mb_Seriennummer);
                                            #else
                                            Serial.println("--> MQTT Value: " + String(etvocval2));
                                            #endif
                                          #endif
                                            #ifdef CO2_on
                                                client.publish(p_inputmqtopic2c, mb_Seriennummer.c_str());
                                            #else
                                                client.publish(p_inputmqtopic2c, String(etvocval2).c_str());
                                            #endif
                                          }
                                        #endif
      
                                        if(p_inputmqserver == "io.adafruit.com"){
      
                                          int Suche1 = p_inputmqtopic2.indexOf("."); 
                                          //Serial.println("Suche1: " + String(Suche1));
                                          String topicresault = p_inputmqtopic2.substring(0, Suche1-0); 
                                          //Serial.println("topicresault: " + topicresault);
      
                                          p_inputmqtopic3 = topicresault;
                                          p_inputmqtopic3 += ".deviceid";
                                          p_inputmqtopic3.toCharArray(p_inputmqtopic3c, 50);
      
                                          client.publish(p_inputmqtopic3c, device_id_s.c_str());
                                        }
                                        
                                        #ifdef MQTT_DEBUG  
                                        Serial.println("--> MQTT publish finish");
                                        #endif
                                        //log_list[log_list_count] = String(p_time) + " | MQTT: " + String(p_inputmqserver) + " publish succses!";
                                        //update_log();
                                          

                                        //----------------------------------------------  
                                          
                                              #ifdef InfoDebug
                                              Serial.println(p_time + " | MQTT publish");
                                              #endif
        
                                      //----------------------------------------------  
                                        // alles übertragen
       
                                  
                                  }   //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
                                  //**********************************************************************************
        

              
              
                          }   //!client.connected())
                          
                              #ifdef MQTT_DEBUG_last
                                Serial.println("-->  [APP] min Free memory  : " + String(esp_get_minimum_free_heap_size()) + " bytes");
                              #endif
                          
                        }  // gMQTTUpdateFlag == true        //Sensor abgefragt
                        
                        
                    }     //0/10/20/3040/50    //lesen beim booten            divstatus2 = divgrau;  // Status
        
        
        
               
            }   //if(fail2Timeinfo == false){  //false = jahr größer 2000 = Jahr OK 
            
          }else{         //1= provision  gemacht 
               divstatus2 = divgrau;  // Status
          }      //1= provision  gemacht 
     
      }else{         //view MQTT Eingeschaltet
           divstatus2 = divgrau;  // Status
      }      //view MQTT Eingeschaltet
      
  }    // MQTT_VAR_NEW == true
  //-----------------------------------------------------------------------------
  //------------------------  M Q T T ---- N E W ------------------------------ 
  //-----------------------------------------------------------------------------
    
    
    
    









     //-----------------------------------------------------------------------------
     //------------------  C L O U D -------------------------
     #ifdef  Radoncloud
     if (p_sett08 == 1){  //view Cloud Eingeschaltet  
        if (cloudAktiveConfig == true) {   //Cloud Eingeschaltet

            p_tr_hidden3 = p_tr_hidden1;


        }else{
          divstatus1 = divgrau;   // Status
          p_tr_hidden3 = p_tr_hidden0;
        }

      }else{
        divstatus1 = divgrau;   // Status
        p_tr_hidden3 = p_tr_hidden0;
      }
      #endif
    //-------------------------------------------------------------------------------



    //if(udp.connect(IPAddress(192,168,1,100), 1234)) {

    //}








    //-------------------------------------------------------------------------------
  #ifdef Freshbox 

    //======= U D P 2 ===========================================================================================
    //======= U D P   ===========================================================================================
    if (freshdAktiveConfig == true && pauseWebpage <= 1) {   // Freshbox Eingeschaltet   

      freshdUDPIncomming = false;  



        //***************************************************
           // if there's data available, read a packet
          
          packetSize = 0;
          if(pauseWebpage == 0){
            packetSize = udp2.parsePacket();
          }

          if(packetSize)
          {   

           // #ifdef Freshebug
            Serial.println("-- U D P 2 --");
           // #endif 

            #ifdef Freshebug
            Serial.print("From ");
            #endif 
            IPAddress remoteIp = udp2.remoteIP();
            #ifdef Freshebug
            Serial.print(remoteIp);
            Serial.print(", port ");
            Serial.println(udp2.remotePort());
            #endif
            // read the packet into packetBufffer
            int len = udp2.read(packetBuffer,255);
            if (len >0) packetBuffer[len]=0;

              receive_data_size = packetSize;
            
              for (int i=0;i<receive_data_size;i++){
                receive_data[i]= *(packetBuffer+i);
              }
             
              //char buf[receive_data_size + 1] = {};
              //byte bufb[receive_data_size + 1] = {};

              //memcpy(bufb, packetBuffer, receive_data_size);
            
              //memcpy(buf, packetBuffer, receive_data_size);
              //String s = String(buf);

               
                #ifdef Freshebug3
                Serial.print("<--in- ");

                for (int i=0;i<receive_data_size;i++){
                    //receive_data[i]= *(packet.data()+i);
                    Serial.print(receive_data[i],HEX);
                    Serial.print(" ");
                }
                
                 Serial.println();
                 #endif

            freshdUDPIncomming = true;     
          }
          //***************************************************


      //***************************************************
      //when there is a packet in the queue:
      //Serial.println(pauseWebpage);
      //delay(500); // creating a pause of 200 milliseconds
      //if(pauseWebpage == 0){
          if (udp.listen(localPort)) {
              //delay a little so as not to crash the queue
              //delay(1000);
              //Serial.println("UDP connected");
              //then deal with the packet
              udp.onPacket([](AsyncUDPPacket packet) {
                  
                  #ifdef Freshebug
                  Serial.println("-- U D P --");
                  #endif

                  receive_data_size = packet.length();


                  for (int i=0;i<receive_data_size;i++){
                    receive_data[i]= *(packet.data()+i);
                  }

                  //char buf[receive_data_size + 1] = {};
                  //byte bufb[receive_data_size + 1] = {};
                  //memcpy(bufb, packet.data(), receive_data_size);
                
                  //memcpy(buf, packet.data(), receive_data_size);

                  //memcpy(receive_data, packet.data(), receive_data_size);

                  //String s = String(buf);

                  //Serial.println("len: "+ String(receive_data_size));


                  p_inputfreship_temp = packet.remoteIP().toString(); ;


                  #ifdef Freshebug
                  Serial.print("UDP Packet Type: ");
                  Serial.print(packet.isBroadcast()?"Broadcast":packet.isMulticast()?"Multicast":"Unicast");
                  Serial.print(", From: ");
                  Serial.print(packet.remoteIP());
                  Serial.print(":");
                  Serial.print(packet.remotePort());
                  Serial.print(", To: ");
                  Serial.print(packet.localIP());
                  Serial.print(":");
                  Serial.print(packet.localPort());
                  Serial.print(", Length: ");
                  Serial.print(packet.length());
                  Serial.println();
                  Serial.print("Data: ");
                  #endif

                  

                    #ifdef Freshebug
                    Serial.print("<-in new- ");    // 0034003F
                    for(s_i = 0; s_i <= receive_data_size; s_i++)
                    {
                      Serial.print(receive_data[s_i],HEX);
                      Serial.print(" ");
                    }
                    Serial.println(" "); 
                    Serial.println();
                    #endif




                  
                  //reply to the client
                  //packet.printf("Got %u bytes of data", packet.length());

              
                  freshdUDPIncomming = true;  

                  //driveSpeed = udpSpeed.toInt();
                  //driveDir = udpDir.toInt();
                  //Serial.println(driveSpeed);
                  //then run the motor and the servo
                  //runMotor (driveDir, driveSpeed);
                  //delay(100);
              });

              //udp.print("Hello Server!");
          }
      //}
       //***************************************************


       //***************************************************
      if(freshdUDPIncomming == true){


          divstatus9 = divred;  // Status

          if(State_anf_schreib_ID_bit == true){
            fresh_werteaktual = "Freshbox ID Change aktiv";
          }else{
            fresh_werteaktual = "<span class='Stil6'>Freshbox connect error</div>";
          }

       if(check_protocol(receive_data, receive_data_size) == 1) // Prüfsumme
          {
             
              #ifdef Freshebug3

                Serial.println("freshdAktiveRead1: " + String(freshdAktiveRead1));  
                Serial.println("freshdAktiveRead2: " + String(freshdAktiveRead2));  
                Serial.println("freshdAktiveRead3: " + String(freshdAktiveRead3));  
                Serial.println("freshdAktiveRead4: " + String(freshdAktiveRead4));  
                Serial.println("freshdAktiveRead5: " + String(freshdAktiveRead5));  
                Serial.println("freshdAktiveRead: " + String(freshdAktiveRead));  
                Serial.println("ms7erg: " + String(ms7erg));  

              #endif  
              //--- alle Daten aktuell eingelesen -----
              if(freshdAktiveRead1 == true && freshdAktiveRead2 == true && freshdAktiveRead3 == true && freshdAktiveRead4 == true && freshdAktiveRead5 == true){
              
                freshdAktiveRead = true;

                ms7erg = millis()- ms7;
                ms7erg = ms7erg / 1000;
                ms7erg = ms7erg / 60;        

              } 
              //---------------------------------------
             
             
              #ifdef Freshebug
              Serial.println("CRC ok");
              #endif
              if(receive_data[2] == 0x02) // Protokolltyp
              {
                

                  if(memcmp(&receive_data[4], current_id, receive_data[3]) == 0){  // ID-Nummer check
                      State_ID_ok = true;
                  }else{
                      State_ID_ok = false;
                      if(State_anf_schreib_ID_bit == true){
                          State_ID_ok = true;
                      }
                  }
                  



                  //-------------------------------------------------------------------
                  if(State_ID_ok == true) // ID-Nummer check
                  {  
                  #ifdef Freshebug
                  Serial.println("ID-Nummer ok");
                  #endif
                  State_Leseanforderung_bit = false;
                  
                  if(State_anf_schreib_ID_bit == true){
                    fresh_werteaktual = "Freshbox ID Change aktiv";
                  }else{
                    fresh_werteaktual = "<span class='Stil5'>Freshbox Connected</div>";
                  }
                  
                  divstatus9 = divgreen;  // Status
                  

                          uint16_t jump_size = 0, page = 0, param, param_size, r_pos;
                          uint8_t flag_check_func = 0, BGCP_func;

                          r_pos = 4 + receive_data[3];
                          r_pos += 1 + receive_data[r_pos]; // Position im Array, wo FUNC-Block startet
                          //Serial.println("Position: " + String(r_pos) );

                          //********************* FUNC und DATA *********************//
                          for(; r_pos < receive_data_size - 2; r_pos++)
                          {
                              //=========== Spezialbefehle ===========//
                              param_size = 2;
                              //=== Neue Funktionsnummer
                              
                              //Serial.println("Funktionsnummer: " + String(receive_data[r_pos]));
                              if((flag_check_func == 1) || (receive_data[r_pos] == BGCP_CMD_FUNC))
                              {
                                  #ifdef Freshebug2
                                  Serial.println("BGCP_CMD_FUNC || flag_check_func");
                                  #endif
                                  if(receive_data[r_pos] == BGCP_CMD_FUNC)
                                  {
                                  #ifdef Freshebug2
                                  Serial.println("r_pos: " + String(r_pos) + " | " + String(receive_data[r_pos]));
                                  #endif
                                  }
                                  //r_pos++;
                                  flag_check_func = 0;
                                  BGCP_func = receive_data[r_pos];
                              r_pos++;
                              //Serial.println("r_pos " + String(r_pos));

                                  if(BGCP_func != BGCP_FUNC_RESP) // Wenn die Funktionsnummer nicht unterstützt wird
                                  {
                                  #ifdef Freshebug2
                                  Serial.println("Funktionsnummer nicht unterstützt: " + String(BGCP_func));
                                  #endif
                                  }
                                  //Serial.println("weiter" + String(r_pos));  
                                  break;
                                  continue;
                         

                              }
                              //=== Neuer High-Byte-Wert für Parameternummer
                              else if(receive_data[r_pos] == BGCP_CMD_PAGE)
                              {
                                #ifdef Freshebug2
                                Serial.println("Neuer High-Byte-Wert für Parameternummer" + String(receive_data[r_pos]));
                                #endif
                                page = receive_data[++r_pos];
                                continue;
                              }

                              //=== neuer Wert der Parametergröße
                              else if(receive_data[r_pos] == BGCP_CMD_SIZE)
                              {
                                #ifdef Freshebug2
                                Serial.print("neuer Wert der Parametergröße");
                                #endif
                                param_size = receive_data[++r_pos];
                                r_pos++;
                                #ifdef Freshebug2
                                Serial.println(" | größe: " + String(param_size));
                                #endif
                              }
                              //=== falls der Parameter nicht unterstützt wird
                              else if(receive_data[r_pos] == BGCP_CMD_NOT_SUP)
                              {
                                  r_pos++;
                                  //******* Verarbeitung der nicht unterstützten Parameter ******//
                                  param = (uint16_t)(page << 8) | (uint16_t)(receive_data[r_pos]);
                                  #ifdef Freshebug2
                                  Serial.println("Verarbeitung der nicht unterstützten Parameter:  " + String(param));
                                  #endif
                                  switch(param)
                                  {
                                    case 0x0001:
                                    break;
                                    case 0x0002:
                                    break;
                                  //...
                                  }
                                  //***********************//
                                  continue;
                              }
                              jump_size = param_size;
                              //===================================//

                                //-----------------Data mit duck auf Zeile im Handy-----------------------------------------------
                                //Block: 0x1 | Data: 185
                                //State_Power: 185
                                //Block: 0xA3 | Data: 13
                                //UDP Packet Type: Broadcast, From: 192.168.178.140:57533, To: 255.255.255.255:4000, Length: 31
                                //Data: <-in new- FD FD 2 10 30 30 33 34 30 30 33 46 35 39 35 32 35 33 30 37 4 31 31 31 31 1 B9 92 A3 D 6 0
                          
                                //-------------------------------------------------------------------------------------------------
                                        
                              #ifdef Freshebug2
                                Serial.println("Parametergröße:  " + String(jump_size) + " | nächstes Byte: " + String(receive_data[r_pos]));
                              #endif
                              //******* Verarbeitung der unterstützten Parameter ******//
                              param = (uint16_t)(page << 8) | (uint16_t)(receive_data[r_pos]);
                              //Serial.println("Block: " + String(param) + " | Data: " + String(receive_data[r_pos+1]));
                              receive_data_01 = receive_data[r_pos+1];
                              #ifdef Freshebug2
                              Serial.print("Block: 0x");
                              Serial.print(param,HEX);
                              Serial.println(" | Data: " + String(receive_data_01));
                              #endif

                              switch(param)
                              {
                                  //---------------------------------------------
                                  case 0x0001:
                                  if(State_Leseanforderung_bit == true){
                                    State_Power = receive_data_01;
                                    if (State_Power == 1)
                                    {
                                      State_Power_s = "EIN";
                                    }else{
                                      State_Power_s = "AUS";
                                    }
                                    freshdAktiveRead1 = true;

                                    if(m_analge_war_aus == true){ //Löfter wurde eingeschaltet  jetzt lüfter steuern
                                      m_analge_war_aus = false;
                                      gFrashupdateFlag = true;
                                    }

                                    #ifdef Freshebug3
                                    Serial.println("State_Power: " + String(State_Power));
                                    #endif

                                  }else{
                                    #ifdef Freshebug3
                                    if(State_anf_schreib_ID_bit == true){  // nur im Learn mode
                                      Serial.println("--> Empfange Config Daten vom Lüfter: ");
                                    }else{
                                      Serial.println("--> Empfange Config Daten vom Lüfter, aber nicht im learn mode: "); 
                                    }
                                    #endif
                                  }
                                  break;

                                  //---------------------------------------------
                                  case 0x0002:
                                  if(State_Leseanforderung_bit == true){
                                    State_Speed_mode = receive_data_01;
                                    val5 = State_Speed_mode;
                                    if(State_Speed_mode >= 6){
                                      State_Speed_mode = 0;
                                      val5 = 0;
                                    }

                                    freshdAktiveRead2 = true;
                                    ms7 = millis(); 
                                    #ifdef Freshebug3
                                    Serial.println("State_Speed_mode: " + String(State_Speed_mode));
                                    Serial.println("letzte Aktualisierung: " + String(ms7erg) + " min");
                                    #endif
                                  }

                                  break;

                                  //---------------------------------------------
                                  case 0x0007:
                                  if(State_Leseanforderung_bit == true){
                                   State_Timer_mode = receive_data_01;
                                   freshdAktiveRead3 = true;
                                    if (State_Timer_mode == 1)
                                    {
                                      State_Timer_s = "EIN";
                                    }else{
                                      State_Timer_s = "AUS";
                                    }
                                    #ifdef Freshebug3
                                    Serial.println("State_Timer_mode: " + String(State_Timer_mode));
                                    #endif
                                  }

                                  break;

                                  //---------------------------------------------
                                  case 0x0008:
                                  if(State_Leseanforderung_bit == true){
                                    State_Timer_Speed_mode = receive_data_01;
                                    val6 = receive_data_01;
                                    freshdAktiveRead4 = true;
                                    if(State_Timer_Speed_mode >= 6){
                                      State_Timer_Speed_mode = 0;
                                      val6 = 0;
                                    }
                                    #ifdef Freshebug3
                                    Serial.println("State_Timer_Speed_mode: " + String(State_Timer_Speed_mode));
                                    #endif
                                  }

                                  break;


                                  //---------------------------------------------
                                  case 0x0072:
                                  if(State_Leseanforderung_bit == true){
                                   State_Calender_mode = receive_data_01;
                                   freshdAktiveRead5 = true;
                                    if (State_Calender_mode == 1)
                                    {
                                      State_Calender_s = "EIN";
                                    }else{
                                      State_Calender_s = "AUS";
                                    }

                                    if(m_analge_war_kalendermodus == true){ //Kalendermodus wurde ausgeschaltet jetzt lüfter steuern
                                      m_analge_war_kalendermodus = false;
                                      gFrashupdateFlag = true;
                                    }
                                    #ifdef Freshebug3
                                    Serial.println("State_Calender_mode: " + String(State_Calender_mode));
                                    #endif

                                  }

                                  break;

                                  //---------------------------------------------
                                  case 0x0073:
                                  if(State_Leseanforderung_bit == true){
                                    State_Calender_Speed_mode = receive_data_01;
                                    val7 = receive_data_01;
                                    freshdAktiveRead6 = true;
                                    if(State_Calender_Speed_mode >= 6){
                                      State_Calender_Speed_mode = 0;
                                      val7 = 0;
                                    }
                                    #ifdef Freshebug3
                                    Serial.println("State_Calender_Speed_mode: " + String(receive_data_01));
                                    #endif
                                  }

                                  break;

                                  //---------------------------------------------
                                  case 0x0077:
                                    #ifdef Freshebug2
                                      Serial.println("Parametergröße:  " + String(jump_size));
                                    #endif
                                  if(State_Leseanforderung_bit == true && jump_size == 6){
                                    State_Zeitplan_b1_mode = receive_data_01;
                                    receive_data_pos = r_pos;
                                    receive_data_pos = receive_data_pos +2;
                                    State_Zeitplan_b2_mode = receive_data[receive_data_pos];
                                    receive_data_pos++;
                                    State_Zeitplan_b3_mode = receive_data[receive_data_pos];
                                    receive_data_pos++;
                                    State_Zeitplan_b4_mode = receive_data[receive_data_pos];
                                    receive_data_pos++;
                                    State_Zeitplan_b5_mode = receive_data[receive_data_pos];
                                    receive_data_pos++;
                                    State_Zeitplan_b6_mode = receive_data[receive_data_pos];
                                  }
                                    #ifdef Freshebug3
                                    Serial.print("DATA: ");
                                    Serial.print(State_Zeitplan_b1_mode, HEX);
                                    Serial.print("  ");
                                    Serial.print(State_Zeitplan_b2_mode, HEX);
                                    Serial.print("  ");
                                    Serial.print(State_Zeitplan_b3_mode, HEX);
                                    Serial.print("  ");
                                    Serial.print(State_Zeitplan_b4_mode, HEX);
                                    Serial.print("  ");
                                    Serial.print(State_Zeitplan_b5_mode, HEX);
                                    Serial.print("  ");
                                    Serial.println(State_Zeitplan_b6_mode, HEX);
                                    #endif
                                  break;


                                  //---------------------------------------------
                                  case 0x0068:
                                  if(State_Leseanforderung_bit == true){
                                  State_TempRegelung_mode = receive_data_01;
                                  }
                                  #ifdef Freshebug2
                                  Serial.println("State_TempRegelung_mode: " + String(State_TempRegelung_mode));
                                  #endif
                                  break;

                                  //---------------------------------------------
                                  case 0x0081:
                                  if(State_Leseanforderung_bit == true){
                                  State_Heizregisters_mode = receive_data_01;
                                  }
                                  #ifdef Freshebug2
                                  Serial.println("State_Heizregisters_mode: " + String(State_Heizregisters_mode));
                                  #endif
                                  break;

                                  //---------------------------------------------
                                  case 0x00F0:
                                  if(State_Leseanforderung_bit == true){
                                  State_Umluftklappe_mode = receive_data_01;
                                  }
                                  #ifdef Freshebug2
                                  Serial.println("State_Umluftklappe_mode: " + String(State_Umluftklappe_mode));
                                  #endif
                                  break;

                                  //---------------------------------------------
                                  case 0x00A3:

                                      if(State_anf_schreib_ID_bit == true){  // nur im Learn mode
                                          //Serial.println("0x00A3: " + String(receive_data_01));
                                          #ifdef Freshebug2
                                          Serial.println("Jetzt  überschreiben der Daten ");
                                          #endif

                                                      
                                          receive_d_len_id = receive_data[3];
                                          //Serial.println("len ID "+ String(receive_d_len_id));   //16
                                          receive_d_pos_pwd = receive_d_len_id + 5;
                                          //Serial.println("pos PWD "+ String(receive_d_pos_pwd));  //21
                                          receive_d_len_pwd = receive_data[receive_d_pos_pwd-1];
                                         ///Serial.println("len PWD "+ String(receive_d_len_pwd));  //4

                                          //Serial.print("ID : ");
                                          receive_d_len_id = receive_d_len_id + 3; //19
                                          strF1 = "";
                                          for(s_i = 4; s_i <= receive_d_len_id; s_i++)
                                          {
                                            strF1 += String((char)receive_data[s_i]);
                                            //Serial.print(receive_data[s_i],HEX);
                                            //Serial.print(" ");
                                          }
                                          p_inputfreshid = strF1;
                                          //Serial.println(" "); 
                                          //Serial.print("PWD: ");
                                          receive_d_start_pwd = receive_d_pos_pwd + receive_d_len_pwd; //25
                                          receive_d_start_pwd = receive_d_start_pwd -1;

                                          strF2 = "";
                                          for(s_i = receive_d_pos_pwd; s_i <= receive_d_start_pwd; s_i++)   //21  24
                                          {
                                            strF2 += String((char)receive_data[s_i]);
                                            //Serial.print(receive_data[s_i],HEX);
                                            //Serial.print(" ");
                                          }
                                          p_inputfreshpwd = strF2;
                                          //Serial.println(" "); 

                                         #ifdef Freshebug2
                                          Serial.println(p_inputfreshid);                                     
                                          Serial.println(p_inputfreshpwd); 
                                         #endif


                                          State_anf_schreib_ID_bit = false;
                                          State_schreib_ID_bit = true;
                                      } 
                                  break;

                                  case 0x0006:
                                  State_Leseanforderung_mode = receive_data_01;
                                  #ifdef Freshebug2
                                  //Serial.print("Leseanforderung eingegangen: ");
                                  #endif
                                  if(State_Leseanforderung_mode == 0xFF){
                                    State_Leseanforderung_bit = true;
                                    #ifdef Freshebug2
                                    //Serial.print("-> Vars save ...");
                                    //Serial.println(" "); 
                                    #endif

                                    if(State_anf_schreib_ID_bit == false){

                                      if(p_inputfreship_temp != p_inputfreship){

                                        //Serial.println(p_inputfreship);
                                        //Serial.println(p_inputfreship_temp);
                                        p_inputfreship = p_inputfreship_temp;
                                        //WritefreshValue();
                                        State_schreib_ID_bit = true;

                                      }
                                   }
                                  }
                                  
                                  break;


                              }
                              //***********************//
                              r_pos += jump_size;
                          }
                          //***********************************************************//



                  }
              }
          }
  



          }

      //}
       //***************************************************

    } // Freshbox Eingeschaltet   

  #endif
    //-------------------------------------------------------------------------------





     //-----------------------------------------------------------------------------
     //------------------  P U H S H -------------------------
    #ifdef Pushover 

    if (pushAktiveConfig == true) {   //Push Eingeschaltet
     
       p_pushvaluei = p_pushvalue.toInt();
     
       if(gpushUpdateFlag_SR == false){
         if(push_val_vorgabe > p_pushvaluei){
            gpushUpdateFlag = true;
            gpushUpdateFlag_SR = true;  // Sperre aktiv
         }
       }

       if(push_val_vorgabe < p_pushvaluei){
          gpushUpdateFlag_SR = false;
       }

       

     
     
      if (gpushUpdateFlag == true) {    
         if (millis() - msPush > 300 * 1000L) {  // max alle 10min
         //if (millis() - msPush > 60 * 1000L) {  // max alle 10min
           
            #ifdef PushDebug
            Serial.println(String(p_time) + " | Push senden...");        
            #endif


           
            push_nachricht();
            //log_list[log_list_count] = String(p_time) + " | Pushover: send Message";
            //update_log();

            #ifdef Push2
              push_nachricht2();
            #endif
            msPush = millis(); 
         } 
      }

     
      // nur für info icon im Status
      if (gpushOnlineUpdateFlag == false) {  
        if (millis() - msPush > 200 * 1000L) {  

          //Pushsafer pushsafer(PushsaferKey, client2);
          if(client2.connect("pushsafer.com",80)){
            divstatus8 = divgreen;  // Status
          }else{
            divstatus8 = divred;  // Status
          }
          gpushOnlineUpdateFlag = true;

        }
      }
      

    }

    #endif
    //-------------------------------------------------------------------------------





   //--------------------------------------------------------------------------------
   //--- 60 min ---------------------------------------------------------------------
   // alle 60min
   if (g_60min_UpdateFlag == true){ 
      g_60min_UpdateFlag = false;
      //if (millis() - ms4 > 3600 * 1000L) {
       // ms4 = millis();
       #ifdef TimeDebug
        Serial.println("-- 60min. --  ");
       #endif
      
       //esp32_uptime ++;

       //p_uptime = String(esp32_uptime);


       //sensor_vals_read = true;

        count_mesh_1_fail = 0;
        count_mesh_2_fail = 0;
        count_mesh_3_fail = 0;
        count_mesh_4_fail = 0;
        count_mesh_5_fail = 0;


    }
   //--- 60 min ---------------------------------------------------------------------
   //--------------------------------------------------------------------------------




   //--------------------------------------------------------------------------------
   //---  1 Tag -------------------------------------------------------------------
   //--- 1440 min ---------------------------------------------------------------------
   // alle  1 Tag
   if (g_1440min_UpdateFlag == true){ 
      g_1440min_UpdateFlag = false;
      //if (millis() - ms4 > 86400 * 1000L) {
       // ms4 = millis();
       #ifdef TimeDebug
        Serial.println("-- 1440 min. --  ");
       #endif
      
       //esp32_uptime ++;

       //p_uptime = String(esp32_uptime);

        if(boot1440 >= 1){
          Serial.println("2--> NTPCallback2()");
          NTPCallback2();     
          g_ntp_update_start = true;
        }
        boot1440 = 1;

       //sensor_vals_read = true;


    }
   //--- 1440 min ---------------------------------------------------------------------
   //--------------------------------------------------------------------------------



   




   //--------------------------------------------------------------------------------
   //--- 60 sec. ---------------------------------------------------------------------
   // alle 60sec.
    // if (millis() - ms1 > 60 * 1000L) {
      //ms1 = millis();
   if (g_60sec_UpdateFlag == true){ 
      g_60sec_UpdateFlag = false;
      boot_min ++;






        //#ifdef TimeDebug
        //Serial.println("-- 60sec. -- | "  + String(p_time) + " | " + timeClient.update());
        //#endif
          // Serial.println(p_time + " " + p_time_mesh_uplod );

          if(charcount13_w > 0){
            p_time_mesh_uplod_s = "Daten im Speicher: " + String(charcount13_w);
          }else{
            p_time_mesh_uplod_s = "Last Upload " + p_time_mesh_uplod;
          }

          Preferences preferences;
          preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden         
          ee_wifires = preferences.getUInt("ee_wifires", 0);              //"Datei" ee_wifires auslesen
          if (ee_wifires > 0){
           
            #ifdef NVS_DEBUG
            Serial.println("immer noch Boot Anzahl für Reset WLAN: " + String(ee_wifires));
            #endif
            ee_wifires = 0;
            preferences.putUInt("ee_wifires", ee_wifires);                  //Variable  speichern

          }

          millissave = epochTime;   // getTime();
          if(millissave > 1577833200){ // > 2020.1.1
            //Serial.println("millissave: " + String(millissave));
            millissave_t = millissave + 60; //rebootzeit
            millissave_t = millissave_t - (gUTC * 3600);
            preferences.putUInt("ee_timesave", millissave_t);         //Variable counter unter "Datei"  speichern
          }

          //--- Text für Sensor aktualisieren
          if (val_sensor_aktual >= 1){
            val_sensor_aktual -- ; 
          }
            if (val_sensor_aktual == 0){
            if (abfr_mb_finish == 1) {
            //mb_werteaktual = "Messwerte &auml;lter als 10min";
            
              if (p_uhrzeit_last != "00.00.00 00:00:00"){
                mb_werteaktual = "letzte aktualisierung: " + p_uhrzeit_last;
              }else{
                mb_werteaktual = "letzte aktualisierung: " + p_time;  // nur beim Starten Zeit unterdrücken
              }
            
            }
          } 

          if (Web_logout_time >= 1){   //
            Web_logout_time -- ; 
            //#ifdef WEB_DEBUG
              //Serial.println("Logout Timer: " + String(Web_logout_time) + " Minuten");
            //#endif
          }
          //----------------------------------

          //----- Logout Timer -----------
          if (Web_logout_time == 0){
            if (web_write_ok == 1){
              web_write_ok = 0 ; 
              bit_setdiv = true;
              divpw = divhidden2; 
              divsetting = divhidden2; 
               
                 if(p_inputpasswort == p_inputpasswort_admin){  
                   p_tr_ad_hidden2 = p_tr_hidden1;
                 }else{
                   p_tr_ad_hidden2 = p_tr_hidden0;  
                 }
                 p_inputpasswort = "";

                //p_logout_or_in= p_login;
                p_logout_or_in= " style='display: none;>";

                div_c02 = divonc02h;
                div_c03 = divonc03h;
                div_c04 = divonc04h;
                div_c06 = divonc06h;
                div_c07 = divonc07h;
                div_c08 = divonc08h;
                div_c09 = divonc09h;
                #ifdef old_option
                div_c10 = divonc10h;
                div_c11 = divonc11h;
                #endif
                div_c12 = divonc12h;
                #ifdef old_option
                div_c13 = divonc13h;
                #endif
                div_c14 = divonc14h;
                div_c19 = divonc19h;

                updateDIVs();
                read_div_values();

                b_logoff = false;

            }
          }



       // Serial.printf("free heap: %d\n", ESP.getFreeHeap());



       if (p_sett06 == 1){  //view Mesh Eingeschaltet  
         
          gMESHUpdateFlag = true;
          gMESHUpdateFlag2 = true;
          gMESHUpdateFlag3 = true;
          gMESHUpdateFlag4 = true;
          gMESHUpdateFlag5 = true;
          toggle_client = 0;

         // 
          if (p_inputip01 != "000.000.000.000"){ 

            if(p_sett20 == 1){  //FAN   1 = dieser Sensor 
              p_mesh_IP_resault = "<span class='Stil5'>    " + p_inputip01 + "</div>";   //grün
            //}else{
              //p_mesh_IP_resault = "<span class='Stil9'>    " + p_inputip01 + "</div>";   //blau  --  im FAN wird unterschieden blau und rot
            }

          }else{
            p_mesh_IP_resault = "";
          }

       }else{
        
          gMESHUpdateFlag = false;
          gMESHUpdateFlag2 = false;
          gMESHUpdateFlag3 = false;
          gMESHUpdateFlag4 = false;
          gMESHUpdateFlag5 = false;
          div01 = divhidden;
          div02 = divhidden;
          div03 = divhidden;
          div04 = divhidden;
          div05 = divhidden;
          divstatus3 = divgrau; //bei Status

          if (p_inputip01 != "000.000.000.000"){ 
            p_mesh_IP_resault =  p_inputip01;    //bei Status    f_Rsource
          }else{
            p_mesh_IP_resault = "";
          } 

       }



        //******************************************************************** 
        //---- PUSH Auswahl ----
          push_val_vorgabe = mb_radon_ist_word;
          
          if (p_pushmessage.indexOf("xxxx")>=1) {   // Searchstring exists?
          
          push_val_vorgabe = mb_radon_ist_word;

          }
          else if(p_pushmessage.indexOf("XXXX")>=1) {  
          #ifdef CO2_on
          push_val_vorgabe = eco2val1;
          #else
          push_val_vorgabe = 0;
          #endif

          }
        //******************************************************************** 


       


        if (p_inputmqoptions == "1"){         //0 = Adafruit [user/pwd]    1 = Thingsboard [Token]
          //gThingsboardUpdateFlag = true;
                   //gThingsboardGETFlag = true;  // WEB GET
        }





          // /styles.css
          //File file2 = SPIFFS.open("/styles.css");
          
          if(len_file1 == 0){
              File file = SPIFFS.open("/styles.css", FILE_READ);  
              if(!file){
                Serial.println("1There was an error opening the file for writing");
              }else{
                len_file1 = file.size();
                #ifdef NVS_DEBUGdetail_
                Serial.print("[styles.css] File size: ");
                Serial.println(len_file1);
                #endif
                file.close();
              }
          }

         #ifdef old_option
          if(len_file2 == 0){
              File file2 = SPIFFS.open("/styles2.css", FILE_READ);  
              if(!file2){
                Serial.println("2There was an error opening the file for writing");
              }else{
                len_file2 = file2.size();
                #ifdef NVS_DEBUGdetail_
                Serial.print("[styles2.css] File size: ");
                Serial.println(len_file2);
                #endif
                file2.close();
              }
          }
          #endif


          if(len_file3 == 0){
              File file3 = SPIFFS.open("/jsthree0.js", FILE_READ);  
              if(!file3){
                Serial.println("3There was an error opening the file for writing");
              }else{
                len_file3 = file3.size();
                #ifdef NVS_DEBUGdetail_
                Serial.print("[jsthree0.js] File size: ");
                Serial.println(len_file3);
                #endif
                file3.close();
              }
          }

          if(len_file4 == 0){
              File file4 = SPIFFS.open("/jsthree.js", FILE_READ);  
              if(!file4){
                Serial.println("4There was an error opening the file for writing");
              }else{
                len_file4 = file4.size(); 
                #ifdef NVS_DEBUGdetail_
                Serial.print("[jsthree.js] File size: ");
                Serial.println(len_file4);
                #endif
                file4.close();
              }
          }

          if(len_file5 == 0){
              File file5 = SPIFFS.open("/jsthree1.js", FILE_READ);  
              if(!file5){
                Serial.println("5There was an error opening the file for writing");
              }else{
                len_file5 = file5.size();
                #ifdef NVS_DEBUGdetail_
                Serial.print("[jsthree1.js] File size: ");
                Serial.println(len_file5);
                #endif
                file5.close();
              }
          }

          if(len_file6 == 0){
              File file6 = SPIFFS.open("/jsthree2.js", FILE_READ);  
              if(!file6){
                Serial.println("6There was an error opening the file for writing");
              }else{
                len_file6 = file6.size();
                #ifdef NVS_DEBUGdetail_
                Serial.print("[jsthree2.js] File size: ");
                Serial.println(len_file6);
                #endif
                file6.close();
              }
          }

          if(len_file7 == 0){
              File file7 = SPIFFS.open("/zonehead.js", FILE_READ);  
              if(!file7){
                Serial.println("7here was an error opening the file for writing");
              }else{
                len_file7 = file7.size();
                #ifdef NVS_DEBUGdetail_
                Serial.print("[zonehead.js] File size: ");
                Serial.println(len_file7);
                #endif
                file7.close();
              }
          }
          
          #ifdef old_option
          if(len_file8 == 0){
              File file8 = SPIFFS.open("/gloader.js", FILE_READ);  
              if(!file8){
                Serial.println("8There was an error opening the file for writing");
              }else{
                len_file8 = file8.size();
                #ifdef NVS_DEBUGdetail_
                Serial.print("[gloader.js] File size: ");
                Serial.println(len_file8);
                #endif
                file8.close();
              }
          }
          #endif

           gledUpdateFlag = true;
      
          //const char * content = file.size();
      
          //Serial.print("Content length: ");
          //Serial.println(strlen(content));


//-------------------------------------------------------------------

      //String sendValueStr;

      sendValueStr2 = p_inputcloudpre;

      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "0=";
      //Date
      sendValueStr2 += String(epochTime_mqtt);  
      //Radon value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "1=";
      sendValueStr2 += String(mb_radon_ist_long);
      
      //MAC
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "2=";
      sendValueStr2 += WiFi.BSSIDstr();

      //Tracer ID value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "3=";
      sendValueStr2 += device_id_s;

      //Radon value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "4=";
      sendValueStr2 += String(mb_radon_24h_32bit);

      //Radon value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "5=";
      sendValueStr2 += String(mb_radon_long_32bit);  

      //Radon value
      sendValueStr2 += p_inputcloudchain;
      sendValueStr2 += "6=";
      sendValueStr2 += String(mb_radon_eintrarge);

      //cloud_list_t = sendValueStr;
      //sendValueStr = sendValueStr2;

      // datei_schreiben11(); 
      

      if(p_inputcloudporti > 80){
         cloud_result = "https://" + p_inputcloudserver + "/" + p_inputcloudpage + "?" + sendValueStr2;
      }else{
         cloud_result = "http://" + p_inputcloudserver + "/" + p_inputcloudpage + "?" + sendValueStr2;
      }
                              
      //Serial.print("RadonCloud = "); Serial.println(cloud_result);

   //-------------------------------------------------------------------





     //----------------------------------------------------------------------------   
     if (p_sett16 == 1){  //view MQTT Eingeschaltet  
       if(gThingsboardUpdateFlag == true){

         gThingsboardUpdateFlag = false;

                if (!client.connected()) {

          
                    #ifdef MQTT_DEBUG
                      Serial.println(String(p_time) + " | MQTT c Start Reconnect");
                    #endif

                    reconnect();

                }else{


                    
                    char attributes[10];

                    
                    //char publishTopic13x[] PROGMEM = "v1/devices/me/attributes/response/+"; 
                    char publishTopic13x[] PROGMEM = "v1/devices/me/rpc/response/+"; 
                    client.subscribe(publishTopic13x); 


                    //char publishTopic12x[] PROGMEM = "v1/devices/me/attributes/request"; 
                    char publishTopic12x[] PROGMEM = "v1/devices/me/rpc/request"; 
                    String payload = "1";
                    payload.toCharArray(attributes, 10);
                    client.publish(publishTopic12x, attributes);  
                    #ifdef MQTT_DEBUG
                    Serial.println("--> MQTT Attributs Topic   : " + String(publishTopic11));
                    Serial.println("--> MQTT Attributs attributes: " + String(attributes));
                    #endif



                }

       }
    }
   //----------------------------------------------------------------------------










   //-------------------- ABFRAGE von SENSORWERTEN ------------------------------
   //----------------------------------------------------------------------------
        // failTimeinfo = true     // NTP nicht aktuell
    if(fail2Timeinfo == false){  //false = jahr größer 1970 = Jahr OK
      if(timeSyncron == false){
        // gDay, gMonth, gYear, gHour, gMinute, gSecond
        if (gMinute == 0 || gMinute == 10 || gMinute == 20 || gMinute == 30 || gMinute == 40 || gMinute == 50) {
          timeSyncron = true;
          ms5 = millis();
          g_05min_UpdateFlag = true;

          gRADONupdateFlag = true; // Abfrage von Sensorwerten

          //if(g_mb_sensor_found != p_inputmqmeshi){ 
            //start_slave_scan = 0;   //MESH 1= scan gestartet  0 = erneut starten
          //}else{ 
            //mb_tracer_number = 1; // lesen starten
          //}
          mb_tracer_number = 1; // lesen starten

          minUpdateFlag = true;
          sensor_vals_read = true;

          #ifdef InfoDebug
          Serial.println(" ");
          Serial.println(p_time + " | ABFRAGE Sensordaten | Baud " + String(mbus_baud));
          Serial.println(" ");
          #endif
          gSensordRadonFlag = false; // hier lööschen weil beim start sonnst zweimal übertragen wird weil dort die Sensoren abgefragt werden.


          #ifdef BLE_WIFI_disable
          if(WiFi_status != WL_CONNECTED){
            //log_list[log_list_count] = String(p_time) + " | WIFI: " + String(WiFi.SSID()) + " connect failed!";
            //update_log();
          } 
          #endif

        } 
      }else{
        if (gMinute != 0 && gMinute != 10 && gMinute != 20 && gMinute != 30 && gMinute != 40 && gMinute != 50){
          timeSyncron = false;
          //#ifdef MBDebug
          //Serial.println(p_time + " | Vorbereitung ABFRAGE Sensordaten: ");
          //#endif


        }


          if(gSensordRadonFlag == true){ // Sensor abfrage erfogreich, jetzt upladen der Daten starten
            gSensordRadonFlag = false;
            //if(gSensorReRadonFlag == false){
              //if (gMinute == 0 || gMinute == 10 || gMinute == 10 || gMinute == 30 || gMinute == 40 || gMinute == 50) {

                gSensorReRadonFlag = true;


                //Serial.println(p_time + " | must_transfer3: " + must_transfer3);
                //Serial.println(p_time + " | g_NTP_update: " + String(g_NTP_update));
                //Serial.println(p_time + " | g_ntp_update_ok: " + String(g_ntp_update_ok));
                //Serial.println(p_time + " | failTimeinfo: " + String(failTimeinfo));

                if(must_transfer3 > 0 && g_NTP_update == false){
                  Serial.println(p_time + " | NTPCallback2 ");

                  if(WiFi_status == WL_CONNECTED){ 
                    force_Time_update();
                  }
                    Timeupdate(); 

                 // NTPCallback2();
                }
            

                //-----------------------------------
                g1_15minRadonFlag = true;  //mqtt
                g2_15minRadonFlag = true;  // mqtt mesh
                g3_15minRadonFlag = true;

                gReboot_TOKENFlag2 = 1;  // MQTT nur neu Speichern wenn Zeit abgelaufen ist    1= Sensor abgefragt
                Preferences preferences;
                preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                preferences.putUInt("p_crebbot2", gReboot_TOKENFlag2);      
                preferences.end();   


                //-----------------------------------

              //}
           // }
          }
          
          //f (gMinute != 0 && gMinute != 10 && gMinute != 20 && gMinute != 30 && gMinute != 40 && gMinute != 50) {
            //gSensorReRadonFlag = false;
          //}


      }
    }
   //----------------------------------------------------------------------------
   //----------------------------------------------------------------------------




   //----------------------------------------------------------------------------
   //----------------------------------------------------------------------------

      if(gFrashupdateFlag == true){
        gFrashupdateFlag = false;
        updateFreshboxRadon();
      }
      if(p_inputfunktion == "on"){    // Senden auch bei Lüfter AUS  
          divstatus10 = divgreen;  // Status
      }else{
          divstatus10 = divgrau;  // Status
      }  

   //----------------------------------------------------------------------------
   //----------------------------------------------------------------------------


    #ifdef BLE_WIFI_disable
    if(WiFi_status != WL_CONNECTED){    
      divstatus5 = divred;  // Status
    }else{
      divstatus5 = divgreen;  // Status
    }   
    #endif



   //--------------------------------------------------------------------------------
   //--- 5 min ---------------------------------------------------------------------
   // alle 5min
    //if (millis() - ms5 > 300 * 1000L) {
     //   ms5 = millis();
    if (g_05min_UpdateFlag == true){ 
      g_05min_UpdateFlag = false;
         #ifdef TimeDebug
           Serial.println("-- 5min. --");
         #endif

        

        if(chart_page == 3 || chart_page == 4 || chart_page == 5){
          gRADONupdateFlag = true;
          gRADONupdateSinifferFlag = true;
        }

        

    }
   //--- 5 min ---------------------------------------------------------------------
   //--------------------------------------------------------------------------------






    //--------------------------------------------------------------------------------
    if (cloudAktiveConfig == true) {   //Cloud Eingeschaltet
        if(p_inputcloudinteri < 5){
          p_inputcloudinteri = 5;
          p_inputcloudinter = "5";
          }
        ms10_t = p_inputcloudinteri*100000;
        
       p_cloud_ID_resault = device_id_s; 


        if(p_inputcloudinteri == 15){
            
             if (gMinute == 0 || gMinute == 15 || gMinute == 30 || gMinute == 45) {
             
                if (gcloudUpdateFlag == true) {  //aktuelle Radonwerte
                  Serial.println(p_time + " | Cloud send");
                        if(g_NTP_update == true){
                            if(p_inputcloudporti > 80){
                              //RadonCloudUpload3();
                              //b_RadonCloudUpload3 = true;
                              b_RadonCloudUpload4 = true;
                                gReboot_TOKENFlag = 1;  // nur neu Speichern wenn Zeit abgelaufen ist
                                Preferences preferences;
                                preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                                preferences.putUInt("p_crebbot", gReboot_TOKENFlag);      
                                preferences.end(); 
                            }else{
                              RadonCloudUpload();
                            }
                        }
                  //update_log();
                  gcloudUpdateFlag = false;
                }

             }

        }else{

             if(p_inputcloudinteri == 10){

                
                    if (gMinute == 0 || gMinute == 10 || gMinute == 20 || gMinute == 30 || gMinute == 40 || gMinute == 50) {

                      if (gcloudUpdateFlag == true) {  //aktuelle Radonwerte
                      if(g_clod_time_upload == false){
                         g_clod_time_upload = true;
                          Serial.println(p_time + " | Cloud send");
                            if(g_NTP_update == true){
                              if(p_inputcloudporti > 80){
                                //RadonCloudUpload3();
                              //b_RadonCloudUpload3 = true;
                              b_RadonCloudUpload4 = true;
                                gReboot_TOKENFlag = 1;  // nur neu Speichern wenn Zeit abgelaufen ist
                                Preferences preferences;
                                preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                                preferences.putUInt("p_crebbot", gReboot_TOKENFlag);      
                                preferences.end(); 
                              }else{
                                RadonCloudUpload();
                              }
                            }
                          //update_log();
                          gcloudUpdateFlag = false; 
                      }
                      }

                    }else{
                        g_clod_time_upload = false;
                    }
                


             }else{

                    
                    if(p_inputcloudinteri == 5){

                      
                          if (gMinute == 0 || gMinute == 5 || gMinute == 10 || gMinute == 15 || gMinute == 20 || gMinute == 25 || gMinute == 30 || gMinute == 35 || gMinute == 40 || gMinute == 45 || gMinute == 50 || gMinute == 55) {
                            
                              if (gcloudUpdateFlag == true) {  //aktuelle Radonwerte
                              if(g_clod_time_upload == false){
                                  g_clod_time_upload = true;
                                  Serial.println(p_time + " | Cloud send");
                                  if(g_NTP_update == true){
                                    if(p_inputcloudporti > 80){
                                      //RadonCloudUpload3();
                                      //b_RadonCloudUpload3 = true;
                                      b_RadonCloudUpload4 = true;
                                      gReboot_TOKENFlag = 1;  // nur neu Speichern wenn Zeit abgelaufen ist
                                      Preferences preferences;
                                      preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                                      preferences.putUInt("p_crebbot", gReboot_TOKENFlag);      
                                      preferences.end(); 
                                    }else{
                                      RadonCloudUpload();
                                    }
                                  }
                                  //update_log();
                                  gcloudUpdateFlag = false; 
                              } 
                              }

                          }else{
                            g_clod_time_upload = false;
                          }
                      

                    }else{    // alles außer 5 10 15 Intervall

                        // alle intervall min.
                        if (millis() - ms10 > ms10_t) {
                            ms10 = millis(); 
                            
                            if(g_NTP_update == true){
                              Serial.println(p_time + " | SEND Cloud");
                              if (gcloudUpdateFlag == true) {  //aktuelle Radonwerte
                               
                                if(p_inputcloudporti > 80){
                                    //RadonCloudUpload3();
                                    //b_RadonCloudUpload3 = true;
                                    b_RadonCloudUpload4 = true;
                                    gReboot_TOKENFlag = 1;  // nur neu Speichern wenn Zeit abgelaufen ist
                                    Preferences preferences;
                                    preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
                                    preferences.putUInt("p_crebbot", gReboot_TOKENFlag);      
                                    preferences.end(); 

                                }else{
                                  RadonCloudUpload();
                                }

                              } 
                            }

                            //update_log();
                            gcloudUpdateFlag = false;
                        }

                    }

                }

             }




             

    }
    //--------------------------------------------------------------------------------


   



   }
   //--- 60 sec. ---------------------------------------------------------------------
   //---------------------------------------------------------------------------------

    //String divhidden = "<div id=\"hidden\" hidden>";
    //String divon = "<div id=\"on\">";








 



   //--------------------------------------------------------------------------------
   //--- 10 sec. ---------------------------------------------------------------------
   // alle 10sec.
   //if (millis() - ms2 > 10 * 1000L) {
   if (g_10sec_UpdateFlag == true){ 
      g_10sec_UpdateFlag = false;
      

      Timeupdate();
      gLedIPSearchFlag = true;
      
      //Serial.print("-->  " + p_time + " "); Serial.println("-- 10sec. -- ");
        //Serial.println("-- response / received size --");
        //Serial.println(s_response_size);
        //Serial.println(p_sett18);


       #ifdef v_4_20_mA_5   //DAC8760
       Serial.print("-->  " + p_time + " "); Serial.println("-- 10sec. -- ");
       dac.write(32767); //0 32767 65535
       #endif



       if(State_anf_werksportal == true){
         State_anf_werksportal = false;

         WiFiManager wifiManager;
         wifiManager.startConfigPortal(p_APname_c, p_inputpasswort_vorgabec);
       }


 
        //Serial.println(p_time + "  VSS= " + String(intV_AI_VSS) + " | Solar= " + String(intV_AI_VCAPA)); //On debug
        
        AI_VSS_mv_s = String(AI_VSS_mv, 2); // 3.14
        AI_VCAPA_mv_s = String(AI_VCAPA_mv, 2); // 3.14
        //Serial.println(p_time + "  VSS= " + AI_VSS_mv_s + " V | Solar= " + AI_VCAPA_mv_s + " V"); //On debug


            // calc_down2, calc_top2
            //  uint16_t calc_top = 3274;
            //  uint16_t calc_down = 655;




          /*
          Serial.println("p_sett16 " + String(p_sett16));
          Serial.println("p_mqonoff " + String(p_mqonoff));
          Serial.println("p_sett07 " + String(p_sett07));
          Serial.println("mqttdAktiveConfig " + String(mqttdAktiveConfig));
         */

         /*
            Serial.println("p_sett01: " + String(p_sett01));
            Serial.println("p_sett02: " + String(p_sett02));
            Serial.println("p_sett03: " + String(p_sett03));
            Serial.println("p_sett04: " + String(p_sett04));
            Serial.println("p_sett05: " + String(p_sett05));
            Serial.println("p_sett06: " + String(p_sett06));
            Serial.println("p_sett07: " + String(p_sett07));
            Serial.println("p_sett08: " + String(p_sett08));
            Serial.println("p_sett09: " + String(p_sett09));
            Serial.println("p_sett10: " + String(p_sett10));
            Serial.println("p_sett11: " + String(p_sett11));
            //Serial.println("p_sett12: " + String(p_sett12));
            Serial.println("p_sett13: " + String(p_sett13));
            Serial.println("p_sett14: " + String(p_sett14));
            Serial.println("p_sett15: " + String(p_sett15));
            Serial.println("p_sett16: " + String(p_sett16));
            Serial.println("p_sett17: " + String(p_sett17));
            Serial.println("p_sett18: " + String(p_sett18));

         */

        //Serial.println("--------------------");


          
  #ifdef PCB_v_7
   //---------------------------------------
   #ifdef v_4_20_mA_3 

     if(gao1UpdateFlag == true){
       
       gao1UpdateFlag = false;

          // sendWert(2048);




      Serial.println(" ");
        Serial.println("-CALC AO-");

    //***********************
    //ao1OGVal = 5000;
    //ao1UGVal = 1000;
    mb_radon_live_32bit = 2000;
    //ao1OptionVal = 0;
    //ao1KorrekturVal = 0;
    //***********************
       
        Serial.println("ao1KorrekturVal " + String(ao1KorrekturVal));

        ao1_adc = 4095;
        ao1_4mA =4;
        ao1_20mA =20;
        ao1_diffmA =ao1_20mA-ao1_4mA;
        ao1_stepmA = ao1_diffmA/ao1_adc;

        ao1_rangediv = ao1OGVal - ao1UGVal;
        Serial.println("ao1_rangediv " + String(ao1_rangediv));
        Serial.println("ao1OGVal " + String(ao1_rangediv));
        Serial.println("ao1_rangediv " + String(ao1_rangediv));
        

        if(ao1OptionVal > 2){
          ao1OptionVal = 2;
        }


        //--------------- 4-20mA -----------------
        if(ao1OptionVal == 0){

          Serial.println("mb_radon_live_32bit " + String(mb_radon_live_32bit));
          Serial.println("ao1UGVal " + String(ao1UGVal));
            
          ao1_div = mb_radon_live_32bit - ao1UGVal;  
          Serial.println("ao1_div " + String(ao1_div));

          ao1_range = ao1_adc / ao1_rangediv;
          Serial.println("ao1_range " + String(ao1_range));


          ao1_set_soll = ao1_div * ao1_range; //ausgabe
          Serial.println("ao1_set_soll " + String(ao1_set_soll));
          ao1_set_ADC = int(ao1_set_soll);
          Serial.println("Ganzzahl Analog zu Wandler " + String(ao1_set_ADC));
          Serial.println(" ");
  
          ao1_outmA = (ao1_set_soll*ao1_stepmA)+ao1_4mA;

          //---- im Bereich -----
          if(mb_radon_live_32bit >= ao1UGVal && mb_radon_live_32bit <= ao1OGVal){
            Serial.println("-------------------------");
            Serial.println("Im Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: " + String(ao1_outmA) + " mA");
            Serial.println("-------------------------");
            //set adc    ao1_set_ADC

            sendWert(ao1_set_ADC);
            Serial.print(ao1_set_ADC);
            Serial.print("\t");



          }
          //------------------------

          //------ set 4mA -------
          // Radon kleiner als UG
          if(mb_radon_live_32bit < ao1UGVal){
            Serial.println("-------------------------");
            ao1_set_ADC = 0;
            Serial.println("Außer Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: 4 mA");
            Serial.println("-------------------------");
            //set adc    ao1_set_ADC
          }
          //-----------------------

          //----- set 20mA -------
          // Radon größer als OG
          if(mb_radon_live_32bit > ao1OGVal){
            Serial.println("-------------------------");
            ao1_set_ADC = ao1_adc;
            Serial.println("Außer Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: 20 mA");
            Serial.println("-------------------------");
            //set adc   ao1_set_ADC
          }
          //---------------------

            Serial.println(" ");
        }
        //--------------- 4-20mA -----------------





        //--------------- 3,8-20,5mA -----------------
        if(ao1OptionVal == 1){




        }
        //--------------- 3,8-20,5mA -----------------




     }
      

    #endif
   //---------------------------------------





   //---------------------------------------
   #ifdef v_4_20_mA_2 

     if(gao1UpdateFlag == true){
       
       gao1UpdateFlag = false;

        Serial.println("-CALC AO-");

       // Write any value from 0-4095
       //myDac.analogWrite(2048);




 Serial.println();
        Serial.println("-CALC AO-");

    //***********************
    //ao1OGVal = 5000;
    //ao1UGVal = 1000;
    mb_radon_live_32bit = 2000;
    //ao1OptionVal = 0;
    //ao1KorrekturVal = 0;
    //***********************
       
        Serial.println("ao1KorrekturVal " + String(ao1KorrekturVal));


        ao1_adc = 4095;
        ao1_4mA =4;
        ao1_20mA =20;
        ao1_diffmA =ao1_20mA-ao1_4mA;
        ao1_stepmA = ao1_diffmA/ao1_adc;

        ao1_rangediv = ao1OGVal - ao1UGVal;
        Serial.println("ao1_rangediv " + String(ao1_rangediv));
        Serial.println("ao1OGVal " + String(ao1_rangediv));
        Serial.println("ao1_rangediv " + String(ao1_rangediv));
        

        if(ao1OptionVal > 2){
          ao1OptionVal = 2;
        }


        //--------------- 4-20mA -----------------
        if(ao1OptionVal == 0){

          Serial.println("mb_radon_live_32bit " + String(mb_radon_live_32bit));
          Serial.println("ao1UGVal " + String(ao1UGVal));
            
          ao1_div = mb_radon_live_32bit - ao1UGVal;  
          Serial.println("ao1_div " + String(ao1_div));

          ao1_range = ao1_adc / ao1_rangediv;
          Serial.println("ao1_range " + String(ao1_range));


          ao1_set_soll = ao1_div * ao1_range; //ausgabe
          Serial.println("ao1_set_soll " + String(ao1_set_soll));
          ao1_set_ADC = int(ao1_set_soll);
          Serial.println("Ganzzahl Analog zu Wandler " + String(ao1_set_ADC));
          Serial.println(" ");
  
          ao1_outmA = (ao1_set_soll*ao1_stepmA)+ao1_4mA;

          

          //---- im Bereich -----
          if(mb_radon_live_32bit >= ao1UGVal && mb_radon_live_32bit <= ao1OGVal){
            Serial.println("-------------------------");
            Serial.println("Im Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: " + String(ao1_outmA) + " mA");
            Serial.println("-------------------------");
            //set adc    ao1_set_ADC

            
            

            //int channel = 0;
            myDac.analogWrite(ao1_set_ADC);


           // esp_task_wdt_reset();
            //myDac.analogWrite(0, 1, 1, 1, ao1_set_ADC);


            Serial.println("analogWrite: " + String(ao1_set_ADC));




            //Serial.println(">>>>>>>>>>>>>>>>>>");
            //analogWrite_test();
            //Serial.println(">>>>>>>>>>>>>>>>>>");


          }
          //------------------------

          //------ set 4mA -------
          // Radon kleiner als UG
          if(mb_radon_live_32bit < ao1UGVal){
            Serial.println("-------------------------");
            ao1_set_ADC = 0;
            Serial.println("Außer Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: 4 mA");
            Serial.println("-------------------------");
            //set adc    ao1_set_ADC
          }
          //-----------------------

          //----- set 20mA -------
          // Radon größer als OG
          if(mb_radon_live_32bit > ao1OGVal){
            Serial.println("-------------------------");
            ao1_set_ADC = ao1_adc;
            Serial.println("Außer Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: 20 mA");
            Serial.println("-------------------------");
            //set adc   ao1_set_ADC
          }
          //---------------------

            Serial.println(" ");
        }
        //--------------- 4-20mA -----------------





        //--------------- 3,8-20,5mA -----------------
        if(ao1OptionVal == 1){




        }
        //--------------- 3,8-20,5mA -----------------




     }

    #endif
   //---------------------------------------









   //---------------------------------------
   #ifdef v_4_20_mA_4 



    if(gao1UpdateFlag == true){
       
       gao1UpdateFlag = false;



       // Write any value from 0-4095
       //myDac.analogWrite(2048);




        Serial.println();
        Serial.println("-CALC AO-");

    //***********************
    //ao1OGVal = 5000;
    //ao1UGVal = 1000;
    mb_radon_live_32bit = 2000;
    //ao1OptionVal = 0;
    //ao1KorrekturVal = 0;
    //***********************
       
       // Serial.println("ao1KorrekturVal " + String(ao1KorrekturVal));
       // Serial.println("ao1Korrektur2Val " + String(ao1Korrektur2Val));




        calc_diff=calc_top-calc_down;

        ao1_adc = 4095;
        if(ao1OptionVal >= 2){
          ao1_4mA = 0;
        }else{
          ao1_4mA = 4;  
        }
        ao1_20mA = 20;
        ao1_diffmA = ao1_20mA-ao1_4mA;
        ao1_stepmA = ao1_diffmA/ao1_adc;

        ao1_rangediv = ao1OGVal - ao1UGVal;
        Serial.println("ao1_rangediv " + String(ao1_rangediv));
        Serial.println("ao1_diff mA " + String(ao1_diffmA));
        Serial.println("ao1_step mA " + String(ao1_stepmA));
        

        if(ao1OptionVal > 2){
          ao1OptionVal = 2;
        }


        //--------------- 4-20mA -----------------
          Serial.println("mb_radon_live_32bit " + String(mb_radon_live_32bit));
          Serial.println("ao1UGVal " + String(ao1UGVal));
            
          ao1_div = mb_radon_live_32bit - ao1UGVal;  
          Serial.println("ao1_div " + String(ao1_div));

          ao1_range = ao1_adc / ao1_rangediv;
          Serial.println("ao1_range " + String(ao1_range));


          ao1_set_soll = ao1_div * ao1_range; //ausgabe
          Serial.println("ao1_set_soll " + String(ao1_set_soll));
          ao1_set_ADC = int(ao1_set_soll);
          //Serial.println("Ganzzahl Analog zu Wandler " + String(ao1_set_ADC));
          //Serial.println(" ");
  
          ao1_outmA = (ao1_set_soll*ao1_stepmA)+ao1_4mA;

          

          //---- im Bereich -----
          if(mb_radon_live_32bit >= ao1UGVal && mb_radon_live_32bit <= ao1OGVal){
            Serial.println("-------------------------");
            Serial.println("Im Bereich. ADC: ");
            Serial.println("Out: " + String(ao1_outmA) + " mA");
            Serial.println("-------------------------");
            //set adc    ao1_set_ADC

             //module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
             //module.output_mA(ao1_set_ADC);



             module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
             uint16_t dac1 = module.output(/*current_mA =*/ao1_outmA); 
             Serial.print("DAC1 value: "); Serial.println(dac1);



          }
          //------------------------

          //------ 3.7mA oder 21mA = Fehler
          // https://forumautomation.com/t/what-is-namur-ne-43-in-4-20ma-signal/7441
          // https://infosys.beckhoff.com/index.php?content=../content/1031/el3751/1607529995.html&id=

          //------ set 4.0mA/3.8mA -------
          // Radon kleiner als UG
          if(mb_radon_live_32bit < ao1UGVal){
            
            if (ao1OptionVal == 0){
                  Serial.println("-------------------------");
                  ao1_set_ADC = 0;
                  Serial.println("Außer Bereich. ADC: ");
                  Serial.println("Out: 4.0 mA");
                  Serial.println("-------------------------");
                          
                  module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
                  uint16_t dac3 = module.output(/*current_mA =*/4); 
                  Serial.print("DAC2 value: "); Serial.println(dac3);
            }
            else if (ao1OptionVal == 1){
                  Serial.println("-------------------------");
                  ao1_set_ADC = 0;
                  Serial.println("Außer Bereich. ADC: ");
                  Serial.println("Out: 3.8 mA");
                  Serial.println("-------------------------");
                        
                  module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
                  uint16_t dac3 = module.output(/*current_mA =*/3.8); 
                  Serial.print("DAC2 value: "); Serial.println(dac3);
            }
            else if (ao1OptionVal == 2){
                  Serial.println("-------------------------");
                  ao1_set_ADC = 0;
                  Serial.println("Außer Bereich. ADC: ");
                  Serial.println("Out: 0 mA");
                  Serial.println("-------------------------");
                          
                  module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
                  uint16_t dac3 = module.output(/*current_mA =*/0); 
                  Serial.print("DAC2 value: "); Serial.println(dac3);
            }

          }
          //-----------------------

          //----- set 20.0mA/20.5mA -------
          // Radon größer als OG
          if(mb_radon_live_32bit > ao1OGVal){
            
            if(ao1OptionVal == 1){  
              Serial.println("-------------------------");
              ao1_set_ADC = ao1_adc;
              Serial.println("Außer Bereich. ADC: ");
              Serial.println("Out: 20.5 mA");
              Serial.println("-------------------------");

              module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
              uint16_t dac4 = module.output(/*current_mA =*/20.5); 
              Serial.print("DAC2 value: "); Serial.println(dac4);
            }else{
              Serial.println("-------------------------");
              ao1_set_ADC = ao1_adc;
              Serial.println("Außer Bereich. ADC: ");
              Serial.println("Out: 20.0 mA");
              Serial.println("-------------------------");

              module.begin(I2C_SCL_PIN, I2C_SDA_PIN);
              uint16_t dac4 = module.output(/*current_mA =*/20); 
              Serial.print("DAC2 value: "); Serial.println(dac4);
            }

          }
          //---------------------

            Serial.println(" ");
       
        //--------------- 4-20mA -----------------



     }





   #endif
   //---------------------------------------



   //---------------------------------------
    #ifdef v_4_20_mA_5   //DAC8760



      if(gao1UpdateFlag == true){
        
        // gao1UpdateFlag = false;


        //myDac.analogWrite(ao1_set_ADC);
        //dac.write(ao1_set_ADC); //0 32767 65535

      }


      




    #endif
   //---------------------------------------





   //---------------------------------------
   #ifdef v_4_20_mA 

     if(gao1UpdateFlag == true){
       
       gao1UpdateFlag = false;
       //analogWrite_calc();



 Serial.println();
        Serial.println("-CALC AO-");

    //***********************
    //ao1OGVal = 5000;
    //ao1UGVal = 1000;
    mb_radon_live_32bit = 2000;
    //ao1OptionVal = 0;
    //ao1KorrekturVal = 0;
    //***********************
       
        Serial.println("ao1KorrekturVal " + String(ao1KorrekturVal));


        ao1_adc = 4095;
        ao1_4mA =4;
        ao1_20mA =20;
        ao1_diffmA =ao1_20mA-ao1_4mA;
        ao1_stepmA = ao1_diffmA/ao1_adc;

        ao1_rangediv = ao1OGVal - ao1UGVal;
        Serial.println("ao1_rangediv " + String(ao1_rangediv));
        Serial.println("ao1OGVal " + String(ao1_rangediv));
        Serial.println("ao1_rangediv " + String(ao1_rangediv));
        

        if(ao1OptionVal > 1){
          ao1OptionVal = 1;
        }


        //--------------- 4-20mA -----------------
        if(ao1OptionVal == 0){

          Serial.println("mb_radon_live_32bit " + String(mb_radon_live_32bit));
          Serial.println("ao1UGVal " + String(ao1UGVal));
            
          ao1_div = mb_radon_live_32bit - ao1UGVal;  
          Serial.println("ao1_div " + String(ao1_div));

          ao1_range = ao1_adc / ao1_rangediv;
          Serial.println("ao1_range " + String(ao1_range));


          ao1_set_soll = ao1_div * ao1_range; //ausgabe
          Serial.println("ao1_set_soll " + String(ao1_set_soll));
          ao1_set_ADC = int(ao1_set_soll);
          Serial.println("Ganzzahl Analog zu Wandler " + String(ao1_set_ADC));
          Serial.println(" ");
  
          ao1_outmA = (ao1_set_soll*ao1_stepmA)+ao1_4mA;

          

          //---- im Bereich -----
          if(mb_radon_live_32bit >= ao1UGVal && mb_radon_live_32bit <= ao1OGVal){
            Serial.println("-------------------------");
            Serial.println("Im Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: " + String(ao1_outmA) + " mA");
            Serial.println("-------------------------");
            //set adc    ao1_set_ADC

            
            analogWrite_ADC();
            //Serial.println(">>>>>>>>>>>>>>>>>>");
            //analogWrite_test();
            //Serial.println(">>>>>>>>>>>>>>>>>>");


          }
          //------------------------

          //------ set 4mA -------
          // Radon kleiner als UG
          if(mb_radon_live_32bit < ao1UGVal){
            Serial.println("-------------------------");
            ao1_set_ADC = 0;
            Serial.println("Außer Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: 4 mA");
            Serial.println("-------------------------");
            //set adc    ao1_set_ADC
          }
          //-----------------------

          //----- set 20mA -------
          // Radon größer als OG
          if(mb_radon_live_32bit > ao1OGVal){
            Serial.println("-------------------------");
            ao1_set_ADC = ao1_adc;
            Serial.println("Außer Bereich. ADC: " + String(ao1_set_ADC));
            Serial.println("Out: 20 mA");
            Serial.println("-------------------------");
            //set adc   ao1_set_ADC
          }
          //---------------------

            Serial.println(" ");
        }
        //--------------- 4-20mA -----------------





        //--------------- 3,8-20,5mA -----------------
        if(ao1OptionVal == 1){




        }
        //--------------- 3,8-20,5mA -----------------

     }

   #endif
   //---------------------------------------

  #endif  //#define PCB_v_7

 
        #ifdef onWIFI_wps
            // ---------------------------
            wifi_config_t config;
            esp_err_t err = esp_wifi_get_config(WIFI_IF_STA, &config);
            if (err == ESP_OK) {
              printf("SSID: %s, PW: %s\n", (char*) config.sta.ssid, (char*) config.sta.password);
            } else {
              printf("Couldn't get config: %d\n", (int) err);
            }
            // ---------------------------
        #endif  

       //Serial.println("    http://" + p_inputstaticip + "/index.html");



 
        if (freshdAktiveConfig == true) {   // Freshbox Eingeschaltet    
         
            if(freshreWriteafteron == 2){   //wenn 2 dann ist erst ANlage eingeschaltet worden und dann lüftungsstufe ändern
                freshreWriteafteron = 0;      
                updateFreshboxRadon();
            }  

         
          if(m_analge_muss_aus_schalten == true){
            toggleSchreiben = 2;   // 1=lesen  2=schreiben
            caseFreshSchreiben = 1;  // 0=Anlage Stufe_1-5      1= Anlage EIN/AUS     2=Boost EIN    3=Boost AUS   4=Kalender EIN   5=Kalender AUS
            w_dummy_data_ein = S_AnlageAus; //Anlage AUS schalten, also ausschalten
            m_analge_muss_aus_schalten = false;
              #ifdef Freshebug3
                Serial.println(String(p_time) + " --> Lüfter AUS!");  
              #endif
          }

         if (pauseWebpage <= 1) {   // Freshbox Eingeschaltet   
           updateFreshbox();
         }

        }





            //*************************************
            // 10 sec.
            //NTPCallback2();
           #ifdef vent_option

            if (vanAktiveConfig == true){   //FAN aktiv
              changeFanValue();
            }else{
              gWerte3UpdateFlag = 3;
            }
            //*************************************


            if (vanAktiveConfig == true){  //FAN Eingeschaltet)
              if (p_sett11 == 1){  //view FAN Eingeschaltet   
                updateluefeter();

                if(web_write_ok == 1){ 
                
                  if (f_alarm == 2) {
                    divfanq_hid = divfan_hid1;   
                    divfan_hid = divfan_hid0;   //   divfan_hid0= unsichtbar
                  }else{
                    divfan_hid = divfan_hid1;
                    divfanq_hid = divfan_hid0; 
                  }

                }else{  
                
                  divfan_hid = divfan_hid0;
                  if (f_alarm == 2) {
                    divfanq_hid = divfan_hid1;
                  }else{
                    divfanq_hid = divfan_hid0;
                  }

                }  

              }
            }
          #endif


         if (p_sett16 == 1){  //view MQTT Eingeschaltet  
            if (mqtt_con_err == true){
              mqtt_con_err = false; //reconnect bei fehler
              reconnect();
              //update_log();
            }
         }





        //if (ee_wifires > 0){
         //Serial.printf("Boot Anzahl für Reset WLAN: %u\n", ee_wifires);          //Variable counter Seriell ausgeben
        //}
        
        #ifndef CO2_on
           val1 = random(0, 50);
           val2 = random(50, 100);
           gWerte2UpdateFlag = 3;
        #else
        gCO2UpdateFlag = true;
        #endif
       
       
       //Serial.println("Boot Anzahl für Reset WLAN: " + String(ee_wifires));
      if (ee_wifires > 0){
          ee_wifires = 0;
          Preferences preferences;
          preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
          preferences.putUInt("ee_wifires", ee_wifires);                  //Variable  speichern
          
          ee_wifires = preferences.getUInt("ee_wifires", 0);              //"Datei" ee_wifires auslesen
          #ifdef NVS_DEBUG
          Serial.println("Boot Anzahl für Reset WLAN: " + String(ee_wifires));
          #endif
          //Serial.println("Boot Anzahl für Reset WLAN: " + String(ee_wifires));
      }


        //------------------------------------------------------------------
        if (received_response__g == 0){
          received_response_size = received_response_size + response_size;
          response_size = 0;
          p_rs485_data = String(received_response_size) + " byte";
        
          if (received_response_size >= 1000 && received_response_size < 1000000){
              received_response_size_k = received_response_size / 1000;
              p_rs485_data = String(received_response_size_k) + " kbyte";
          }
          if (received_response_size >= 1000000 && received_response_size < 1000000000){
              received_response_size_m = received_response_size / 1000000;
              p_rs485_data = String(received_response_size_m) + " Mbyte";
          }
        }

        if (received_response_size >= 1000000000){
          received_response__g ++;
          received_response_size = 0;
          //p_rs485_data =  String(received_response__g) + " Gbyte";
        }  

        if (received_response__g >= 1){

          received_response_size = received_response_size + response_size;
           response_size = 0;
          p_rs485_data_b = String(received_response_size) + " byte";
        
          if (received_response_size >= 1000 && received_response_size < 1000000){
              received_response_size_k = received_response_size / 1000;
              p_rs485_data_b = String(received_response_size_k) + " kbyte";
          }
          if (received_response_size >= 1000000 && received_response_size < 1000000000){
              received_response_size_m = received_response_size / 1000000;
              p_rs485_data_b = String(received_response_size_m) + " Mbyte";
          }

          p_rs485_data =  String(received_response__g) + " Gbyte + " + p_rs485_data_b;

        }

        // überschreiben mit Anfragen
        #ifdef MB_Gateway
        received_count = MB.getMessageCount() - MBbridge.getMessageCount();
        received_count = received_count + MBbridge.getMessageCount();
        #endif
        

        msRs485 = millis();
        msRs485_diff = msRs485 - msRs485_start;
        //Serial.println(msRs485_diff);

        msRs485_diff = msRs485_diff / 7200000;  //Stunden
        //Serial.println(msRs485_diff);   

        msRs485_eintr = received_count / msRs485_diff;
       // p_rs485_data = String(msRs485_eintr) + " Counts/h";
        //Serial.println(msRs485_eintr);
        if (received_count > 30){
          p_rs485_data = String(msRs485_eintr) + " requests/h";
        }else{
          p_rs485_data = String(received_count) + " requests";
        }
        
        //-----------------------------------------------------------------------

        

        //-----------------------------------------------------------------------
        if(select_apmodus == 1){
          select_apmodus = 0;
           
           Serial.println("select_apmodus");
           
            Preferences preferences;
            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden

            ee_portalTimeout = 620;                                          
            #ifdef WIFI_DEBUG
            Serial.printf("Portal Timeout: %u\n", ee_portalTimeout);          //Variable counter Seriell ausgeben
            #endif
            preferences.putUInt("ePortalTime", ee_portalTimeout);                  //Variable counter unter "Datei" ee_portalTimeout speichern 
            
            preferences.putString("p_ipchange", "0");                     //Variable speichern

            gCONNECTEDflag = 0;
            preferences.putUInt("gCONNflag", gCONNECTEDflag);                  //Variable  speichern   // 1=WLAN ist verbunden

            ee_ip_search = 1;
            preferences.putUInt("ee_ipsearch", ee_ip_search);                  //Variable unter "Datei" ee_ipsearch speichern 

    preferences.putString("p_staticip", "");                    //Variable speichern
    preferences.putString("p_subnetmask", "");                  //Variable speichern
    preferences.putString("p_gateway", "");                     //Variable speichern
    preferences.putString("p_wifidns", "");                     //Variable speichern
    preferences.putString("p_ipchange", "0");                     //Variable speichern

            preferences.end();                                      //Preferences beenden
           
           
            #ifdef BLE_WIFI_disable
              Serial.println("WIFI resetSettings");
              WiFiManager wifiManager;
              //wifiManager.WiFi_eraseConfig();
                IPAddress _ip,_gw,_sn,_dns1,_dns2;
                _ip.fromString("");
                _gw.fromString("");
                _sn.fromString("");
                _dns1.fromString("");
                _dns2.fromString("");
                wifiManager.setSTAStaticIPConfig(_ip, _gw, _sn , _dns1);
                //wifiManager.setSTAStaticIPConfig(IPAddress(), IPAddress(), IPAddress(), IPAddress());
              wifiManager.erase(true);
              //wifiManager.resetSettings();
            #endif
            delay(500);
            ESP.restart(); 

        }
        //-----------------------------------------------------------------------
        
       /*
       Serial.println("[MAIN] Free heap: %d bytes\n"+ String(ESP.getFreeHeap()));

       Serial.println("[MAIN] getChipRevision"+ String(ESP.getChipRevision()));
       Serial.println("[MAIN] getPsramSize"+ ESP.getPsramSize());
       Serial.println("[MAIN] getFlashChipSize"+ ESP.getFlashChipSize());
       Serial.println("[MAIN] getCpuFreqMHz"+ ESP.getCpuFreqMHz());
       Serial.println("[MAIN] getFreeHeap"+ ESP.getFreeHeap());
       Serial.println("[MAIN] getSketchSize"+ ESP.getSketchSize());
       Serial.println("[MAIN] getFreeSketchSpace"+ ESP.getFreeSketchSpace());
       Serial.println("[MAIN] temperatureRead"+ String(temperatureRead()));
       Serial.println("[MAIN] temperatureRead()+32)*1.8"+ String((temperatureRead()+32)*1.8));
       Serial.println("[MAIN] hallRead"+ hallRead());
       */

       //Serial.println("[MAIN] getCpuFreqMHz"+ ESP.getCpuFreqMHz());


    #ifdef CO2_on


      #ifndef mit_CO2
        gCO2UpdateFlag = false;
      #endif

     if (gCO2UpdateFlag == true){

       gCO2UpdateFlag = false;

      // Read
        uint16_t eco2, etvoc, errstat, raw;
        ccs811.read(&eco2, &etvoc, &errstat, &raw);
      
        // Print measurement results based on status
      if ( errstat == CCS811_ERRSTAT_OK )
        {
          eco2val1 = eco2;
          etvocval2 = etvoc;
          val1 = eco2val1;
          val2 = etvocval2;
          gWerte2UpdateFlag = 3;

          //val1 = 2000;
         //--------------------------------------------
         //--------  CO2  ------------
         if(val1 <= 600){  //  0-600

            val1max = 2000;// max wert 1000
            vredTo2 = val1max;
            vredFrom2 = 1500;
            vyellowTo2 = vredFrom2;
            vyellowFrom2 = 1000;
            vgreenTo2 = vyellowFrom2;
            vgreenFrom2 = 300;
            val1_color = "0, 250, 0, 0.3";  //grün
            #ifdef CO2_DEBUG
            Serial.println("<1000");
            #endif
           
          }else if(val1 <= 1000){   //   600-800

           val1max = 2000;// max wert 1000
            vredTo2 = val1max;
            vredFrom2 = 1500;
            vyellowTo2 = vredFrom2;
            vyellowFrom2 = 1000;
            vgreenTo2 = vyellowFrom2;
            vgreenFrom2 = 300;
            val1_color = "250, 200, 0, 0.3"; //orange
            #ifdef CO2_DEBUG
            Serial.println("<1000");
            #endif
            
          }else if(val1 <= 1800){   //   800-1000

           val1max = 2000; // max wert 1000
            vredTo2 = val1max;
            vredFrom2 = 1500;
            vyellowTo2 = vredFrom2;
            vyellowFrom2 = 1000;
            vgreenTo2 = vyellowFrom2;
            vgreenFrom2 = 300;
            val1_color = "250, 0, 0, 0.3"; //rot
            #ifdef CO2_DEBUG
            Serial.println("<1000");
            #endif
                    
          }else if(val1 <= 2000){   //  1000 - 2000

            val1max = 2500;    // max wert 2000
            vredTo2 = val1max;
            vredFrom2 = 1500;
            vyellowTo2 = vredFrom2;
            vyellowFrom2 = 1000;
            vgreenTo2 = vyellowFrom2;
            vgreenFrom2 = 300;
            val1_color = "250, , 0, 0.3";//rot
            #ifdef CO2_DEBUG
            Serial.println("<2000");
            #endif

          }else if(val1 <= 3000){

            val1max = 3000;
            vredTo2 = val1max;
            vredFrom2 = 1500;
            vyellowTo2 = vredFrom2;
            vyellowFrom2 = 1000;
            vgreenTo2 = vyellowFrom2;
            vgreenFrom2 = 300;
            val1_color = "250, 0, 0, 0.3";
            #ifdef CO2_DEBUG
            Serial.println("<3000");
            #endif

          }else{

            val1max = val1 + 500;
            vredTo2 = val1max;
            vredFrom2 = 800;
            vyellowTo2 = vredFrom2;
            vyellowFrom2 = 600;
            vgreenTo2 = vyellowFrom2;
            vgreenFrom2 = 300;
            val1_color = "250, 0, 0, 0.3";
            #ifdef CO2_DEBUG
            Serial.println(">3000");
            #endif
          }


         //--------------------------------------------
         //--------  TVOC  ------------
         if(val2 <= 50){   //  0 - 50

            val2max = 100;    // max wert 10
            vredTo3 = val2max;
            vredFrom3 = 80;
            vyellowTo3 = vredFrom3;
            vyellowFrom3 = 50;
            vgreenTo3 = vyellowFrom3;
            vgreenFrom3 = 10;
            val2_color = "0, 250, 0, 0.3";  //grün


          }else if(val2 <= 80){  //  50  - 80

            val2max = 100;    // max wert 100
            vredTo3 = val2max;
            vredFrom3 = 80;
            vyellowTo3 = vredFrom3;
            vyellowFrom3 = 50;
            vgreenTo3 = vyellowFrom3;
            vgreenFrom3 = 10;
            val2_color = "250, 200, 0, 0.3"; //  orange

          }else if(val2 <= 100){

            val2max = 100;    // max wert 100
            vredTo3 = val2max;
            vredFrom3 = 80;
            vyellowTo3 = vredFrom3;
            vyellowFrom3 = 50;
            vgreenTo3 = vyellowFrom3;
            vgreenFrom3 = 10;
            val2_color = "250, 0, 0, 0.3";//  rot

          }else if(val2 <= 150){

            val2max = 150; // max wert 150
            vredTo3 = val2max;
            vredFrom3 = 80;
            vyellowTo3 = vredFrom3;
            vyellowFrom3 = 50;
            vgreenTo3 = vyellowFrom3;
            vgreenFrom3 = 10;
            val2_color = "250, 0, 0, 0.3";//  rot
        
          }else{

            val2max = val2 + 100; 
            vredTo3 = val2max;
            vredFrom3 = 80;
            vyellowTo3 = vredFrom3;
            vyellowFrom3 = 50;
            vgreenTo3 = vyellowFrom3;
            vgreenFrom3 = 10;
            val2_color = "250, 0, 0, 0.3";//  rot

          }


          r0_val1 = String(eco2val1);
          r0_val2 = String(etvocval2);  

  


          #ifdef CO2_DEBUG
          Serial.print("CCS811: ");
          Serial.print("eco2=");
          Serial.print(eco2val1);           
          Serial.print(" ppm  ");
      
          Serial.print("etvoc=");
          Serial.print(etvocval2);
          Serial.print(" ppb  ");
          Serial.println();
          #endif
        }
        else if ( errstat == CCS811_ERRSTAT_OK_NODATA )
        {
          #ifdef CO2_DEBUG
          Serial.println("CCS811: waiting for (new) data");
          #endif
          gWerte2UpdateFlag = 2;
        } else if ( errstat & CCS811_ERRSTAT_I2CFAIL )
        {
          #ifdef CO2_DEBUG
          Serial.println("CCS811: I2C error");
          #endif
          gWerte2UpdateFlag = 3;
        }
        else
        {
          #ifdef CO2_DEBUG
          Serial.print("CCS811: errstat=");
          Serial.print(errstat, HEX);
          Serial.print("=");
          Serial.println( ccs811.errstat_str(errstat) );
          #endif
          gWerte2UpdateFlag = 3;
        }

     }

    #endif


    //---------------------------------
        if (p_sett06 == 1 && p_inputip01 != "000.000.000.000"){  //view Mesh Eingeschaltet        p_mesh_IP_resault =  p_inputip01;    //bei Status 
          tr_h_3 = divon2;  //  Mesh anzeigen
          tr_h_3a = tr_h_3;
        }else{
          tr_h_3 = divhidden2;  //  Mesh nicht anzeigen
          tr_h_3a = tr_h_3;
          divstatus3 = divgrau; //bei Status
        }

        if (mqttdAktiveConfig == true){  //view MQTT Eingeschaltet  
          tr_h_2 = divon2;  // divon2  MQTT anzeigen
          tr_h_2a = tr_h_2;
        }else{
           tr_h_2 = divhidden2;  //  MQTT nicht anzeigen
           tr_h_2a = tr_h_2;
        }

        if (cloudAktiveConfig == true){  //view Cloud Eingeschaltet  
           tr_h_1 = divon2;  //  Cloud anzeigen
           tr_h_1a = tr_h_1;
        }else{
           tr_h_1 = divhidden2;  //  Cloud nicht anzeigen
           tr_h_1a = tr_h_1;
        }

        if (vanAktiveConfig == true){  //view Lüfter Eingeschaltet  
           tr_h_4 = divon2;  //  Lüfter Alarm anzeigen
           tr_h_4a = tr_h_4;
        }else{
           tr_h_4 = divhidden2;  //  Lüfter Alarm nicht anzeigen
           tr_h_4a = tr_h_4;
        }

        if (pushAktiveConfig == true){  //view Push Eingeschaltet  
           tr_h_5 = divon2;  //  Push anzeigen
           tr_h_5a = tr_h_5;
        }else{
           tr_h_5 = divhidden2;  //  Push nicht anzeigen
           tr_h_5a = tr_h_5;
        }

        if (freshdAktiveConfig == true){  //view Freshbox Eingeschaltet  
          tr_h_6 = divon2;  // divon2  MQTT anzeigen
          tr_h_6a = tr_h_6;
        }else{
           tr_h_6 = divhidden2;  //  MQTT nicht anzeigen
           tr_h_6a = tr_h_6;
        }
    //---------------------------------



   //------------------------------------------------------------------------

     //Serial.println("---- Bit  GRAPH delete = " + String(gGraphDeleteFlag));


   }
   //--- 10 sec. ---------------------------------------------------------------------
   //--------------------------------------------------------------------------------










   //--------    Radon Value Led    --------
   //--------------------------------------------------------------------------------
    if(State_anf_schreib_ID_bit == false)  { //nicht ausführen wenn Tracer auf Frreshbox ID wartet

      //------- LED update ----------
      //if (p_sett09 == 1){  //view LED Eingeschaltet  
        if (gledUpdateFlag == true){
          gledUpdateFlag = false;
          //if (ledAktiveConfig == false){

            #ifdef led_on 
              updateColors();    // LEDs
            #endif
          //}
        
        }
      //}
      //--------------------------------------

      if (millis() - msLed > 20 * 1000L) {
          msLed = millis();

          if (ledAktiveConfig == true){
            #ifdef led_on 
              updateColors();    // LEDs
            #endif
          }
      }


    }
   //------ led ---------------------------------------------------------------------
   //--------------------------------------------------------------------------------







  //------------ Timer -------------------
  //---------Verzögerung 10 Sec. -----------------------------------------------------------
   if (millis() - ms6 > 10 * 1000L) {
      ms6 = millis();

     if(mb_afrg_Radon == 2){
       mb_afrg_Radon = 0;
       gModbusValupdateFlag = true;
     }
    
      if (gLedSearchFlag == true || gLedDeleteFlag == true){
        on_LED_Search();
      }

      
   }
  //---------------------------------------------------------------------------------------
  //------------------------------------



  //---------------------------------------------------------------------------
      if (gModbusValupdateFlag == true)  {
            gModbusValupdateFlag = false;

                        // Read register
                        abfr_mb_finish = 0;
                        Error errc = MB.addRequest(1, client_id, READ_INPUT_REGISTER, 0, 6);
                      
                        //while (abfr_mb_finish <= 0) {
                          if (errc==TIMEOUT) {
                            //ModbusError e(err);
                            //LOG_E("aaaError creating request: %02X - %s\n", (int)e, (const char *)e);
                            p_inputsavebit_txt = "Sensor abfrage fehlgeschlagen";
                            p_inputsavebit = "savebit_red";
                            #ifdef MBDebug
                            Serial.println("--> fehlgeschlagen");  
                            #endif
                            abfr_mb_finish = 2;
                            gWerte1UpdateFlag = 1;
                          }
                          if (errc==ACKNOWLEDGE) {
                            p_inputsavebit = "savebit_green";
                            p_inputsavebit_txt = "Sensor Werte aktualisiert";
                            abfr_mb_finish = 1;
                            gWerte1UpdateFlag = 3;
                          }


      }
   //---------------------------------------------------------------------------





   //--- 1 sec. ---------------------------------------------------------------------
   // alle 1sec.
    //if (millis() - ms3 > 1 * 1000L) {
     // ms3 = millis();
   if (g_01sec_UpdateFlag == true){ 
     
      g_01sec_UpdateFlag = false;
      //Serial.println("-- 1sec. --");
     

       //relais_toggle = !relais_toggle; // switch
       //digitalWrite(relaisIN1, relais_toggle);  //Relais1 
       




      if(pauseWebpage == 0){
        ++ g_crc_counter;
        if(g_restart_pw_change_t > 0 ){g_restart_pw_change_t --;}
      }

      if (g_crc_counter == 15 ){
        bit_set_fan = true;  
        g_CRC_ok = false;
        changeFanValue();
      }  
      if (g_crc_counter >= 20 ){
        g_crc_counter = 20;
        if (pauseErrorFan == 0){
          pauseErrorFan = 20;
        }
      }
     
     
      mesh_02_val = " <div style=\"background-color: orange;\"> ";

      if (pauseWebpage > 0){
        pauseWebpage --;
      }

      if (pauseErrorFan > 0){
        pauseErrorFan --;
      }
      
     


      #ifdef Unix_Zeit   
          //epochTime = getTime();
          epochTime = timeClient.getEpochTime();
          epochTime_mqtt = epochTime;// * 1000;
          epochTime_diff = epochTime - epochTime_start;  // p_uptime  esp32_uptimep_uptime
          //Serial.println("--> UNIX Time start: " + String(epochTime_start)); 
          //Serial.println("--> UNIX Time ist: " + String(epochTime)); 
          //Serial.println("--> UNIX Time diff: " + String(epochTime_diff)); 
          
          if (epochTime_diff > 3600){
           
            if (epochTime_diff <= 86400){
              esp32_uptime = epochTime_diff / 3600;
              p_uptime = String(esp32_uptime) + " [h]"; 
              p_uptime2 = "[h]"; 
            }else{
              esp32_uptime = epochTime_diff / 86400;
              p_uptime = String(esp32_uptime) + " [d]"; 
              p_uptime2 = "[d]"; 
            }

          }else{
            if (epochTime_diff > 60){
              esp32_uptime = epochTime_diff / 60;
              p_uptime = String(esp32_uptime) + " [min]"; 
              p_uptime2 = "[min]"; 
            }else{
              p_uptime = "0 [min]"; 
              p_uptime2 = "[min]"; 
            }
          }
          

         
          if (p_timeon == 0){
            if (epochTime > 10000){
              if (epochTime_start < 10000){
                epochTime_start = epochTime;
                #ifdef TimeDebug
                Serial.println("--> UNIX Time geschrieben: " + String(epochTime_start));  
                #endif
                WriteTimeValue();

                epochTime_diff = epochTime - epochTime_start;
                //Serial.println("--> UNIX Time diff: " + String(epochTime_diff)); 
              }
            }
          }

          //Serial.print("Epoch Time: ");
          //Serial.println(epochTime);
      #endif





  #ifdef PCB_v_7
    #ifdef v_4_20_mA  

       if(adc_direction == true){
        //ao1_set_ADC --;
        ao1_set_ADC = ao1_set_ADC - 50;
       }else{
         //ao1_set_ADC ++;
         ao1_set_ADC = ao1_set_ADC + 50;
       }
       

       if(ao1_set_ADC > 2500){
        adc_direction = true;
        ao1_set_ADC = 2500;
        Serial.println(ao1_set_ADC);
        MCP.begin(5);
       }


       if(ao1_set_ADC <= 4){
        adc_direction = false;
        ao1_set_ADC = 0;
        Serial.println(ao1_set_ADC);
        MCP.begin(5);
       }
        Serial.println(ao1_set_ADC);
        MCP.fastWriteA(ao1_set_ADC);
        //MCP.analogWrite(ao1_set_ADC, 0);

    #endif
  #endif //#define PCB_v_7




      //---- wird angesprungen wenn im WM die Daten geändert wurden.
      if (shouldSaveConfig == true){
          shouldSaveConfig = false;
        
            Serial.println("-->> ESP nach AP Modus !");

            Preferences preferences;
            preferences.begin("eenvs", false);                         //Ordner eenvs anlegen/verwenden
           
            ee_wifires = 0;
            preferences.putUInt("ee_wifires", ee_wifires);                  //Variable counter unter "Datei"  speichern
            Serial.printf("Save Boot Anzahl für Reset WLAN: %u\n", ee_wifires);          //Variable counter Seriell ausgeben
           
            ee_portalTimeout = 1;                                            // 30  kürzer wegen neu Booten
            //Serial.printf("Portal Timeout: %u\n", ee_portalTimeout);          //Variable counter Seriell ausgeben
            preferences.putUInt("ePortalTime", ee_portalTimeout);                  //Variable counter unter "Datei" ee_portalTimeout speichern 
           
            ee_ip_search = 0;
            preferences.putUInt("ee_ipsearch", ee_ip_search);                  //Variable unter "Datei" ee_ipsearch speichern 

            gCONNECTEDflag = 0;
            preferences.putUInt("gCONNflag", gCONNECTEDflag);                  //Variable  speichern   // 1=WLAN ist verbunden

            preferences.end();                                      //Preferences beenden
  
            Serial.println("-->> now restart ......");
            delay(1000);
            ESP.restart(); 
      }

      


    }
   //--- 1 sec. ---------------------------------------------------------------------




      //--------------------- WLAN RESET mit Boot Button ---------------------------
        b_BOOT = digitalRead(PIN_BOOT_BUTTON);
        if( b_BOOT == HIGH) { 
            reset_timer_wlan = 20;
        }
      //-----------------------------------------------------------------------------





     //--------------------- UPDATE LED Farben nach Radon ausgelesen ---------------------------
     if (gLEDColorUpdateFlag == true){
       gLEDColorUpdateFlag = false;
       //UpdateLEDValue();

     }  
     //----------------------------------------------------------------------------------------





     //--------------------- Graph update alle 15 min ---------------------------
     if (gGRAPHReadFlag == true){  

          //datei_lesen_line();  // TVOC Daten
          //datei_lesen_line2();  // co2 Daten
          datei_lesen_line3();  // radon Daten
          //datei_lesen_line5();  // Hz Daten
          //datei_lesen_line7();  // Radon FAN Daten
          //datei_lesen_line8();  // radon mqtt lost Daten

          ReadChartValue();

       UpdateChartValue();

         if (gGRAPHUpdateFlag == true){ 
          //datei_schreiben();  // tvoc Daten
          //datei_schreiben2();  // co2 Daten
          datei_schreiben3();  // radon Daten
          //datei_schreiben5();  // Hz Daten
          //datei_schreiben7();  // Radon FAN Daten

          WritedChartValue();
         }

         gGRAPHUpdateFlag = false;
         gGRAPHReadFlag = false;

     }  
     //----------------------------------------------------------------------------------------




    //--------------------- Messwerte ---------------------------
    if (sensor_vals_read == true){
      sensor_vals_read = false;
    
      
        measurement = hallRead();
        measurement_lage = measurement;
       #ifdef tempDebug
        Serial.println("---------------------------------");
        Serial.print("Hall sensor measurement: ");
        Serial.println(measurement_lage); 
      #endif

      
        measurement_temp = (temprature_sens_read() - 32) / 1.8;
      #ifdef tempDebug
        Serial.print("Temperature: ");
        // Convert raw temperature in F to Celsius degrees
        Serial.print(measurement_temp);  
        Serial.println(" °C");
        Serial.println("---------------------------------");
      #endif

    }
    //------------------------------------------------------------





    //------------------------------------------------------------------
    if (gGraphDeleteFlag == true && gGraphDeleteFlag == 1){
       gGraphDeleteFlag = false;
        Serial.println("---- GRAPH delete -------");
        chartime00 = "";
        chartime00a = "";
        chartime00b = "";
        chartime01 = "";
        chartime01a = "";
        chartime01b = "";
        chartime02 = "";
        chartime02a = "";
        chartime02b = "";
        chartime03 = "";
        chartime03a = "";
        chartime03b = "";
        chartime04 = "";
        chartime04a = "";
        chartime04b = "";
        chartime05 = "";
        chartime05a = "";
        chartime05b = "";
        chartime06 = "";
        chartime06a = "";
        chartime06b = "";
        chartime07 = "";
        chartime07a = "";
        chartime07b = "";
        chartime08 = "";
        chartime08a = "";
        chartime08b = "";
        chartime09 = "";
        chartime09a = "";
        chartime09b = "";
        chartime10 = "";
        chartime10a = "";
        chartime10b = "";
        chartime11 = "";
        chartime11a = "";
        chartime11b = "";
        chartime12 = "";
        chartime12a = "";
        chartime12b = "";
        chartime13 = "";
        chartime13a = "";
        chartime13b = "";

        radon_tag = 0;
        radon_tag01 = 0;
        radon_tag02 = 0;
        radon_tag03 = 0;
        radon_tag04 = 0;
        radon_tag05 = 0;
        radon_tag06 = 0;
        radon_tag07 = 0;
        radon_tag08 = 0;
        radon_tag09 = 0;
        radon_tag10 = 0;
        radon_tag11 = 0;
        radon_tag12 = 0;
        radon_tag13 = 0;
        radon_tag14 = 0;
        radonTagCount = 0;
        radonTagEintrCount = 0;
        radonMore14Day = 0;
        charcount = 0;
        chartumlauf = 0;
        
          //-------------------
          // Wiederhole 41 Mal:
          
          for (int i=0; i <= 41; i++){
              
            #ifdef old_option
              charInts4[i] = 0;
              charInts3[i] = 0;
              charInts5[i] = 0;
              charInts8[i] = 0;
            #endif 
            charInts[i] = 0;
            
          } 
         
          //--------------------

           /*
          //--------------------- 
          for (int i=0; i <= 64; i++){
            charInts8_s[i] = "";
          } 
          charcount8 = 0;   // Zeilen inhalt der MQTT nicht übertragenen Dateien
          gcharcount8Del = true;
          datei_schreiben8();  // DELETE Radon mqtt lost Daten
          //---------------------
          */

          //----- DELETE ------
          //datei_schreiben();  // tvoc Daten
          //datei_schreiben2();  // co2 Daten
          datei_schreiben3();  // radon Daten
          //datei_schreiben5();  // Hz Daten
          //datei_schreiben7();  // Radon Fan Daten


          WritedChartValue();
         
         // balken auf 0
         stringdata2 = "data : [" + String(radon_tag01) + "," + String(radon_tag02) + "," + String(radon_tag03) + "," + String(radon_tag04) + "," + String(radon_tag05) + "," + String(radon_tag06) + "," + String(radon_tag07) + "," + String(radon_tag08) + "," + String(radon_tag09) + "," + String(radon_tag10) + "," + String(radon_tag11) + "," + String(radon_tag12) + "," + String(radon_tag13) + "," + String(radon_tag14) + ",],";


    }
    //----------------------------------------------------------------------






      //--------------------------------------------------------------------------------------------
      #ifdef MeshRoom
      if(gMESHUpdateFlag == true){
        //mesh_werteaktual = "Mesh deaktiviert";  
        //mesh_aktiv = " class='Stil1b' "; 

        //Serial.println("Mesh update " + p_time);

          mesh_01_val = " class='Stil1' ";
          b_set_mesh_on = false;
          b_set_mesh_read = true;
        //**************************************************************************
                  // p_mesh_IP_resault =  p_inputip01;    //bei Status 
          if (p_room01 != "----------" && p_inputip01 != "000.000.000.000"){
            //if (p_inputip01 != "000.000.000.000"){
              b_set_mesh_on = true;
              div01 = divon;
              if (toggle_client == 0){
                
                    toggle_client = 1; 
                    gMESHUpdateFlag = false;

                if(count_mesh_1_fail <=3){
                  
                    //-------------
                    #ifdef MeshDebug
                    Serial.println("------------------------------------");
                    Serial.println("Room 1");
                    #endif
                    mesh_werteaktual = "<span class='Stil5'>Mesh aktiviert</div>"; 
                    mesh_aktiv = " class='Stil1a' ";

                    p_inputip01.toCharArray(p_inputip01c, 15);
                    // http://192.168.178.62/radon.html
                    #ifdef MeshDebug
                    Serial.print("connecting to ");
                    Serial.println(p_inputip01);
                    #endif
                    // Use WClient class to create TCP connections
                    WiFiClient client;
                    const int httpPort = 80;
                    b_set_mesh_online = true;


                    if (!client.connect(p_inputip01c, httpPort)) {
                      #ifdef MeshDebug
                        Serial.println("connection failed");
                        Serial.println("------------------------------------");
                      #endif
                      b_set_mesh_online = false;
                      //log_list[log_list_count] = String(p_time) + " | MESH 1: " + String(p_inputip01c) + " connect failed!";
                      divstatus3 = divred; //bei Status
                      //update_log();
                      mesh_01_val = " class='Stil8' ";
                      toggle_client = 0; 
                      div01rg = divr;

                      #ifdef MeshDebug_min
                      Serial.println("-->  " + p_time + " Mesh 1 connection failed"); 
                      #endif
                      count_mesh_1_fail ++;

                      return;

                    }else{

                      #ifdef MeshDebug_min
                      Serial.println("-->  " + p_time + " Mesh 1 connect success"); 
                      #endif
                      count_mesh_1_fail = 0;

                    }
                    
                    divstatus3 = divgreen; //bei Status
                    div01rg = divg;
                    mesh_01_val = " class='Stil7' ";
                    // We now create a URI for the request
                    String url = "/radon.html";
                    
                    //Serial.print("Requesting URL: ");
                    //Serial.println(url);
                    
                    // This will send the request to the server
                    client.print(String("GET ") + url + " HTTP/1.1\r\n" +
                                "Host: " + "192.168.178.62" + "\r\n" + 
                                "Connection: close\r\n\r\n");
                    // start waiting for the response    

                    String line_t = ""; 

                    unsigned long lasttime = millis();
                    while (!client.available() && millis() - lasttime < 1000) {delay(1);}   // wait max 1s for data
                    // Read all the lines of the reply from server and print them to Serial

                    
                      while (client.available()) {
                      
                      String line = client.readStringUntil('\n');
                    
                      if (line.indexOf("var1")>=1) {   // Searchstring exists?
                      
                        line_t = line;
                      // Serial.println(line_t);

                        uint32_t position1 = line_t.indexOf(">CO2:") + 5;
                              //Serial.println(position1);
                        
                        uint32_t position2 = line_t.indexOf(">TVOC:") + 6;
                            // Serial.println(position2);
                        
                        uint32_t position3 = line_t.indexOf(">Radon:") + 7;
                              //Serial.println(position3);
                      
                        uint32_t position4 = line_t.indexOf("ppm<") - 3;
                              //Serial.println(position4);
                        
                        uint32_t position5 = line_t.indexOf("ppb<") - 3;
                              //Serial.println(position5);
                        
                        uint32_t position6 = line_t.indexOf("bqm3<") - 0;
                              //Serial.println(position6);

                        //Serial.println(line_t);
                        #ifdef MeshDebug
                          Serial.println();
                          Serial.print("CO2 ");
                          Serial.println(line_t.substring(position1, position4));
                        #endif
                        r1_val1 = line_t.substring(position1, position4);
                        #ifdef MeshDebug
                          Serial.print("TVOV ");
                          Serial.println(line_t.substring(position2, position5));
                        #endif
                        r1_val2 = line_t.substring(position2, position5);
                        #ifdef MeshDebug
                          Serial.print("Radon ");
                          Serial.println(line_t.substring(position3, position6));
                        #endif
                        r1_val3 = line_t.substring(position3, position6);

                        // Mesh oder dieser Sensor
                        if(p_sett20 == 0){
                          fval1 = r1_val3.toInt();  
                        }

                        //String radonSubString = line_t.substring(position3,position6);
                        //int radon = atoi(radonSubString.c_str());

                      }
                      //Serial.print(line);
                    }
                    #ifdef MeshDebug
                    Serial.println();
                    Serial.println("closing connection Room 1");
                    Serial.println("------------------------------------");
                    #endif
               
                }else{
                    
                      #ifdef MeshDebug_min
                      Serial.println("-->  " + p_time + " Mesh 1 connection paused"); 
                      #endif
                      if(count_mesh_1_fail != 30){
                       // log_list[log_list_count] = String(p_time) + " | MESH 1: " + String(p_inputip01c) + " connection paused!";
                        divstatus3 = divred; //bei Status
                        //update_log();
                      }
                      count_mesh_1_fail = 30;

                }
                
                    toggle_client = 0; 
                    //----------
              }
            // }
          }else{
            div01 = divhidden;
            divstatus3 = divgrau; //bei Status
          }
        //**************************************************************************
        
      } 
      #endif 


      //--------------------------------------------------------------------------------------------
      #ifdef MeshRoom
      if(gMESHUpdateFlag2 == true){
          mesh_02_val = " class='Stil1' ";
        //************************************************************************** 
          if (p_room02 != "----------" && p_inputip02 != "000.000.000.000"){
            //if (p_inputip02 != "000.000.000.000"){
              div02 = divon;
              if (toggle_client == 0){
                
                  gMESHUpdateFlag2 = false;
                  toggle_client = 1;

                if(count_mesh_2_fail <=3){

                      #ifdef MeshDebug
                        Serial.println("------------------------------------");
                        Serial.println("Room 2");
                      #endif
                      p_inputip02.toCharArray(p_inputip02c, 15);
                      #ifdef MeshDebug
                        Serial.print("connecting to ");
                        Serial.println(p_inputip02);
                      #endif
                      WiFiClient client;

                      const int httpPort = 80;
                        
                      if (!client.connect(p_inputip02c, httpPort)) {
                        #ifdef MeshDebug
                          Serial.println("connection failed");
                          Serial.println("------------------------------------");
                        #endif
                       // log_list[log_list_count] = String(p_time) + " | MESH 2: " + String(p_inputip01c) + " connect failed!";
                        //update_log();
                        mesh_02_val = " class='Stil8' ";
                        toggle_client = 0;
                        div02rg = divr;

                        #ifdef MeshDebug_min
                        Serial.println("-->  " + p_time + " Mesh 2 connection failed"); 
                        #endif
                        count_mesh_2_fail ++;

                        return;

                      }else{

                        #ifdef MeshDebug_min
                        Serial.println("-->  " + p_time + " Mesh 2 connect success"); 
                        #endif
                        count_mesh_2_fail = 0;
                      }

                      div02rg = divg;
                      mesh_02_val = " class='Stil7' ";
                      String url = "/radon.html";
                      client.print(String("GET ") + url + " HTTP/1.1\r\n" +
                                    "Host: " + p_inputip02 + "\r\n" + 
                                    "Connection: close\r\n\r\n");
                      String line_t = "";  
                      unsigned long lasttime = millis();
                      while (!client.available() && millis() - lasttime < 1000) {delay(1);}   // wait max 1s for data         
                          while (client.available()) {
                          String line = client.readStringUntil('\n');
                          if (line.indexOf("var1")>=1) {   // Searchstring exists?
                            line_t = line;
                            uint32_t position1 = line_t.indexOf(">CO2:") + 5;              
                            uint32_t position2 = line_t.indexOf(">TVOC:") + 6;
                            uint32_t position3 = line_t.indexOf(">Radon:") + 7;
                            uint32_t position4 = line_t.indexOf("ppm<") - 3;
                            uint32_t position5 = line_t.indexOf("ppb<") - 3;
                            uint32_t position6 = line_t.indexOf("bqm3<") - 0;
                          
                            #ifdef MeshDebug
                              Serial.println();
                              Serial.print("CO2 ");
                              Serial.println(line_t.substring(position1, position4));
                            #endif
                            
                              r2_val1 = line_t.substring(position1, position4);
                            #ifdef MeshDebug
                              Serial.print("TVOV ");
                              Serial.println(line_t.substring(position2, position5));
                            #endif
                              r2_val2 = line_t.substring(position2, position5);
                            #ifdef MeshDebug
                              Serial.print("Radon ");
                              Serial.println(line_t.substring(position3, position6));
                            #endif
                              r2_val3 = line_t.substring(position3, position6);
                          }
                        }
                        #ifdef MeshDebug
                          Serial.println();
                          Serial.println("closing connection Room 2");
                          Serial.println("------------------------------------");
                        #endif
                  
                }else{
                    
                      #ifdef MeshDebug_min
                      Serial.println("-->  " + p_time + " Mesh 2 connection paused"); 
                      #endif
                      if(count_mesh_2_fail != 30){
                       // log_list[log_list_count] = String(p_time) + " | MESH 2: " + String(p_inputip02c) + " connection paused!";
                        //update_log();
                      }
                      count_mesh_2_fail = 30;

                }
                  
                    toggle_client = 0; 
                    //----------
              }
           // }
          }else{
            div02 = divhidden;
          }
        //**************************************************************************
      }   
      #endif   
      //--------------------------------------------------------------------------------------------

   
      //--------------------------------------------------------------------------------------------
      #ifdef MeshRoom
      if(gMESHUpdateFlag3 == true){   
          mesh_03_val = " class='Stil1' "; 
        //************************************************************************** 
         if (p_room03 != "----------" && p_inputip03 != "000.000.000.000"){
            //if (p_inputip02 != "000.000.000.000"){
              div03 = divon;
              if (toggle_client == 0){

                 gMESHUpdateFlag3 = false; 
                 toggle_client = 1; 

                if(count_mesh_3_fail <=3){  
                 

                      #ifdef MeshDebug
                        Serial.println("------------------------------------");
                        Serial.println("Room 3");
                      #endif
                      p_inputip03.toCharArray(p_inputip03c, 15);
                      #ifdef MeshDebug
                        Serial.print("connecting to ");
                        Serial.println(p_inputip03);
                      #endif
                      WiFiClient client;

                      const int httpPort = 80;
                        
                      if (!client.connect(p_inputip03c, httpPort)) {
                        #ifdef MeshDebug
                          Serial.println("connection failed");
                          Serial.println("------------------------------------");
                        #endif
                        mesh_03_val = " class='Stil8' ";
                        toggle_client = 0;
                        div03rg = divr;

                        #ifdef MeshDebug_min
                        Serial.println("-->  " + p_time + " Mesh 3 connection failed"); 
                        #endif
                        count_mesh_3_fail ++;

                        return;

                      }else{

                        #ifdef MeshDebug_min
                        Serial.println("-->  " + p_time + " Mesh 3 connect success"); 
                        #endif
                        count_mesh_3_fail = 0;
                      }

                      div03rg = divg;
                      mesh_03_val = " class='Stil7' ";
                      String url = "/radon.html";
                      client.print(String("GET ") + url + " HTTP/1.1\r\n" +
                                    "Host: " + p_inputip03 + "\r\n" + 
                                    "Connection: close\r\n\r\n");
                      String line_t = "";  
                      unsigned long lasttime = millis();
                      while (!client.available() && millis() - lasttime < 1000) {delay(1);}   // wait max 1s for data         
                          while (client.available()) {
                          String line = client.readStringUntil('\n');
                          if (line.indexOf("var1")>=1) {   // Searchstring exists?
                            line_t = line;
                            uint32_t position1 = line_t.indexOf(">CO2:") + 5;              
                            uint32_t position2 = line_t.indexOf(">TVOC:") + 6;
                            uint32_t position3 = line_t.indexOf(">Radon:") + 7;
                            uint32_t position4 = line_t.indexOf("ppm<") - 3;
                            uint32_t position5 = line_t.indexOf("ppb<") - 3;
                            uint32_t position6 = line_t.indexOf("bqm3<") - 0;
                            #ifdef MeshDebug
                              Serial.println();
                              Serial.print("CO2 ");
                              Serial.println(line_t.substring(position1, position4));
                            #endif
                              r3_val1 = line_t.substring(position1, position4);
                            #ifdef MeshDebug
                              Serial.print("TVOV ");
                              Serial.println(line_t.substring(position2, position5));
                            #endif
                              r3_val2 = line_t.substring(position2, position5);
                            #ifdef MeshDebug
                              Serial.print("Radon ");
                              Serial.println(line_t.substring(position3, position6));
                            #endif
                            r3_val3 = line_t.substring(position3, position6);
                          }
                        }
                        #ifdef MeshDebug
                          Serial.println();
                          Serial.println("closing connection Room 3");
                          Serial.println("------------------------------------");
                        #endif
                  
                }else{
                    
                      #ifdef MeshDebug_min
                      Serial.println("-->  " + p_time + " Mesh 3 connection paused"); 
                      #endif
                      if(count_mesh_3_fail != 30){
                       // log_list[log_list_count] = String(p_time) + " | MESH 3: " + String(p_inputip03c) + " connection paused!";
                        //update_log();
                      }
                      count_mesh_3_fail = 30;

                }
                  
                    toggle_client = 0; 
                    //----------
              }
           // }
          }else{
            div03 = divhidden;
          }
        //**************************************************************************
      }   
      #endif   

   
      //--------------------------------------------------------------------------------------------
      #ifdef MeshRoom
      if(gMESHUpdateFlag4 == true){
        //************************************************************************** 
         if (p_room04 != "----------" && p_inputip04 != "000.000.000.000"){
            //if (p_inputip02 != "000.000.000.000"){
              div04 = divon;
              if (toggle_client == 0){

                  gMESHUpdateFlag4 = false;
                  toggle_client = 1; 

                if(count_mesh_4_fail <=3){
               
  
                      #ifdef MeshDebug
                        Serial.println("------------------------------------");
                        Serial.println("Room 4");
                      #endif
                        p_inputip04.toCharArray(p_inputip04c, 15);
                      #ifdef MeshDebug
                        Serial.print("connecting to ");
                        Serial.println(p_inputip04);
                      #endif
                      WiFiClient client;
                      const int httpPort = 80;
                        
                      if (!client.connect(p_inputip04c, httpPort)) {
                        #ifdef MeshDebug
                          Serial.println("connection failed");
                          Serial.println("------------------------------------");
                        #endif
                        mesh_04_val = " class='Stil8' ";
                        toggle_client = 0;
                        div04rg = divr;

                        #ifdef MeshDebug_min
                        Serial.println("-->  " + p_time + " Mesh 4 connection failed"); 
                        #endif
                        count_mesh_4_fail ++;

                        return;

                      }else{

                        #ifdef MeshDebug_min
                        Serial.println("-->  " + p_time + " Mesh 4 connect success"); 
                        #endif
                        count_mesh_4_fail = 0;
                      }

                      div04rg = divg;
                      mesh_04_val = " class='Stil7' ";
                      String url = "/radon.html";
                      client.print(String("GET ") + url + " HTTP/1.1\r\n" +
                                    "Host: " + p_inputip04 + "\r\n" + 
                                    "Connection: close\r\n\r\n");
                      String line_t = "";  
                      unsigned long lasttime = millis();
                      while (!client.available() && millis() - lasttime < 1000) {delay(1);}   // wait max 1s for data         
                          while (client.available()) {
                          String line = client.readStringUntil('\n');
                          if (line.indexOf("var1")>=1) {   // Searchstring exists?
                            line_t = line;
                            uint32_t position1 = line_t.indexOf(">CO2:") + 5;              
                            uint32_t position2 = line_t.indexOf(">TVOC:") + 6;
                            uint32_t position3 = line_t.indexOf(">Radon:") + 7;
                            uint32_t position4 = line_t.indexOf("ppm<") - 3;
                            uint32_t position5 = line_t.indexOf("ppb<") - 3;
                            uint32_t position6 = line_t.indexOf("bqm3<") - 0;
                            #ifdef MeshDebug
                            Serial.println();
                            Serial.print("CO2 ");
                            Serial.println(line_t.substring(position1, position4));
                            #endif
                            r4_val1 = line_t.substring(position1, position4);
                            #ifdef MeshDebug
                            Serial.print("TVOV ");
                            Serial.println(line_t.substring(position2, position5));
                            #endif
                            r4_val2 = line_t.substring(position2, position5);
                            #ifdef MeshDebug
                            Serial.print("Radon ");
                            Serial.println(line_t.substring(position3, position6));
                            #endif
                            r4_val3 = line_t.substring(position3, position6);
                          }
                        }
                        #ifdef MeshDebug
                        Serial.println();
                        Serial.println("closing connection Room 4");
                        Serial.println("------------------------------------");
                        #endif

                }else{
                    
                      #ifdef MeshDebug_min
                      Serial.println("-->  " + p_time + " Mesh 4 connection paused"); 
                      #endif
                      if(count_mesh_4_fail != 30){
                       // log_list[log_list_count] = String(p_time) + " | MESH 3: " + String(p_inputip04c) + " connection paused!";
                        //update_log();
                      }
                      count_mesh_4_fail = 30;

                }

                    toggle_client = 0; 
                    //----------
              }
           // }
          }else{
            div04 = divhidden;
          }
        //**************************************************************************
      }  
      #endif    
   
   
      //--------------------------------------------------------------------------------------------
      #ifdef MeshRoom
      if(gMESHUpdateFlag5 == true){
        //************************************************************************** 
        if (p_room05 != "----------" && p_inputip05 != "000.000.000.000"){
            //if (p_inputip02 != "000.000.000.000"){
              div05 = divon;
              if (toggle_client == 0){
                 
                  gMESHUpdateFlag5 = false;
                  toggle_client = 1; 
               
                if(count_mesh_5_fail <=3){

                      
                      #ifdef MeshDebug
                        Serial.println("------------------------------------");
                        Serial.println("Room 5");
                      #endif
                      p_inputip03.toCharArray(p_inputip05c, 15);
                      #ifdef MeshDebug
                      Serial.print("connecting to ");
                      Serial.println(p_inputip05);
                      #endif
                      WiFiClient client;
                      const int httpPort = 80;
                        
                      if (!client.connect(p_inputip05c, httpPort)) {
                        #ifdef MeshDebug
                        Serial.println("connection failed");
                        Serial.println("------------------------------------");
                        #endif
                        mesh_05_val = " class='Stil8' ";
                        toggle_client = 0;
                        div05rg = divr;

                        #ifdef MeshDebug_min
                        Serial.println("-->  " + p_time + " Mesh 5 connection failed"); 
                        #endif
                        count_mesh_5_fail ++;

                        return;

                      }else{

                        #ifdef MeshDebug_min
                        Serial.println("-->  " + p_time + " Mesh 5 connect success"); 
                        #endif
                        count_mesh_5_fail = 0;
                      }

                      div05rg = divg;
                      mesh_05_val = " class='Stil7' ";
                      String url = "/radon.html";
                      client.print(String("GET ") + url + " HTTP/1.1\r\n" +
                                    "Host: " + p_inputip05 + "\r\n" + 
                                    "Connection: close\r\n\r\n");
                      String line_t = "";  
                      unsigned long lasttime = millis();
                      while (!client.available() && millis() - lasttime < 1000) {delay(1);}   // wait max 1s for data         
                          while (client.available()) {
                          String line = client.readStringUntil('\n');
                          if (line.indexOf("var1")>=1) {   // Searchstring exists?
                            line_t = line;
                            uint32_t position1 = line_t.indexOf(">CO2:") + 5;              
                            uint32_t position2 = line_t.indexOf(">TVOC:") + 6;
                            uint32_t position3 = line_t.indexOf(">Radon:") + 7;
                            uint32_t position4 = line_t.indexOf("ppm<") - 3;
                            uint32_t position5 = line_t.indexOf("ppb<") - 3;
                            uint32_t position6 = line_t.indexOf("bqm3<") - 0;
                            #ifdef MeshDebug
                            Serial.println();
                            Serial.print("CO2 ");
                            Serial.println(line_t.substring(position1, position4));
                            #endif
                            r5_val1 = line_t.substring(position1, position4);
                            #ifdef MeshDebug
                            Serial.print("TVOV ");
                            Serial.println(line_t.substring(position2, position5));
                            #endif
                            r5_val2 = line_t.substring(position2, position5);
                            #ifdef MeshDebug
                            Serial.print("Radon ");
                            Serial.println(line_t.substring(position3, position6));
                            #endif
                            r5_val3 = line_t.substring(position3, position6);
                          }
                        }
                        #ifdef MeshDebug
                        Serial.println();
                        Serial.println("closing connection Room 5");
                        Serial.println("------------------------------------");
                        #endif

                }else{
                    
                      #ifdef MeshDebug_min
                      Serial.println("-->  " + p_time + " Mesh 5 connection paused"); 
                      #endif
                      if(count_mesh_5_fail != 30){
                       //log_list[log_list_count] = String(p_time) + " | MESH 5: " + String(p_inputip05c) + " connection paused!";
                        //update_log();
                      }
                      count_mesh_5_fail = 30;

                }

                    toggle_client = 0; 
                    //----------
              }
           // }
          }else{
            div05 = divhidden;
          }
        //**************************************************************************
      }
      #endif
      //-------------------------------------------------------------------------------  
      






  // print the string when a newline arrives:
  if (stringComplete) {
    Serial.println(inputString);
    // clear the string:
    inputString = "";
    stringComplete = false;
  }


 // Daten nur senden, wenn Daten erhalten:
  // check if data is available
  /*
  int rxlen = Serial1.available(); // number of bytes available in Serial buffer
  if (rxlen > 17) {
  //if (rxlen > 0) {
  
    int rlen; // number of bytes to read
    if (rxlen > BUFFER_SIZE1) // check if the data exceeds the buffer size
      rlen = BUFFER_SIZE1;    // if yes, read BUFFER_SIZE bytes. The remaining will be read in the next time
    else
      rlen = rxlen;
     
    // read the incoming bytes:
    rlen = Serial1.readBytes(buf1, rlen);

    // prints the received data
    Serial.print("I received: ");
    for(int i = 0; i < rlen; i++)
      Serial.print(buf1[i],HEX);
       Serial.println("");
  }
*/

#ifdef vent_option

  if(pauseErrorFan == 0){
    if(pauseWebpage == 0){
      //if (Serial1.available() > 0) {
      if (Serial1.available() > 14) {
        // read the incoming bytes:
        msg_TGt = 0xFC;
        //int rlen = Serial1.readBytesUntil('\n', buf1, BUFFER_SIZE1);
        int rlen = Serial1.readBytesUntil(msg_TGt, buf1, BUFFER_SIZE1);

        // prints the received data
        //Serial.print(String(rlen) + "  I received: ");
        
        
        for(int i = 0; i < rlen; i++)
        // Serial.print(buf1[i]);
          //Serial.printf(" %02X",buf1[i]);
          //Serial.println("");

          


          //ser_val_01[0] = buf1[1];
          ser_val_01[0] = (byte)buf1[0];
          ser_val_01[1] = (byte)buf1[1];
          //Serial.println(ser_val_01[0]);
          //Serial.println(ser_val_01[1]);

          ser_val_02[0] = (byte)buf1[2];
          ser_val_02[1] = (byte)buf1[3];
          //Serial.println(ser_val_02[0]);
          //Serial.println(ser_val_02[1]);

          ser_val_03[0] = (byte)buf1[4];
          ser_val_03[1] = (byte)buf1[5];
          //Serial.println(ser_val_03[0]);
          //Serial.println(ser_val_03[1]);

          ser_val_04 = (byte)buf1[6];
          //Serial.println(ser_val_04);

          ser_val_05[0] = (byte)buf1[7];
          ser_val_05[1] = (byte)buf1[8];
          //Serial.println(ser_val_05[0]);
          //Serial.println(ser_val_05[1]);

          ser_val_06[0] = (byte)buf1[9];
          ser_val_06[1] = (byte)buf1[10];
          //Serial.println(ser_val_06[0]);
          //Serial.println(ser_val_06[1]);

          ser_val_07 = (byte)buf1[11];
          //Serial.println(ser_val_07);

          ser_val_08 = (byte)buf1[12];
          ser_val_09 = (byte)buf1[13];
          ser_val_10 = (byte)buf1[14];
          ser_val_11 = (byte)buf1[15];

          ser_val_12 = (byte)buf1[16];
          //Serial.println(ser_val_12);

          f_check_rec = ser_val_01[0]+ser_val_01[1]+ser_val_02[0]+ser_val_02[1]+ser_val_03[0]+ser_val_03[1]+ser_val_04+ser_val_05[0]+ser_val_05[1]+ser_val_06[0]+ser_val_06[1]+ser_val_07+ser_val_08+ser_val_09+ser_val_10+ser_val_11;
          byte low_byte = lowByte(f_check_rec);
          //Serial.println("CRC1: " + String(low_byte)); 
          //Serial.println("CRC2: " + String(ser_val_12)); 
          //if (g_crc_counter > 6 ){ 
            //g_crc_counter ++; //erst dann hier auch
          //}
          g_CRC_ok = false;
          if (g_crc_counter >= 20){
            g_crc_errorBit = true; // Daten kommen an aber fehler nach Zeit
            //Serial.println("CRC Fehler: "); 
            g_crc_counter = 20; 
          }

      
          gWerte3UpdateFlag = 1;
          if (low_byte == ser_val_12 && low_byte !=0 && ser_val_12 !=0){

            g_crc_counter = 0; 
            g_CRC_ok = true;           // b_set_mesh_online
            g_crc_errorBit = false;
            gWerte3UpdateFlag = 3;

              f_filterRemaining = word(ser_val_01[0], ser_val_01[1]);
              fval2 = f_filterRemaining;
              //Serial.println("Filter: " + String(f_filterRemaining));
            
              f_min = ser_val_02[0];
              //Serial.println("min: " + String(f_min));    
              f_pwm = ser_val_02[1];
              fval3 = f_pwm;
              //Serial.println("pwm: " + String(f_pwm));
            
              f_alarmlevl = word(ser_val_03[1], ser_val_03[0]);
              fval4 = f_alarmlevl;
              //Serial.println("Alarmlevel: " + String(f_alarmlevl));

              fval5 = ser_val_09;
              //Serial.println("Speed: " + String(ser_val_09));

              f_alarm = ser_val_04;
              fval6 = f_alarm;
              //Serial.println("alarm: " + String(f_alarm));

              f_software = word(ser_val_05[1], ser_val_05[0]);
                //fvalx = f_software;
              //Serial.println("software: " + String(f_software));

              f_opHour = word(ser_val_06[1], ser_val_06[0]);
              fval7 = f_opHour;
              //Serial.println("Operation h: " + String(f_opHour));

              f_filterMonitor = ser_val_07;
              fval8 = f_filterMonitor;
              //Serial.println("Filter Monitor: " + String(f_filterMonitor));

              f_checksum = ser_val_12;
              //fvalx = f_filterMonitor;
              //Serial.println("checksum: " + String(f_checksum));

              //Serial.println("");


                  if (f_alarm == 0) {
                  f_alarm_s = "off";
                  divfan7 = divgrau;
                  divstatus7 = divgrau;  // Status
                  }
                  else if (f_alarm == 1) {
                  f_alarm_s = "no Alarm";
                  divfan7 = divgreen;
                  divstatus7 = divgreen;  // Status
                  }
                  else if (f_alarm == 2) {
                  f_alarm_s = "Alarm";
                  divfan7 = divred;
                  divstatus7 = divred;  // Status
                  }
                  else {
                  f_alarm_s = " ";
                  divfan7 = divgrau;
                  divstatus7 = divgrau;  // Status
                  }


                  divfan1 = divgrau;
                  divfan2 = divgrau;
                  divfan3 = divgrau;
                  divfan4 = divgrau;
                  divfan5 = divgrau;
                  divfan6 = divgrau;

                  if (f_filterMonitor == 0) {
                  divfan1 = divgreen;
                  }
                  else if (f_filterMonitor == 1) {
                  divfan1 = divgreen;
                  divfan2 = divgreen;
                  }
                  else if (f_filterMonitor == 2) {
                  divfan1 = divgreen;
                  divfan2 = divgreen;
                  divfan3 = divgreen;
                  }
                  else if (f_filterMonitor == 3) {
                  divfan1 = divgreen;
                  divfan2 = divgreen;
                  divfan3 = divgreen;
                  divfan4 = divgreen;
                  }
                  else if (f_filterMonitor == 4) {
                  divfan1 = divgreen;
                  divfan2 = divgreen;
                  divfan3 = divgreen;
                  divfan4 = divgreen;
                  divfan5 = divgreen;
                  }
                  else if (f_filterMonitor == 5) {
                  divfan1 = divgreen;
                  divfan2 = divgreen;
                  divfan3 = divgreen;
                  divfan4 = divgreen;
                  divfan5 = divgreen;
                  divfan6 = divgreen;
                  }


                  //---------------------------------------------
                    divpower01 = divpwgrau;
                    divpower02 = divpwgrau;
                    divpower03 = divpwgrau;
                    divpower04 = divpwgrau;
                    divpower05 = divpwgrau;
                    divpower06 = divpwgrau;
                    divpower07 = divpwgrau;
                    divpower08 = divpwgrau;
                    divpower09 = divpwgrau;
                    divpower10 = divpwgrau;
                    divpower11 = divpwgrau;
                    divpower12 = divpwgrau;
                    divpower13 = divpwgrau;
                    divpower14 = divpwgrau;
                    divpower15 = divpwgrau;
                    divpower16 = divpwgrau;
                    divpower17 = divpwgrau;
                    divpower18 = divpwgrau;
                    divpower19 = divpwgrau;
                    divpower20 = divpwgrau;
                
                  if (f_pwm == 5) {
                    divpower01 = divpwgreen;
                  }
                  if (f_pwm == 10) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                  } 
                  if (f_pwm == 15) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                  } 
                  if (f_pwm == 20) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                  } 
                  if (f_pwm == 25) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                  } 
                  if (f_pwm == 30) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                  } 
                  if (f_pwm == 35) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                  } 
                  if (f_pwm == 40) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                  } 
                  if (f_pwm == 45) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                  } 
                  if (f_pwm == 50) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                  } 
                  if (f_pwm == 55) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                  } 
                  if (f_pwm == 60) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                  } 
                  if (f_pwm == 65) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                    divpower13 = divpwgreen;
                  } 
                  if (f_pwm == 70) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                    divpower13 = divpwgreen;
                    divpower14 = divpwgreen;
                  } 
                  if (f_pwm == 75) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                    divpower13 = divpwgreen;
                    divpower14 = divpwgreen;
                    divpower15 = divpwgreen;
                  } 
                  if (f_pwm == 80) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                    divpower13 = divpwgreen;
                    divpower14 = divpwgreen;
                    divpower15 = divpwgreen;
                    divpower16 = divpwgreen;
                  } 
                  if (f_pwm == 85) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                    divpower13 = divpwgreen;
                    divpower14 = divpwgreen;
                    divpower15 = divpwgreen;
                    divpower16 = divpwgreen;
                    divpower17 = divpwgreen;
                  } 
                  if (f_pwm == 90) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                    divpower13 = divpwgreen;
                    divpower14 = divpwgreen;
                    divpower15 = divpwgreen;
                    divpower16 = divpwgreen;
                    divpower17 = divpwgreen;
                    divpower18 = divpwgreen;
                  } 
                  if (f_pwm == 95) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                    divpower13 = divpwgreen;
                    divpower14 = divpwgreen;
                    divpower15 = divpwgreen;
                    divpower16 = divpwgreen;
                    divpower17 = divpwgreen;
                    divpower18 = divpwgreen;
                    divpower19 = divpwgreen;
                  } 

                  if (f_pwm >= 96) {
                    divpower01 = divpwgreen;
                    divpower02 = divpwgreen;
                    divpower03 = divpwgreen;
                    divpower04 = divpwgreen;
                    divpower05 = divpwgreen;
                    divpower06 = divpwgreen;
                    divpower07 = divpwgreen;
                    divpower08 = divpwgreen;
                    divpower09 = divpwgreen;
                    divpower10 = divpwgreen;
                    divpower11 = divpwgreen;
                    divpower12 = divpwgreen;
                    divpower13 = divpwgreen;
                    divpower14 = divpwgreen;
                    divpower15 = divpwgreen;
                    divpower16 = divpwgreen;
                    divpower17 = divpwgreen;
                    divpower18 = divpwgreen;
                    divpower19 = divpwgreen;
                    divpower20 = divpwgreen;
                  }
                //---------------------------------------------------

                  if (p_fansavebit_txt == "<span class='Stil6'>FAN offline!</div>"){
                    changeFanValue(); 
                  }


              }else{
              //Serial.println("checksum not ok");
              gWerte3UpdateFlag = 2;
        
          } //crc


      }  //Serial1.available() > 0
    } //pausewebseite load
  } // pause Error FAN
#endif
  //------------------------------------------------------------------------------

  









}
//---  LOOP  ---
//-----------------------------------------------------






/*
  SerialEvent occurs whenever a new data comes in the hardware serial RX. This
  routine is run between each time loop() runs, so using delay inside loop can
  delay response. Multiple bytes of data may be available.
*/
/*
void serialEvent1() {
  while (Serial1.available()) {
    // get the new byte:
    char inChar = (char)Serial1.read();
    // add it to the inputString:
    inputString += inChar;
    // if the incoming character is a newline, set a flag so the main loop can
    // do something about it:
    Serial.println("..");
    if (inChar == '\n') {
      stringComplete = true;
    }
  }
}
*/


// string: string to parse
// c: delimiter
// returns number of items parsed
/*
int split(String string, char c)
{
  String data = "";
  int bufferIndex = 0;

  for (int i = 0; i < string.length(); ++i)
  {
    char c = string[i];
    
    if (c != '.')
    {
      data += c;
      //Serial.println(data); 
    }
    else
    {
      //data += '\0';
      //Serial.println("--"); 
      //Serial.println(data); 
      strings[bufferIndex++] = data;
      data = "";
    }
  }
  strings[bufferIndex++] = data;
  return bufferIndex;
}
*/
//****************************************************

